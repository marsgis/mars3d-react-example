/**
 * 该文件开源版本中 暂未开放源码，但可以免费无限制使用。
 * 【仅此1个文件是未开源的，接口见 widget.d.ts 】
 *
 * 如果需要完整代码，可以访问了解更多：http://mars3d.cn/details.html?id=jcxm-react
 *
 * 编译日期：2022-5-22
 * 版权所有：Copyright by 火星科技  http://mars3d.cn
 */
var __defProp=Object.defineProperty,__defProps=Object.defineProperties,__getOwnPropDescs=Object.getOwnPropertyDescriptors,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(e,t,r)=>t in e?__defProp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,__spreadValues=(e,t)=>{for(var r in t||(t={}))__hasOwnProp.call(t,r)&&__defNormalProp(e,r,t[r]);if(__getOwnPropSymbols)for(var r of __getOwnPropSymbols(t))__propIsEnum.call(t,r)&&__defNormalProp(e,r,t[r]);return e},__spreadProps=(e,t)=>__defProps(e,__getOwnPropDescs(t));!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react"),require("uuid"),require("redux"),require("react-redux")):"function"==typeof define&&define.amd?define(["exports","react","uuid","redux","react-redux"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).widget={},e.require$$0,e.uuid,e.redux,e.reactRedux)}(this,(function(e,t,r,a,s){"use strict";function i(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var o={exports:{}},d={},n=i(t).default,l=Symbol.for("react.element"),p=Symbol.for("react.fragment"),u=Object.prototype.hasOwnProperty,_=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function f(e,t,r){var a,s={},i=null,o=null;for(a in void 0!==r&&(i=""+r),void 0!==t.key&&(i=""+t.key),void 0!==t.ref&&(o=t.ref),t)u.call(t,a)&&!c.hasOwnProperty(a)&&(s[a]=t[a]);if(e&&e.defaultProps)for(a in t=e.defaultProps)void 0===s[a]&&(s[a]=t[a]);return{$$typeof:l,type:e,key:i,ref:o,props:s,_owner:_.current}}d.Fragment=p,d.jsx=f,d.jsxs=f,o.exports=d;const g=o.exports.jsx,b=o.exports.jsxs,w=o.exports.Fragment,m=e=>{let t={};return e.meta&&e.meta.props&&(t=__spreadValues(__spreadValues({},t),e.meta.props)),e.data&&e.data.props&&(t=__spreadValues(__spreadValues({},t),e.data.props)),t};let y=null;const v=e=>{y.dispatch({type:"disable",widget:e})},O=s.connect((e=>({widgets:e.widgets})))((e=>(console.log("数据更新"),g(w,{children:e.widgets.filter((e=>e.visible)).map((e=>{const r=e.component;return g(t.Suspense,{fallback:g("div",{}),children:g(r,__spreadProps(__spreadValues({},m(e)),{visible:e.visible,onClose:()=>v(e.name),currentWidget:e}))},e.key)}))}))));e.WidgetView=O,e.activate=(e,t=!0)=>{y.dispatch({type:"activate",widget:e,reload:t})},e.connectWidget=e=>s.connect((e=>({widgets:e.widgets})))(e),e.disable=v,e.disableAll=(e=!1)=>{y.dispatch({type:"disableAll",force:e})},e.generateWidgetView=e=>{if(!e)throw new Error("generateWidgetView参数不能为空");const t=__spreadValues({autoDisable:!0,disableOther:!1},e.defaultOption),i=e.openAtStart||[],o=e.widgets.map((e=>__spreadProps(__spreadValues(__spreadValues({visible:i.includes(e.name)},t),e),{meta:__spreadValues(__spreadValues({},t.meta),e.meta),key:r.v4()})));return y=a.createStore((function(e={widgets:o},t){switch(t.type){case"disable":{const r=e.widgets;let a=t.widget;return"string"==typeof a&&(a=[a]),{widgets:r.map((e=>(-1!==a.indexOf(e.name)&&(delete e.data,e.visible=!1),e)))}}case"activate":{const a=e.widgets,{widget:s,reload:i}=t,o="string"==typeof s?s:s.name,d=a.find((e=>e.name===o));return d?{widgets:a.map((e=>(e.name===o?(e.visible&&i&&(e.key=r.v4()),"object"==typeof s&&null!==s&&s.data&&(e.data=s.data),e.visible=!0):(d.group&&e.group===d.group&&(e.visible=!1),Array.isArray(d.disableOther)&&d.disableOther.includes(e.name)&&(e.visible=!1),!0===d.disableOther&&!0===e.autoDisable&&(e.visible=!1)),e)))}:(console.log("widget不存在",s),e)}case"disableAll":{const{force:r}=t;return{widgets:e.widgets.map((e=>(e.visible&&(r||e.autoDisable)&&(e.visible=!1),e)))}}case"update":{const{widget:r,data:a}=t;return{widgets:e.widgets.map((e=>-1!==r.indexOf(e.name)?__spreadProps(__spreadValues({},e),{data:a}):e))}}default:return e}})),({children:e})=>b(s.Provider,{store:y,children:[g(O,{}),e]})},e.isActive=e=>{const t=(y.getState().widgets||[]).find((t=>t.name===e));return t&&t.visible},e.updateWidget=(e,t)=>{y.dispatch({type:"update",widget:e,data:t})},Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
