/**
 * Mars3D平台插件,支持气象 风向图 功能插件  mars3d-wind
 *
 * 版本信息：v3.6.11
 * 编译日期：2023-11-04 00:01:15
 * 版权所有：Copyright by 火星科技  http://mars3d.cn
 * 使用单位：免费公开版 ，2023-03-17
 */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, (window.mars3d || require('mars3d'))) :
  typeof define === 'function' && define.amd ? define(['exports', 'mars3d'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global["mars3d-wind"] = {}, global.mars3d));
})(this, (function (exports, mars3d) { 
'use strict';const _0x18a09d=_0x4026;(function(_0x1bd453,_0x257997){const _0x439884=_0x4026,_0x2247f9=_0x1bd453();while(!![]){try{const _0xc42ef3=parseInt(_0x439884(0x185))/0x1+-parseInt(_0x439884(0xec))/0x2+-parseInt(_0x439884(0xf0))/0x3+parseInt(_0x439884(0x14d))/0x4+-parseInt(_0x439884(0x192))/0x5*(parseInt(_0x439884(0x15e))/0x6)+-parseInt(_0x439884(0x143))/0x7+-parseInt(_0x439884(0x158))/0x8*(-parseInt(_0x439884(0x114))/0x9);if(_0xc42ef3===_0x257997)break;else _0x2247f9['push'](_0x2247f9['shift']());}catch(_0x4c72fa){_0x2247f9['push'](_0x2247f9['shift']());}}}(_0xdb86,0x566cd));function _interopNamespace(_0x3a46ba){const _0x5d3709=_0x4026;if(_0x3a46ba&&_0x3a46ba[_0x5d3709(0x14f)])return _0x3a46ba;var _0x31161f=Object[_0x5d3709(0x198)](null);return _0x3a46ba&&Object['keys'](_0x3a46ba)['forEach'](function(_0x5c1d33){const _0x109952=_0x5d3709;if(_0x5c1d33!=='default'){var _0x4f6dcf=Object['getOwnPropertyDescriptor'](_0x3a46ba,_0x5c1d33);Object['defineProperty'](_0x31161f,_0x5c1d33,_0x4f6dcf[_0x109952(0x171)]?_0x4f6dcf:{'enumerable':!![],'get':function(){return _0x3a46ba[_0x5c1d33];}});}}),_0x31161f['default']=_0x3a46ba,_0x31161f;}var mars3d__namespace=_interopNamespace(mars3d);const Cesium$7=mars3d__namespace['Cesium'];function getU(_0x35eb82,_0x18ffb1){const _0x19c9cc=_0x4026,_0x3642f9=_0x35eb82*Math['cos'](Cesium$7[_0x19c9cc(0x177)]['toRadians'](_0x18ffb1));return _0x3642f9;}function getV(_0x5a4dee,_0x4990de){const _0x22c34c=_0x4026,_0x30c31b=_0x5a4dee*Math[_0x22c34c(0x13f)](Cesium$7['Math']['toRadians'](_0x4990de));return _0x30c31b;}function getSpeed(_0x59f790,_0x468356){const _0x1929b8=_0x4026,_0x303657=Math[_0x1929b8(0xc4)](Math[_0x1929b8(0x1a0)](_0x59f790,0x2)+Math['pow'](_0x468356,0x2));return _0x303657;}function getDirection(_0x1f1018,_0x273a18){let _0x63c068=Cesium$7['Math']['toDegrees'](Math['atan2'](_0x273a18,_0x1f1018));return _0x63c068+=_0x63c068<0x0?0x168:0x0,_0x63c068;}var WindUtil={'__proto__':null,'getU':getU,'getV':getV,'getSpeed':getSpeed,'getDirection':getDirection};const Cesium$6=mars3d__namespace['Cesium'];class CustomPrimitive{constructor(_0x1dc5c0){const _0x298f95=_0x4026;this[_0x298f95(0x118)]=_0x1dc5c0['commandType'],this[_0x298f95(0x112)]=_0x1dc5c0[_0x298f95(0x112)],this['attributeLocations']=_0x1dc5c0['attributeLocations'],this['primitiveType']=_0x1dc5c0['primitiveType'],this['uniformMap']=_0x1dc5c0['uniformMap'],this['vertexShaderSource']=_0x1dc5c0['vertexShaderSource'],this['fragmentShaderSource']=_0x1dc5c0['fragmentShaderSource'],this['rawRenderState']=_0x1dc5c0['rawRenderState'],this[_0x298f95(0xd8)]=_0x1dc5c0['framebuffer'],this['outputTexture']=_0x1dc5c0[_0x298f95(0x165)],this['autoClear']=_0x1dc5c0['autoClear']??![],this['preExecute']=_0x1dc5c0['preExecute'],this[_0x298f95(0x19e)]=!![],this[_0x298f95(0x173)]=undefined,this[_0x298f95(0xc9)]=undefined,this['autoClear']&&(this[_0x298f95(0xc9)]=new Cesium$6['ClearCommand']({'color':new Cesium$6['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':this[_0x298f95(0xd8)],'pass':Cesium$6['Pass']['OPAQUE']}));}[_0x18a09d(0x18f)](_0x4842df){const _0x403b13=_0x18a09d;switch(this['commandType']){case _0x403b13(0x154):{const _0x2fb25e=Cesium$6['VertexArray']['fromGeometry']({'context':_0x4842df,'geometry':this['geometry'],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6['BufferUsage']['STATIC_DRAW']}),_0x36160e=Cesium$6['ShaderProgram']['fromCache']({'context':_0x4842df,'attributeLocations':this['attributeLocations'],'vertexShaderSource':this['vertexShaderSource'],'fragmentShaderSource':this['fragmentShaderSource']}),_0x4fac69=Cesium$6['RenderState'][_0x403b13(0x178)](this['rawRenderState']);return new Cesium$6[(_0x403b13(0x106))]({'primitiveType':this['primitiveType'],'shaderProgram':_0x36160e,'vertexArray':_0x2fb25e,'modelMatrix':Cesium$6['Matrix4']['IDENTITY'],'renderState':_0x4fac69,'uniformMap':this['uniformMap'],'castShadows':![],'receiveShadows':![],'framebuffer':this['framebuffer'],'pass':Cesium$6['Pass']['OPAQUE'],'pickOnly':!![],'owner':this});}case'Compute':{return new Cesium$6['ComputeCommand']({'owner':this,'fragmentShaderSource':this['fragmentShaderSource'],'uniformMap':this['uniformMap'],'outputTexture':this['outputTexture'],'persists':!![]});}}}['setGeometry'](_0x5c3c2e,_0x551f2f){const _0x5f1256=_0x18a09d;this['geometry']=_0x551f2f;const _0x234bd6=Cesium$6['VertexArray']['fromGeometry']({'context':_0x5c3c2e,'geometry':this[_0x5f1256(0x112)],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6['BufferUsage']['STATIC_DRAW']});this['commandToExecute'][_0x5f1256(0xd1)]=_0x234bd6;}['update'](_0x4653ce){const _0x197a2b=_0x18a09d;if(!this['show'])return;if(_0x4653ce['mode']!==Cesium$6['SceneMode']['SCENE3D'])return;!Cesium$6['defined'](this[_0x197a2b(0x173)])&&(this[_0x197a2b(0x173)]=this['createCommand'](_0x4653ce[_0x197a2b(0x184)])),Cesium$6['defined'](this['preExecute'])&&this[_0x197a2b(0x19f)](),Cesium$6[_0x197a2b(0x17c)](this['clearCommand'])&&_0x4653ce[_0x197a2b(0x159)][_0x197a2b(0xe1)](this['clearCommand']),_0x4653ce[_0x197a2b(0x159)]['push'](this['commandToExecute']);}['isDestroyed'](){return![];}['destroy'](){const _0x5a4947=_0x18a09d;if(this[_0x5a4947(0xc9)]){var _0x2096ee,_0x2934af;(_0x2096ee=this[_0x5a4947(0xc9)])!==null&&_0x2096ee!==void 0x0&&_0x2096ee['vertexArray']&&this['clearCommand']['vertexArray']['destroy'](),(_0x2934af=this['clearCommand'])!==null&&_0x2934af!==void 0x0&&_0x2934af['shaderProgram']&&this[_0x5a4947(0xc9)]['shaderProgram']['destroy'](),delete this['clearCommand'];}return this[_0x5a4947(0x173)]&&(this['commandToExecute']['vertexArray']&&this['commandToExecute']['vertexArray']['destroy'](),this['commandToExecute']['shaderProgram']&&this['commandToExecute']['shaderProgram'][_0x5a4947(0x19b)](),delete this['commandToExecute']),Cesium$6['destroyObject'](this);}}const Cesium$5=mars3d__namespace['Cesium'],Util=(function(){const _0x3137b8=function(){const _0x63aa77=_0x4026,_0x2aef7d=new Cesium$5['Geometry']({'attributes':new Cesium$5[(_0x63aa77(0x199))]({'position':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x3,'values':new Float32Array([-0x1,-0x1,0x0,0x1,-0x1,0x0,0x1,0x1,0x0,-0x1,0x1,0x0])}),'st':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x2,'values':new Float32Array([0x0,0x0,0x1,0x0,0x1,0x1,0x0,0x1])})}),'indices':new Uint32Array([0x3,0x2,0x0,0x0,0x2,0x1])});return _0x2aef7d;},_0x3534e7=function(_0x253e75,_0x562d8e){const _0x5164ba=_0x4026;if(Cesium$5['defined'](_0x562d8e)){const _0x90e09a={};_0x90e09a[_0x5164ba(0xc0)]=_0x562d8e,_0x253e75[_0x5164ba(0x109)]=_0x90e09a;}const _0x3c50be=new Cesium$5['Texture'](_0x253e75);return _0x3c50be;},_0x5179b5=function(_0x46c6b5,_0x133d1b,_0x37a3a7){const _0x349fb6=new Cesium$5['Framebuffer']({'context':_0x46c6b5,'colorTextures':[_0x133d1b],'depthTexture':_0x37a3a7});return _0x349fb6;},_0xc6e285=function(_0x5ef69d){const _0x37f282=_0x4026,_0x221e3a=!![],_0x18a989=![],_0x3b5909={'viewport':_0x5ef69d['viewport'],'depthTest':_0x5ef69d['depthTest'],'depthMask':_0x5ef69d['depthMask'],'blending':_0x5ef69d[_0x37f282(0x15c)]},_0x4893c8=Cesium$5['Appearance'][_0x37f282(0x13e)](_0x221e3a,_0x18a989,_0x3b5909);return _0x4893c8;},_0x1d0e15=function(_0xb15444){const _0x54258a=_0x4026,_0x1ed6fd={},_0x4c2aef=Cesium$5[_0x54258a(0x177)]['mod'](_0xb15444['west'],Cesium$5['Math']['TWO_PI']),_0x18332c=Cesium$5['Math'][_0x54258a(0xd7)](_0xb15444['east'],Cesium$5['Math']['TWO_PI']),_0xae641f=_0xb15444[_0x54258a(0xc2)];let _0x1390ce,_0x53e177;_0xae641f>Cesium$5['Math'][_0x54258a(0x149)]?(_0x1390ce=0x0,_0x53e177=Cesium$5['Math'][_0x54258a(0x16d)]):_0x18332c-_0x4c2aef<_0xae641f?(_0x1390ce=_0x4c2aef,_0x53e177=_0x4c2aef+_0xae641f):(_0x1390ce=_0x4c2aef,_0x53e177=_0x18332c);_0x1ed6fd[_0x54258a(0x176)]={'min':Cesium$5['Math']['toDegrees'](_0x1390ce),'max':Cesium$5['Math']['toDegrees'](_0x53e177)};const _0x2c539b=_0xb15444['south'],_0x2b6740=_0xb15444['north'],_0x287458=_0xb15444['height'],_0x210a54=_0x287458>Cesium$5['Math']['PI']/0xc?_0x287458/0x2:0x0;let _0x4fa62e=Cesium$5['Math']['clampToLatitudeRange'](_0x2c539b-_0x210a54),_0x49c6ee=Cesium$5['Math']['clampToLatitudeRange'](_0x2b6740+_0x210a54);return _0x4fa62e<-Cesium$5['Math']['PI_OVER_THREE']&&(_0x4fa62e=-Cesium$5['Math']['PI_OVER_TWO']),_0x49c6ee>Cesium$5['Math']['PI_OVER_THREE']&&(_0x49c6ee=Cesium$5['Math']['PI_OVER_TWO']),_0x1ed6fd['lat']={'min':Cesium$5['Math']['toDegrees'](_0x4fa62e),'max':Cesium$5['Math'][_0x54258a(0x186)](_0x49c6ee)},_0x1ed6fd;};return{'getFullscreenQuad':_0x3137b8,'createTexture':_0x3534e7,'createFramebuffer':_0x5179b5,'createRawRenderState':_0xc6e285,'viewRectangleToLonLatRange':_0x1d0e15};}());var segmentDraw_vert='in\x20vec2\x20st;\x0a//\x20it\x20is\x20not\x20normal\x20itself,\x20but\x20used\x20to\x20control\x20normal\x0ain\x20vec3\x20normal;\x20//\x20(point\x20to\x20use,\x20offset\x20sign,\x20not\x20used\x20component)\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x0auniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20postProcessingSpeed;\x0a\x0auniform\x20float\x20particleHeight;\x0a\x0auniform\x20float\x20aspect;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20lineWidth;\x0a\x0aout\x20float\x20speedNormalization;\x0a\x0avec3\x20convertCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20WGS84\x20(lon,\x20lat,\x20lev)\x20->\x20ECEF\x20(x,\x20y,\x20z)\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_conversion#From_geodetic_to_ECEF_coordinates\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20WGS\x2084\x20geometric\x20constants\x0a\x20\x20\x20\x20float\x20a\x20=\x206378137.0;\x20//\x20Semi-major\x20axis\x0a\x20\x20\x20\x20float\x20b\x20=\x206356752.3142;\x20//\x20Semi-minor\x20axis\x0a\x20\x20\x20\x20float\x20e2\x20=\x206.69437999014e-3;\x20//\x20First\x20eccentricity\x20squared\x0a\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x20\x20\x20\x20float\x20longitude\x20=\x20radians(lonLatLev.x);\x0a\x0a\x20\x20\x20\x20float\x20cosLat\x20=\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20sinLat\x20=\x20sin(latitude);\x0a\x20\x20\x20\x20float\x20cosLon\x20=\x20cos(longitude);\x0a\x20\x20\x20\x20float\x20sinLon\x20=\x20sin(longitude);\x0a\x0a\x20\x20\x20\x20float\x20N_Phi\x20=\x20a\x20/\x20sqrt(1.0\x20-\x20e2\x20*\x20sinLat\x20*\x20sinLat);\x0a\x20\x20\x20\x20float\x20h\x20=\x20particleHeight;\x20//\x20it\x20should\x20be\x20high\x20enough\x20otherwise\x20the\x20particle\x20may\x20not\x20pass\x20the\x20terrain\x20depth\x20test\x0a\x0a\x20\x20\x20\x20vec3\x20cartesian\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20cartesian.x\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20cosLon;\x0a\x20\x20\x20\x20cartesian.y\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20sinLon;\x0a\x20\x20\x20\x20cartesian.z\x20=\x20((b\x20*\x20b)\x20/\x20(a\x20*\x20a)\x20*\x20N_Phi\x20+\x20h)\x20*\x20sinLat;\x0a\x20\x20\x20\x20return\x20cartesian;\x0a}\x0a\x0avec4\x20calcProjectedCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20the\x20range\x20of\x20longitude\x20in\x20Cesium\x20is\x20[-180,\x20180]\x20but\x20the\x20range\x20of\x20longitude\x20in\x20the\x20NetCDF\x20file\x20is\x20[0,\x20360]\x0a\x20\x20\x20\x20//\x20[0,\x20180]\x20is\x20corresponding\x20to\x20[0,\x20180]\x20and\x20[180,\x20360]\x20is\x20corresponding\x20to\x20[-180,\x200]\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x\x20+\x20180.0,\x20360.0)\x20-\x20180.0;\x0a\x20\x20\x20\x20vec3\x20particlePosition\x20=\x20convertCoordinate(lonLatLev);\x0a\x20\x20\x20\x20vec4\x20projectedCoordinate\x20=\x20czm_modelViewProjection\x20*\x20vec4(particlePosition,\x201.0);\x0a\x20\x20\x20\x20return\x20projectedCoordinate;\x0a}\x0a\x0avec4\x20calcOffset(vec4\x20currentProjectedCoordinate,\x20vec4\x20nextProjectedCoordinate,\x20float\x20offsetSign)\x20{\x0a\x20\x20\x20\x20vec2\x20aspectVec2\x20=\x20vec2(aspect,\x201.0);\x0a\x20\x20\x20\x20vec2\x20currentXY\x20=\x20(currentProjectedCoordinate.xy\x20/\x20currentProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x20\x20\x20\x20vec2\x20nextXY\x20=\x20(nextProjectedCoordinate.xy\x20/\x20nextProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x0a\x20\x20\x20\x20float\x20offsetLength\x20=\x20lineWidth\x20/\x202.0;\x0a\x20\x20\x20\x20vec2\x20direction\x20=\x20normalize(nextXY\x20-\x20currentXY);\x0a\x20\x20\x20\x20vec2\x20normalVector\x20=\x20vec2(-direction.y,\x20direction.x);\x0a\x20\x20\x20\x20normalVector.x\x20=\x20normalVector.x\x20/\x20aspect;\x0a\x20\x20\x20\x20normalVector\x20=\x20offsetLength\x20*\x20normalVector;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20vec4(offsetSign\x20*\x20normalVector,\x200.0,\x200.0);\x0a\x20\x20\x20\x20return\x20offset;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec2\x20particleIndex\x20=\x20st;\x0a\x0a\x20\x20\x20\x20vec3\x20currentPosition\x20=\x20texture(currentParticlesPosition,\x20particleIndex).rgb;\x0a\x20\x20\x20\x20vec4\x20nextPosition\x20=\x20texture(postProcessingPosition,\x20particleIndex);\x0a\x0a\x20\x20\x20\x20vec4\x20currentProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20vec4\x20nextProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(nextPosition.w\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(nextPosition.xyz);\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20float\x20pointToUse\x20=\x20normal.x;\x20//\x20-1\x20is\x20currentProjectedCoordinate\x20and\x20+1\x20is\x20nextProjectedCoordinate\x0a\x20\x20\x20\x20float\x20offsetSign\x20=\x20normal.y;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20pixelSize\x20*\x20calcOffset(currentProjectedCoordinate,\x20nextProjectedCoordinate,\x20offsetSign);\x0a\x20\x20\x20\x20if\x20(pointToUse\x20<\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20currentProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20nextProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20speedNormalization\x20=\x20texture(postProcessingSpeed,\x20particleIndex).a;\x0a}\x0a',segmentDraw_frag='uniform\x20sampler2D\x20colorTable;\x0a\x0ain\x20float\x20speedNormalization;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20out_FragColor\x20=\x20texture(colorTable,\x20vec2(speedNormalization,\x200.0));\x0a}\x0a',fullscreen_vert=_0x18a09d(0x189),trailDraw_frag='uniform\x20sampler2D\x20segmentsColorTexture;\x0auniform\x20sampler2D\x20segmentsDepthTexture;\x0a\x0auniform\x20sampler2D\x20currentTrailsColor;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0auniform\x20float\x20fadeOpacity;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20pointsColor\x20=\x20texture(segmentsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(currentTrailsColor,\x20textureCoordinate);\x0a\x0a\x20\x20\x20\x20trailsColor\x20=\x20floor(fadeOpacity\x20*\x20255.0\x20*\x20trailsColor)\x20/\x20255.0;\x20//\x20make\x20sure\x20the\x20trailsColor\x20will\x20be\x20strictly\x20decreased\x0a\x0a\x20\x20\x20\x20float\x20pointsDepth\x20=\x20texture(segmentsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(pointsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20pointsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20trailsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20gl_FragDepth\x20=\x20min(pointsDepth,\x20trailsDepth);\x0a}\x0a',screenDraw_frag='uniform\x20sampler2D\x20trailsColorTexture;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(trailsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20trailsColor;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$4=mars3d__namespace['Cesium'];function _0xdb86(){const _0x32bcc9=['visibility','outputTexture','canvas','Cartesian2','Compute','globeBoundingSphere','layer','viewerParameters','BoundingSphere','TWO_PI','tlat','createWindTextures','SCENE3D','get','createSegmentsGeometry','commandToExecute','drawingBufferWidth','beginPath','lon','Math','fromCache','SceneTransforms','log','particles','defined','PrimitiveType','_canrefresh','setOptions','createRenderingPrimitives','maxAge','mouseMove','style','context','248946TxVYNC','toDegrees','colorTable','_onMap_preRenderEvent','in\x20vec3\x20position;\x0ain\x20vec2\x20st;\x0a\x0aout\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20textureCoordinate\x20=\x20st;\x0a\x20\x20\x20\x20gl_Position\x20=\x20vec4(position,\x201.0);\x0a}\x0a','color','lev','getPixelSize','lng','mouse_down','createCommand','_onMapWhellEvent','createComputingPrimitives','3169115rYATnB','umax','mouse_move','_setOptionsHook','particlesTextureSize','particlesRendering','create','GeometryAttributes','setDate','destroy','nextParticlesSpeed','_onMouseUpEvent','show','preExecute','pow','options','framebuffers','_addedHook','add','_onMouseMoveEvent','xmin','windTextures','speed','arrayBufferView','animateFrame','width','ceil','sqrt','preRender','addPrimitives','nextParticlesPosition','updateSpeed','clearCommand','red','unbindEvent','Cesium','udata','frameTime','_calc_speedRate','refreshParticles','vertexArray','removeChild','SceneMode','redraw','segmentsDepth','_map','mod','framebuffer','UNSIGNED_INT','OPAQUE','canvasContext','FLOAT','getUVByXY','min','mouseUp','getWind','push','currentTrailsDepth','dimensions','now','fixedHeight','_bilinearInterpolation','removeEventListener','getParticles','wheel','getColorTexture','ymax','56276wmrmzw','Cartesian3','DISABLE_LOG_DEPTH_FRAGMENT_WRITE','bind','1550952BCstlf','speedRate','clear','hidden','Geometry','cols','cancelAnimationFrame','_drawLines','addEventListener','windData','clientHeight','Sampler','isInExtent','createRenderingTextures','Color','randomBetween','ShaderSource','postProcessingSpeed','drawingBufferHeight','CanvasWindLayer','particlesTextures','resize','DrawCommand','uniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20lengthOfLonLat(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20unit\x20conversion:\x20meters\x20->\x20longitude\x20latitude\x20degrees\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_system#Length_of_a_degree\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20Calculate\x20the\x20length\x20of\x20a\x20degree\x20of\x20latitude\x20and\x20longitude\x20in\x20meters\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x0a\x20\x20\x20\x20float\x20term1\x20=\x20111132.92;\x0a\x20\x20\x20\x20float\x20term2\x20=\x20559.82\x20*\x20cos(2.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term3\x20=\x201.175\x20*\x20cos(4.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term4\x20=\x200.0023\x20*\x20cos(6.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20latLength\x20=\x20term1\x20-\x20term2\x20+\x20term3\x20-\x20term4;\x0a\x0a\x20\x20\x20\x20float\x20term5\x20=\x20111412.84\x20*\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20term6\x20=\x2093.5\x20*\x20cos(3.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term7\x20=\x200.118\x20*\x20cos(5.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20longLength\x20=\x20term5\x20-\x20term6\x20+\x20term7;\x0a\x0a\x20\x20\x20\x20return\x20vec2(longLength,\x20latLength);\x0a}\x0a\x0avoid\x20updatePosition(vec3\x20lonLatLev,\x20vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec2\x20lonLatLength\x20=\x20lengthOfLonLat(lonLatLev);\x0a\x20\x20\x20\x20float\x20u\x20=\x20speed.x\x20/\x20lonLatLength.x;\x0a\x20\x20\x20\x20float\x20v\x20=\x20speed.y\x20/\x20lonLatLength.y;\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20vec3\x20windVectorInLonLatLev\x20=\x20vec3(u,\x20v,\x20w);\x0a\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20lonLatLev\x20+\x20windVectorInLonLatLev;\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20speed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20updatePosition(lonLatLev,\x20speed);\x0a}\x0a','lat','source','reverseY','particleSystem','ymin','_pointerEvents','xmax','TRIANGLES','_colorRamp','bindEvent','geometry','setData','9RWoGaP','postProcessingPosition','none','EventType','commandType','colors','rows','DomUtil','trails','_onMouseDownEvent','off','update','vdata','keys','grid','ClearCommand','ComponentDatatype','clientWidth','stroke','particlesComputing','createTexture','0px','RGB','scene','forEach','currentParticlesSpeed','_speedRate','updatePosition','max','PixelDatatype','createRawRenderState','height','particlesNumber','NEAREST','tlng','canvasWidth','length','_tomap','textures','depthTexture','segments','worker','getDefaultRenderState','sin','_calcUV','vmin','lonRange','2225286KqWbEF','particlesWind','destroyParticlesTextures','camera','_updateIng','pointer-events','THREE_PI_OVER_TWO','mouseDown','array','pointerEvents','691972TRSIKr','reverse','__esModule','primitives','maxParticles','auto','_removedHook','Draw','BaseLayer','ColorRamp','mouseHidden','11431208EHvxSE','commandList','ellipsoid','lineWidth','blending','strokeStyle','6FgGAiH','UNSIGNED_BYTE','windField','data','mode','random'];_0xdb86=function(){return _0x32bcc9;};return _0xdb86();}class ParticlesRendering{constructor(_0xb94515,_0x44c460,_0x1b069d,_0x32c6e7,_0x1367da){const _0x2fc65f=_0x18a09d;this[_0x2fc65f(0xfd)](_0xb94515,_0x44c460,_0x1b069d['colors']),this['createRenderingFramebuffers'](_0xb94515),this['createRenderingPrimitives'](_0xb94515,_0x1b069d,_0x32c6e7,_0x1367da);}['createRenderingTextures'](_0x455c80,_0x48d344,_0x58750a){const _0x3c3e5c=_0x18a09d,_0x44a2f7={'context':_0x455c80,'width':_0x455c80['drawingBufferWidth'],'height':_0x455c80[_0x3c3e5c(0x102)],'pixelFormat':Cesium$4['PixelFormat']['RGBA'],'pixelDatatype':Cesium$4['PixelDatatype'][_0x3c3e5c(0x15f)]},_0x10d357={'context':_0x455c80,'width':_0x455c80[_0x3c3e5c(0x174)],'height':_0x455c80['drawingBufferHeight'],'pixelFormat':Cesium$4['PixelFormat']['DEPTH_COMPONENT'],'pixelDatatype':Cesium$4['PixelDatatype'][_0x3c3e5c(0xd9)]},_0x4afd33=_0x58750a['length'],_0xced042=new Float32Array(_0x4afd33*0x3);for(let _0x4fea9d=0x0;_0x4fea9d<_0x4afd33;_0x4fea9d++){const _0x476f3e=Cesium$4['Color']['fromCssColorString'](_0x58750a[_0x4fea9d]);_0xced042[0x3*_0x4fea9d]=_0x476f3e[_0x3c3e5c(0xca)],_0xced042[0x3*_0x4fea9d+0x1]=_0x476f3e['green'],_0xced042[0x3*_0x4fea9d+0x2]=_0x476f3e['blue'];}const _0x1e072b={'context':_0x455c80,'width':_0x4afd33,'height':0x1,'pixelFormat':Cesium$4['PixelFormat'][_0x3c3e5c(0x12a)],'pixelDatatype':Cesium$4['PixelDatatype']['FLOAT'],'sampler':new Cesium$4['Sampler']({'minificationFilter':Cesium$4['TextureMinificationFilter']['LINEAR'],'magnificationFilter':Cesium$4['TextureMagnificationFilter']['LINEAR']})};this[_0x3c3e5c(0x13a)]={'segmentsColor':Util[_0x3c3e5c(0x128)](_0x44a2f7),'segmentsDepth':Util['createTexture'](_0x10d357),'currentTrailsColor':Util['createTexture'](_0x44a2f7),'currentTrailsDepth':Util[_0x3c3e5c(0x128)](_0x10d357),'nextTrailsColor':Util['createTexture'](_0x44a2f7),'nextTrailsDepth':Util['createTexture'](_0x10d357),'colorTable':Util['createTexture'](_0x1e072b,_0xced042)};}['createRenderingFramebuffers'](_0x75682e){const _0x1fa94e=_0x18a09d;this[_0x1fa94e(0x1a2)]={'segments':Util['createFramebuffer'](_0x75682e,this['textures']['segmentsColor'],this['textures']['segmentsDepth']),'currentTrails':Util['createFramebuffer'](_0x75682e,this['textures']['currentTrailsColor'],this['textures'][_0x1fa94e(0xe2)]),'nextTrails':Util['createFramebuffer'](_0x75682e,this['textures']['nextTrailsColor'],this['textures']['nextTrailsDepth'])};}['createSegmentsGeometry'](_0x25c3be){const _0x3e4d4c=_0x18a09d,_0x1def50=0x4;let _0x464396=[];for(let _0x15f682=0x0;_0x15f682<_0x25c3be['particlesTextureSize'];_0x15f682++){for(let _0x3e2c5e=0x0;_0x3e2c5e<_0x25c3be[_0x3e4d4c(0x196)];_0x3e2c5e++){for(let _0x23aa9b=0x0;_0x23aa9b<_0x1def50;_0x23aa9b++){_0x464396['push'](_0x15f682/_0x25c3be[_0x3e4d4c(0x196)]),_0x464396[_0x3e4d4c(0xe1)](_0x3e2c5e/_0x25c3be['particlesTextureSize']);}}}_0x464396=new Float32Array(_0x464396);let _0x4bc447=[];const _0x4194ef=[-0x1,0x1],_0x26a79a=[-0x1,0x1];for(let _0x399248=0x0;_0x399248<_0x25c3be['maxParticles'];_0x399248++){for(let _0x2494a6=0x0;_0x2494a6<_0x1def50/0x2;_0x2494a6++){for(let _0x2c7236=0x0;_0x2c7236<_0x1def50/0x2;_0x2c7236++){_0x4bc447['push'](_0x4194ef[_0x2494a6]),_0x4bc447['push'](_0x26a79a[_0x2c7236]),_0x4bc447['push'](0x0);}}}_0x4bc447=new Float32Array(_0x4bc447);const _0x411506=0x6*_0x25c3be['maxParticles'],_0x19f605=new Uint32Array(_0x411506);for(let _0x19409e=0x0,_0x1dc43e=0x0,_0x41b1a6=0x0;_0x19409e<_0x25c3be['maxParticles'];_0x19409e++){_0x19f605[_0x1dc43e++]=_0x41b1a6+0x0,_0x19f605[_0x1dc43e++]=_0x41b1a6+0x1,_0x19f605[_0x1dc43e++]=_0x41b1a6+0x2,_0x19f605[_0x1dc43e++]=_0x41b1a6+0x2,_0x19f605[_0x1dc43e++]=_0x41b1a6+0x1,_0x19f605[_0x1dc43e++]=_0x41b1a6+0x3,_0x41b1a6+=0x4;}const _0x4bd6bb=new Cesium$4[(_0x3e4d4c(0xf4))]({'attributes':new Cesium$4[(_0x3e4d4c(0x199))]({'st':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x2,'values':_0x464396}),'normal':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4[_0x3e4d4c(0x124)]['FLOAT'],'componentsPerAttribute':0x3,'values':_0x4bc447})}),'indices':_0x19f605});return _0x4bd6bb;}[_0x18a09d(0x180)](_0x4a5d4f,_0x2604d1,_0x2e6414,_0x1dd7b9){const _0x387bf4=_0x18a09d,_0x536b93=this;this['primitives']={'segments':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'st':0x0,'normal':0x1},'geometry':this[_0x387bf4(0x172)](_0x2604d1),'primitiveType':Cesium$4['PrimitiveType'][_0x387bf4(0x10f)],'uniformMap':{'currentParticlesPosition':function(){return _0x1dd7b9['particlesTextures']['currentParticlesPosition'];},'postProcessingPosition':function(){return _0x1dd7b9['particlesTextures']['postProcessingPosition'];},'postProcessingSpeed':function(){return _0x1dd7b9['particlesTextures']['postProcessingSpeed'];},'colorTable':function(){const _0x46bf48=_0x387bf4;return _0x536b93['textures'][_0x46bf48(0x187)];},'aspect':function(){const _0x10a67e=_0x387bf4;return _0x4a5d4f[_0x10a67e(0x174)]/_0x4a5d4f['drawingBufferHeight'];},'pixelSize':function(){return _0x2e6414['pixelSize'];},'lineWidth':function(){const _0x333b27=_0x387bf4;return _0x2604d1[_0x333b27(0x15b)];},'particleHeight':function(){return _0x2604d1['particleHeight'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![]},'depthMask':!![]}),'framebuffer':this['framebuffers']['segments'],'autoClear':!![]}),'trails':new CustomPrimitive({'commandType':_0x387bf4(0x154),'attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'segmentsColorTexture':function(){return _0x536b93['textures']['segmentsColor'];},'segmentsDepthTexture':function(){const _0x44b1fb=_0x387bf4;return _0x536b93['textures'][_0x44b1fb(0xd5)];},'currentTrailsColor':function(){const _0x3b9850=_0x387bf4;return _0x536b93[_0x3b9850(0x1a2)]['currentTrails'][_0x3b9850(0xea)](0x0);},'trailsDepthTexture':function(){return _0x536b93['framebuffers']['currentTrails']['depthTexture'];},'fadeOpacity':function(){return _0x2604d1['fadeOpacity'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':[_0x387bf4(0xee)],'sources':[trailDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![],'func':Cesium$4['DepthFunction']['ALWAYS']},'depthMask':!![]}),'framebuffer':this['framebuffers']['nextTrails'],'autoClear':!![],'preExecute':function(){const _0x5912d2=_0x387bf4,_0x459d47=_0x536b93['framebuffers']['currentTrails'];_0x536b93[_0x5912d2(0x1a2)]['currentTrails']=_0x536b93['framebuffers']['nextTrails'],_0x536b93['framebuffers']['nextTrails']=_0x459d47,_0x536b93['primitives'][_0x5912d2(0x11c)][_0x5912d2(0x173)]['framebuffer']=_0x536b93['framebuffers']['nextTrails'],_0x536b93['primitives'][_0x5912d2(0x11c)]['clearCommand']['framebuffer']=_0x536b93['framebuffers']['nextTrails'];}}),'screen':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4[_0x387bf4(0x17d)]['TRIANGLES'],'uniformMap':{'trailsColorTexture':function(){const _0x55dc7e=_0x387bf4;return _0x536b93[_0x55dc7e(0x1a2)]['nextTrails']['getColorTexture'](0x0);},'trailsDepthTexture':function(){const _0x5b0da8=_0x387bf4;return _0x536b93['framebuffers']['nextTrails'][_0x5b0da8(0x13b)];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[screenDraw_frag]}),'rawRenderState':Util[_0x387bf4(0x132)]({'viewport':undefined,'depthTest':{'enabled':![]},'depthMask':!![],'blending':{'enabled':!![]}}),'framebuffer':undefined})};}}var getWind_frag='//\x20the\x20size\x20of\x20UV\x20textures:\x20width\x20=\x20lon,\x20height\x20=\x20lat*lev\x0auniform\x20sampler2D\x20U;\x20//\x20eastward\x20wind\x0auniform\x20sampler2D\x20V;\x20//\x20northward\x20wind\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0a\x0auniform\x20vec3\x20dimension;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20vec3\x20minimum;\x20//\x20minimum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20maximum;\x20//\x20maximum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20interval;\x20//\x20interval\x20of\x20each\x20dimension\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20mapPositionToNormalizedIndex2D(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20range\x20of\x20longitude\x20and\x20latitude\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x,\x20360.0);\x0a\x20\x20\x20\x20lonLatLev.y\x20=\x20clamp(lonLatLev.y,\x20-90.0,\x2090.0);\x0a\x0a\x20\x20\x20\x20vec3\x20index3D\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20index3D.x\x20=\x20(lonLatLev.x\x20-\x20minimum.x)\x20/\x20interval.x;\x0a\x20\x20\x20\x20index3D.y\x20=\x20(lonLatLev.y\x20-\x20minimum.y)\x20/\x20interval.y;\x0a\x20\x20\x20\x20index3D.z\x20=\x20(lonLatLev.z\x20-\x20minimum.z)\x20/\x20interval.z;\x0a\x0a\x20\x20\x20\x20//\x20the\x20st\x20texture\x20coordinate\x20corresponding\x20to\x20(col,\x20row)\x20index\x0a\x20\x20\x20\x20//\x20example\x0a\x20\x20\x20\x20//\x20data\x20array\x20is\x20[0,\x201,\x202,\x203,\x204,\x205],\x20width\x20=\x203,\x20height\x20=\x202\x0a\x20\x20\x20\x20//\x20the\x20content\x20of\x20texture\x20will\x20be\x0a\x20\x20\x20\x20//\x20t\x201.0\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x203\x204\x205\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x200\x201\x202\x0a\x20\x20\x20\x20//\x20\x20\x200.0------1.0\x20s\x0a\x0a\x20\x20\x20\x20vec2\x20index2D\x20=\x20vec2(index3D.x,\x20index3D.z\x20*\x20dimension.y\x20+\x20index3D.y);\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20vec2(index2D.x\x20/\x20dimension.x,\x20index2D.y\x20/\x20(dimension.y\x20*\x20dimension.z));\x0a\x20\x20\x20\x20return\x20normalizedIndex2D;\x0a}\x0a\x0afloat\x20getWind(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20mapPositionToNormalizedIndex2D(lonLatLev);\x0a\x20\x20\x20\x20float\x20result\x20=\x20texture(windTexture,\x20normalizedIndex2D).r;\x0a\x20\x20\x20\x20return\x20result;\x0a}\x0a\x0aconst\x20mat4\x20kernelMatrix\x20=\x20mat4(\x0a\x20\x20\x20\x200.0,\x20-1.0,\x202.0,\x20-1.0,\x20//\x20first\x20column\x0a\x20\x20\x20\x202.0,\x200.0,\x20-5.0,\x203.0,\x20//\x20second\x20column\x0a\x20\x20\x20\x200.0,\x201.0,\x204.0,\x20-3.0,\x20//\x20third\x20column\x0a\x20\x20\x20\x200.0,\x200.0,\x20-1.0,\x201.0\x20//\x20fourth\x20column\x0a);\x0afloat\x20oneDimensionInterpolation(float\x20t,\x20float\x20p0,\x20float\x20p1,\x20float\x20p2,\x20float\x20p3)\x20{\x0a\x20\x20\x20\x20vec4\x20tVec4\x20=\x20vec4(1.0,\x20t,\x20t\x20*\x20t,\x20t\x20*\x20t\x20*\x20t);\x0a\x20\x20\x20\x20tVec4\x20=\x20tVec4\x20/\x202.0;\x0a\x20\x20\x20\x20vec4\x20pVec4\x20=\x20vec4(p0,\x20p1,\x20p2,\x20p3);\x0a\x20\x20\x20\x20return\x20dot((tVec4\x20*\x20kernelMatrix),\x20pVec4);\x0a}\x0a\x0afloat\x20calculateB(sampler2D\x20windTexture,\x20float\x20t,\x20float\x20lon,\x20float\x20lat,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20float\x20lon0\x20=\x20floor(lon)\x20-\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon1\x20=\x20floor(lon);\x0a\x20\x20\x20\x20float\x20lon2\x20=\x20floor(lon)\x20+\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon3\x20=\x20floor(lon)\x20+\x202.0\x20*\x20interval.x;\x0a\x0a\x20\x20\x20\x20float\x20p0\x20=\x20getWind(windTexture,\x20vec3(lon0,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p1\x20=\x20getWind(windTexture,\x20vec3(lon1,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p2\x20=\x20getWind(windTexture,\x20vec3(lon2,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p3\x20=\x20getWind(windTexture,\x20vec3(lon3,\x20lat,\x20lev));\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(t,\x20p0,\x20p1,\x20p2,\x20p3);\x0a}\x0a\x0afloat\x20interpolateOneTexture(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20float\x20lon\x20=\x20lonLatLev.x;\x0a\x20\x20\x20\x20float\x20lat\x20=\x20lonLatLev.y;\x0a\x20\x20\x20\x20float\x20lev\x20=\x20lonLatLev.z;\x0a\x0a\x20\x20\x20\x20float\x20lat0\x20=\x20floor(lat)\x20-\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat1\x20=\x20floor(lat);\x0a\x20\x20\x20\x20float\x20lat2\x20=\x20floor(lat)\x20+\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat3\x20=\x20floor(lat)\x20+\x202.0\x20*\x20interval.y;\x0a\x0a\x20\x20\x20\x20vec2\x20coefficient\x20=\x20lonLatLev.xy\x20-\x20floor(lonLatLev.xy);\x0a\x20\x20\x20\x20float\x20b0\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat0,\x20lev);\x0a\x20\x20\x20\x20float\x20b1\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat1,\x20lev);\x0a\x20\x20\x20\x20float\x20b2\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat2,\x20lev);\x0a\x20\x20\x20\x20float\x20b3\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat3,\x20lev);\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(coefficient.y,\x20b0,\x20b1,\x20b2,\x20b3);\x0a}\x0a\x0avec3\x20bicubic(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20https://en.wikipedia.org/wiki/Bicubic_interpolation#Bicubic_convolution_algorithm\x0a\x20\x20\x20\x20float\x20u\x20=\x20interpolateOneTexture(U,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20v\x20=\x20interpolateOneTexture(V,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20return\x20vec3(u,\x20v,\x20w);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20bicubic(lonLatLev);\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(windVector,\x200.0);\x0a}\x0a',updateSpeed_frag='uniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0auniform\x20sampler2D\x20particlesWind;\x0a\x0a//\x20used\x20to\x20calculate\x20the\x20wind\x20norm\x0auniform\x20vec2\x20uSpeedRange;\x20//\x20(min,\x20max);\x0auniform\x20vec2\x20vSpeedRange;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20speedFactor;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0afloat\x20calculateWindNorm(vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec3\x20percent\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20percent.x\x20=\x20(speed.x\x20-\x20uSpeedRange.x)\x20/\x20(uSpeedRange.y\x20-\x20uSpeedRange.x);\x0a\x20\x20\x20\x20percent.y\x20=\x20(speed.y\x20-\x20vSpeedRange.x)\x20/\x20(vSpeedRange.y\x20-\x20vSpeedRange.x);\x0a\x20\x20\x20\x20float\x20normalization\x20=\x20length(percent);\x0a\x0a\x20\x20\x20\x20return\x20normalization;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20//\x20vec3\x20currentSpeed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20texture(particlesWind,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20vec4(speedFactor\x20*\x20pixelSize\x20*\x20windVector,\x20calculateWindNorm(windVector));\x0a\x20\x20\x20\x20out_FragColor\x20=\x20nextSpeed;\x0a}\x0a',updatePosition_frag=_0x18a09d(0x107),postProcessingPosition_frag='uniform\x20sampler2D\x20nextParticlesPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0a//\x20range\x20(min,\x20max)\x0auniform\x20vec2\x20lonRange;\x0auniform\x20vec2\x20latRange;\x0a\x0auniform\x20float\x20randomCoefficient;\x20//\x20use\x20to\x20improve\x20the\x20pseudo-random\x20generator\x0auniform\x20float\x20dropRate;\x20//\x20drop\x20rate\x20is\x20a\x20chance\x20a\x20particle\x20will\x20restart\x20at\x20random\x20position\x20to\x20avoid\x20degeneration\x0auniform\x20float\x20dropRateBump;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0a//\x20pseudo-random\x20generator\x0aconst\x20vec3\x20randomConstants\x20=\x20vec3(12.9898,\x2078.233,\x204375.85453);\x0aconst\x20vec2\x20normalRange\x20=\x20vec2(0.0,\x201.0);\x0afloat\x20rand(vec2\x20seed,\x20vec2\x20range)\x20{\x0a\x20\x20\x20\x20vec2\x20randomSeed\x20=\x20randomCoefficient\x20*\x20seed;\x0a\x20\x20\x20\x20float\x20temp\x20=\x20dot(randomConstants.xy,\x20randomSeed);\x0a\x20\x20\x20\x20temp\x20=\x20fract(sin(temp)\x20*\x20(randomConstants.z\x20+\x20temp));\x0a\x20\x20\x20\x20return\x20temp\x20*\x20(range.y\x20-\x20range.x)\x20+\x20range.x;\x0a}\x0a\x0avec3\x20generateRandomParticle(vec2\x20seed,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20longitude\x20is\x20in\x20[0,\x20360]\x0a\x20\x20\x20\x20float\x20randomLon\x20=\x20mod(rand(seed,\x20lonRange),\x20360.0);\x0a\x20\x20\x20\x20float\x20randomLat\x20=\x20rand(-seed,\x20latRange);\x0a\x0a\x20\x20\x20\x20return\x20vec3(randomLon,\x20randomLat,\x20lev);\x0a}\x0a\x0abool\x20particleOutbound(vec3\x20particle)\x20{\x0a\x20\x20\x20\x20return\x20particle.y\x20<\x20-90.0\x20||\x20particle.y\x20>\x2090.0;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20texture(nextParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20float\x20particleDropRate\x20=\x20dropRate\x20+\x20dropRateBump\x20*\x20nextSpeed.a;\x0a\x0a\x20\x20\x20\x20vec2\x20seed1\x20=\x20nextParticle.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec2\x20seed2\x20=\x20nextSpeed.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec3\x20randomParticle\x20=\x20generateRandomParticle(seed1,\x20nextParticle.z);\x0a\x20\x20\x20\x20float\x20randomNumber\x20=\x20rand(seed2,\x20normalRange);\x0a\x0a\x20\x20\x20\x20if\x20(randomNumber\x20<\x20particleDropRate\x20||\x20particleOutbound(nextParticle))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(randomParticle,\x201.0);\x20//\x201.0\x20means\x20this\x20is\x20a\x20random\x20particle\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a\x20\x20\x20\x20}\x0a}\x0a',postProcessingSpeed_frag='uniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20randomParticle\x20=\x20texture(postProcessingPosition,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20vec4\x20particleSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x0a\x20\x20\x20\x20if\x20(randomParticle.a\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20particleSpeed;\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$3=mars3d__namespace[_0x18a09d(0xcc)];class ParticlesComputing{constructor(_0x575eba,_0x5b2b0c,_0x45fb31,_0x222f80){const _0x5119c1=_0x18a09d;this['data']=_0x5b2b0c,this[_0x5119c1(0x16f)](_0x575eba,_0x5b2b0c),this['createParticlesTextures'](_0x575eba,_0x45fb31,_0x222f80),this[_0x5119c1(0x191)](_0x5b2b0c,_0x45fb31,_0x222f80);}[_0x18a09d(0x16f)](_0x570692,_0x35745a){const _0x27d466=_0x18a09d,_0x53dbfe={'context':_0x570692,'width':_0x35745a['dimensions']['lon'],'height':_0x35745a[_0x27d466(0xe3)]['lat']*(_0x35745a[_0x27d466(0xe3)]['lev']||0x1),'pixelFormat':Cesium$3['PixelFormat']['LUMINANCE'],'pixelDatatype':Cesium$3[_0x27d466(0x131)]['FLOAT'],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3['TextureMinificationFilter'][_0x27d466(0x135)],'magnificationFilter':Cesium$3['TextureMagnificationFilter']['NEAREST']})};this[_0x27d466(0xbe)]={'U':Util['createTexture'](_0x53dbfe,_0x35745a['U'][_0x27d466(0x14b)]),'V':Util[_0x27d466(0x128)](_0x53dbfe,_0x35745a['V'][_0x27d466(0x14b)])};}['createParticlesTextures'](_0x101f38,_0x455175,_0x260393){const _0x34dc3e=_0x18a09d,_0x334bcf={'context':_0x101f38,'width':_0x455175[_0x34dc3e(0x196)],'height':_0x455175[_0x34dc3e(0x196)],'pixelFormat':Cesium$3['PixelFormat']['RGBA'],'pixelDatatype':Cesium$3['PixelDatatype'][_0x34dc3e(0xdc)],'flipY':![],'sampler':new Cesium$3[(_0x34dc3e(0xfb))]({'minificationFilter':Cesium$3['TextureMinificationFilter'][_0x34dc3e(0x135)],'magnificationFilter':Cesium$3['TextureMagnificationFilter'][_0x34dc3e(0x135)]})},_0x400aac=this['randomizeParticles'](_0x455175[_0x34dc3e(0x151)],_0x260393),_0x426437=new Float32Array(0x4*_0x455175['maxParticles'])['fill'](0x0);this['particlesTextures']={'particlesWind':Util['createTexture'](_0x334bcf),'currentParticlesPosition':Util['createTexture'](_0x334bcf,_0x400aac),'nextParticlesPosition':Util['createTexture'](_0x334bcf,_0x400aac),'currentParticlesSpeed':Util[_0x34dc3e(0x128)](_0x334bcf,_0x426437),'nextParticlesSpeed':Util['createTexture'](_0x334bcf,_0x426437),'postProcessingPosition':Util['createTexture'](_0x334bcf,_0x400aac),'postProcessingSpeed':Util[_0x34dc3e(0x128)](_0x334bcf,_0x426437)};}['randomizeParticles'](_0x17a4d7,_0xa2ff25){const _0x2bcdb0=_0x18a09d,_0x364cda=new Float32Array(0x4*_0x17a4d7);for(let _0x39d65d=0x0;_0x39d65d<_0x17a4d7;_0x39d65d++){_0x364cda[0x4*_0x39d65d]=Cesium$3[_0x2bcdb0(0x177)]['randomBetween'](_0xa2ff25[_0x2bcdb0(0x142)]['x'],_0xa2ff25['lonRange']['y']),_0x364cda[0x4*_0x39d65d+0x1]=Cesium$3[_0x2bcdb0(0x177)]['randomBetween'](_0xa2ff25['latRange']['x'],_0xa2ff25['latRange']['y']),_0x364cda[0x4*_0x39d65d+0x2]=Cesium$3['Math'][_0x2bcdb0(0xff)](this['data']['lev']['min'],this['data']['lev']['max']),_0x364cda[0x4*_0x39d65d+0x3]=0x0;}return _0x364cda;}[_0x18a09d(0x145)](){Object['keys'](this['particlesTextures'])['forEach'](_0x55864d=>{this['particlesTextures'][_0x55864d]['destroy']();});}[_0x18a09d(0x191)](_0x3fc883,_0x399c0f,_0x34fef8){const _0x5b1c5a=_0x18a09d,_0x574163=new Cesium$3[(_0x5b1c5a(0xed))](_0x3fc883[_0x5b1c5a(0xe3)]['lon'],_0x3fc883['dimensions'][_0x5b1c5a(0x108)],_0x3fc883['dimensions']['lev']),_0x511326=new Cesium$3[(_0x5b1c5a(0xed))](_0x3fc883[_0x5b1c5a(0x176)]['min'],_0x3fc883['lat'][_0x5b1c5a(0xde)],_0x3fc883['lev']['min']),_0x41e245=new Cesium$3['Cartesian3'](_0x3fc883[_0x5b1c5a(0x176)]['max'],_0x3fc883[_0x5b1c5a(0x108)]['max'],_0x3fc883[_0x5b1c5a(0x18b)]['max']),_0x28e9e6=new Cesium$3['Cartesian3']((_0x41e245['x']-_0x511326['x'])/(_0x574163['x']-0x1),(_0x41e245['y']-_0x511326['y'])/(_0x574163['y']-0x1),_0x574163['z']>0x1?(_0x41e245['z']-_0x511326['z'])/(_0x574163['z']-0x1):0x1),_0x272b33=new Cesium$3['Cartesian2'](_0x3fc883['U']['min'],_0x3fc883['U']['max']),_0x340e4c=new Cesium$3['Cartesian2'](_0x3fc883['V'][_0x5b1c5a(0xde)],_0x3fc883['V']['max']),_0x25985a=this;this['primitives']={'getWind':new CustomPrimitive({'commandType':_0x5b1c5a(0x168),'uniformMap':{'U':function(){return _0x25985a['windTextures']['U'];},'V':function(){return _0x25985a['windTextures']['V'];},'currentParticlesPosition':function(){return _0x25985a['particlesTextures']['currentParticlesPosition'];},'dimension':function(){return _0x574163;},'minimum':function(){return _0x511326;},'maximum':function(){return _0x41e245;},'interval':function(){return _0x28e9e6;}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[getWind_frag]}),'outputTexture':this[_0x5b1c5a(0x104)]['particlesWind'],'preExecute':function(){const _0x1e5b08=_0x5b1c5a;_0x25985a['primitives']['getWind']['commandToExecute'][_0x1e5b08(0x165)]=_0x25985a['particlesTextures'][_0x1e5b08(0x144)];}}),'updateSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesSpeed':function(){const _0x35dfa8=_0x5b1c5a;return _0x25985a[_0x35dfa8(0x104)]['currentParticlesSpeed'];},'particlesWind':function(){return _0x25985a['particlesTextures']['particlesWind'];},'uSpeedRange':function(){return _0x272b33;},'vSpeedRange':function(){return _0x340e4c;},'pixelSize':function(){return _0x34fef8['pixelSize'];},'speedFactor':function(){return _0x399c0f['speedFactor'];}},'fragmentShaderSource':new Cesium$3[(_0x5b1c5a(0x100))]({'sources':[updateSpeed_frag]}),'outputTexture':this['particlesTextures'][_0x5b1c5a(0x19c)],'preExecute':function(){const _0x4aea35=_0x5b1c5a,_0x2abd77=_0x25985a['particlesTextures']['currentParticlesSpeed'];_0x25985a['particlesTextures'][_0x4aea35(0x12d)]=_0x25985a[_0x4aea35(0x104)][_0x4aea35(0x101)],_0x25985a['particlesTextures'][_0x4aea35(0x101)]=_0x2abd77,_0x25985a['primitives']['updateSpeed']['commandToExecute']['outputTexture']=_0x25985a[_0x4aea35(0x104)]['nextParticlesSpeed'];}}),'updatePosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesPosition':function(){return _0x25985a['particlesTextures']['currentParticlesPosition'];},'currentParticlesSpeed':function(){const _0x43e5ab=_0x5b1c5a;return _0x25985a[_0x43e5ab(0x104)][_0x43e5ab(0x12d)];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updatePosition_frag]}),'outputTexture':this[_0x5b1c5a(0x104)]['nextParticlesPosition'],'preExecute':function(){const _0x308bf0=_0x5b1c5a,_0x4cf3e9=_0x25985a[_0x308bf0(0x104)]['currentParticlesPosition'];_0x25985a['particlesTextures']['currentParticlesPosition']=_0x25985a[_0x308bf0(0x104)]['postProcessingPosition'],_0x25985a['particlesTextures'][_0x308bf0(0x115)]=_0x4cf3e9,_0x25985a['primitives']['updatePosition']['commandToExecute']['outputTexture']=_0x25985a[_0x308bf0(0x104)][_0x308bf0(0xc7)];}}),'postProcessingPosition':new CustomPrimitive({'commandType':_0x5b1c5a(0x168),'uniformMap':{'nextParticlesPosition':function(){return _0x25985a['particlesTextures']['nextParticlesPosition'];},'nextParticlesSpeed':function(){const _0x4fc191=_0x5b1c5a;return _0x25985a['particlesTextures'][_0x4fc191(0x19c)];},'lonRange':function(){return _0x34fef8['lonRange'];},'latRange':function(){return _0x34fef8['latRange'];},'randomCoefficient':function(){const _0x2de456=Math['random']();return _0x2de456;},'dropRate':function(){return _0x399c0f['dropRate'];},'dropRateBump':function(){return _0x399c0f['dropRateBump'];}},'fragmentShaderSource':new Cesium$3[(_0x5b1c5a(0x100))]({'sources':[postProcessingPosition_frag]}),'outputTexture':this[_0x5b1c5a(0x104)]['postProcessingPosition'],'preExecute':function(){const _0x1288d7=_0x5b1c5a;_0x25985a[_0x1288d7(0x150)]['postProcessingPosition']['commandToExecute']['outputTexture']=_0x25985a[_0x1288d7(0x104)]['postProcessingPosition'];}}),'postProcessingSpeed':new CustomPrimitive({'commandType':_0x5b1c5a(0x168),'uniformMap':{'postProcessingPosition':function(){return _0x25985a['particlesTextures']['postProcessingPosition'];},'nextParticlesSpeed':function(){return _0x25985a['particlesTextures']['nextParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[postProcessingSpeed_frag]}),'outputTexture':this['particlesTextures']['postProcessingSpeed'],'preExecute':function(){const _0x24ecd0=_0x5b1c5a;_0x25985a['primitives'][_0x24ecd0(0x101)]['commandToExecute']['outputTexture']=_0x25985a[_0x24ecd0(0x104)]['postProcessingSpeed'];}})};}}const Cesium$2=mars3d__namespace['Cesium'];class ParticleSystem{constructor(_0xfd56c5,_0x3245da,_0x3f3d6a,_0x83aa67){const _0x86f3c1=_0x18a09d;this['context']=_0xfd56c5,_0x3245da={..._0x3245da},_0x3245da['udata']&&_0x3245da['vdata']&&(_0x3245da['dimensions']={},_0x3245da[_0x86f3c1(0xe3)]['lon']=_0x3245da['cols'],_0x3245da['dimensions'][_0x86f3c1(0x108)]=_0x3245da[_0x86f3c1(0x11a)],_0x3245da[_0x86f3c1(0xe3)]['lev']=_0x3245da['lev']||0x1,_0x3245da[_0x86f3c1(0x176)]={},_0x3245da[_0x86f3c1(0x176)]['min']=_0x3245da[_0x86f3c1(0xbd)],_0x3245da['lon']['max']=_0x3245da[_0x86f3c1(0x10e)],_0x3245da[_0x86f3c1(0x108)]={},_0x3245da['lat'][_0x86f3c1(0xde)]=_0x3245da[_0x86f3c1(0x10c)],_0x3245da[_0x86f3c1(0x108)]['max']=_0x3245da['ymax'],_0x3245da[_0x86f3c1(0x18b)]={},_0x3245da['lev'][_0x86f3c1(0xde)]=_0x3245da['levmin']??0x1,_0x3245da['lev']['max']=_0x3245da['levmax']??0x1,_0x3245da['U']={},_0x3245da['U'][_0x86f3c1(0x14b)]=new Float32Array(_0x3245da['udata']),_0x3245da['U']['min']=_0x3245da['umin']??Math['min'](..._0x3245da['udata']),_0x3245da['U'][_0x86f3c1(0x130)]=_0x3245da[_0x86f3c1(0x193)]??Math[_0x86f3c1(0x130)](..._0x3245da['udata']),_0x3245da['V']={},_0x3245da['V']['array']=new Float32Array(_0x3245da['vdata']),_0x3245da['V']['min']=_0x3245da[_0x86f3c1(0x141)]??Math['min'](..._0x3245da[_0x86f3c1(0x120)]),_0x3245da['V'][_0x86f3c1(0x130)]=_0x3245da['vmax']??Math[_0x86f3c1(0x130)](..._0x3245da['vdata'])),this['data']=_0x3245da,this['options']=_0x3f3d6a,this['viewerParameters']=_0x83aa67,this['particlesComputing']=new ParticlesComputing(this['context'],this[_0x86f3c1(0x161)],this[_0x86f3c1(0x1a1)],this['viewerParameters']),this['particlesRendering']=new ParticlesRendering(this['context'],this['data'],this[_0x86f3c1(0x1a1)],this['viewerParameters'],this['particlesComputing']);}['canvasResize'](_0x3a31d5){const _0x289768=_0x18a09d;this['particlesComputing'][_0x289768(0x145)](),Object['keys'](this[_0x289768(0x127)]['windTextures'])[_0x289768(0x12c)](_0x30fba2=>{const _0x3263fa=_0x289768;this['particlesComputing']['windTextures'][_0x30fba2][_0x3263fa(0x19b)]();}),this['particlesRendering'][_0x289768(0x13a)]['colorTable']['destroy'](),Object[_0x289768(0x121)](this[_0x289768(0x197)]['framebuffers'])['forEach'](_0x214550=>{const _0x82171=_0x289768;this[_0x82171(0x197)][_0x82171(0x1a2)][_0x214550][_0x82171(0x19b)]();}),this['context']=_0x3a31d5,this[_0x289768(0x127)]=new ParticlesComputing(this['context'],this[_0x289768(0x161)],this['options'],this['viewerParameters']),this['particlesRendering']=new ParticlesRendering(this[_0x289768(0x184)],this[_0x289768(0x161)],this[_0x289768(0x1a1)],this['viewerParameters'],this['particlesComputing']);}['clearFramebuffers'](){const _0x36a5d5=_0x18a09d,_0x4c086e=new Cesium$2[(_0x36a5d5(0x123))]({'color':new Cesium$2[(_0x36a5d5(0xfe))](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':undefined,'pass':Cesium$2['Pass'][_0x36a5d5(0xda)]});Object['keys'](this['particlesRendering']['framebuffers'])['forEach'](_0x261874=>{_0x4c086e['framebuffer']=this['particlesRendering']['framebuffers'][_0x261874],_0x4c086e['execute'](this['context']);});}['refreshParticles'](_0x4afde7){const _0x347337=_0x18a09d;this['clearFramebuffers'](),this['particlesComputing']['destroyParticlesTextures'](),this[_0x347337(0x127)]['createParticlesTextures'](this['context'],this[_0x347337(0x1a1)],this['viewerParameters']);if(_0x4afde7){var _0x57f6bf;const _0x487f0f=this['particlesRendering'][_0x347337(0x172)](this[_0x347337(0x1a1)]);this['particlesRendering'][_0x347337(0x150)]['segments']['geometry']=_0x487f0f;const _0x2237b1=Cesium$2['VertexArray']['fromGeometry']({'context':this[_0x347337(0x184)],'geometry':_0x487f0f,'attributeLocations':this['particlesRendering'][_0x347337(0x150)]['segments']['attributeLocations'],'bufferUsage':Cesium$2['BufferUsage']['STATIC_DRAW']});(_0x57f6bf=this['particlesRendering']['primitives'])!==null&&_0x57f6bf!==void 0x0&&(_0x57f6bf=_0x57f6bf[_0x347337(0x13c)])!==null&&_0x57f6bf!==void 0x0&&_0x57f6bf['commandToExecute']&&(this['particlesRendering'][_0x347337(0x150)]['segments']['commandToExecute']['vertexArray']=_0x2237b1);}}['setOptions'](_0x2ba538){const _0x5c9d09=_0x18a09d;let _0x1be156=![];this[_0x5c9d09(0x1a1)]['maxParticles']!==_0x2ba538['maxParticles']&&(_0x1be156=!![]),Object['keys'](_0x2ba538)['forEach'](_0x567cf1=>{const _0x3f93ba=_0x5c9d09;this[_0x3f93ba(0x1a1)][_0x567cf1]=_0x2ba538[_0x567cf1];}),this[_0x5c9d09(0xd0)](_0x1be156);}['applyViewerParameters'](_0x4e4ddd){Object['keys'](_0x4e4ddd)['forEach'](_0x35c2d9=>{this['viewerParameters'][_0x35c2d9]=_0x4e4ddd[_0x35c2d9];}),this['refreshParticles'](![]);}['destroy'](){const _0x3e0694=_0x18a09d;clearTimeout(this['canrefresh']),this['particlesComputing']['destroyParticlesTextures'](),Object['keys'](this['particlesComputing']['windTextures'])[_0x3e0694(0x12c)](_0x3efe70=>{this['particlesComputing']['windTextures'][_0x3efe70]['destroy']();}),this['particlesRendering']['textures'][_0x3e0694(0x187)]['destroy'](),Object[_0x3e0694(0x121)](this['particlesRendering']['framebuffers'])['forEach'](_0x17631f=>{this['particlesRendering']['framebuffers'][_0x17631f]['destroy']();});for(const _0x31884f in this){delete this[_0x31884f];}}}const Cesium$1=mars3d__namespace['Cesium'],BaseLayer$1=mars3d__namespace[_0x18a09d(0x16a)][_0x18a09d(0x155)],DEF_OPTIONS={'particlesNumber':0x1000,'fixedHeight':0x0,'fadeOpacity':0.996,'dropRate':0.003,'dropRateBump':0.01,'speedFactor':0.5,'lineWidth':0x2,'colors':['rgb(206,255,255)']};class WindLayer extends BaseLayer$1{constructor(_0x987c34={}){const _0x266d8f=_0x18a09d;_0x987c34={...DEF_OPTIONS,..._0x987c34},super(_0x987c34),this[_0x266d8f(0x195)](_0x987c34);}get['layer'](){return this['primitives'];}get['data'](){return this['_data'];}set['data'](_0x35c8f0){this['setData'](_0x35c8f0);}get[_0x18a09d(0x119)](){const _0x2c1fdc=_0x18a09d;return this[_0x2c1fdc(0x1a1)][_0x2c1fdc(0x119)];}set['colors'](_0x32c28f){const _0x4a0367=_0x18a09d;this[_0x4a0367(0x1a1)]['colors']=_0x32c28f,this['particleSystem']&&this['particleSystem'][_0x4a0367(0x17f)]({'colors':_0x32c28f}),this[_0x4a0367(0x105)]();}['_mountedHook'](){}['_addedHook'](){const _0x220814=_0x18a09d;this[_0x220814(0x12b)]=this['_map']['scene'],this[_0x220814(0x146)]=this['_map'][_0x220814(0x146)],this['primitives']=new Cesium$1['PrimitiveCollection'](),this['_map']['scene']['primitives']['add'](this[_0x220814(0x150)]),this['viewerParameters']={'lonRange':new Cesium$1[(_0x220814(0x167))](),'latRange':new Cesium$1[(_0x220814(0x167))](),'pixelSize':0x0},this[_0x220814(0x169)]=new Cesium$1[(_0x220814(0x16c))](Cesium$1['Cartesian3']['ZERO'],0.99*0x615299),this['updateViewerParameters'](),window['addEventListener']('resize',this['resize'][_0x220814(0xef)](this),![]),this['mouse_down']=![],this['mouse_move']=![],this[_0x220814(0xd6)]['on'](mars3d__namespace[_0x220814(0x117)]['wheel'],this['_onMapWhellEvent'],this),this[_0x220814(0xd6)]['on'](mars3d__namespace[_0x220814(0x117)][_0x220814(0x14a)],this['_onMouseDownEvent'],this),this['_map']['on'](mars3d__namespace[_0x220814(0x117)]['mouseUp'],this['_onMouseUpEvent'],this),this['_map']['on'](mars3d__namespace['EventType'][_0x220814(0x182)],this['_onMouseMoveEvent'],this),this['_data']&&this['setData'](this['_data']);}[_0x18a09d(0x153)](){const _0x3001cf=_0x18a09d;window['removeEventListener']('resize',this['resize']),this['_map'][_0x3001cf(0x11e)](mars3d__namespace['EventType'][_0x3001cf(0xc5)],this['_onMap_preRenderEvent'],this),this[_0x3001cf(0xd6)]['off'](mars3d__namespace[_0x3001cf(0x117)][_0x3001cf(0xe9)],this['_onMapWhellEvent'],this),this['_map'][_0x3001cf(0x11e)](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this['_map'][_0x3001cf(0x11e)](mars3d__namespace['EventType']['mouseUp'],this[_0x3001cf(0x19d)],this),this[_0x3001cf(0xd6)][_0x3001cf(0x11e)](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this[_0x3001cf(0x150)]['removeAll'](),this['_map']['scene']['primitives']['remove'](this['primitives']);}['resize'](){const _0x1988d4=_0x18a09d;if(!this[_0x1988d4(0x19e)]||!this['particleSystem'])return;this['primitives']['show']=![],this['primitives']['removeAll'](),this['_map']['once'](mars3d__namespace['EventType']['preRender'],this[_0x1988d4(0x188)],this);}['_onMap_preRenderEvent'](_0x29142b){const _0x400cad=_0x18a09d;this['particleSystem']['canvasResize'](this[_0x400cad(0x12b)]['context']),this['addPrimitives'](),this['primitives']['show']=!![];}[_0x18a09d(0x190)](_0x133487){clearTimeout(this['refreshTimer']);if(!this['show']||!this['particleSystem'])return;this['primitives']['show']=![],this['refreshTimer']=setTimeout(()=>{if(!this['show'])return;this['redraw']();},0xc8);}[_0x18a09d(0x11d)](_0x1af03d){this['mouse_down']=!![];}['_onMouseMoveEvent'](_0x23a533){const _0x4306b6=_0x18a09d;if(!this['show']||!this['particleSystem'])return;this[_0x4306b6(0x18e)]&&(this['primitives'][_0x4306b6(0x19e)]=![],this[_0x4306b6(0x194)]=!![]);}['_onMouseUpEvent'](_0x1b4646){const _0x3b38e0=_0x18a09d;if(!this['show']||!this['particleSystem'])return;this[_0x3b38e0(0x18e)]&&this[_0x3b38e0(0x194)]&&this['redraw'](),this[_0x3b38e0(0x150)]['show']=!![],this[_0x3b38e0(0x18e)]=![],this['mouse_move']=![];}[_0x18a09d(0xd4)](){const _0x33661d=_0x18a09d;if(!this['_map']||!this['show'])return;this['updateViewerParameters'](),this[_0x33661d(0x10b)]['applyViewerParameters'](this[_0x33661d(0x16b)]),this['primitives']['show']=!![];}['setData'](_0x1de52e){const _0x1208d1=_0x18a09d;this['_data']=_0x1de52e,this['particleSystem']&&this['particleSystem']['destroy'](),this['particleSystem']=new ParticleSystem(this[_0x1208d1(0x12b)]['context'],_0x1de52e,this['getOptions'](),this['viewerParameters']),this[_0x1208d1(0xc6)]();}[_0x18a09d(0x195)](_0x3c70d6,_0x53c512){const _0x5edd4c=_0x18a09d;if(_0x3c70d6)for(const _0x5aca20 in _0x3c70d6){this[_0x5aca20]=_0x3c70d6[_0x5aca20];}this['particleSystem']&&this[_0x5edd4c(0x10b)]['setOptions'](this['getOptions']());}['getOptions'](){const _0x156193=_0x18a09d,_0x4b8d62=Math[_0x156193(0xc3)](Math['sqrt'](this['particlesNumber']));return this['particlesNumber']=_0x4b8d62*_0x4b8d62,{'particlesTextureSize':_0x4b8d62,'maxParticles':this['particlesNumber'],'particleHeight':this[_0x156193(0xe5)],'fadeOpacity':this['fadeOpacity'],'dropRate':this['dropRate'],'dropRateBump':this['dropRateBump'],'speedFactor':this['speedFactor'],'lineWidth':this['lineWidth'],'colors':this['colors']};}['addPrimitives'](){const _0x584c26=_0x18a09d;this['primitives'][_0x584c26(0xbb)](this['particleSystem']['particlesComputing'][_0x584c26(0x150)][_0x584c26(0xe0)]),this['primitives'][_0x584c26(0xbb)](this[_0x584c26(0x10b)][_0x584c26(0x127)]['primitives'][_0x584c26(0xc8)]),this[_0x584c26(0x150)][_0x584c26(0xbb)](this['particleSystem'][_0x584c26(0x127)]['primitives'][_0x584c26(0x12f)]),this[_0x584c26(0x150)]['add'](this['particleSystem']['particlesComputing']['primitives']['postProcessingPosition']),this['primitives']['add'](this['particleSystem'][_0x584c26(0x127)][_0x584c26(0x150)]['postProcessingSpeed']),this['primitives']['add'](this[_0x584c26(0x10b)]['particlesRendering']['primitives']['segments']),this['primitives']['add'](this['particleSystem'][_0x584c26(0x197)]['primitives']['trails']),this['primitives']['add'](this['particleSystem']['particlesRendering']['primitives']['screen']);}['updateViewerParameters'](){const _0x1b3997=_0x18a09d;let _0x52f71c=this['camera']['computeViewRectangle'](this['scene']['globe'][_0x1b3997(0x15a)]);if(!_0x52f71c){const _0x17b503=this[_0x1b3997(0xd6)]['getExtent']();_0x52f71c=Cesium$1['Rectangle']['fromDegrees'](_0x17b503[_0x1b3997(0xbd)],_0x17b503['ymin'],_0x17b503[_0x1b3997(0x10e)],_0x17b503[_0x1b3997(0xeb)]);}const _0x43795f=Util['viewRectangleToLonLatRange'](_0x52f71c);this[_0x1b3997(0x16b)]['lonRange']['x']=_0x43795f['lon'][_0x1b3997(0xde)],this[_0x1b3997(0x16b)][_0x1b3997(0x142)]['y']=_0x43795f['lon'][_0x1b3997(0x130)],this['viewerParameters']['latRange']['x']=_0x43795f[_0x1b3997(0x108)]['min'],this['viewerParameters']['latRange']['y']=_0x43795f['lat']['max'];const _0x228a64=this[_0x1b3997(0x146)][_0x1b3997(0x18c)](this['globeBoundingSphere'],this['scene'][_0x1b3997(0x174)],this['scene'][_0x1b3997(0x102)]);_0x228a64>0x0&&(this[_0x1b3997(0x16b)]['pixelSize']=_0x228a64);}}mars3d__namespace['LayerUtil']['register']('wind',WindLayer),mars3d__namespace['layer']['WindLayer']=WindLayer;class CanvasParticle{constructor(){const _0x4610dc=_0x18a09d;this[_0x4610dc(0x18d)]=null,this['lat']=null,this[_0x4610dc(0x136)]=null,this[_0x4610dc(0x16e)]=null,this['age']=null,this['speed']=null;}['destroy'](){for(const _0x275803 in this){delete this[_0x275803];}}}class CanvasWindField{constructor(_0x1744e7){this['setOptions'](_0x1744e7);}get['speedRate'](){return this['_speedRate'];}set['speedRate'](_0x78fac4){const _0x2fa005=_0x18a09d;this['_speedRate']=(0x64-(_0x78fac4>0x63?0x63:_0x78fac4))*0x64,this['_calc_speedRate']=[(this['xmax']-this[_0x2fa005(0xbd)])/this[_0x2fa005(0x12e)],(this['ymax']-this['ymin'])/this['_speedRate']];}get['maxAge'](){return this['_maxAge'];}set['maxAge'](_0x197b8f){this['_maxAge']=_0x197b8f;}['setOptions'](_0xe72689){const _0x2655dc=_0x18a09d;this['options']=_0xe72689,this['maxAge']=_0xe72689['maxAge']||0x78,this['speedRate']=_0xe72689[_0x2655dc(0xf1)]||0x32,this[_0x2655dc(0x17b)]=[];const _0x37af03=_0xe72689['particlesNumber']||0x1000;for(let _0x4daf79=0x0;_0x4daf79<_0x37af03;_0x4daf79++){const _0x255106=this['_randomParticle'](new CanvasParticle());this['particles']['push'](_0x255106);}}['setDate'](_0x3c0ff5){const _0x1a8d30=_0x18a09d;this[_0x1a8d30(0x11a)]=_0x3c0ff5[_0x1a8d30(0x11a)],this['cols']=_0x3c0ff5['cols'],this[_0x1a8d30(0xbd)]=_0x3c0ff5['xmin'],this['xmax']=_0x3c0ff5['xmax'],this['ymin']=_0x3c0ff5['ymin'],this[_0x1a8d30(0xeb)]=_0x3c0ff5['ymax'],this[_0x1a8d30(0x122)]=[];const _0x8338eb=_0x3c0ff5[_0x1a8d30(0xcd)],_0x5c8736=_0x3c0ff5[_0x1a8d30(0x120)];let _0x2382c2=![];_0x8338eb['length']===this['rows']&&_0x8338eb[0x0][_0x1a8d30(0x138)]===this['cols']&&(_0x2382c2=!![]);let _0x42feca=0x0,_0x25167b=null,_0x3977f7=null;for(let _0x520f4b=0x0;_0x520f4b<this['rows'];_0x520f4b++){_0x25167b=[];for(let _0x45bfa6=0x0;_0x45bfa6<this[_0x1a8d30(0xf5)];_0x45bfa6++,_0x42feca++){_0x2382c2?_0x3977f7=this['_calcUV'](_0x8338eb[_0x520f4b][_0x45bfa6],_0x5c8736[_0x520f4b][_0x45bfa6]):_0x3977f7=this[_0x1a8d30(0x140)](_0x8338eb[_0x42feca],_0x5c8736[_0x42feca]),_0x25167b['push'](_0x3977f7);}this[_0x1a8d30(0x122)][_0x1a8d30(0xe1)](_0x25167b);}this['options']['reverseY']&&this[_0x1a8d30(0x122)][_0x1a8d30(0x14e)]();}['clear'](){const _0x51eb73=_0x18a09d;delete this['rows'],delete this[_0x51eb73(0xf5)],delete this['xmin'],delete this['xmax'],delete this[_0x51eb73(0x10c)],delete this[_0x51eb73(0xeb)],delete this['grid'],delete this[_0x51eb73(0x17b)];}['toGridXY'](_0x589719,_0x2690f3){const _0x57bdc3=_0x18a09d,_0x2feffe=(_0x589719-this['xmin'])/(this['xmax']-this['xmin'])*(this['cols']-0x1),_0x233489=(this['ymax']-_0x2690f3)/(this['ymax']-this[_0x57bdc3(0x10c)])*(this[_0x57bdc3(0x11a)]-0x1);return[_0x2feffe,_0x233489];}['getUVByXY'](_0x3dba88,_0x4cb18e){const _0x32fcef=_0x18a09d;if(_0x3dba88<0x0||_0x3dba88>=this['cols']||_0x4cb18e>=this['rows'])return[0x0,0x0,0x0];const _0x306925=Math['floor'](_0x3dba88),_0x3a2e86=Math['floor'](_0x4cb18e);if(_0x306925===_0x3dba88&&_0x3a2e86===_0x4cb18e)return this['grid'][_0x4cb18e][_0x3dba88];const _0x7f42e8=_0x306925+0x1,_0x944141=_0x3a2e86+0x1,_0x5e7fb3=this['getUVByXY'](_0x306925,_0x3a2e86),_0x114ff1=this[_0x32fcef(0xdd)](_0x7f42e8,_0x3a2e86),_0x404fb0=this[_0x32fcef(0xdd)](_0x306925,_0x944141),_0x3dd5cf=this['getUVByXY'](_0x7f42e8,_0x944141);let _0x53b78a=null;try{_0x53b78a=this[_0x32fcef(0xe6)](_0x3dba88-_0x306925,_0x4cb18e-_0x3a2e86,_0x5e7fb3,_0x114ff1,_0x404fb0,_0x3dd5cf);}catch(_0x519636){console[_0x32fcef(0x17a)](_0x3dba88,_0x4cb18e);}return _0x53b78a;}[_0x18a09d(0xe6)](_0x5766d6,_0x14fce1,_0x55f681,_0x3899c0,_0x21a085,_0x235a89){const _0xed63ad=0x1-_0x5766d6,_0x195286=0x1-_0x14fce1,_0x76fa4c=_0xed63ad*_0x195286,_0xcda905=_0x5766d6*_0x195286,_0x86192b=_0xed63ad*_0x14fce1,_0x150325=_0x5766d6*_0x14fce1,_0x3abed8=_0x55f681[0x0]*_0x76fa4c+_0x3899c0[0x0]*_0xcda905+_0x21a085[0x0]*_0x86192b+_0x235a89[0x0]*_0x150325,_0x505335=_0x55f681[0x1]*_0x76fa4c+_0x3899c0[0x1]*_0xcda905+_0x21a085[0x1]*_0x86192b+_0x235a89[0x1]*_0x150325;return this['_calcUV'](_0x3abed8,_0x505335);}[_0x18a09d(0x140)](_0xcfaee3,_0x5b8017){return[+_0xcfaee3,+_0x5b8017,Math['sqrt'](_0xcfaee3*_0xcfaee3+_0x5b8017*_0x5b8017)];}['getUVByPoint'](_0x234443,_0x2350cc){const _0x1e5a7f=_0x18a09d;if(!this['isInExtent'](_0x234443,_0x2350cc))return null;const _0x198051=this['toGridXY'](_0x234443,_0x2350cc),_0x43ace7=this[_0x1e5a7f(0xdd)](_0x198051[0x0],_0x198051[0x1]);return _0x43ace7;}[_0x18a09d(0xfc)](_0x37edc3,_0x5ce279){return _0x37edc3>=this['xmin']&&_0x37edc3<=this['xmax']&&_0x5ce279>=this['ymin']&&_0x5ce279<=this['ymax']?!![]:![];}['getRandomLatLng'](){const _0x474c66=_0x18a09d,_0x30f688=fRandomByfloat(this['xmin'],this[_0x474c66(0x10e)]),_0xc5fa28=fRandomByfloat(this[_0x474c66(0x10c)],this['ymax']);return{'lat':_0xc5fa28,'lng':_0x30f688};}[_0x18a09d(0xe8)](){const _0x57b06b=_0x18a09d;let _0xd813b2,_0x1f9615,_0x354947;for(let _0x517679=0x0,_0x1d5c05=this['particles']['length'];_0x517679<_0x1d5c05;_0x517679++){let _0x4834a0=this['particles'][_0x517679];_0x4834a0['age']<=0x0&&(_0x4834a0=this['_randomParticle'](_0x4834a0));if(_0x4834a0['age']>0x0){const _0x363cba=_0x4834a0[_0x57b06b(0x136)],_0x2cb7b6=_0x4834a0['tlat'];_0x354947=this['getUVByPoint'](_0x363cba,_0x2cb7b6),_0x354947?(_0xd813b2=_0x363cba+this[_0x57b06b(0xcf)][0x0]*_0x354947[0x0],_0x1f9615=_0x2cb7b6+this['_calc_speedRate'][0x1]*_0x354947[0x1],_0x4834a0['lng']=_0x363cba,_0x4834a0['lat']=_0x2cb7b6,_0x4834a0[_0x57b06b(0x136)]=_0xd813b2,_0x4834a0['tlat']=_0x1f9615,_0x4834a0['speed']=_0x354947[0x2],_0x4834a0['age']--):_0x4834a0['age']=0x0;}}return this['particles'];}['_randomParticle'](_0x2463eb){const _0x12eda3=_0x18a09d;let _0x412fa5,_0x5645b2;for(let _0x19359b=0x0;_0x19359b<0x1e;_0x19359b++){_0x412fa5=this['getRandomLatLng'](),_0x5645b2=this['getUVByPoint'](_0x412fa5['lng'],_0x412fa5['lat']);if(_0x5645b2&&_0x5645b2[0x2]>0x0)break;}if(!_0x5645b2)return _0x2463eb;const _0x72bae9=_0x412fa5[_0x12eda3(0x18d)]+this['_calc_speedRate'][0x0]*_0x5645b2[0x0],_0x438962=_0x412fa5[_0x12eda3(0x108)]+this['_calc_speedRate'][0x1]*_0x5645b2[0x1];return _0x2463eb['lng']=_0x412fa5[_0x12eda3(0x18d)],_0x2463eb['lat']=_0x412fa5['lat'],_0x2463eb[_0x12eda3(0x136)]=_0x72bae9,_0x2463eb['tlat']=_0x438962,_0x2463eb['age']=Math['round'](Math[_0x12eda3(0x163)]()*this[_0x12eda3(0x181)]),_0x2463eb[_0x12eda3(0xbf)]=_0x5645b2[0x2],_0x2463eb;}['destroy'](){for(const _0x4cbd8d in this){delete this[_0x4cbd8d];}}}function fRandomByfloat(_0x4bd1d1,_0x393965){return _0x4bd1d1+Math['random']()*(_0x393965-_0x4bd1d1);}function _0x4026(_0xcdff9f,_0x2c404d){const _0xdb861e=_0xdb86();return _0x4026=function(_0x402654,_0x242899){_0x402654=_0x402654-0xbb;let _0x559a06=_0xdb861e[_0x402654];return _0x559a06;},_0x4026(_0xcdff9f,_0x2c404d);}const Cesium=mars3d__namespace['Cesium'],BaseLayer=mars3d__namespace['layer']['BaseLayer'];class CanvasWindLayer extends BaseLayer{constructor(_0x47b2df={}){const _0x2b96b5=_0x18a09d;super(_0x47b2df),this['_setOptionsHook'](_0x47b2df),this['canvas']=null,_0x47b2df['colors']&&_0x47b2df['steps']&&(this[_0x2b96b5(0x110)]=new mars3d__namespace[(_0x2b96b5(0x156))](_0x47b2df));}['_setOptionsHook'](_0x5406e0,_0x1708fd){const _0xa06ec6=_0x18a09d;this['frameTime']=0x3e8/(_0x5406e0['frameRate']||0xa),this[_0xa06ec6(0x10d)]=this[_0xa06ec6(0x1a1)]['pointerEvents']??![],this[_0xa06ec6(0x18a)]=_0x5406e0['color']||'#ffffff',this['lineWidth']=_0x5406e0['lineWidth']||0x1,this[_0xa06ec6(0xe5)]=_0x5406e0['fixedHeight']??0x0,this['reverseY']=_0x5406e0[_0xa06ec6(0x10a)]??![],this['windField']&&this['windField']['setOptions'](_0x5406e0);}get[_0x18a09d(0x16a)](){return this['canvas'];}get[_0x18a09d(0x137)](){return this['_map']['scene']['canvas']['clientWidth'];}get['canvasHeight'](){const _0x4d382c=_0x18a09d;return this['_map'][_0x4d382c(0x12b)]['canvas']['clientHeight'];}get['pointerEvents'](){return this['_pointerEvents'];}set['pointerEvents'](_0xda4d03){const _0x444bb4=_0x18a09d;this['_pointerEvents']=_0xda4d03;if(!this['canvas'])return;_0xda4d03?this['canvas']['style'][_0x444bb4(0x148)]='all':this['canvas']['style']['pointer-events']=_0x444bb4(0x116);}get['particlesNumber'](){const _0x286ff3=_0x18a09d;return this['options'][_0x286ff3(0x134)];}set[_0x18a09d(0x134)](_0x8386d){const _0x2fce82=_0x18a09d;this['options']['particlesNumber']=_0x8386d,clearTimeout(this[_0x2fce82(0x17e)]),this[_0x2fce82(0x17e)]=setTimeout(()=>{this['redraw']();},0x1f4);}get[_0x18a09d(0xf1)](){const _0x51cfd3=_0x18a09d;return this[_0x51cfd3(0x1a1)][_0x51cfd3(0xf1)];}set['speedRate'](_0x4ea5fa){const _0x554521=_0x18a09d;this['options'][_0x554521(0xf1)]=_0x4ea5fa,this['windField']&&(this[_0x554521(0x160)]['speedRate']=_0x4ea5fa);}get['maxAge'](){return this['options']['maxAge'];}set['maxAge'](_0x5e688d){const _0x44b048=_0x18a09d;this['options'][_0x44b048(0x181)]=_0x5e688d,this['windField']&&(this['windField']['maxAge']=_0x5e688d);}get['data'](){return this['windData'];}set[_0x18a09d(0x161)](_0x22845e){this['setData'](_0x22845e);}['_showHook'](_0x273cca){const _0x3ab949=_0x18a09d;_0x273cca?this[_0x3ab949(0x1a3)]():(this[_0x3ab949(0xf9)]&&(this['options'][_0x3ab949(0x161)]=this['windData']),this['_removedHook']());}['_mountedHook'](){const _0x4c1768=_0x18a09d;this[_0x4c1768(0x1a1)][_0x4c1768(0x13d)]?this['initWorker']():this['windField']=new CanvasWindField(this['options']);}[_0x18a09d(0x1a3)](){const _0x398ed0=_0x18a09d;this[_0x398ed0(0x166)]=this['_createCanvas'](),this[_0x398ed0(0xdb)]=this[_0x398ed0(0x166)]['getContext']('2d',{'willReadFrequently':!![]}),this[_0x398ed0(0x111)](),this[_0x398ed0(0x1a1)]['data']&&this[_0x398ed0(0x113)](this[_0x398ed0(0x1a1)]['data']);}[_0x18a09d(0x153)](){const _0x5da4d9=_0x18a09d;this['clear'](),this['unbindEvent'](),this[_0x5da4d9(0x166)]&&(this['_map']['container'][_0x5da4d9(0xd2)](this['canvas']),delete this['canvas']);}['_createCanvas'](){const _0x17c5b0=_0x18a09d,_0x46291d=mars3d__namespace[_0x17c5b0(0x11b)]['create'](_0x17c5b0(0x166),'mars3d-canvasWind',this['_map']['container']);return _0x46291d[_0x17c5b0(0x183)]['position']='absolute',_0x46291d['style']['top']='0px',_0x46291d['style']['left']=_0x17c5b0(0x129),_0x46291d[_0x17c5b0(0x183)]['width']=this['_map']['scene']['canvas'][_0x17c5b0(0x125)]+'px',_0x46291d[_0x17c5b0(0x183)]['height']=this['_map']['scene'][_0x17c5b0(0x166)]['clientHeight']+'px',_0x46291d['style'][_0x17c5b0(0x14c)]=this[_0x17c5b0(0x10d)]?_0x17c5b0(0x152):_0x17c5b0(0x116),_0x46291d['style']['zIndex']=this[_0x17c5b0(0x1a1)]['zIndex']??0x9,_0x46291d['width']=this['_map']['scene']['canvas']['clientWidth'],_0x46291d['height']=this[_0x17c5b0(0xd6)]['scene']['canvas'][_0x17c5b0(0xfa)],_0x46291d;}['resize'](){const _0x33c747=_0x18a09d;this['canvas']&&(this['canvas']['style'][_0x33c747(0xc2)]=this[_0x33c747(0xd6)]['scene'][_0x33c747(0x166)]['clientWidth']+'px',this[_0x33c747(0x166)]['style']['height']=this['_map']['scene'][_0x33c747(0x166)]['clientHeight']+'px',this['canvas']['width']=this['_map']['scene']['canvas']['clientWidth'],this[_0x33c747(0x166)][_0x33c747(0x133)]=this['_map']['scene'][_0x33c747(0x166)][_0x33c747(0xfa)]);}['bindEvent'](){const _0x29635a=_0x18a09d,_0x39a77b=this;let _0x367f8b=Date['now']();(function _0x165be4(){const _0x4ce731=_0x4026;_0x39a77b['animateFrame']=window['requestAnimationFrame'](_0x165be4);if(_0x39a77b['show']&&_0x39a77b['windField']){const _0x1a6e53=Date[_0x4ce731(0xe4)](),_0x5b7246=_0x1a6e53-_0x367f8b;_0x5b7246>_0x39a77b['frameTime']&&(_0x367f8b=_0x1a6e53-_0x5b7246%_0x39a77b[_0x4ce731(0xce)],_0x39a77b['update']());}}(),window[_0x29635a(0xf8)](_0x29635a(0x105),this[_0x29635a(0x105)][_0x29635a(0xef)](this),![]),this['mouse_down']=![],this['mouse_move']=![],this['options'][_0x29635a(0x157)]&&(this[_0x29635a(0xd6)]['on'](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this['_map']['on'](mars3d__namespace['EventType'][_0x29635a(0x14a)],this['_onMouseDownEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseUp'],this[_0x29635a(0x19d)],this)));}[_0x18a09d(0xcb)](){const _0x16d443=_0x18a09d;window[_0x16d443(0xf6)](this['animateFrame']),delete this[_0x16d443(0xc1)],window[_0x16d443(0xe7)]('resize',this['resize']),this['options']['mouseHidden']&&(this['_map']['off'](mars3d__namespace[_0x16d443(0x117)]['wheel'],this[_0x16d443(0x190)],this),this[_0x16d443(0xd6)]['off'](mars3d__namespace['EventType'][_0x16d443(0x14a)],this['_onMouseDownEvent'],this),this['_map'][_0x16d443(0x11e)](mars3d__namespace['EventType'][_0x16d443(0xdf)],this['_onMouseUpEvent'],this),this[_0x16d443(0xd6)]['off'](mars3d__namespace['EventType'][_0x16d443(0x182)],this['_onMouseMoveEvent'],this));}[_0x18a09d(0x190)](_0x152470){const _0x27f5a4=_0x18a09d;clearTimeout(this['refreshTimer']);if(!this['show']||!this['canvas'])return;this['canvas']['style'][_0x27f5a4(0x164)]=_0x27f5a4(0xf3),this['refreshTimer']=setTimeout(()=>{const _0xb1039b=_0x27f5a4;if(!this[_0xb1039b(0x19e)])return;this['redraw'](),this['canvas']['style'][_0xb1039b(0x164)]='visible';},0xc8);}['_onMouseDownEvent'](_0x1d8117){const _0x18d5ac=_0x18a09d;this[_0x18d5ac(0x18e)]=!![],this[_0x18d5ac(0xd6)]['off'](mars3d__namespace['EventType'][_0x18d5ac(0x182)],this['_onMouseMoveEvent'],this),this['_map']['on'](mars3d__namespace['EventType'][_0x18d5ac(0x182)],this['_onMouseMoveEvent'],this);}['_onMouseMoveEvent'](_0xf57391){const _0x251aaa=_0x18a09d;if(!this[_0x251aaa(0x19e)]||!this[_0x251aaa(0x166)])return;this[_0x251aaa(0x18e)]&&(this['canvas']['style']['visibility']='hidden',this['mouse_move']=!![]);}['_onMouseUpEvent'](_0x40cd65){const _0x49538f=_0x18a09d;if(!this[_0x49538f(0x19e)]||!this['canvas'])return;this['_map']['off'](mars3d__namespace['EventType'][_0x49538f(0x182)],this[_0x49538f(0xbc)],this),this['mouse_down']&&this[_0x49538f(0x194)]&&this['redraw'](),this['canvas']['style'][_0x49538f(0x164)]='visible',this['mouse_down']=![],this[_0x49538f(0x194)]=![];}['setData'](_0x17fd18){const _0x1a7841=_0x18a09d;this['clear'](),this[_0x1a7841(0xf9)]=_0x17fd18,this['windField'][_0x1a7841(0x19a)](_0x17fd18),this[_0x1a7841(0xd4)]();}[_0x18a09d(0xd4)](){if(!this['show'])return;this['windField']['setOptions'](this['options']),this['update']();}[_0x18a09d(0x11f)](){const _0x37e556=_0x18a09d;if(this['_updateIng'])return;this[_0x37e556(0x147)]=!![];if(this['worker'])this['windField']['update']();else{const _0x2f8879=this['windField']['getParticles']();this[_0x37e556(0xf7)](_0x2f8879);}this[_0x37e556(0x147)]=![];}['_drawLines'](_0x518d60){const _0x505016=_0x18a09d;this['canvasContext']['globalCompositeOperation']='destination-in',this['canvasContext']['fillRect'](0x0,0x0,this['canvasWidth'],this['canvasHeight']),this['canvasContext']['globalCompositeOperation']='lighter',this['canvasContext']['globalAlpha']=0.9;const _0x288ebb=this[_0x505016(0xd6)]['scene'][_0x505016(0x162)]!==Cesium['SceneMode']['SCENE3D'],_0x3fa7ec=this[_0x505016(0x137)]*0.25;if(this['_colorRamp'])for(let _0x312df7=0x0,_0x3cc781=_0x518d60['length'];_0x312df7<_0x3cc781;_0x312df7++){const _0x15e810=_0x518d60[_0x312df7],_0x2847ef=this[_0x505016(0x139)](_0x15e810['lng'],_0x15e810['lat'],_0x15e810),_0x569a35=this[_0x505016(0x139)](_0x15e810['tlng'],_0x15e810['tlat'],_0x15e810);if(!_0x2847ef||!_0x569a35)continue;if(_0x288ebb&&Math['abs'](_0x2847ef[0x0]-_0x569a35[0x0])>=_0x3fa7ec)continue;this['canvasContext'][_0x505016(0x175)](),this['canvasContext']['lineWidth']=this['lineWidth'],this[_0x505016(0xdb)][_0x505016(0x15d)]=this['_colorRamp']['getColor'](_0x15e810[_0x505016(0xbf)]),this['canvasContext']['moveTo'](_0x2847ef[0x0],_0x2847ef[0x1]),this['canvasContext']['lineTo'](_0x569a35[0x0],_0x569a35[0x1]),this[_0x505016(0xdb)]['stroke']();}else{this['canvasContext']['beginPath'](),this[_0x505016(0xdb)]['lineWidth']=this['lineWidth'],this['canvasContext'][_0x505016(0x15d)]=this['color'];for(let _0x2469f6=0x0,_0x4eaa7d=_0x518d60[_0x505016(0x138)];_0x2469f6<_0x4eaa7d;_0x2469f6++){const _0x111e15=_0x518d60[_0x2469f6],_0x16cb26=this[_0x505016(0x139)](_0x111e15[_0x505016(0x18d)],_0x111e15['lat'],_0x111e15),_0x4cacd3=this['_tomap'](_0x111e15[_0x505016(0x136)],_0x111e15[_0x505016(0x16e)],_0x111e15);if(!_0x16cb26||!_0x4cacd3)continue;if(_0x288ebb&&Math['abs'](_0x16cb26[0x0]-_0x4cacd3[0x0])>=_0x3fa7ec)continue;this['canvasContext']['moveTo'](_0x16cb26[0x0],_0x16cb26[0x1]),this['canvasContext']['lineTo'](_0x4cacd3[0x0],_0x4cacd3[0x1]);}this['canvasContext'][_0x505016(0x126)]();}}[_0x18a09d(0x139)](_0x1c1c88,_0xa50cb,_0x1956b6){const _0x423ce5=_0x18a09d,_0x660535=Cesium['Cartesian3']['fromDegrees'](_0x1c1c88,_0xa50cb,this['fixedHeight']),_0x4a1b20=this['_map']['scene'];if(_0x4a1b20['mode']===Cesium[_0x423ce5(0xd3)][_0x423ce5(0x170)]){const _0x31ebdd=new Cesium['EllipsoidalOccluder'](_0x4a1b20['globe'][_0x423ce5(0x15a)],_0x4a1b20['camera']['positionWC']),_0x5e1c49=_0x31ebdd['isPointVisible'](_0x660535);if(!_0x5e1c49)return _0x1956b6['age']=0x0,null;}const _0x399137=Cesium[_0x423ce5(0x179)]['wgs84ToWindowCoordinates'](this['_map'][_0x423ce5(0x12b)],_0x660535);return _0x399137?[_0x399137['x'],_0x399137['y']]:null;}['clear'](){const _0x59a595=_0x18a09d;this[_0x59a595(0x160)]['clear'](),delete this[_0x59a595(0xf9)];}['initWorker'](){const _0x5aedab=_0x18a09d;this['worker']=new Worker(this['options']['worker']),this['worker']['onmessage']=_0x47778d=>{const _0x26537f=_0x4026;this['_drawLines'](_0x47778d[_0x26537f(0x161)]['particles']),this['_updateIng2']=![];},this[_0x5aedab(0x160)]={'init':_0xb8737c=>{this['worker']['postMessage']({'type':'init','options':_0xb8737c});},'setOptions':_0x4f6724=>{this['worker']['postMessage']({'type':'setOptions','options':_0x4f6724});},'setDate':_0x53de34=>{const _0x484dd5=_0x5aedab;this['worker']['postMessage']({'type':_0x484dd5(0x19a),'data':_0x53de34});},'update':()=>{if(this['_updateIng2'])return;this['_updateIng2']=!![],this['worker']['postMessage']({'type':'update'});},'clear':()=>{const _0x6ca212=_0x5aedab;this['worker']['postMessage']({'type':_0x6ca212(0xf2)});}},this['windField']['init'](this['options']);}}mars3d__namespace['LayerUtil']['register']('canvasWind',CanvasWindLayer),mars3d__namespace['layer'][_0x18a09d(0x103)]=CanvasWindLayer,mars3d__namespace['CanvasWindField']=CanvasWindField,mars3d__namespace['WindUtil']=WindUtil,exports['CanvasWindField']=CanvasWindField,exports['CanvasWindLayer']=CanvasWindLayer,exports['WindLayer']=WindLayer,exports['WindUtil']=WindUtil,Object['defineProperty'](exports,'__esModule',{'value':!![]});
}));
