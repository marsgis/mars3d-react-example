/**
 * Mars3D平台插件,支持气象 风向图 功能插件  mars3d-wind
 *
 * 版本信息：v3.6.5
 * 编译日期：2023-09-12 12:41:59
 * 版权所有：Copyright by 火星科技  http://mars3d.cn
 * 使用单位：免费公开版 ，2023-03-17
 */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, (window.mars3d || require('mars3d'))) :
  typeof define === 'function' && define.amd ? define(['exports', 'mars3d'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global["mars3d-wind"] = {}, global.mars3d));
})(this, (function (exports, mars3d) { 
'use strict';const _0x50525e=_0x3c67;(function(_0x23dbfc,_0x575705){const _0x22f6d7=_0x3c67,_0x16e486=_0x23dbfc();while(!![]){try{const _0x421820=-parseInt(_0x22f6d7(0xf4))/0x1+parseInt(_0x22f6d7(0x17c))/0x2+-parseInt(_0x22f6d7(0x11b))/0x3+parseInt(_0x22f6d7(0xf0))/0x4+parseInt(_0x22f6d7(0x1aa))/0x5*(parseInt(_0x22f6d7(0x1ab))/0x6)+parseInt(_0x22f6d7(0x1d4))/0x7+-parseInt(_0x22f6d7(0xfd))/0x8*(parseInt(_0x22f6d7(0x15f))/0x9);if(_0x421820===_0x575705)break;else _0x16e486['push'](_0x16e486['shift']());}catch(_0x500600){_0x16e486['push'](_0x16e486['shift']());}}}(_0x468e,0xae9f8));function _interopNamespace(_0x19b8b1){const _0x468691=_0x3c67;if(_0x19b8b1&&_0x19b8b1['__esModule'])return _0x19b8b1;var _0x1696d3=Object[_0x468691(0x137)](null);return _0x19b8b1&&Object['keys'](_0x19b8b1)[_0x468691(0x164)](function(_0x304f5b){const _0x4e3490=_0x468691;if(_0x304f5b!=='default'){var _0x3f4500=Object['getOwnPropertyDescriptor'](_0x19b8b1,_0x304f5b);Object['defineProperty'](_0x1696d3,_0x304f5b,_0x3f4500[_0x4e3490(0x18a)]?_0x3f4500:{'enumerable':!![],'get':function(){return _0x19b8b1[_0x304f5b];}});}}),_0x1696d3['default']=_0x19b8b1,_0x1696d3;}var mars3d__namespace=_interopNamespace(mars3d);const Cesium$7=mars3d__namespace['Cesium'];function getU(_0x121bd2,_0x4bee0b){const _0xa80eeb=_0x3c67,_0x4986bb=_0x121bd2*Math['cos'](Cesium$7[_0xa80eeb(0x138)]['toRadians'](_0x4bee0b));return _0x4986bb;}function getV(_0x25b274,_0x12640f){const _0x1e2dcb=_0x3c67,_0x42e472=_0x25b274*Math[_0x1e2dcb(0x127)](Cesium$7[_0x1e2dcb(0x138)]['toRadians'](_0x12640f));return _0x42e472;}function getSpeed(_0x22ce74,_0x2149b4){const _0x34c439=Math['sqrt'](Math['pow'](_0x22ce74,0x2)+Math['pow'](_0x2149b4,0x2));return _0x34c439;}function getDirection(_0x5e9c39,_0x4b515e){const _0x2ca8e3=_0x3c67;let _0x3c6614=Cesium$7[_0x2ca8e3(0x138)][_0x2ca8e3(0x145)](Math['atan2'](_0x4b515e,_0x5e9c39));return _0x3c6614+=_0x3c6614<0x0?0x168:0x0,_0x3c6614;}var WindUtil={'__proto__':null,'getU':getU,'getV':getV,'getSpeed':getSpeed,'getDirection':getDirection};const Cesium$6=mars3d__namespace['Cesium'];class CustomPrimitive{constructor(_0xedc7a7){const _0x4b0f75=_0x3c67;this['commandType']=_0xedc7a7['commandType'],this['geometry']=_0xedc7a7['geometry'],this['attributeLocations']=_0xedc7a7[_0x4b0f75(0x166)],this[_0x4b0f75(0x156)]=_0xedc7a7['primitiveType'],this[_0x4b0f75(0x115)]=_0xedc7a7['uniformMap'],this['vertexShaderSource']=_0xedc7a7[_0x4b0f75(0x1c4)],this[_0x4b0f75(0x178)]=_0xedc7a7['fragmentShaderSource'],this['rawRenderState']=_0xedc7a7['rawRenderState'],this['framebuffer']=_0xedc7a7['framebuffer'],this['outputTexture']=_0xedc7a7['outputTexture'],this['autoClear']=_0xedc7a7['autoClear']??![],this['preExecute']=_0xedc7a7['preExecute'],this['show']=!![],this['commandToExecute']=undefined,this['clearCommand']=undefined,this[_0x4b0f75(0x111)]&&(this[_0x4b0f75(0x1b6)]=new Cesium$6['ClearCommand']({'color':new Cesium$6[(_0x4b0f75(0x12e))](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':this['framebuffer'],'pass':Cesium$6[_0x4b0f75(0x106)]['OPAQUE']}));}['createCommand'](_0x576ad3){const _0x57519b=_0x3c67;switch(this['commandType']){case'Draw':{const _0x190dfd=Cesium$6['VertexArray']['fromGeometry']({'context':_0x576ad3,'geometry':this[_0x57519b(0x1c7)],'attributeLocations':this[_0x57519b(0x166)],'bufferUsage':Cesium$6['BufferUsage']['STATIC_DRAW']}),_0x3d4d27=Cesium$6['ShaderProgram']['fromCache']({'context':_0x576ad3,'attributeLocations':this['attributeLocations'],'vertexShaderSource':this[_0x57519b(0x1c4)],'fragmentShaderSource':this['fragmentShaderSource']}),_0x5aa40e=Cesium$6[_0x57519b(0x129)]['fromCache'](this[_0x57519b(0x1bf)]);return new Cesium$6[(_0x57519b(0x17f))]({'primitiveType':this['primitiveType'],'shaderProgram':_0x3d4d27,'vertexArray':_0x190dfd,'modelMatrix':Cesium$6['Matrix4']['IDENTITY'],'renderState':_0x5aa40e,'uniformMap':this['uniformMap'],'castShadows':![],'receiveShadows':![],'framebuffer':this['framebuffer'],'pass':Cesium$6['Pass'][_0x57519b(0x107)],'pickOnly':!![],'owner':this});}case _0x57519b(0x1a3):{return new Cesium$6['ComputeCommand']({'owner':this,'fragmentShaderSource':this['fragmentShaderSource'],'uniformMap':this['uniformMap'],'outputTexture':this[_0x57519b(0x15a)],'persists':!![]});}}}['setGeometry'](_0x11b6ed,_0x4ba0f6){const _0x1ffeb5=_0x3c67;this['geometry']=_0x4ba0f6;const _0x414204=Cesium$6['VertexArray']['fromGeometry']({'context':_0x11b6ed,'geometry':this['geometry'],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6[_0x1ffeb5(0x105)]['STATIC_DRAW']});this['commandToExecute']['vertexArray']=_0x414204;}['update'](_0x4ad5bf){const _0x1c401b=_0x3c67;if(!this['show'])return;if(_0x4ad5bf['mode']!==Cesium$6[_0x1c401b(0x187)][_0x1c401b(0x1b7)])return;!Cesium$6['defined'](this['commandToExecute'])&&(this[_0x1c401b(0x1e0)]=this[_0x1c401b(0x18b)](_0x4ad5bf['context'])),Cesium$6['defined'](this['preExecute'])&&this[_0x1c401b(0x163)](),Cesium$6['defined'](this[_0x1c401b(0x1b6)])&&_0x4ad5bf[_0x1c401b(0x15d)]['push'](this['clearCommand']),_0x4ad5bf[_0x1c401b(0x15d)][_0x1c401b(0x1a7)](this['commandToExecute']);}['isDestroyed'](){return![];}[_0x50525e(0x113)](){const _0x2e2d37=_0x50525e;if(this['clearCommand']){var _0x44c0fa,_0x5e403c;(_0x44c0fa=this['clearCommand'])!==null&&_0x44c0fa!==void 0x0&&_0x44c0fa[_0x2e2d37(0x1d1)]&&this[_0x2e2d37(0x1b6)]['vertexArray']['destroy'](),(_0x5e403c=this[_0x2e2d37(0x1b6)])!==null&&_0x5e403c!==void 0x0&&_0x5e403c[_0x2e2d37(0x151)]&&this['clearCommand']['shaderProgram']['destroy'](),delete this['clearCommand'];}return this['commandToExecute']&&(this['commandToExecute']['vertexArray']&&this['commandToExecute']['vertexArray']['destroy'](),this['commandToExecute']['shaderProgram']&&this['commandToExecute']['shaderProgram']['destroy'](),delete this[_0x2e2d37(0x1e0)]),Cesium$6['destroyObject'](this);}}const Cesium$5=mars3d__namespace['Cesium'],Util=(function(){const _0x2c2b21=function(){const _0x2f79f2=_0x3c67,_0x237b68=new Cesium$5['Geometry']({'attributes':new Cesium$5['GeometryAttributes']({'position':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5['ComponentDatatype'][_0x2f79f2(0x180)],'componentsPerAttribute':0x3,'values':new Float32Array([-0x1,-0x1,0x0,0x1,-0x1,0x0,0x1,0x1,0x0,-0x1,0x1,0x0])}),'st':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5[_0x2f79f2(0xfc)]['FLOAT'],'componentsPerAttribute':0x2,'values':new Float32Array([0x0,0x0,0x1,0x0,0x1,0x1,0x0,0x1])})}),'indices':new Uint32Array([0x3,0x2,0x0,0x0,0x2,0x1])});return _0x237b68;},_0x249431=function(_0x7c21c4,_0x5cb839){if(Cesium$5['defined'](_0x5cb839)){const _0x3c16de={};_0x3c16de['arrayBufferView']=_0x5cb839,_0x7c21c4['source']=_0x3c16de;}const _0x489851=new Cesium$5['Texture'](_0x7c21c4);return _0x489851;},_0x2a36dd=function(_0x171ac7,_0x4c9143,_0x568272){const _0x59f515=new Cesium$5['Framebuffer']({'context':_0x171ac7,'colorTextures':[_0x4c9143],'depthTexture':_0x568272});return _0x59f515;},_0x25a084=function(_0x2fa35b){const _0x1b7a9a=_0x3c67,_0x456b83=!![],_0x3aa7b1=![],_0x3b8e70={'viewport':_0x2fa35b['viewport'],'depthTest':_0x2fa35b['depthTest'],'depthMask':_0x2fa35b[_0x1b7a9a(0x10a)],'blending':_0x2fa35b['blending']},_0x2b06d8=Cesium$5['Appearance']['getDefaultRenderState'](_0x456b83,_0x3aa7b1,_0x3b8e70);return _0x2b06d8;},_0x36977b=function(_0x21847f){const _0x2f71bb=_0x3c67,_0x18f650={},_0x16d899=Cesium$5['Math']['mod'](_0x21847f[_0x2f71bb(0x135)],Cesium$5[_0x2f71bb(0x138)]['TWO_PI']),_0x26bce2=Cesium$5['Math']['mod'](_0x21847f['east'],Cesium$5['Math']['TWO_PI']),_0x414ed6=_0x21847f['width'];let _0x66cc0e,_0x44b0ee;_0x414ed6>Cesium$5['Math']['THREE_PI_OVER_TWO']?(_0x66cc0e=0x0,_0x44b0ee=Cesium$5['Math']['TWO_PI']):_0x26bce2-_0x16d899<_0x414ed6?(_0x66cc0e=_0x16d899,_0x44b0ee=_0x16d899+_0x414ed6):(_0x66cc0e=_0x16d899,_0x44b0ee=_0x26bce2);_0x18f650['lon']={'min':Cesium$5['Math'][_0x2f71bb(0x145)](_0x66cc0e),'max':Cesium$5['Math']['toDegrees'](_0x44b0ee)};const _0x4dbdfc=_0x21847f['south'],_0x4eb420=_0x21847f[_0x2f71bb(0x118)],_0xd6eb7c=_0x21847f['height'],_0x5a1d9d=_0xd6eb7c>Cesium$5[_0x2f71bb(0x138)]['PI']/0xc?_0xd6eb7c/0x2:0x0;let _0x5c618d=Cesium$5['Math']['clampToLatitudeRange'](_0x4dbdfc-_0x5a1d9d),_0x3e6124=Cesium$5['Math'][_0x2f71bb(0x14d)](_0x4eb420+_0x5a1d9d);return _0x5c618d<-Cesium$5['Math'][_0x2f71bb(0x1af)]&&(_0x5c618d=-Cesium$5[_0x2f71bb(0x138)][_0x2f71bb(0x123)]),_0x3e6124>Cesium$5['Math']['PI_OVER_THREE']&&(_0x3e6124=Cesium$5[_0x2f71bb(0x138)][_0x2f71bb(0x123)]),_0x18f650[_0x2f71bb(0x192)]={'min':Cesium$5['Math']['toDegrees'](_0x5c618d),'max':Cesium$5['Math'][_0x2f71bb(0x145)](_0x3e6124)},_0x18f650;};return{'getFullscreenQuad':_0x2c2b21,'createTexture':_0x249431,'createFramebuffer':_0x2a36dd,'createRawRenderState':_0x25a084,'viewRectangleToLonLatRange':_0x36977b};}());var segmentDraw_vert='in\x20vec2\x20st;\x0a//\x20it\x20is\x20not\x20normal\x20itself,\x20but\x20used\x20to\x20control\x20normal\x0ain\x20vec3\x20normal;\x20//\x20(point\x20to\x20use,\x20offset\x20sign,\x20not\x20used\x20component)\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x0auniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20postProcessingSpeed;\x0a\x0auniform\x20float\x20particleHeight;\x0a\x0auniform\x20float\x20aspect;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20lineWidth;\x0a\x0aout\x20float\x20speedNormalization;\x0a\x0avec3\x20convertCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20WGS84\x20(lon,\x20lat,\x20lev)\x20->\x20ECEF\x20(x,\x20y,\x20z)\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_conversion#From_geodetic_to_ECEF_coordinates\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20WGS\x2084\x20geometric\x20constants\x0a\x20\x20\x20\x20float\x20a\x20=\x206378137.0;\x20//\x20Semi-major\x20axis\x0a\x20\x20\x20\x20float\x20b\x20=\x206356752.3142;\x20//\x20Semi-minor\x20axis\x0a\x20\x20\x20\x20float\x20e2\x20=\x206.69437999014e-3;\x20//\x20First\x20eccentricity\x20squared\x0a\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x20\x20\x20\x20float\x20longitude\x20=\x20radians(lonLatLev.x);\x0a\x0a\x20\x20\x20\x20float\x20cosLat\x20=\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20sinLat\x20=\x20sin(latitude);\x0a\x20\x20\x20\x20float\x20cosLon\x20=\x20cos(longitude);\x0a\x20\x20\x20\x20float\x20sinLon\x20=\x20sin(longitude);\x0a\x0a\x20\x20\x20\x20float\x20N_Phi\x20=\x20a\x20/\x20sqrt(1.0\x20-\x20e2\x20*\x20sinLat\x20*\x20sinLat);\x0a\x20\x20\x20\x20float\x20h\x20=\x20particleHeight;\x20//\x20it\x20should\x20be\x20high\x20enough\x20otherwise\x20the\x20particle\x20may\x20not\x20pass\x20the\x20terrain\x20depth\x20test\x0a\x0a\x20\x20\x20\x20vec3\x20cartesian\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20cartesian.x\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20cosLon;\x0a\x20\x20\x20\x20cartesian.y\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20sinLon;\x0a\x20\x20\x20\x20cartesian.z\x20=\x20((b\x20*\x20b)\x20/\x20(a\x20*\x20a)\x20*\x20N_Phi\x20+\x20h)\x20*\x20sinLat;\x0a\x20\x20\x20\x20return\x20cartesian;\x0a}\x0a\x0avec4\x20calcProjectedCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20the\x20range\x20of\x20longitude\x20in\x20Cesium\x20is\x20[-180,\x20180]\x20but\x20the\x20range\x20of\x20longitude\x20in\x20the\x20NetCDF\x20file\x20is\x20[0,\x20360]\x0a\x20\x20\x20\x20//\x20[0,\x20180]\x20is\x20corresponding\x20to\x20[0,\x20180]\x20and\x20[180,\x20360]\x20is\x20corresponding\x20to\x20[-180,\x200]\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x\x20+\x20180.0,\x20360.0)\x20-\x20180.0;\x0a\x20\x20\x20\x20vec3\x20particlePosition\x20=\x20convertCoordinate(lonLatLev);\x0a\x20\x20\x20\x20vec4\x20projectedCoordinate\x20=\x20czm_modelViewProjection\x20*\x20vec4(particlePosition,\x201.0);\x0a\x20\x20\x20\x20return\x20projectedCoordinate;\x0a}\x0a\x0avec4\x20calcOffset(vec4\x20currentProjectedCoordinate,\x20vec4\x20nextProjectedCoordinate,\x20float\x20offsetSign)\x20{\x0a\x20\x20\x20\x20vec2\x20aspectVec2\x20=\x20vec2(aspect,\x201.0);\x0a\x20\x20\x20\x20vec2\x20currentXY\x20=\x20(currentProjectedCoordinate.xy\x20/\x20currentProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x20\x20\x20\x20vec2\x20nextXY\x20=\x20(nextProjectedCoordinate.xy\x20/\x20nextProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x0a\x20\x20\x20\x20float\x20offsetLength\x20=\x20lineWidth\x20/\x202.0;\x0a\x20\x20\x20\x20vec2\x20direction\x20=\x20normalize(nextXY\x20-\x20currentXY);\x0a\x20\x20\x20\x20vec2\x20normalVector\x20=\x20vec2(-direction.y,\x20direction.x);\x0a\x20\x20\x20\x20normalVector.x\x20=\x20normalVector.x\x20/\x20aspect;\x0a\x20\x20\x20\x20normalVector\x20=\x20offsetLength\x20*\x20normalVector;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20vec4(offsetSign\x20*\x20normalVector,\x200.0,\x200.0);\x0a\x20\x20\x20\x20return\x20offset;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec2\x20particleIndex\x20=\x20st;\x0a\x0a\x20\x20\x20\x20vec3\x20currentPosition\x20=\x20texture(currentParticlesPosition,\x20particleIndex).rgb;\x0a\x20\x20\x20\x20vec4\x20nextPosition\x20=\x20texture(postProcessingPosition,\x20particleIndex);\x0a\x0a\x20\x20\x20\x20vec4\x20currentProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20vec4\x20nextProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(nextPosition.w\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(nextPosition.xyz);\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20float\x20pointToUse\x20=\x20normal.x;\x20//\x20-1\x20is\x20currentProjectedCoordinate\x20and\x20+1\x20is\x20nextProjectedCoordinate\x0a\x20\x20\x20\x20float\x20offsetSign\x20=\x20normal.y;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20pixelSize\x20*\x20calcOffset(currentProjectedCoordinate,\x20nextProjectedCoordinate,\x20offsetSign);\x0a\x20\x20\x20\x20if\x20(pointToUse\x20<\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20currentProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20nextProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20speedNormalization\x20=\x20texture(postProcessingSpeed,\x20particleIndex).a;\x0a}\x0a',segmentDraw_frag='uniform\x20sampler2D\x20colorTable;\x0a\x0ain\x20float\x20speedNormalization;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20out_FragColor\x20=\x20texture(colorTable,\x20vec2(speedNormalization,\x200.0));\x0a}\x0a',fullscreen_vert=_0x50525e(0x177),trailDraw_frag='uniform\x20sampler2D\x20segmentsColorTexture;\x0auniform\x20sampler2D\x20segmentsDepthTexture;\x0a\x0auniform\x20sampler2D\x20currentTrailsColor;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0auniform\x20float\x20fadeOpacity;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20pointsColor\x20=\x20texture(segmentsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(currentTrailsColor,\x20textureCoordinate);\x0a\x0a\x20\x20\x20\x20trailsColor\x20=\x20floor(fadeOpacity\x20*\x20255.0\x20*\x20trailsColor)\x20/\x20255.0;\x20//\x20make\x20sure\x20the\x20trailsColor\x20will\x20be\x20strictly\x20decreased\x0a\x0a\x20\x20\x20\x20float\x20pointsDepth\x20=\x20texture(segmentsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(pointsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20pointsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20trailsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20gl_FragDepth\x20=\x20min(pointsDepth,\x20trailsDepth);\x0a}\x0a',screenDraw_frag=_0x50525e(0x16d);const Cesium$4=mars3d__namespace['Cesium'];class ParticlesRendering{constructor(_0x311a19,_0x5907b5,_0x4a83bb,_0x358e21,_0xcfdcd2){const _0x3643cb=_0x50525e;this['createRenderingTextures'](_0x311a19,_0x5907b5,_0x4a83bb['colors']),this[_0x3643cb(0x19e)](_0x311a19),this['createRenderingPrimitives'](_0x311a19,_0x4a83bb,_0x358e21,_0xcfdcd2);}[_0x50525e(0x158)](_0x342b95,_0x75af16,_0x21b99a){const _0x1f5dd7=_0x50525e,_0x205eb9={'context':_0x342b95,'width':_0x342b95['drawingBufferWidth'],'height':_0x342b95['drawingBufferHeight'],'pixelFormat':Cesium$4['PixelFormat']['RGBA'],'pixelDatatype':Cesium$4['PixelDatatype']['UNSIGNED_BYTE']},_0x2ec96b={'context':_0x342b95,'width':_0x342b95[_0x1f5dd7(0x14e)],'height':_0x342b95[_0x1f5dd7(0x136)],'pixelFormat':Cesium$4['PixelFormat']['DEPTH_COMPONENT'],'pixelDatatype':Cesium$4[_0x1f5dd7(0x185)][_0x1f5dd7(0x13f)]},_0x24863c=_0x21b99a['length'],_0x37cbb2=new Float32Array(_0x24863c*0x3);for(let _0xa91da6=0x0;_0xa91da6<_0x24863c;_0xa91da6++){const _0x213b35=Cesium$4['Color']['fromCssColorString'](_0x21b99a[_0xa91da6]);_0x37cbb2[0x3*_0xa91da6]=_0x213b35['red'],_0x37cbb2[0x3*_0xa91da6+0x1]=_0x213b35['green'],_0x37cbb2[0x3*_0xa91da6+0x2]=_0x213b35[_0x1f5dd7(0x1bd)];}const _0x5415db={'context':_0x342b95,'width':_0x24863c,'height':0x1,'pixelFormat':Cesium$4[_0x1f5dd7(0x179)]['RGB'],'pixelDatatype':Cesium$4['PixelDatatype']['FLOAT'],'sampler':new Cesium$4['Sampler']({'minificationFilter':Cesium$4['TextureMinificationFilter']['LINEAR'],'magnificationFilter':Cesium$4[_0x1f5dd7(0x11f)]['LINEAR']})};this[_0x1f5dd7(0x11c)]={'segmentsColor':Util[_0x1f5dd7(0xf6)](_0x205eb9),'segmentsDepth':Util['createTexture'](_0x2ec96b),'currentTrailsColor':Util['createTexture'](_0x205eb9),'currentTrailsDepth':Util['createTexture'](_0x2ec96b),'nextTrailsColor':Util['createTexture'](_0x205eb9),'nextTrailsDepth':Util['createTexture'](_0x2ec96b),'colorTable':Util['createTexture'](_0x5415db,_0x37cbb2)};}[_0x50525e(0x19e)](_0x5c6fad){const _0xf80569=_0x50525e;this[_0xf80569(0x18d)]={'segments':Util['createFramebuffer'](_0x5c6fad,this['textures'][_0xf80569(0x153)],this[_0xf80569(0x11c)]['segmentsDepth']),'currentTrails':Util['createFramebuffer'](_0x5c6fad,this['textures']['currentTrailsColor'],this[_0xf80569(0x11c)][_0xf80569(0x1ca)]),'nextTrails':Util[_0xf80569(0x114)](_0x5c6fad,this['textures']['nextTrailsColor'],this['textures']['nextTrailsDepth'])};}[_0x50525e(0x12d)](_0x2f97ad){const _0x5157c5=_0x50525e,_0x3517d5=0x4;let _0x43e958=[];for(let _0x4cac05=0x0;_0x4cac05<_0x2f97ad['particlesTextureSize'];_0x4cac05++){for(let _0x4d7c89=0x0;_0x4d7c89<_0x2f97ad['particlesTextureSize'];_0x4d7c89++){for(let _0x2088dd=0x0;_0x2088dd<_0x3517d5;_0x2088dd++){_0x43e958['push'](_0x4cac05/_0x2f97ad[_0x5157c5(0x1a0)]),_0x43e958['push'](_0x4d7c89/_0x2f97ad[_0x5157c5(0x1a0)]);}}}_0x43e958=new Float32Array(_0x43e958);let _0x5ec35a=[];const _0x28f42c=[-0x1,0x1],_0x34a846=[-0x1,0x1];for(let _0xa73083=0x0;_0xa73083<_0x2f97ad['maxParticles'];_0xa73083++){for(let _0x71fb30=0x0;_0x71fb30<_0x3517d5/0x2;_0x71fb30++){for(let _0x523329=0x0;_0x523329<_0x3517d5/0x2;_0x523329++){_0x5ec35a[_0x5157c5(0x1a7)](_0x28f42c[_0x71fb30]),_0x5ec35a['push'](_0x34a846[_0x523329]),_0x5ec35a[_0x5157c5(0x1a7)](0x0);}}}_0x5ec35a=new Float32Array(_0x5ec35a);const _0x4465dd=0x6*_0x2f97ad['maxParticles'],_0x341c5b=new Uint32Array(_0x4465dd);for(let _0x16d4b5=0x0,_0x597451=0x0,_0x154b59=0x0;_0x16d4b5<_0x2f97ad['maxParticles'];_0x16d4b5++){_0x341c5b[_0x597451++]=_0x154b59+0x0,_0x341c5b[_0x597451++]=_0x154b59+0x1,_0x341c5b[_0x597451++]=_0x154b59+0x2,_0x341c5b[_0x597451++]=_0x154b59+0x2,_0x341c5b[_0x597451++]=_0x154b59+0x1,_0x341c5b[_0x597451++]=_0x154b59+0x3,_0x154b59+=0x4;}const _0x56145b=new Cesium$4[(_0x5157c5(0x1ad))]({'attributes':new Cesium$4['GeometryAttributes']({'st':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4['ComponentDatatype'][_0x5157c5(0x180)],'componentsPerAttribute':0x2,'values':_0x43e958}),'normal':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4[_0x5157c5(0xfc)]['FLOAT'],'componentsPerAttribute':0x3,'values':_0x5ec35a})}),'indices':_0x341c5b});return _0x56145b;}['createRenderingPrimitives'](_0x4213c5,_0x2333f2,_0x23a029,_0x1c8aca){const _0xcb11b4=_0x50525e,_0x168ea5=this;this[_0xcb11b4(0x101)]={'segments':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'st':0x0,'normal':0x1},'geometry':this[_0xcb11b4(0x12d)](_0x2333f2),'primitiveType':Cesium$4[_0xcb11b4(0xf2)]['TRIANGLES'],'uniformMap':{'currentParticlesPosition':function(){return _0x1c8aca['particlesTextures']['currentParticlesPosition'];},'postProcessingPosition':function(){const _0x1f227f=_0xcb11b4;return _0x1c8aca['particlesTextures'][_0x1f227f(0x120)];},'postProcessingSpeed':function(){const _0x3c8016=_0xcb11b4;return _0x1c8aca[_0x3c8016(0x17e)]['postProcessingSpeed'];},'colorTable':function(){return _0x168ea5['textures']['colorTable'];},'aspect':function(){return _0x4213c5['drawingBufferWidth']/_0x4213c5['drawingBufferHeight'];},'pixelSize':function(){const _0x528365=_0xcb11b4;return _0x23a029[_0x528365(0x10f)];},'lineWidth':function(){return _0x2333f2['lineWidth'];},'particleHeight':function(){return _0x2333f2['particleHeight'];}},'vertexShaderSource':new Cesium$4[(_0xcb11b4(0x167))]({'sources':[segmentDraw_vert]}),'fragmentShaderSource':new Cesium$4[(_0xcb11b4(0x167))]({'sources':[segmentDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![]},'depthMask':!![]}),'framebuffer':this[_0xcb11b4(0x18d)][_0xcb11b4(0x112)],'autoClear':!![]}),'trails':new CustomPrimitive({'commandType':_0xcb11b4(0x1c3),'attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4[_0xcb11b4(0xf2)]['TRIANGLES'],'uniformMap':{'segmentsColorTexture':function(){return _0x168ea5['textures']['segmentsColor'];},'segmentsDepthTexture':function(){const _0x5c4233=_0xcb11b4;return _0x168ea5['textures'][_0x5c4233(0x122)];},'currentTrailsColor':function(){const _0xe6f607=_0xcb11b4;return _0x168ea5['framebuffers']['currentTrails'][_0xe6f607(0x155)](0x0);},'trailsDepthTexture':function(){const _0x4ad977=_0xcb11b4;return _0x168ea5['framebuffers']['currentTrails'][_0x4ad977(0x16f)];},'fadeOpacity':function(){const _0x5cd31e=_0xcb11b4;return _0x2333f2[_0x5cd31e(0x16b)];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4[(_0xcb11b4(0x167))]({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[trailDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![],'func':Cesium$4['DepthFunction'][_0xcb11b4(0x154)]},'depthMask':!![]}),'framebuffer':this['framebuffers']['nextTrails'],'autoClear':!![],'preExecute':function(){const _0x319efd=_0xcb11b4,_0x3bff39=_0x168ea5['framebuffers']['currentTrails'];_0x168ea5[_0x319efd(0x18d)]['currentTrails']=_0x168ea5['framebuffers'][_0x319efd(0x191)],_0x168ea5['framebuffers'][_0x319efd(0x191)]=_0x3bff39,_0x168ea5[_0x319efd(0x101)][_0x319efd(0x1cd)]['commandToExecute']['framebuffer']=_0x168ea5['framebuffers']['nextTrails'],_0x168ea5['primitives']['trails'][_0x319efd(0x1b6)]['framebuffer']=_0x168ea5['framebuffers'][_0x319efd(0x191)];}}),'screen':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4['PrimitiveType'][_0xcb11b4(0xfb)],'uniformMap':{'trailsColorTexture':function(){return _0x168ea5['framebuffers']['nextTrails']['getColorTexture'](0x0);},'trailsDepthTexture':function(){const _0x94701b=_0xcb11b4;return _0x168ea5['framebuffers']['nextTrails'][_0x94701b(0x16f)];}},'vertexShaderSource':new Cesium$4[(_0xcb11b4(0x167))]({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[screenDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':![]},'depthMask':!![],'blending':{'enabled':!![]}}),'framebuffer':undefined})};}}var getWind_frag=_0x50525e(0x174),updateSpeed_frag='uniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0auniform\x20sampler2D\x20particlesWind;\x0a\x0a//\x20used\x20to\x20calculate\x20the\x20wind\x20norm\x0auniform\x20vec2\x20uSpeedRange;\x20//\x20(min,\x20max);\x0auniform\x20vec2\x20vSpeedRange;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20speedFactor;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0afloat\x20calculateWindNorm(vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec3\x20percent\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20percent.x\x20=\x20(speed.x\x20-\x20uSpeedRange.x)\x20/\x20(uSpeedRange.y\x20-\x20uSpeedRange.x);\x0a\x20\x20\x20\x20percent.y\x20=\x20(speed.y\x20-\x20vSpeedRange.x)\x20/\x20(vSpeedRange.y\x20-\x20vSpeedRange.x);\x0a\x20\x20\x20\x20float\x20normalization\x20=\x20length(percent);\x0a\x0a\x20\x20\x20\x20return\x20normalization;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20//\x20vec3\x20currentSpeed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20texture(particlesWind,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20vec4(speedFactor\x20*\x20pixelSize\x20*\x20windVector,\x20calculateWindNorm(windVector));\x0a\x20\x20\x20\x20out_FragColor\x20=\x20nextSpeed;\x0a}\x0a',updatePosition_frag=_0x50525e(0x1b5),postProcessingPosition_frag='uniform\x20sampler2D\x20nextParticlesPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0a//\x20range\x20(min,\x20max)\x0auniform\x20vec2\x20lonRange;\x0auniform\x20vec2\x20latRange;\x0a\x0auniform\x20float\x20randomCoefficient;\x20//\x20use\x20to\x20improve\x20the\x20pseudo-random\x20generator\x0auniform\x20float\x20dropRate;\x20//\x20drop\x20rate\x20is\x20a\x20chance\x20a\x20particle\x20will\x20restart\x20at\x20random\x20position\x20to\x20avoid\x20degeneration\x0auniform\x20float\x20dropRateBump;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0a//\x20pseudo-random\x20generator\x0aconst\x20vec3\x20randomConstants\x20=\x20vec3(12.9898,\x2078.233,\x204375.85453);\x0aconst\x20vec2\x20normalRange\x20=\x20vec2(0.0,\x201.0);\x0afloat\x20rand(vec2\x20seed,\x20vec2\x20range)\x20{\x0a\x20\x20\x20\x20vec2\x20randomSeed\x20=\x20randomCoefficient\x20*\x20seed;\x0a\x20\x20\x20\x20float\x20temp\x20=\x20dot(randomConstants.xy,\x20randomSeed);\x0a\x20\x20\x20\x20temp\x20=\x20fract(sin(temp)\x20*\x20(randomConstants.z\x20+\x20temp));\x0a\x20\x20\x20\x20return\x20temp\x20*\x20(range.y\x20-\x20range.x)\x20+\x20range.x;\x0a}\x0a\x0avec3\x20generateRandomParticle(vec2\x20seed,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20longitude\x20is\x20in\x20[0,\x20360]\x0a\x20\x20\x20\x20float\x20randomLon\x20=\x20mod(rand(seed,\x20lonRange),\x20360.0);\x0a\x20\x20\x20\x20float\x20randomLat\x20=\x20rand(-seed,\x20latRange);\x0a\x0a\x20\x20\x20\x20return\x20vec3(randomLon,\x20randomLat,\x20lev);\x0a}\x0a\x0abool\x20particleOutbound(vec3\x20particle)\x20{\x0a\x20\x20\x20\x20return\x20particle.y\x20<\x20-90.0\x20||\x20particle.y\x20>\x2090.0;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20texture(nextParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20float\x20particleDropRate\x20=\x20dropRate\x20+\x20dropRateBump\x20*\x20nextSpeed.a;\x0a\x0a\x20\x20\x20\x20vec2\x20seed1\x20=\x20nextParticle.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec2\x20seed2\x20=\x20nextSpeed.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec3\x20randomParticle\x20=\x20generateRandomParticle(seed1,\x20nextParticle.z);\x0a\x20\x20\x20\x20float\x20randomNumber\x20=\x20rand(seed2,\x20normalRange);\x0a\x0a\x20\x20\x20\x20if\x20(randomNumber\x20<\x20particleDropRate\x20||\x20particleOutbound(nextParticle))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(randomParticle,\x201.0);\x20//\x201.0\x20means\x20this\x20is\x20a\x20random\x20particle\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a\x20\x20\x20\x20}\x0a}\x0a',postProcessingSpeed_frag='uniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20randomParticle\x20=\x20texture(postProcessingPosition,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20vec4\x20particleSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x0a\x20\x20\x20\x20if\x20(randomParticle.a\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20particleSpeed;\x0a\x20\x20\x20\x20}\x0a}\x0a';function _0x468e(){const _0x31ce2a=['cols','_speedRate','particles','LayerUtil','register','visible','createRenderingFramebuffers','color','particlesTextureSize','grid','context','Compute','log','height','canvas','push','canvasWidth','ymin','3368990hRRhRY','6vCrMAO','VertexArray','Geometry','setOptions','PI_OVER_THREE','bind','windField','lev','EventType','init','uniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20lengthOfLonLat(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20unit\x20conversion:\x20meters\x20->\x20longitude\x20latitude\x20degrees\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_system#Length_of_a_degree\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20Calculate\x20the\x20length\x20of\x20a\x20degree\x20of\x20latitude\x20and\x20longitude\x20in\x20meters\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x0a\x20\x20\x20\x20float\x20term1\x20=\x20111132.92;\x0a\x20\x20\x20\x20float\x20term2\x20=\x20559.82\x20*\x20cos(2.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term3\x20=\x201.175\x20*\x20cos(4.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term4\x20=\x200.0023\x20*\x20cos(6.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20latLength\x20=\x20term1\x20-\x20term2\x20+\x20term3\x20-\x20term4;\x0a\x0a\x20\x20\x20\x20float\x20term5\x20=\x20111412.84\x20*\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20term6\x20=\x2093.5\x20*\x20cos(3.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term7\x20=\x200.118\x20*\x20cos(5.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20longLength\x20=\x20term5\x20-\x20term6\x20+\x20term7;\x0a\x0a\x20\x20\x20\x20return\x20vec2(longLength,\x20latLength);\x0a}\x0a\x0avoid\x20updatePosition(vec3\x20lonLatLev,\x20vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec2\x20lonLatLength\x20=\x20lengthOfLonLat(lonLatLev);\x0a\x20\x20\x20\x20float\x20u\x20=\x20speed.x\x20/\x20lonLatLength.x;\x0a\x20\x20\x20\x20float\x20v\x20=\x20speed.y\x20/\x20lonLatLength.y;\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20vec3\x20windVectorInLonLatLev\x20=\x20vec3(u,\x20v,\x20w);\x0a\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20lonLatLev\x20+\x20windVectorInLonLatLev;\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20speed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20updatePosition(lonLatLev,\x20speed);\x0a}\x0a','clearCommand','SCENE3D','add','canvasResize','nextParticlesSpeed','dropRate','particlesComputing','blue','addPrimitives','rawRenderState','_calc_speedRate','rows','_canrefresh','Draw','vertexShaderSource','max','RGBA','geometry','WindUtil','CanvasWindLayer','currentTrailsDepth','_tomap','particlesWind','trails','update','dimensions','getUVByXY','vertexArray','PrimitiveCollection','sqrt','6256404ElnSGG','_updateIng','setData','updateViewerParameters','off','positionWC','ymax','min','refreshTimer','_calcUV','rgb(206,255,255)','mouseUp','commandToExecute','currentParticlesSpeed','_mountedHook','clear','4656148IIeLzm','particleSystem','PrimitiveType','width','649597wVKwDk','lonRange','createTexture','array','strokeStyle','worker','camera','TRIANGLES','ComponentDatatype','53024opczrE','mouse_down','particlesRendering','visibility','primitives','canvasContext','tlng','Sampler','BufferUsage','Pass','OPAQUE','fixedHeight','wheel','depthMask','vdata','createWindTextures','udata','_maxAge','pixelSize','Cartesian3','autoClear','segments','destroy','createFramebuffer','uniformMap','xmax','options','north','_onMouseDownEvent','xmin','2966121rRNQaN','textures','lon','initWorker','TextureMagnificationFilter','postProcessingPosition','data','segmentsDepth','PI_OVER_TWO','container','umin','lineTo','sin','framebuffer','RenderState','postMessage','currentParticlesPosition','_onMapWhellEvent','createSegmentsGeometry','Color','speed','_data','dropRateBump','windTextures','viewerParameters','tlat','west','drawingBufferHeight','create','Math','age','ellipsoid','maxParticles','pointerEvents','_onMouseMoveEvent','mouseDown','UNSIGNED_INT','clientWidth','bindEvent','getWind','random','redraw','toDegrees','isPointVisible','resize','postProcessingSpeed','now','globalCompositeOperation','speedFactor','animateFrame','clampToLatitudeRange','drawingBufferWidth','createParticlesTextures','_onMap_preRenderEvent','shaderProgram','_colorRamp','segmentsColor','ALWAYS','getColorTexture','primitiveType','clientHeight','createRenderingTextures','_randomParticle','outputTexture','mouseMove','_removedHook','commandList','0px','2214LuVAHz','mouse_move','layer','hidden','preExecute','forEach','getParticles','attributeLocations','ShaderSource','once','requestAnimationFrame','createComputingPrimitives','fadeOpacity','frameTime','uniform\x20sampler2D\x20trailsColorTexture;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(trailsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20trailsColor;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x0a}\x0a','show','depthTexture','ceil','keys','speedRate','reverseY','//\x20the\x20size\x20of\x20UV\x20textures:\x20width\x20=\x20lon,\x20height\x20=\x20lat*lev\x0auniform\x20sampler2D\x20U;\x20//\x20eastward\x20wind\x0auniform\x20sampler2D\x20V;\x20//\x20northward\x20wind\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0a\x0auniform\x20vec3\x20dimension;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20vec3\x20minimum;\x20//\x20minimum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20maximum;\x20//\x20maximum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20interval;\x20//\x20interval\x20of\x20each\x20dimension\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20mapPositionToNormalizedIndex2D(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20range\x20of\x20longitude\x20and\x20latitude\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x,\x20360.0);\x0a\x20\x20\x20\x20lonLatLev.y\x20=\x20clamp(lonLatLev.y,\x20-90.0,\x2090.0);\x0a\x0a\x20\x20\x20\x20vec3\x20index3D\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20index3D.x\x20=\x20(lonLatLev.x\x20-\x20minimum.x)\x20/\x20interval.x;\x0a\x20\x20\x20\x20index3D.y\x20=\x20(lonLatLev.y\x20-\x20minimum.y)\x20/\x20interval.y;\x0a\x20\x20\x20\x20index3D.z\x20=\x20(lonLatLev.z\x20-\x20minimum.z)\x20/\x20interval.z;\x0a\x0a\x20\x20\x20\x20//\x20the\x20st\x20texture\x20coordinate\x20corresponding\x20to\x20(col,\x20row)\x20index\x0a\x20\x20\x20\x20//\x20example\x0a\x20\x20\x20\x20//\x20data\x20array\x20is\x20[0,\x201,\x202,\x203,\x204,\x205],\x20width\x20=\x203,\x20height\x20=\x202\x0a\x20\x20\x20\x20//\x20the\x20content\x20of\x20texture\x20will\x20be\x0a\x20\x20\x20\x20//\x20t\x201.0\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x203\x204\x205\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x200\x201\x202\x0a\x20\x20\x20\x20//\x20\x20\x200.0------1.0\x20s\x0a\x0a\x20\x20\x20\x20vec2\x20index2D\x20=\x20vec2(index3D.x,\x20index3D.z\x20*\x20dimension.y\x20+\x20index3D.y);\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20vec2(index2D.x\x20/\x20dimension.x,\x20index2D.y\x20/\x20(dimension.y\x20*\x20dimension.z));\x0a\x20\x20\x20\x20return\x20normalizedIndex2D;\x0a}\x0a\x0afloat\x20getWind(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20mapPositionToNormalizedIndex2D(lonLatLev);\x0a\x20\x20\x20\x20float\x20result\x20=\x20texture(windTexture,\x20normalizedIndex2D).r;\x0a\x20\x20\x20\x20return\x20result;\x0a}\x0a\x0aconst\x20mat4\x20kernelMatrix\x20=\x20mat4(\x0a\x20\x20\x20\x200.0,\x20-1.0,\x202.0,\x20-1.0,\x20//\x20first\x20column\x0a\x20\x20\x20\x202.0,\x200.0,\x20-5.0,\x203.0,\x20//\x20second\x20column\x0a\x20\x20\x20\x200.0,\x201.0,\x204.0,\x20-3.0,\x20//\x20third\x20column\x0a\x20\x20\x20\x200.0,\x200.0,\x20-1.0,\x201.0\x20//\x20fourth\x20column\x0a);\x0afloat\x20oneDimensionInterpolation(float\x20t,\x20float\x20p0,\x20float\x20p1,\x20float\x20p2,\x20float\x20p3)\x20{\x0a\x20\x20\x20\x20vec4\x20tVec4\x20=\x20vec4(1.0,\x20t,\x20t\x20*\x20t,\x20t\x20*\x20t\x20*\x20t);\x0a\x20\x20\x20\x20tVec4\x20=\x20tVec4\x20/\x202.0;\x0a\x20\x20\x20\x20vec4\x20pVec4\x20=\x20vec4(p0,\x20p1,\x20p2,\x20p3);\x0a\x20\x20\x20\x20return\x20dot((tVec4\x20*\x20kernelMatrix),\x20pVec4);\x0a}\x0a\x0afloat\x20calculateB(sampler2D\x20windTexture,\x20float\x20t,\x20float\x20lon,\x20float\x20lat,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20float\x20lon0\x20=\x20floor(lon)\x20-\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon1\x20=\x20floor(lon);\x0a\x20\x20\x20\x20float\x20lon2\x20=\x20floor(lon)\x20+\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon3\x20=\x20floor(lon)\x20+\x202.0\x20*\x20interval.x;\x0a\x0a\x20\x20\x20\x20float\x20p0\x20=\x20getWind(windTexture,\x20vec3(lon0,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p1\x20=\x20getWind(windTexture,\x20vec3(lon1,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p2\x20=\x20getWind(windTexture,\x20vec3(lon2,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p3\x20=\x20getWind(windTexture,\x20vec3(lon3,\x20lat,\x20lev));\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(t,\x20p0,\x20p1,\x20p2,\x20p3);\x0a}\x0a\x0afloat\x20interpolateOneTexture(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20float\x20lon\x20=\x20lonLatLev.x;\x0a\x20\x20\x20\x20float\x20lat\x20=\x20lonLatLev.y;\x0a\x20\x20\x20\x20float\x20lev\x20=\x20lonLatLev.z;\x0a\x0a\x20\x20\x20\x20float\x20lat0\x20=\x20floor(lat)\x20-\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat1\x20=\x20floor(lat);\x0a\x20\x20\x20\x20float\x20lat2\x20=\x20floor(lat)\x20+\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat3\x20=\x20floor(lat)\x20+\x202.0\x20*\x20interval.y;\x0a\x0a\x20\x20\x20\x20vec2\x20coefficient\x20=\x20lonLatLev.xy\x20-\x20floor(lonLatLev.xy);\x0a\x20\x20\x20\x20float\x20b0\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat0,\x20lev);\x0a\x20\x20\x20\x20float\x20b1\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat1,\x20lev);\x0a\x20\x20\x20\x20float\x20b2\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat2,\x20lev);\x0a\x20\x20\x20\x20float\x20b3\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat3,\x20lev);\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(coefficient.y,\x20b0,\x20b1,\x20b2,\x20b3);\x0a}\x0a\x0avec3\x20bicubic(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20https://en.wikipedia.org/wiki/Bicubic_interpolation#Bicubic_convolution_algorithm\x0a\x20\x20\x20\x20float\x20u\x20=\x20interpolateOneTexture(U,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20v\x20=\x20interpolateOneTexture(V,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20return\x20vec3(u,\x20v,\x20w);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20bicubic(lonLatLev);\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(windVector,\x200.0);\x0a}\x0a','stroke','destroyParticlesTextures','in\x20vec3\x20position;\x0ain\x20vec2\x20st;\x0a\x0aout\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20textureCoordinate\x20=\x20st;\x0a\x20\x20\x20\x20gl_Position\x20=\x20vec4(position,\x201.0);\x0a}\x0a','fragmentShaderSource','PixelFormat','scene','particlesNumber','2504882ZYJMdv','NEAREST','particlesTextures','DrawCommand','FLOAT','CanvasWindField','windData','unbindEvent','umax','PixelDatatype','toGridXY','SceneMode','canvasHeight','mouseHidden','get','createCommand','randomizeParticles','framebuffers','none','setDate','getPixelSize','nextTrails','lat','_map','style','STATIC_DRAW','refreshParticles','getRandomLatLng'];_0x468e=function(){return _0x31ce2a;};return _0x468e();}const Cesium$3=mars3d__namespace['Cesium'];class ParticlesComputing{constructor(_0x18cdb0,_0x2683a4,_0x5a64d7,_0x6edd5d){const _0x598e49=_0x50525e;this['data']=_0x2683a4,this[_0x598e49(0x10c)](_0x18cdb0,_0x2683a4),this[_0x598e49(0x14f)](_0x18cdb0,_0x5a64d7,_0x6edd5d),this[_0x598e49(0x16a)](_0x2683a4,_0x5a64d7,_0x6edd5d);}['createWindTextures'](_0x58c13e,_0x169237){const _0x23c210=_0x50525e,_0x58a0b2={'context':_0x58c13e,'width':_0x169237['dimensions'][_0x23c210(0x11d)],'height':_0x169237['dimensions']['lat']*(_0x169237[_0x23c210(0x1cf)]['lev']||0x1),'pixelFormat':Cesium$3['PixelFormat']['LUMINANCE'],'pixelDatatype':Cesium$3[_0x23c210(0x185)][_0x23c210(0x180)],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3['TextureMinificationFilter'][_0x23c210(0x17d)],'magnificationFilter':Cesium$3['TextureMagnificationFilter'][_0x23c210(0x17d)]})};this['windTextures']={'U':Util['createTexture'](_0x58a0b2,_0x169237['U']['array']),'V':Util['createTexture'](_0x58a0b2,_0x169237['V'][_0x23c210(0xf7)])};}['createParticlesTextures'](_0x48f0ec,_0x1dbb14,_0x1dda9b){const _0x417735=_0x50525e,_0x478e03={'context':_0x48f0ec,'width':_0x1dbb14['particlesTextureSize'],'height':_0x1dbb14['particlesTextureSize'],'pixelFormat':Cesium$3['PixelFormat'][_0x417735(0x1c6)],'pixelDatatype':Cesium$3[_0x417735(0x185)]['FLOAT'],'flipY':![],'sampler':new Cesium$3[(_0x417735(0x104))]({'minificationFilter':Cesium$3['TextureMinificationFilter']['NEAREST'],'magnificationFilter':Cesium$3['TextureMagnificationFilter'][_0x417735(0x17d)]})},_0x16ad85=this[_0x417735(0x18c)](_0x1dbb14['maxParticles'],_0x1dda9b),_0x144ba9=new Float32Array(0x4*_0x1dbb14[_0x417735(0x13b)])['fill'](0x0);this['particlesTextures']={'particlesWind':Util['createTexture'](_0x478e03),'currentParticlesPosition':Util[_0x417735(0xf6)](_0x478e03,_0x16ad85),'nextParticlesPosition':Util['createTexture'](_0x478e03,_0x16ad85),'currentParticlesSpeed':Util['createTexture'](_0x478e03,_0x144ba9),'nextParticlesSpeed':Util['createTexture'](_0x478e03,_0x144ba9),'postProcessingPosition':Util[_0x417735(0xf6)](_0x478e03,_0x16ad85),'postProcessingSpeed':Util[_0x417735(0xf6)](_0x478e03,_0x144ba9)};}['randomizeParticles'](_0x2890e6,_0x51142f){const _0x311fac=_0x50525e,_0x5e74a3=new Float32Array(0x4*_0x2890e6);for(let _0x411219=0x0;_0x411219<_0x2890e6;_0x411219++){_0x5e74a3[0x4*_0x411219]=Cesium$3['Math']['randomBetween'](_0x51142f['lonRange']['x'],_0x51142f['lonRange']['y']),_0x5e74a3[0x4*_0x411219+0x1]=Cesium$3['Math']['randomBetween'](_0x51142f['latRange']['x'],_0x51142f['latRange']['y']),_0x5e74a3[0x4*_0x411219+0x2]=Cesium$3[_0x311fac(0x138)]['randomBetween'](this[_0x311fac(0x121)]['lev'][_0x311fac(0x1db)],this['data']['lev']['max']),_0x5e74a3[0x4*_0x411219+0x3]=0x0;}return _0x5e74a3;}['destroyParticlesTextures'](){const _0x22ae78=_0x50525e;Object['keys'](this[_0x22ae78(0x17e)])['forEach'](_0x3a998d=>{this['particlesTextures'][_0x3a998d]['destroy']();});}[_0x50525e(0x16a)](_0x3b4cc3,_0x1156d7,_0x3f7373){const _0x58b2e5=_0x50525e,_0x45677a=new Cesium$3['Cartesian3'](_0x3b4cc3['dimensions']['lon'],_0x3b4cc3[_0x58b2e5(0x1cf)]['lat'],_0x3b4cc3['dimensions']['lev']),_0x5c1fa5=new Cesium$3['Cartesian3'](_0x3b4cc3['lon']['min'],_0x3b4cc3['lat']['min'],_0x3b4cc3['lev']['min']),_0x188888=new Cesium$3[(_0x58b2e5(0x110))](_0x3b4cc3[_0x58b2e5(0x11d)]['max'],_0x3b4cc3[_0x58b2e5(0x192)][_0x58b2e5(0x1c5)],_0x3b4cc3[_0x58b2e5(0x1b2)]['max']),_0x3c6dd9=new Cesium$3['Cartesian3']((_0x188888['x']-_0x5c1fa5['x'])/(_0x45677a['x']-0x1),(_0x188888['y']-_0x5c1fa5['y'])/(_0x45677a['y']-0x1),_0x45677a['z']>0x1?(_0x188888['z']-_0x5c1fa5['z'])/(_0x45677a['z']-0x1):0x1),_0x123140=new Cesium$3['Cartesian2'](_0x3b4cc3['U']['min'],_0x3b4cc3['U']['max']),_0x3935fa=new Cesium$3['Cartesian2'](_0x3b4cc3['V'][_0x58b2e5(0x1db)],_0x3b4cc3['V'][_0x58b2e5(0x1c5)]),_0x594d0d=this;this['primitives']={'getWind':new CustomPrimitive({'commandType':'Compute','uniformMap':{'U':function(){return _0x594d0d['windTextures']['U'];},'V':function(){return _0x594d0d['windTextures']['V'];},'currentParticlesPosition':function(){const _0x3f2966=_0x58b2e5;return _0x594d0d[_0x3f2966(0x17e)]['currentParticlesPosition'];},'dimension':function(){return _0x45677a;},'minimum':function(){return _0x5c1fa5;},'maximum':function(){return _0x188888;},'interval':function(){return _0x3c6dd9;}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[getWind_frag]}),'outputTexture':this['particlesTextures']['particlesWind'],'preExecute':function(){const _0x25a7a5=_0x58b2e5;_0x594d0d['primitives'][_0x25a7a5(0x142)][_0x25a7a5(0x1e0)][_0x25a7a5(0x15a)]=_0x594d0d['particlesTextures']['particlesWind'];}}),'updateSpeed':new CustomPrimitive({'commandType':_0x58b2e5(0x1a3),'uniformMap':{'currentParticlesSpeed':function(){return _0x594d0d['particlesTextures']['currentParticlesSpeed'];},'particlesWind':function(){const _0x17c836=_0x58b2e5;return _0x594d0d['particlesTextures'][_0x17c836(0x1cc)];},'uSpeedRange':function(){return _0x123140;},'vSpeedRange':function(){return _0x3935fa;},'pixelSize':function(){const _0x34aea0=_0x58b2e5;return _0x3f7373[_0x34aea0(0x10f)];},'speedFactor':function(){return _0x1156d7['speedFactor'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updateSpeed_frag]}),'outputTexture':this['particlesTextures'][_0x58b2e5(0x1ba)],'preExecute':function(){const _0x115477=_0x58b2e5,_0xfc9cd4=_0x594d0d[_0x115477(0x17e)]['currentParticlesSpeed'];_0x594d0d['particlesTextures']['currentParticlesSpeed']=_0x594d0d[_0x115477(0x17e)][_0x115477(0x148)],_0x594d0d['particlesTextures']['postProcessingSpeed']=_0xfc9cd4,_0x594d0d['primitives']['updateSpeed'][_0x115477(0x1e0)]['outputTexture']=_0x594d0d[_0x115477(0x17e)]['nextParticlesSpeed'];}}),'updatePosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesPosition':function(){return _0x594d0d['particlesTextures']['currentParticlesPosition'];},'currentParticlesSpeed':function(){const _0x2bcaa4=_0x58b2e5;return _0x594d0d['particlesTextures'][_0x2bcaa4(0x1e1)];}},'fragmentShaderSource':new Cesium$3[(_0x58b2e5(0x167))]({'sources':[updatePosition_frag]}),'outputTexture':this['particlesTextures']['nextParticlesPosition'],'preExecute':function(){const _0x68a920=_0x58b2e5,_0x18f573=_0x594d0d[_0x68a920(0x17e)]['currentParticlesPosition'];_0x594d0d[_0x68a920(0x17e)][_0x68a920(0x12b)]=_0x594d0d['particlesTextures']['postProcessingPosition'],_0x594d0d[_0x68a920(0x17e)][_0x68a920(0x120)]=_0x18f573,_0x594d0d['primitives']['updatePosition']['commandToExecute']['outputTexture']=_0x594d0d[_0x68a920(0x17e)]['nextParticlesPosition'];}}),'postProcessingPosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'nextParticlesPosition':function(){return _0x594d0d['particlesTextures']['nextParticlesPosition'];},'nextParticlesSpeed':function(){const _0x330ed4=_0x58b2e5;return _0x594d0d[_0x330ed4(0x17e)]['nextParticlesSpeed'];},'lonRange':function(){const _0x5931f5=_0x58b2e5;return _0x3f7373[_0x5931f5(0xf5)];},'latRange':function(){return _0x3f7373['latRange'];},'randomCoefficient':function(){const _0x4a99ba=_0x58b2e5,_0x14aec6=Math[_0x4a99ba(0x143)]();return _0x14aec6;},'dropRate':function(){return _0x1156d7['dropRate'];},'dropRateBump':function(){const _0x1166cf=_0x58b2e5;return _0x1156d7[_0x1166cf(0x131)];}},'fragmentShaderSource':new Cesium$3[(_0x58b2e5(0x167))]({'sources':[postProcessingPosition_frag]}),'outputTexture':this[_0x58b2e5(0x17e)][_0x58b2e5(0x120)],'preExecute':function(){const _0x173069=_0x58b2e5;_0x594d0d[_0x173069(0x101)][_0x173069(0x120)]['commandToExecute']['outputTexture']=_0x594d0d['particlesTextures']['postProcessingPosition'];}}),'postProcessingSpeed':new CustomPrimitive({'commandType':_0x58b2e5(0x1a3),'uniformMap':{'postProcessingPosition':function(){return _0x594d0d['particlesTextures']['postProcessingPosition'];},'nextParticlesSpeed':function(){return _0x594d0d['particlesTextures']['nextParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3[(_0x58b2e5(0x167))]({'sources':[postProcessingSpeed_frag]}),'outputTexture':this['particlesTextures']['postProcessingSpeed'],'preExecute':function(){const _0x4991f5=_0x58b2e5;_0x594d0d['primitives']['postProcessingSpeed'][_0x4991f5(0x1e0)]['outputTexture']=_0x594d0d[_0x4991f5(0x17e)][_0x4991f5(0x148)];}})};}}const Cesium$2=mars3d__namespace['Cesium'];class ParticleSystem{constructor(_0x527910,_0x540ed6,_0xdd4a45,_0x34d373){const _0x1624c6=_0x50525e;this['context']=_0x527910,_0x540ed6={..._0x540ed6},_0x540ed6[_0x1624c6(0x10d)]&&_0x540ed6['vdata']&&(_0x540ed6['dimensions']={},_0x540ed6['dimensions']['lon']=_0x540ed6['cols'],_0x540ed6[_0x1624c6(0x1cf)][_0x1624c6(0x192)]=_0x540ed6['rows'],_0x540ed6['dimensions'][_0x1624c6(0x1b2)]=_0x540ed6[_0x1624c6(0x1b2)]||0x1,_0x540ed6['lon']={},_0x540ed6['lon']['min']=_0x540ed6['xmin'],_0x540ed6['lon']['max']=_0x540ed6['xmax'],_0x540ed6['lat']={},_0x540ed6['lat']['min']=_0x540ed6['ymin'],_0x540ed6['lat']['max']=_0x540ed6['ymax'],_0x540ed6[_0x1624c6(0x1b2)]={},_0x540ed6[_0x1624c6(0x1b2)]['min']=_0x540ed6['levmin']??0x1,_0x540ed6[_0x1624c6(0x1b2)]['max']=_0x540ed6['levmax']??0x1,_0x540ed6['U']={},_0x540ed6['U']['array']=new Float32Array(_0x540ed6[_0x1624c6(0x10d)]),_0x540ed6['U']['min']=_0x540ed6[_0x1624c6(0x125)]??Math[_0x1624c6(0x1db)](..._0x540ed6['udata']),_0x540ed6['U']['max']=_0x540ed6[_0x1624c6(0x184)]??Math['max'](..._0x540ed6['udata']),_0x540ed6['V']={},_0x540ed6['V'][_0x1624c6(0xf7)]=new Float32Array(_0x540ed6['vdata']),_0x540ed6['V']['min']=_0x540ed6['vmin']??Math['min'](..._0x540ed6['vdata']),_0x540ed6['V']['max']=_0x540ed6['vmax']??Math['max'](..._0x540ed6[_0x1624c6(0x10b)])),this['data']=_0x540ed6,this['options']=_0xdd4a45,this['viewerParameters']=_0x34d373,this['particlesComputing']=new ParticlesComputing(this['context'],this[_0x1624c6(0x121)],this['options'],this[_0x1624c6(0x133)]),this['particlesRendering']=new ParticlesRendering(this['context'],this[_0x1624c6(0x121)],this['options'],this['viewerParameters'],this['particlesComputing']);}[_0x50525e(0x1b9)](_0x51445a){const _0x35dff0=_0x50525e;this[_0x35dff0(0x1bc)]['destroyParticlesTextures'](),Object['keys'](this['particlesComputing'][_0x35dff0(0x132)])['forEach'](_0xcc9be3=>{const _0x4266dd=_0x35dff0;this[_0x4266dd(0x1bc)]['windTextures'][_0xcc9be3]['destroy']();}),this['particlesRendering'][_0x35dff0(0x11c)]['colorTable']['destroy'](),Object['keys'](this['particlesRendering']['framebuffers'])['forEach'](_0x5a615d=>{const _0x518bd5=_0x35dff0;this['particlesRendering'][_0x518bd5(0x18d)][_0x5a615d]['destroy']();}),this['context']=_0x51445a,this['particlesComputing']=new ParticlesComputing(this[_0x35dff0(0x1a2)],this[_0x35dff0(0x121)],this[_0x35dff0(0x117)],this[_0x35dff0(0x133)]),this['particlesRendering']=new ParticlesRendering(this[_0x35dff0(0x1a2)],this['data'],this[_0x35dff0(0x117)],this['viewerParameters'],this['particlesComputing']);}['clearFramebuffers'](){const _0x8125a1=_0x50525e,_0xd3ba66=new Cesium$2['ClearCommand']({'color':new Cesium$2['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':undefined,'pass':Cesium$2[_0x8125a1(0x106)]['OPAQUE']});Object['keys'](this['particlesRendering'][_0x8125a1(0x18d)])['forEach'](_0x598b71=>{const _0x240e0f=_0x8125a1;_0xd3ba66[_0x240e0f(0x128)]=this[_0x240e0f(0xff)]['framebuffers'][_0x598b71],_0xd3ba66['execute'](this['context']);});}['refreshParticles'](_0x3415ab){const _0x289772=_0x50525e;this['clearFramebuffers'](),this[_0x289772(0x1bc)][_0x289772(0x176)](),this['particlesComputing']['createParticlesTextures'](this['context'],this[_0x289772(0x117)],this[_0x289772(0x133)]);if(_0x3415ab){var _0x45fbab,_0x3aed17;const _0xfa5853=this['particlesRendering']['createSegmentsGeometry'](this[_0x289772(0x117)]);this['particlesRendering']['primitives']['segments']['geometry']=_0xfa5853;const _0x28a7e1=Cesium$2[_0x289772(0x1ac)]['fromGeometry']({'context':this['context'],'geometry':_0xfa5853,'attributeLocations':this[_0x289772(0xff)][_0x289772(0x101)]['segments'][_0x289772(0x166)],'bufferUsage':Cesium$2['BufferUsage'][_0x289772(0x195)]});(_0x45fbab=this[_0x289772(0xff)]['primitives'])!==null&&_0x45fbab!==void 0x0&&(_0x3aed17=_0x45fbab[_0x289772(0x112)])!==null&&_0x3aed17!==void 0x0&&_0x3aed17['commandToExecute']&&(this[_0x289772(0xff)][_0x289772(0x101)][_0x289772(0x112)]['commandToExecute']['vertexArray']=_0x28a7e1);}}[_0x50525e(0x1ae)](_0x47857b){const _0x186787=_0x50525e;let _0x144639=![];this['options']['maxParticles']!==_0x47857b['maxParticles']&&(_0x144639=!![]),Object['keys'](_0x47857b)[_0x186787(0x164)](_0x413f55=>{this['options'][_0x413f55]=_0x47857b[_0x413f55];}),this[_0x186787(0x196)](_0x144639);}['applyViewerParameters'](_0x22c779){const _0x430e18=_0x50525e;Object[_0x430e18(0x171)](_0x22c779)['forEach'](_0x52ac02=>{this['viewerParameters'][_0x52ac02]=_0x22c779[_0x52ac02];}),this['refreshParticles'](![]);}['destroy'](){const _0x8c4609=_0x50525e;clearTimeout(this['canrefresh']),this['particlesComputing']['destroyParticlesTextures'](),Object['keys'](this['particlesComputing']['windTextures'])['forEach'](_0x2d4caa=>{const _0x20b1b3=_0x3c67;this['particlesComputing'][_0x20b1b3(0x132)][_0x2d4caa][_0x20b1b3(0x113)]();}),this['particlesRendering'][_0x8c4609(0x11c)]['colorTable']['destroy'](),Object[_0x8c4609(0x171)](this['particlesRendering']['framebuffers'])['forEach'](_0x4ebdb9=>{this['particlesRendering']['framebuffers'][_0x4ebdb9]['destroy']();});for(const _0x522157 in this){delete this[_0x522157];}}}const Cesium$1=mars3d__namespace['Cesium'],BaseLayer$1=mars3d__namespace[_0x50525e(0x161)]['BaseLayer'],DEF_OPTIONS={'particlesNumber':0x1000,'fixedHeight':0x0,'fadeOpacity':0.996,'dropRate':0.003,'dropRateBump':0.01,'speedFactor':0.5,'lineWidth':0x2,'colors':[_0x50525e(0x1de)]};class WindLayer extends BaseLayer$1{constructor(_0x21b876={}){_0x21b876={...DEF_OPTIONS,..._0x21b876},super(_0x21b876),this['_setOptionsHook'](_0x21b876);}get['layer'](){return this['primitives'];}get[_0x50525e(0x121)](){return this['_data'];}set['data'](_0x2f536d){this['setData'](_0x2f536d);}get['colors'](){return this['options']['colors'];}set['colors'](_0xf97f27){const _0x7445d3=_0x50525e;this[_0x7445d3(0x117)]['colors']=_0xf97f27,this['particleSystem']&&this['particleSystem'][_0x7445d3(0x1ae)]({'colors':_0xf97f27}),this['resize']();}['_mountedHook'](){}['_addedHook'](){const _0x2918c4=_0x50525e;this[_0x2918c4(0x17a)]=this['_map']['scene'],this[_0x2918c4(0xfa)]=this['_map']['camera'],this['primitives']=new Cesium$1[(_0x2918c4(0x1d2))](),this['_map'][_0x2918c4(0x17a)]['primitives']['add'](this['primitives']),this[_0x2918c4(0x133)]={'lonRange':new Cesium$1['Cartesian2'](),'latRange':new Cesium$1['Cartesian2'](),'pixelSize':0x0},this['globeBoundingSphere']=new Cesium$1['BoundingSphere'](Cesium$1['Cartesian3']['ZERO'],0.99*0x615299),this[_0x2918c4(0x1d7)](),window['addEventListener']('resize',this['resize'][_0x2918c4(0x1b0)](this),![]),this['mouse_down']=![],this['mouse_move']=![],this['_map']['on'](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this['_map']['on'](mars3d__namespace['EventType'][_0x2918c4(0x13e)],this['_onMouseDownEvent'],this),this[_0x2918c4(0x193)]['on'](mars3d__namespace['EventType'][_0x2918c4(0x1df)],this['_onMouseUpEvent'],this),this[_0x2918c4(0x193)]['on'](mars3d__namespace['EventType'][_0x2918c4(0x15b)],this['_onMouseMoveEvent'],this),this['_data']&&this['setData'](this['_data']);}['_removedHook'](){const _0x44efc0=_0x50525e;window['removeEventListener'](_0x44efc0(0x147),this[_0x44efc0(0x147)]),this[_0x44efc0(0x193)]['off'](mars3d__namespace['EventType']['preRender'],this['_onMap_preRenderEvent'],this),this['_map'][_0x44efc0(0x1d8)](mars3d__namespace['EventType']['wheel'],this[_0x44efc0(0x12c)],this),this['_map'][_0x44efc0(0x1d8)](mars3d__namespace[_0x44efc0(0x1b3)][_0x44efc0(0x13e)],this['_onMouseDownEvent'],this),this['_map']['off'](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this),this[_0x44efc0(0x193)]['off'](mars3d__namespace[_0x44efc0(0x1b3)]['mouseMove'],this['_onMouseMoveEvent'],this),this['primitives']['removeAll'](),this[_0x44efc0(0x193)][_0x44efc0(0x17a)]['primitives']['remove'](this['primitives']);}['resize'](){const _0x4b18a4=_0x50525e;if(!this['show']||!this['particleSystem'])return;this['primitives']['show']=![],this['primitives']['removeAll'](),this['_map'][_0x4b18a4(0x168)](mars3d__namespace['EventType']['preRender'],this['_onMap_preRenderEvent'],this);}[_0x50525e(0x150)](_0x5d7591){const _0x59afcb=_0x50525e;this[_0x59afcb(0xf1)]['canvasResize'](this['scene']['context']),this[_0x59afcb(0x1be)](),this[_0x59afcb(0x101)]['show']=!![];}['_onMapWhellEvent'](_0x18b662){const _0x4660b8=_0x50525e;clearTimeout(this['refreshTimer']);if(!this['show']||!this['particleSystem'])return;this['primitives'][_0x4660b8(0x16e)]=![],this['refreshTimer']=setTimeout(()=>{if(!this['show'])return;this['redraw']();},0xc8);}['_onMouseDownEvent'](_0x5b2e39){this['mouse_down']=!![];}[_0x50525e(0x13d)](_0xb51713){const _0x35be74=_0x50525e;if(!this['show']||!this['particleSystem'])return;this['mouse_down']&&(this[_0x35be74(0x101)]['show']=![],this[_0x35be74(0x160)]=!![]);}['_onMouseUpEvent'](_0x16cd0e){const _0x7008f1=_0x50525e;if(!this['show']||!this['particleSystem'])return;this[_0x7008f1(0xfe)]&&this['mouse_move']&&this['redraw'](),this['primitives'][_0x7008f1(0x16e)]=!![],this[_0x7008f1(0xfe)]=![],this[_0x7008f1(0x160)]=![];}[_0x50525e(0x144)](){const _0x4b540b=_0x50525e;if(!this['_map']||!this['show'])return;this[_0x4b540b(0x1d7)](),this['particleSystem']['applyViewerParameters'](this['viewerParameters']),this['primitives'][_0x4b540b(0x16e)]=!![];}['setData'](_0x1cba52){const _0x278ae3=_0x50525e;this[_0x278ae3(0x130)]=_0x1cba52,this['particleSystem']&&this[_0x278ae3(0xf1)]['destroy'](),this[_0x278ae3(0xf1)]=new ParticleSystem(this['scene']['context'],_0x1cba52,this['getOptions'](),this['viewerParameters']),this[_0x278ae3(0x1be)]();}['_setOptionsHook'](_0x662012,_0x151f77){const _0x340719=_0x50525e;if(_0x662012)for(const _0x561155 in _0x662012){this[_0x561155]=_0x662012[_0x561155];}this['particleSystem']&&this[_0x340719(0xf1)]['setOptions'](this['getOptions']());}['getOptions'](){const _0x5aef51=_0x50525e,_0x489603=Math[_0x5aef51(0x170)](Math['sqrt'](this['particlesNumber']));return this[_0x5aef51(0x17b)]=_0x489603*_0x489603,{'particlesTextureSize':_0x489603,'maxParticles':this['particlesNumber'],'particleHeight':this['fixedHeight'],'fadeOpacity':this['fadeOpacity'],'dropRate':this[_0x5aef51(0x1bb)],'dropRateBump':this[_0x5aef51(0x131)],'speedFactor':this[_0x5aef51(0x14b)],'lineWidth':this['lineWidth'],'colors':this['colors']};}['addPrimitives'](){const _0x3b33af=_0x50525e;this[_0x3b33af(0x101)]['add'](this['particleSystem'][_0x3b33af(0x1bc)]['primitives']['getWind']),this[_0x3b33af(0x101)]['add'](this[_0x3b33af(0xf1)][_0x3b33af(0x1bc)]['primitives']['updateSpeed']),this['primitives'][_0x3b33af(0x1b8)](this[_0x3b33af(0xf1)][_0x3b33af(0x1bc)]['primitives']['updatePosition']),this['primitives']['add'](this[_0x3b33af(0xf1)]['particlesComputing']['primitives'][_0x3b33af(0x120)]),this[_0x3b33af(0x101)]['add'](this[_0x3b33af(0xf1)]['particlesComputing']['primitives'][_0x3b33af(0x148)]),this[_0x3b33af(0x101)]['add'](this['particleSystem']['particlesRendering']['primitives']['segments']),this[_0x3b33af(0x101)]['add'](this[_0x3b33af(0xf1)][_0x3b33af(0xff)]['primitives'][_0x3b33af(0x1cd)]),this['primitives'][_0x3b33af(0x1b8)](this['particleSystem'][_0x3b33af(0xff)]['primitives']['screen']);}[_0x50525e(0x1d7)](){const _0x51ea5b=_0x50525e;let _0x47b0db=this['camera']['computeViewRectangle'](this['scene']['globe']['ellipsoid']);if(!_0x47b0db){const _0x360bf7=this['_map']['getExtent']();_0x47b0db=Cesium$1['Rectangle']['fromDegrees'](_0x360bf7['xmin'],_0x360bf7['ymin'],_0x360bf7['xmax'],_0x360bf7['ymax']);}const _0x59f943=Util['viewRectangleToLonLatRange'](_0x47b0db);this['viewerParameters']['lonRange']['x']=_0x59f943['lon'][_0x51ea5b(0x1db)],this[_0x51ea5b(0x133)]['lonRange']['y']=_0x59f943['lon']['max'],this['viewerParameters']['latRange']['x']=_0x59f943['lat']['min'],this['viewerParameters']['latRange']['y']=_0x59f943['lat']['max'];const _0x2a3a43=this['camera'][_0x51ea5b(0x190)](this['globeBoundingSphere'],this[_0x51ea5b(0x17a)]['drawingBufferWidth'],this['scene'][_0x51ea5b(0x136)]);_0x2a3a43>0x0&&(this['viewerParameters'][_0x51ea5b(0x10f)]=_0x2a3a43);}}mars3d__namespace[_0x50525e(0x19b)][_0x50525e(0x19c)]('wind',WindLayer),mars3d__namespace['layer']['WindLayer']=WindLayer;class CanvasParticle{constructor(){const _0x55886a=_0x50525e;this['lng']=null,this[_0x55886a(0x192)]=null,this['tlng']=null,this['tlat']=null,this[_0x55886a(0x139)]=null,this['speed']=null;}['destroy'](){for(const _0x3a92dd in this){delete this[_0x3a92dd];}}}function _0x3c67(_0x141910,_0xe0934b){const _0x468e18=_0x468e();return _0x3c67=function(_0x3c678e,_0x580947){_0x3c678e=_0x3c678e-0xf0;let _0x375797=_0x468e18[_0x3c678e];return _0x375797;},_0x3c67(_0x141910,_0xe0934b);}class CanvasWindField{constructor(_0x4f361c){const _0x4c308b=_0x50525e;this[_0x4c308b(0x1ae)](_0x4f361c);}get[_0x50525e(0x172)](){const _0x3256bb=_0x50525e;return this[_0x3256bb(0x199)];}set[_0x50525e(0x172)](_0x157139){const _0x5f59ff=_0x50525e;this['_speedRate']=(0x64-(_0x157139>0x63?0x63:_0x157139))*0x64,this[_0x5f59ff(0x1c0)]=[(this[_0x5f59ff(0x116)]-this['xmin'])/this[_0x5f59ff(0x199)],(this[_0x5f59ff(0x1da)]-this['ymin'])/this['_speedRate']];}get['maxAge'](){const _0x4a09e6=_0x50525e;return this[_0x4a09e6(0x10e)];}set['maxAge'](_0x1b9849){this['_maxAge']=_0x1b9849;}['setOptions'](_0x282113){const _0xa8c33e=_0x50525e;this['options']=_0x282113,this['maxAge']=_0x282113['maxAge']||0x78,this['speedRate']=_0x282113['speedRate']||0x32,this['particles']=[];const _0x4fee23=_0x282113['particlesNumber']||0x1000;for(let _0x3e81e0=0x0;_0x3e81e0<_0x4fee23;_0x3e81e0++){const _0x3e1a54=this[_0xa8c33e(0x159)](new CanvasParticle());this[_0xa8c33e(0x19a)][_0xa8c33e(0x1a7)](_0x3e1a54);}}['setDate'](_0x14ce4b){const _0x5a29c3=_0x50525e;this['rows']=_0x14ce4b['rows'],this['cols']=_0x14ce4b[_0x5a29c3(0x198)],this['xmin']=_0x14ce4b['xmin'],this['xmax']=_0x14ce4b['xmax'],this['ymin']=_0x14ce4b['ymin'],this['ymax']=_0x14ce4b[_0x5a29c3(0x1da)],this[_0x5a29c3(0x1a1)]=[];const _0x5fe3e1=_0x14ce4b[_0x5a29c3(0x10d)],_0x312c56=_0x14ce4b[_0x5a29c3(0x10b)];let _0x12f28a=![];_0x5fe3e1['length']===this['rows']&&_0x5fe3e1[0x0]['length']===this['cols']&&(_0x12f28a=!![]);let _0x951372=0x0,_0x47108a=null,_0x3fbc3e=null;for(let _0x4a6260=0x0;_0x4a6260<this['rows'];_0x4a6260++){_0x47108a=[];for(let _0x441593=0x0;_0x441593<this['cols'];_0x441593++,_0x951372++){_0x12f28a?_0x3fbc3e=this['_calcUV'](_0x5fe3e1[_0x4a6260][_0x441593],_0x312c56[_0x4a6260][_0x441593]):_0x3fbc3e=this[_0x5a29c3(0x1dd)](_0x5fe3e1[_0x951372],_0x312c56[_0x951372]),_0x47108a['push'](_0x3fbc3e);}this['grid']['push'](_0x47108a);}this['options']['reverseY']&&this['grid']['reverse']();}['clear'](){const _0x52eda9=_0x50525e;delete this['rows'],delete this['cols'],delete this['xmin'],delete this['xmax'],delete this['ymin'],delete this['ymax'],delete this[_0x52eda9(0x1a1)],delete this['particles'];}['toGridXY'](_0x41d2fd,_0x34b616){const _0x55d0d5=_0x50525e,_0x2fa462=(_0x41d2fd-this['xmin'])/(this[_0x55d0d5(0x116)]-this['xmin'])*(this['cols']-0x1),_0x1e1743=(this[_0x55d0d5(0x1da)]-_0x34b616)/(this['ymax']-this['ymin'])*(this[_0x55d0d5(0x1c1)]-0x1);return[_0x2fa462,_0x1e1743];}['getUVByXY'](_0x33fe95,_0x369c38){const _0x51dbe3=_0x50525e;if(_0x33fe95<0x0||_0x33fe95>=this[_0x51dbe3(0x198)]||_0x369c38>=this['rows'])return[0x0,0x0,0x0];const _0x6ac5a0=Math['floor'](_0x33fe95),_0x1a1a0c=Math['floor'](_0x369c38);if(_0x6ac5a0===_0x33fe95&&_0x1a1a0c===_0x369c38)return this['grid'][_0x369c38][_0x33fe95];const _0x1c4128=_0x6ac5a0+0x1,_0x188c15=_0x1a1a0c+0x1,_0x346454=this[_0x51dbe3(0x1d0)](_0x6ac5a0,_0x1a1a0c),_0x432e81=this['getUVByXY'](_0x1c4128,_0x1a1a0c),_0x24320b=this[_0x51dbe3(0x1d0)](_0x6ac5a0,_0x188c15),_0x342393=this['getUVByXY'](_0x1c4128,_0x188c15);let _0x4c217d=null;try{_0x4c217d=this['_bilinearInterpolation'](_0x33fe95-_0x6ac5a0,_0x369c38-_0x1a1a0c,_0x346454,_0x432e81,_0x24320b,_0x342393);}catch(_0x53cf11){console[_0x51dbe3(0x1a4)](_0x33fe95,_0x369c38);}return _0x4c217d;}['_bilinearInterpolation'](_0x14e3a3,_0x373858,_0x268190,_0x8a4ac7,_0x34de06,_0x27b190){const _0x4091fe=0x1-_0x14e3a3,_0x36f9e3=0x1-_0x373858,_0x118a97=_0x4091fe*_0x36f9e3,_0x57beb6=_0x14e3a3*_0x36f9e3,_0x572257=_0x4091fe*_0x373858,_0x1bd267=_0x14e3a3*_0x373858,_0xb5dab5=_0x268190[0x0]*_0x118a97+_0x8a4ac7[0x0]*_0x57beb6+_0x34de06[0x0]*_0x572257+_0x27b190[0x0]*_0x1bd267,_0x1aff89=_0x268190[0x1]*_0x118a97+_0x8a4ac7[0x1]*_0x57beb6+_0x34de06[0x1]*_0x572257+_0x27b190[0x1]*_0x1bd267;return this['_calcUV'](_0xb5dab5,_0x1aff89);}['_calcUV'](_0x4ed3a0,_0x47068f){const _0xbe6317=_0x50525e;return[+_0x4ed3a0,+_0x47068f,Math[_0xbe6317(0x1d3)](_0x4ed3a0*_0x4ed3a0+_0x47068f*_0x47068f)];}['getUVByPoint'](_0x5c1b3d,_0x37510e){const _0x3afd5b=_0x50525e;if(!this['isInExtent'](_0x5c1b3d,_0x37510e))return null;const _0x1573fc=this[_0x3afd5b(0x186)](_0x5c1b3d,_0x37510e),_0x1b7956=this['getUVByXY'](_0x1573fc[0x0],_0x1573fc[0x1]);return _0x1b7956;}['isInExtent'](_0xd49167,_0x483729){const _0x48e12e=_0x50525e;return _0xd49167>=this['xmin']&&_0xd49167<=this['xmax']&&_0x483729>=this[_0x48e12e(0x1a9)]&&_0x483729<=this[_0x48e12e(0x1da)]?!![]:![];}[_0x50525e(0x197)](){const _0xb68dce=_0x50525e,_0x285d8b=fRandomByfloat(this[_0xb68dce(0x11a)],this['xmax']),_0xe82978=fRandomByfloat(this['ymin'],this['ymax']);return{'lat':_0xe82978,'lng':_0x285d8b};}['getParticles'](){const _0x337685=_0x50525e;let _0x4ecf51,_0xc1f465,_0x3414ca;for(let _0x1c5b4f=0x0,_0x25fe7b=this['particles']['length'];_0x1c5b4f<_0x25fe7b;_0x1c5b4f++){let _0x33bb5e=this[_0x337685(0x19a)][_0x1c5b4f];_0x33bb5e[_0x337685(0x139)]<=0x0&&(_0x33bb5e=this[_0x337685(0x159)](_0x33bb5e));if(_0x33bb5e['age']>0x0){const _0x2f1c1e=_0x33bb5e['tlng'],_0x5bc8d1=_0x33bb5e['tlat'];_0x3414ca=this['getUVByPoint'](_0x2f1c1e,_0x5bc8d1),_0x3414ca?(_0x4ecf51=_0x2f1c1e+this['_calc_speedRate'][0x0]*_0x3414ca[0x0],_0xc1f465=_0x5bc8d1+this['_calc_speedRate'][0x1]*_0x3414ca[0x1],_0x33bb5e['lng']=_0x2f1c1e,_0x33bb5e[_0x337685(0x192)]=_0x5bc8d1,_0x33bb5e[_0x337685(0x103)]=_0x4ecf51,_0x33bb5e['tlat']=_0xc1f465,_0x33bb5e['speed']=_0x3414ca[0x2],_0x33bb5e['age']--):_0x33bb5e[_0x337685(0x139)]=0x0;}}return this[_0x337685(0x19a)];}[_0x50525e(0x159)](_0x4f0cdc){const _0x310e5d=_0x50525e;let _0x18e2a8,_0xbdc48;for(let _0x5b7ddf=0x0;_0x5b7ddf<0x1e;_0x5b7ddf++){_0x18e2a8=this['getRandomLatLng'](),_0xbdc48=this['getUVByPoint'](_0x18e2a8['lng'],_0x18e2a8['lat']);if(_0xbdc48&&_0xbdc48[0x2]>0x0)break;}if(!_0xbdc48)return _0x4f0cdc;const _0x4a2fea=_0x18e2a8['lng']+this['_calc_speedRate'][0x0]*_0xbdc48[0x0],_0x2b1a63=_0x18e2a8['lat']+this[_0x310e5d(0x1c0)][0x1]*_0xbdc48[0x1];return _0x4f0cdc['lng']=_0x18e2a8['lng'],_0x4f0cdc['lat']=_0x18e2a8['lat'],_0x4f0cdc['tlng']=_0x4a2fea,_0x4f0cdc['tlat']=_0x2b1a63,_0x4f0cdc['age']=Math['round'](Math[_0x310e5d(0x143)]()*this['maxAge']),_0x4f0cdc[_0x310e5d(0x12f)]=_0xbdc48[0x2],_0x4f0cdc;}['destroy'](){for(const _0x41f6a4 in this){delete this[_0x41f6a4];}}}function fRandomByfloat(_0x445e94,_0x425651){return _0x445e94+Math['random']()*(_0x425651-_0x445e94);}const Cesium=mars3d__namespace['Cesium'],BaseLayer=mars3d__namespace['layer']['BaseLayer'];class CanvasWindLayer extends BaseLayer{constructor(_0x5580c3={}){super(_0x5580c3),this['_setOptionsHook'](_0x5580c3),this['canvas']=null,_0x5580c3['colors']&&_0x5580c3['steps']&&(this['_colorRamp']=new mars3d__namespace['ColorRamp'](_0x5580c3));}['_setOptionsHook'](_0x2262f5,_0x47d1f5){const _0x18225c=_0x50525e;this[_0x18225c(0x16c)]=0x3e8/(_0x2262f5['frameRate']||0xa),this['_pointerEvents']=this['options']['pointerEvents']??![],this[_0x18225c(0x19f)]=_0x2262f5[_0x18225c(0x19f)]||'#ffffff',this['lineWidth']=_0x2262f5['lineWidth']||0x1,this['fixedHeight']=_0x2262f5[_0x18225c(0x108)]??0x0,this[_0x18225c(0x173)]=_0x2262f5['reverseY']??![],this['windField']&&this['windField'][_0x18225c(0x1ae)](_0x2262f5);}get['layer'](){return this['canvas'];}get['canvasWidth'](){return this['_map']['scene']['canvas']['clientWidth'];}get[_0x50525e(0x188)](){const _0x1b1e05=_0x50525e;return this['_map'][_0x1b1e05(0x17a)]['canvas'][_0x1b1e05(0x157)];}get['pointerEvents'](){return this['_pointerEvents'];}set['pointerEvents'](_0x211726){const _0x2b09c6=_0x50525e;this['_pointerEvents']=_0x211726;if(!this[_0x2b09c6(0x1a6)])return;_0x211726?this[_0x2b09c6(0x1a6)]['style']['pointer-events']='all':this['canvas']['style']['pointer-events']=_0x2b09c6(0x18e);}get[_0x50525e(0x17b)](){const _0x11285c=_0x50525e;return this['options'][_0x11285c(0x17b)];}set['particlesNumber'](_0x2b5540){const _0x35c41c=_0x50525e;this['options']['particlesNumber']=_0x2b5540,clearTimeout(this[_0x35c41c(0x1c2)]),this['_canrefresh']=setTimeout(()=>{const _0x3ad483=_0x35c41c;this[_0x3ad483(0x144)]();},0x1f4);}get['speedRate'](){return this['options']['speedRate'];}set['speedRate'](_0x34045a){const _0x1904ae=_0x50525e;this['options']['speedRate']=_0x34045a,this[_0x1904ae(0x1b1)]&&(this[_0x1904ae(0x1b1)][_0x1904ae(0x172)]=_0x34045a);}get['maxAge'](){return this['options']['maxAge'];}set['maxAge'](_0x37b5d3){const _0x25ebfa=_0x50525e;this['options']['maxAge']=_0x37b5d3,this[_0x25ebfa(0x1b1)]&&(this[_0x25ebfa(0x1b1)]['maxAge']=_0x37b5d3);}get['data'](){return this['windData'];}set['data'](_0x16063b){const _0x49cae1=_0x50525e;this[_0x49cae1(0x1d6)](_0x16063b);}['_showHook'](_0x5e8b95){const _0x351b04=_0x50525e;_0x5e8b95?this['_addedHook']():(this['windData']&&(this[_0x351b04(0x117)]['data']=this[_0x351b04(0x182)]),this[_0x351b04(0x15c)]());}[_0x50525e(0x1e2)](){const _0x25c7ab=_0x50525e;this['options']['worker']?this[_0x25c7ab(0x11e)]():this['windField']=new CanvasWindField(this['options']);}['_addedHook'](){const _0xcd95e0=_0x50525e;this['canvas']=this['_createCanvas'](),this['canvasContext']=this['canvas']['getContext']('2d',{'willReadFrequently':!![]}),this['bindEvent'](),this['options']['data']&&this['setData'](this['options'][_0xcd95e0(0x121)]);}['_removedHook'](){const _0xfdf7d4=_0x50525e;this['clear'](),this[_0xfdf7d4(0x183)](),this['canvas']&&(this[_0xfdf7d4(0x193)]['container']['removeChild'](this['canvas']),delete this[_0xfdf7d4(0x1a6)]);}['_createCanvas'](){const _0x1e905a=_0x50525e,_0x4ebf06=mars3d__namespace['DomUtil']['create']('canvas','mars3d-canvasWind',this['_map'][_0x1e905a(0x124)]);return _0x4ebf06[_0x1e905a(0x194)]['position']='absolute',_0x4ebf06['style']['top']='0px',_0x4ebf06['style']['left']=_0x1e905a(0x15e),_0x4ebf06['style']['width']=this['_map'][_0x1e905a(0x17a)]['canvas']['clientWidth']+'px',_0x4ebf06['style']['height']=this['_map']['scene'][_0x1e905a(0x1a6)][_0x1e905a(0x157)]+'px',_0x4ebf06['style'][_0x1e905a(0x13c)]=this['_pointerEvents']?'auto':_0x1e905a(0x18e),_0x4ebf06['style']['zIndex']=this[_0x1e905a(0x117)]['zIndex']??0x9,_0x4ebf06['width']=this['_map']['scene'][_0x1e905a(0x1a6)]['clientWidth'],_0x4ebf06['height']=this[_0x1e905a(0x193)]['scene']['canvas']['clientHeight'],_0x4ebf06;}['resize'](){const _0x5aa21c=_0x50525e;this['canvas']&&(this['canvas']['style'][_0x5aa21c(0xf3)]=this['_map']['scene']['canvas'][_0x5aa21c(0x140)]+'px',this['canvas']['style'][_0x5aa21c(0x1a5)]=this[_0x5aa21c(0x193)][_0x5aa21c(0x17a)]['canvas']['clientHeight']+'px',this['canvas']['width']=this['_map']['scene']['canvas']['clientWidth'],this['canvas'][_0x5aa21c(0x1a5)]=this['_map']['scene']['canvas']['clientHeight']);}[_0x50525e(0x141)](){const _0x20c219=_0x50525e,_0x367de0=this;let _0x56e730=Date[_0x20c219(0x149)]();(function _0x2fc2f6(){const _0x4e3427=_0x20c219;_0x367de0[_0x4e3427(0x14c)]=window[_0x4e3427(0x169)](_0x2fc2f6);if(_0x367de0['show']&&_0x367de0['windField']){const _0x353bc4=Date[_0x4e3427(0x149)](),_0x1e1738=_0x353bc4-_0x56e730;_0x1e1738>_0x367de0['frameTime']&&(_0x56e730=_0x353bc4-_0x1e1738%_0x367de0['frameTime'],_0x367de0['update']());}}(),window['addEventListener']('resize',this['resize']['bind'](this),![]),this[_0x20c219(0xfe)]=![],this['mouse_move']=![],this['options']['mouseHidden']&&(this['_map']['on'](mars3d__namespace['EventType'][_0x20c219(0x109)],this['_onMapWhellEvent'],this),this['_map']['on'](mars3d__namespace[_0x20c219(0x1b3)]['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['on'](mars3d__namespace[_0x20c219(0x1b3)][_0x20c219(0x1df)],this['_onMouseUpEvent'],this)));}['unbindEvent'](){const _0x15e25d=_0x50525e;window['cancelAnimationFrame'](this['animateFrame']),delete this[_0x15e25d(0x14c)],window['removeEventListener']('resize',this['resize']),this[_0x15e25d(0x117)][_0x15e25d(0x189)]&&(this[_0x15e25d(0x193)][_0x15e25d(0x1d8)](mars3d__namespace['EventType'][_0x15e25d(0x109)],this['_onMapWhellEvent'],this),this[_0x15e25d(0x193)][_0x15e25d(0x1d8)](mars3d__namespace['EventType']['mouseDown'],this[_0x15e25d(0x119)],this),this['_map'][_0x15e25d(0x1d8)](mars3d__namespace['EventType'][_0x15e25d(0x1df)],this['_onMouseUpEvent'],this),this[_0x15e25d(0x193)]['off'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this));}['_onMapWhellEvent'](_0x3dabd0){const _0x53c788=_0x50525e;clearTimeout(this['refreshTimer']);if(!this[_0x53c788(0x16e)]||!this['canvas'])return;this['canvas']['style'][_0x53c788(0x100)]=_0x53c788(0x162),this[_0x53c788(0x1dc)]=setTimeout(()=>{const _0x44e0ac=_0x53c788;if(!this[_0x44e0ac(0x16e)])return;this[_0x44e0ac(0x144)](),this['canvas'][_0x44e0ac(0x194)][_0x44e0ac(0x100)]=_0x44e0ac(0x19d);},0xc8);}['_onMouseDownEvent'](_0x5bb215){const _0x1c8243=_0x50525e;this['mouse_down']=!![],this['_map']['off'](mars3d__namespace[_0x1c8243(0x1b3)]['mouseMove'],this[_0x1c8243(0x13d)],this),this['_map']['on'](mars3d__namespace['EventType']['mouseMove'],this[_0x1c8243(0x13d)],this);}[_0x50525e(0x13d)](_0x9f7dd){const _0x43eae3=_0x50525e;if(!this['show']||!this['canvas'])return;this[_0x43eae3(0xfe)]&&(this['canvas']['style'][_0x43eae3(0x100)]='hidden',this[_0x43eae3(0x160)]=!![]);}['_onMouseUpEvent'](_0x2fb013){const _0x39be81=_0x50525e;if(!this['show']||!this['canvas'])return;this['_map']['off'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this['mouse_down']&&this['mouse_move']&&this['redraw'](),this['canvas'][_0x39be81(0x194)]['visibility']='visible',this['mouse_down']=![],this['mouse_move']=![];}[_0x50525e(0x1d6)](_0x2c62b1){this['clear'](),this['windData']=_0x2c62b1,this['windField']['setDate'](_0x2c62b1),this['redraw']();}['redraw'](){const _0x26df83=_0x50525e;if(!this['show'])return;this['windField'][_0x26df83(0x1ae)](this['options']),this['update']();}[_0x50525e(0x1ce)](){const _0x5b9727=_0x50525e;if(this['_updateIng'])return;this[_0x5b9727(0x1d5)]=!![];if(this['worker'])this[_0x5b9727(0x1b1)]['update']();else{const _0x3efc8d=this['windField'][_0x5b9727(0x165)]();this['_drawLines'](_0x3efc8d);}this[_0x5b9727(0x1d5)]=![];}['_drawLines'](_0x10ed10){const _0x3ef7f6=_0x50525e;this['canvasContext'][_0x3ef7f6(0x14a)]='destination-in',this['canvasContext']['fillRect'](0x0,0x0,this['canvasWidth'],this[_0x3ef7f6(0x188)]),this['canvasContext'][_0x3ef7f6(0x14a)]='lighter',this['canvasContext']['globalAlpha']=0.9;const _0x1e6f1b=this['_map']['scene']['mode']!==Cesium[_0x3ef7f6(0x187)][_0x3ef7f6(0x1b7)],_0x5b06d0=this[_0x3ef7f6(0x1a8)]*0.25;if(this[_0x3ef7f6(0x152)])for(let _0x20ec53=0x0,_0x1091e7=_0x10ed10['length'];_0x20ec53<_0x1091e7;_0x20ec53++){const _0x2b92f9=_0x10ed10[_0x20ec53],_0x178c0d=this['_tomap'](_0x2b92f9['lng'],_0x2b92f9[_0x3ef7f6(0x192)],_0x2b92f9),_0x37ec95=this[_0x3ef7f6(0x1cb)](_0x2b92f9['tlng'],_0x2b92f9[_0x3ef7f6(0x134)],_0x2b92f9);if(!_0x178c0d||!_0x37ec95)continue;if(_0x1e6f1b&&Math['abs'](_0x178c0d[0x0]-_0x37ec95[0x0])>=_0x5b06d0)continue;this['canvasContext']['beginPath'](),this['canvasContext']['lineWidth']=this['lineWidth'],this['canvasContext'][_0x3ef7f6(0xf8)]=this['_colorRamp']['getColor'](_0x2b92f9['speed']),this['canvasContext']['moveTo'](_0x178c0d[0x0],_0x178c0d[0x1]),this['canvasContext'][_0x3ef7f6(0x126)](_0x37ec95[0x0],_0x37ec95[0x1]),this['canvasContext'][_0x3ef7f6(0x175)]();}else{this['canvasContext']['beginPath'](),this['canvasContext']['lineWidth']=this['lineWidth'],this[_0x3ef7f6(0x102)][_0x3ef7f6(0xf8)]=this['color'];for(let _0x488510=0x0,_0x4ec303=_0x10ed10['length'];_0x488510<_0x4ec303;_0x488510++){const _0x4b055e=_0x10ed10[_0x488510],_0x58769b=this['_tomap'](_0x4b055e['lng'],_0x4b055e['lat'],_0x4b055e),_0x41d866=this['_tomap'](_0x4b055e[_0x3ef7f6(0x103)],_0x4b055e['tlat'],_0x4b055e);if(!_0x58769b||!_0x41d866)continue;if(_0x1e6f1b&&Math['abs'](_0x58769b[0x0]-_0x41d866[0x0])>=_0x5b06d0)continue;this[_0x3ef7f6(0x102)]['moveTo'](_0x58769b[0x0],_0x58769b[0x1]),this['canvasContext'][_0x3ef7f6(0x126)](_0x41d866[0x0],_0x41d866[0x1]);}this['canvasContext'][_0x3ef7f6(0x175)]();}}[_0x50525e(0x1cb)](_0x21cafe,_0x3d9c8a,_0x1b6ee6){const _0x42ecfd=_0x50525e,_0x12893a=Cesium['Cartesian3']['fromDegrees'](_0x21cafe,_0x3d9c8a,this['fixedHeight']),_0x36c1d3=this[_0x42ecfd(0x193)]['scene'];if(_0x36c1d3['mode']===Cesium[_0x42ecfd(0x187)]['SCENE3D']){const _0x433b91=new Cesium['EllipsoidalOccluder'](_0x36c1d3['globe'][_0x42ecfd(0x13a)],_0x36c1d3['camera'][_0x42ecfd(0x1d9)]),_0x55ca40=_0x433b91[_0x42ecfd(0x146)](_0x12893a);if(!_0x55ca40)return _0x1b6ee6['age']=0x0,null;}const _0x669bd=Cesium['SceneTransforms']['wgs84ToWindowCoordinates'](this['_map']['scene'],_0x12893a);return _0x669bd?[_0x669bd['x'],_0x669bd['y']]:null;}[_0x50525e(0x1e3)](){const _0x2df679=_0x50525e;this[_0x2df679(0x1b1)]['clear'](),delete this['windData'];}['initWorker'](){const _0x4ce4b6=_0x50525e;this[_0x4ce4b6(0xf9)]=new Worker(this['options']['worker']),this['worker']['onmessage']=_0x3d3c1c=>{const _0x38fa7f=_0x4ce4b6;this['_drawLines'](_0x3d3c1c[_0x38fa7f(0x121)]['particles']),this['_updateIng2']=![];},this['windField']={'init':_0x27dea5=>{const _0x312ebc=_0x4ce4b6;this['worker']['postMessage']({'type':_0x312ebc(0x1b4),'options':_0x27dea5});},'setOptions':_0x494293=>{this['worker']['postMessage']({'type':'setOptions','options':_0x494293});},'setDate':_0x4508f2=>{const _0x5c0a9f=_0x4ce4b6;this['worker']['postMessage']({'type':_0x5c0a9f(0x18f),'data':_0x4508f2});},'update':()=>{const _0x301756=_0x4ce4b6;if(this['_updateIng2'])return;this['_updateIng2']=!![],this[_0x301756(0xf9)][_0x301756(0x12a)]({'type':_0x301756(0x1ce)});},'clear':()=>{const _0x321418=_0x4ce4b6;this[_0x321418(0xf9)]['postMessage']({'type':'clear'});}},this['windField']['init'](this['options']);}}mars3d__namespace[_0x50525e(0x19b)][_0x50525e(0x19c)]('canvasWind',CanvasWindLayer),mars3d__namespace[_0x50525e(0x161)]['CanvasWindLayer']=CanvasWindLayer,mars3d__namespace[_0x50525e(0x181)]=CanvasWindField,mars3d__namespace[_0x50525e(0x1c8)]=WindUtil,exports['CanvasWindField']=CanvasWindField,exports[_0x50525e(0x1c9)]=CanvasWindLayer,exports['WindLayer']=WindLayer,exports[_0x50525e(0x1c8)]=WindUtil,Object['defineProperty'](exports,'__esModule',{'value':!![]});
}));
