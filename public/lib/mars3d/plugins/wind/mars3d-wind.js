/**
 * Mars3D平台插件,支持气象 风向图 功能插件  mars3d-wind
 *
 * 版本信息：v3.6.8
 * 编译日期：2023-10-08 23:31:23
 * 版权所有：Copyright by 火星科技  http://mars3d.cn
 * 使用单位：免费公开版 ，2023-03-17
 */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, (window.mars3d || require('mars3d'))) :
  typeof define === 'function' && define.amd ? define(['exports', 'mars3d'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global["mars3d-wind"] = {}, global.mars3d));
})(this, (function (exports, mars3d) { 
'use strict';const _0x3a25a4=_0x21a1;(function(_0x42859c,_0x251352){const _0x52b20a=_0x21a1,_0x2b46f8=_0x42859c();while(!![]){try{const _0x1875d0=-parseInt(_0x52b20a(0x257))/0x1*(-parseInt(_0x52b20a(0x1b9))/0x2)+-parseInt(_0x52b20a(0x244))/0x3+-parseInt(_0x52b20a(0x1e7))/0x4*(parseInt(_0x52b20a(0x1db))/0x5)+parseInt(_0x52b20a(0x1ff))/0x6*(-parseInt(_0x52b20a(0x26c))/0x7)+-parseInt(_0x52b20a(0x193))/0x8*(parseInt(_0x52b20a(0x20a))/0x9)+-parseInt(_0x52b20a(0x207))/0xa+parseInt(_0x52b20a(0x1e5))/0xb;if(_0x1875d0===_0x251352)break;else _0x2b46f8['push'](_0x2b46f8['shift']());}catch(_0x5370d1){_0x2b46f8['push'](_0x2b46f8['shift']());}}}(_0x3469,0x4fb7a));function _interopNamespace(_0x29d455){if(_0x29d455&&_0x29d455['__esModule'])return _0x29d455;var _0x39042a=Object['create'](null);return _0x29d455&&Object['keys'](_0x29d455)['forEach'](function(_0x4d855a){const _0xec231=_0x21a1;if(_0x4d855a!=='default'){var _0x465af8=Object['getOwnPropertyDescriptor'](_0x29d455,_0x4d855a);Object[_0xec231(0x202)](_0x39042a,_0x4d855a,_0x465af8['get']?_0x465af8:{'enumerable':!![],'get':function(){return _0x29d455[_0x4d855a];}});}}),_0x39042a['default']=_0x29d455,_0x39042a;}var mars3d__namespace=_interopNamespace(mars3d);const Cesium$7=mars3d__namespace[_0x3a25a4(0x191)];function getU(_0x565b95,_0x1806f6){const _0x3e6283=_0x3a25a4,_0xeb77e=_0x565b95*Math[_0x3e6283(0x24d)](Cesium$7[_0x3e6283(0x21d)]['toRadians'](_0x1806f6));return _0xeb77e;}function getV(_0x386450,_0x4390e6){const _0x2375cc=_0x3a25a4,_0x22845f=_0x386450*Math[_0x2375cc(0x1d9)](Cesium$7['Math']['toRadians'](_0x4390e6));return _0x22845f;}function _0x3469(){const _0x1461fd=['Cartesian3','particlesComputing','Math','moveTo','FLOAT','isInExtent','windTextures','particlesTextures','VertexArray','sqrt','createRenderingPrimitives','scene','pointerEvents','clampToLatitudeRange','height','refreshTimer','lev','mouseUp','lon','setOptions','dimensions','animateFrame','maxAge','TWO_PI','0px','clearFramebuffers','tlat','PixelDatatype','execute','uniformMap','floor','getColor','vertexArray','max','_setOptionsHook','removeAll','getUVByXY','mouse_down','_map','_calc_speedRate','trails','1514073VjibNF','computeViewRectangle','BufferUsage','vertexShaderSource','mars3d-canvasWind','setData','arrayBufferView','speedRate','none','cos','_data','_updateIng2','createTexture','preExecute','stroke','once','layer','randomizeParticles','_speedRate','28imeQiD','outputTexture','STATIC_DRAW','beginPath','mouse_move','fadeOpacity','OPAQUE','lineTo','createCommand','nextTrailsDepth','clientWidth','array','TRIANGLES','SceneMode','fromGeometry','canvas','_tomap','LayerUtil','globeBoundingSphere','drawingBufferHeight','ellipsoid','2503487iqAmeJ','lineWidth','resize','ymin','primitives','shaderProgram','rawRenderState','latRange','commandToExecute','_bilinearInterpolation','_mountedHook','_drawLines','postProcessingPosition','canrefresh','rows','length','createRawRenderState','textures','push','_onMapWhellEvent','currentTrails','rgb(206,255,255)','fromCache','mouseMove','mouseDown','xmin','age','globalCompositeOperation','particlesRendering','blue','_calcUV','Cesium','vmax','2306152WKWslg','ComponentDatatype','framebuffer','zIndex','geometry','context','fragmentShaderSource','particlesTextureSize','DepthFunction','createParticlesTextures','segments','attributeLocations','createSegmentsGeometry','LINEAR','frameTime','autoClear','onmessage','ymax','canvasHeight','_maxAge','style','RenderState','windField','getUVByPoint','requestAnimationFrame','_pointerEvents','destroy','setDate','random','RGBA','updatePosition','PixelFormat','canvasWidth','grid','Rectangle','ZERO','Sampler','particlesWind','37816HwchcE','updateViewerParameters','currentParticlesPosition','mod','_onMouseDownEvent','primitiveType','Texture','particlesNumber','updateSpeed','getExtent','lat','forEach','WindUtil','clear','//\x20the\x20size\x20of\x20UV\x20textures:\x20width\x20=\x20lon,\x20height\x20=\x20lat*lev\x0auniform\x20sampler2D\x20U;\x20//\x20eastward\x20wind\x0auniform\x20sampler2D\x20V;\x20//\x20northward\x20wind\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0a\x0auniform\x20vec3\x20dimension;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20vec3\x20minimum;\x20//\x20minimum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20maximum;\x20//\x20maximum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20interval;\x20//\x20interval\x20of\x20each\x20dimension\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20mapPositionToNormalizedIndex2D(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20range\x20of\x20longitude\x20and\x20latitude\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x,\x20360.0);\x0a\x20\x20\x20\x20lonLatLev.y\x20=\x20clamp(lonLatLev.y,\x20-90.0,\x2090.0);\x0a\x0a\x20\x20\x20\x20vec3\x20index3D\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20index3D.x\x20=\x20(lonLatLev.x\x20-\x20minimum.x)\x20/\x20interval.x;\x0a\x20\x20\x20\x20index3D.y\x20=\x20(lonLatLev.y\x20-\x20minimum.y)\x20/\x20interval.y;\x0a\x20\x20\x20\x20index3D.z\x20=\x20(lonLatLev.z\x20-\x20minimum.z)\x20/\x20interval.z;\x0a\x0a\x20\x20\x20\x20//\x20the\x20st\x20texture\x20coordinate\x20corresponding\x20to\x20(col,\x20row)\x20index\x0a\x20\x20\x20\x20//\x20example\x0a\x20\x20\x20\x20//\x20data\x20array\x20is\x20[0,\x201,\x202,\x203,\x204,\x205],\x20width\x20=\x203,\x20height\x20=\x202\x0a\x20\x20\x20\x20//\x20the\x20content\x20of\x20texture\x20will\x20be\x0a\x20\x20\x20\x20//\x20t\x201.0\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x203\x204\x205\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x200\x201\x202\x0a\x20\x20\x20\x20//\x20\x20\x200.0------1.0\x20s\x0a\x0a\x20\x20\x20\x20vec2\x20index2D\x20=\x20vec2(index3D.x,\x20index3D.z\x20*\x20dimension.y\x20+\x20index3D.y);\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20vec2(index2D.x\x20/\x20dimension.x,\x20index2D.y\x20/\x20(dimension.y\x20*\x20dimension.z));\x0a\x20\x20\x20\x20return\x20normalizedIndex2D;\x0a}\x0a\x0afloat\x20getWind(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20mapPositionToNormalizedIndex2D(lonLatLev);\x0a\x20\x20\x20\x20float\x20result\x20=\x20texture(windTexture,\x20normalizedIndex2D).r;\x0a\x20\x20\x20\x20return\x20result;\x0a}\x0a\x0aconst\x20mat4\x20kernelMatrix\x20=\x20mat4(\x0a\x20\x20\x20\x200.0,\x20-1.0,\x202.0,\x20-1.0,\x20//\x20first\x20column\x0a\x20\x20\x20\x202.0,\x200.0,\x20-5.0,\x203.0,\x20//\x20second\x20column\x0a\x20\x20\x20\x200.0,\x201.0,\x204.0,\x20-3.0,\x20//\x20third\x20column\x0a\x20\x20\x20\x200.0,\x200.0,\x20-1.0,\x201.0\x20//\x20fourth\x20column\x0a);\x0afloat\x20oneDimensionInterpolation(float\x20t,\x20float\x20p0,\x20float\x20p1,\x20float\x20p2,\x20float\x20p3)\x20{\x0a\x20\x20\x20\x20vec4\x20tVec4\x20=\x20vec4(1.0,\x20t,\x20t\x20*\x20t,\x20t\x20*\x20t\x20*\x20t);\x0a\x20\x20\x20\x20tVec4\x20=\x20tVec4\x20/\x202.0;\x0a\x20\x20\x20\x20vec4\x20pVec4\x20=\x20vec4(p0,\x20p1,\x20p2,\x20p3);\x0a\x20\x20\x20\x20return\x20dot((tVec4\x20*\x20kernelMatrix),\x20pVec4);\x0a}\x0a\x0afloat\x20calculateB(sampler2D\x20windTexture,\x20float\x20t,\x20float\x20lon,\x20float\x20lat,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20float\x20lon0\x20=\x20floor(lon)\x20-\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon1\x20=\x20floor(lon);\x0a\x20\x20\x20\x20float\x20lon2\x20=\x20floor(lon)\x20+\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon3\x20=\x20floor(lon)\x20+\x202.0\x20*\x20interval.x;\x0a\x0a\x20\x20\x20\x20float\x20p0\x20=\x20getWind(windTexture,\x20vec3(lon0,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p1\x20=\x20getWind(windTexture,\x20vec3(lon1,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p2\x20=\x20getWind(windTexture,\x20vec3(lon2,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p3\x20=\x20getWind(windTexture,\x20vec3(lon3,\x20lat,\x20lev));\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(t,\x20p0,\x20p1,\x20p2,\x20p3);\x0a}\x0a\x0afloat\x20interpolateOneTexture(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20float\x20lon\x20=\x20lonLatLev.x;\x0a\x20\x20\x20\x20float\x20lat\x20=\x20lonLatLev.y;\x0a\x20\x20\x20\x20float\x20lev\x20=\x20lonLatLev.z;\x0a\x0a\x20\x20\x20\x20float\x20lat0\x20=\x20floor(lat)\x20-\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat1\x20=\x20floor(lat);\x0a\x20\x20\x20\x20float\x20lat2\x20=\x20floor(lat)\x20+\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat3\x20=\x20floor(lat)\x20+\x202.0\x20*\x20interval.y;\x0a\x0a\x20\x20\x20\x20vec2\x20coefficient\x20=\x20lonLatLev.xy\x20-\x20floor(lonLatLev.xy);\x0a\x20\x20\x20\x20float\x20b0\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat0,\x20lev);\x0a\x20\x20\x20\x20float\x20b1\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat1,\x20lev);\x0a\x20\x20\x20\x20float\x20b2\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat2,\x20lev);\x0a\x20\x20\x20\x20float\x20b3\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat3,\x20lev);\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(coefficient.y,\x20b0,\x20b1,\x20b2,\x20b3);\x0a}\x0a\x0avec3\x20bicubic(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20https://en.wikipedia.org/wiki/Bicubic_interpolation#Bicubic_convolution_algorithm\x0a\x20\x20\x20\x20float\x20u\x20=\x20interpolateOneTexture(U,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20v\x20=\x20interpolateOneTexture(V,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20return\x20vec3(u,\x20v,\x20w);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20bicubic(lonLatLev);\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(windVector,\x200.0);\x0a}\x0a','NEAREST','particleSystem','pow','depthTexture','clientHeight','register','min','viewerParameters','source','RGB','abs','toDegrees','now','udata','UNSIGNED_INT','_onMouseUpEvent','getOptions','sin','getColorTexture','5HmvfJd','nextTrails','speedFactor','commandType','hidden','speed','particles','north','init','bind','12238798kduzFw','destroyParticlesTextures','517572kAPvaY','Compute','data','particleHeight','SceneTransforms','worker','cancelAnimationFrame','options','postProcessingSpeed','addPrimitives','cols','tlng','uniform\x20sampler2D\x20segmentsColorTexture;\x0auniform\x20sampler2D\x20segmentsDepthTexture;\x0a\x0auniform\x20sampler2D\x20currentTrailsColor;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0auniform\x20float\x20fadeOpacity;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20pointsColor\x20=\x20texture(segmentsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(currentTrailsColor,\x20textureCoordinate);\x0a\x0a\x20\x20\x20\x20trailsColor\x20=\x20floor(fadeOpacity\x20*\x20255.0\x20*\x20trailsColor)\x20/\x20255.0;\x20//\x20make\x20sure\x20the\x20trailsColor\x20will\x20be\x20strictly\x20decreased\x0a\x0a\x20\x20\x20\x20float\x20pointsDepth\x20=\x20texture(segmentsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(pointsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20pointsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20trailsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20gl_FragDepth\x20=\x20min(pointsDepth,\x20trailsDepth);\x0a}\x0a','initWorker','framebuffers','keys','fromCssColorString','Appearance','Color','width','createFramebuffer','EventType','vdata','_onMouseMoveEvent','6ytNLPf','globe','_colorRamp','defineProperty','defined','color','DISABLE_LOG_DEPTH_FRAGMENT_WRITE','visible','355260XApvNC','show','update','9mxoLuj','DEPTH_COMPONENT','pointer-events','clearCommand','_addedHook','pixelSize','ShaderSource','wgs84ToWindowCoordinates','WindLayer','uniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20randomParticle\x20=\x20texture(postProcessingPosition,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20vec4\x20particleSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x0a\x20\x20\x20\x20if\x20(randomParticle.a\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20particleSpeed;\x0a\x20\x20\x20\x20}\x0a}\x0a','maxParticles','add','canvasContext','camera','off','createWindTextures','south'];_0x3469=function(){return _0x1461fd;};return _0x3469();}function getSpeed(_0x76be82,_0x1f117c){const _0x4105d9=_0x3a25a4,_0x4d743f=Math['sqrt'](Math[_0x4105d9(0x1ca)](_0x76be82,0x2)+Math['pow'](_0x1f117c,0x2));return _0x4d743f;}function getDirection(_0x110d87,_0x4b8d06){let _0x2335d1=Cesium$7['Math']['toDegrees'](Math['atan2'](_0x4b8d06,_0x110d87));return _0x2335d1+=_0x2335d1<0x0?0x168:0x0,_0x2335d1;}var WindUtil={'__proto__':null,'getU':getU,'getV':getV,'getSpeed':getSpeed,'getDirection':getDirection};const Cesium$6=mars3d__namespace['Cesium'];class CustomPrimitive{constructor(_0x532eb5){const _0xde4170=_0x3a25a4;this[_0xde4170(0x1de)]=_0x532eb5[_0xde4170(0x1de)],this[_0xde4170(0x197)]=_0x532eb5[_0xde4170(0x197)],this['attributeLocations']=_0x532eb5[_0xde4170(0x19e)],this['primitiveType']=_0x532eb5['primitiveType'],this['uniformMap']=_0x532eb5[_0xde4170(0x238)],this[_0xde4170(0x247)]=_0x532eb5['vertexShaderSource'],this['fragmentShaderSource']=_0x532eb5[_0xde4170(0x199)],this[_0xde4170(0x272)]=_0x532eb5[_0xde4170(0x272)],this['framebuffer']=_0x532eb5['framebuffer'],this['outputTexture']=_0x532eb5[_0xde4170(0x258)],this['autoClear']=_0x532eb5['autoClear']??![],this[_0xde4170(0x251)]=_0x532eb5['preExecute'],this[_0xde4170(0x208)]=!![],this[_0xde4170(0x274)]=undefined,this['clearCommand']=undefined,this[_0xde4170(0x1a2)]&&(this['clearCommand']=new Cesium$6['ClearCommand']({'color':new Cesium$6['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':this['framebuffer'],'pass':Cesium$6['Pass']['OPAQUE']}));}[_0x3a25a4(0x25f)](_0x5a196c){const _0xf4a6e9=_0x3a25a4;switch(this['commandType']){case'Draw':{const _0x6c9db1=Cesium$6[_0xf4a6e9(0x223)]['fromGeometry']({'context':_0x5a196c,'geometry':this['geometry'],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6['BufferUsage'][_0xf4a6e9(0x259)]}),_0x347e17=Cesium$6['ShaderProgram']['fromCache']({'context':_0x5a196c,'attributeLocations':this[_0xf4a6e9(0x19e)],'vertexShaderSource':this[_0xf4a6e9(0x247)],'fragmentShaderSource':this['fragmentShaderSource']}),_0x10d28a=Cesium$6[_0xf4a6e9(0x1a8)][_0xf4a6e9(0x282)](this['rawRenderState']);return new Cesium$6['DrawCommand']({'primitiveType':this[_0xf4a6e9(0x1be)],'shaderProgram':_0x347e17,'vertexArray':_0x6c9db1,'modelMatrix':Cesium$6['Matrix4']['IDENTITY'],'renderState':_0x10d28a,'uniformMap':this['uniformMap'],'castShadows':![],'receiveShadows':![],'framebuffer':this['framebuffer'],'pass':Cesium$6['Pass']['OPAQUE'],'pickOnly':!![],'owner':this});}case'Compute':{return new Cesium$6['ComputeCommand']({'owner':this,'fragmentShaderSource':this[_0xf4a6e9(0x199)],'uniformMap':this['uniformMap'],'outputTexture':this[_0xf4a6e9(0x258)],'persists':!![]});}}}['setGeometry'](_0x5d6181,_0x93b5e0){const _0x2755c4=_0x3a25a4;this[_0x2755c4(0x197)]=_0x93b5e0;const _0x42d2e4=Cesium$6[_0x2755c4(0x223)][_0x2755c4(0x265)]({'context':_0x5d6181,'geometry':this[_0x2755c4(0x197)],'attributeLocations':this[_0x2755c4(0x19e)],'bufferUsage':Cesium$6['BufferUsage']['STATIC_DRAW']});this[_0x2755c4(0x274)]['vertexArray']=_0x42d2e4;}['update'](_0x2cbe43){const _0x498fdb=_0x3a25a4;if(!this['show'])return;if(_0x2cbe43['mode']!==Cesium$6[_0x498fdb(0x264)]['SCENE3D'])return;!Cesium$6[_0x498fdb(0x203)](this['commandToExecute'])&&(this['commandToExecute']=this['createCommand'](_0x2cbe43[_0x498fdb(0x198)])),Cesium$6['defined'](this['preExecute'])&&this['preExecute'](),Cesium$6['defined'](this[_0x498fdb(0x20d)])&&_0x2cbe43['commandList']['push'](this[_0x498fdb(0x20d)]),_0x2cbe43['commandList'][_0x498fdb(0x27e)](this[_0x498fdb(0x274)]);}['isDestroyed'](){return![];}[_0x3a25a4(0x1ad)](){const _0x37e0e5=_0x3a25a4;if(this['clearCommand']){var _0x34ef0b,_0x127c1c;(_0x34ef0b=this['clearCommand'])!==null&&_0x34ef0b!==void 0x0&&_0x34ef0b[_0x37e0e5(0x23b)]&&this[_0x37e0e5(0x20d)][_0x37e0e5(0x23b)]['destroy'](),(_0x127c1c=this[_0x37e0e5(0x20d)])!==null&&_0x127c1c!==void 0x0&&_0x127c1c[_0x37e0e5(0x271)]&&this[_0x37e0e5(0x20d)][_0x37e0e5(0x271)]['destroy'](),delete this['clearCommand'];}return this[_0x37e0e5(0x274)]&&(this['commandToExecute'][_0x37e0e5(0x23b)]&&this['commandToExecute']['vertexArray']['destroy'](),this['commandToExecute']['shaderProgram']&&this['commandToExecute'][_0x37e0e5(0x271)][_0x37e0e5(0x1ad)](),delete this['commandToExecute']),Cesium$6['destroyObject'](this);}}const Cesium$5=mars3d__namespace[_0x3a25a4(0x191)],Util=(function(){const _0x3f9946=function(){const _0x3c5f99=_0x21a1,_0x8b2f26=new Cesium$5['Geometry']({'attributes':new Cesium$5['GeometryAttributes']({'position':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5[_0x3c5f99(0x194)]['FLOAT'],'componentsPerAttribute':0x3,'values':new Float32Array([-0x1,-0x1,0x0,0x1,-0x1,0x0,0x1,0x1,0x0,-0x1,0x1,0x0])}),'st':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x2,'values':new Float32Array([0x0,0x0,0x1,0x0,0x1,0x1,0x0,0x1])})}),'indices':new Uint32Array([0x3,0x2,0x0,0x0,0x2,0x1])});return _0x8b2f26;},_0x31d99f=function(_0x45ebba,_0x5ab13c){const _0x1761c4=_0x21a1;if(Cesium$5['defined'](_0x5ab13c)){const _0x3878ab={};_0x3878ab[_0x1761c4(0x24a)]=_0x5ab13c,_0x45ebba[_0x1761c4(0x1d0)]=_0x3878ab;}const _0x2feee6=new Cesium$5[(_0x1761c4(0x1bf))](_0x45ebba);return _0x2feee6;},_0x4ddf54=function(_0x31c561,_0x231783,_0x2b2ecb){const _0x154f75=new Cesium$5['Framebuffer']({'context':_0x31c561,'colorTextures':[_0x231783],'depthTexture':_0x2b2ecb});return _0x154f75;},_0x5631ca=function(_0xac4016){const _0x271eab=_0x21a1,_0x1855c9=!![],_0x4952d4=![],_0x37a97e={'viewport':_0xac4016['viewport'],'depthTest':_0xac4016['depthTest'],'depthMask':_0xac4016['depthMask'],'blending':_0xac4016['blending']},_0x5d7bba=Cesium$5[_0x271eab(0x1f8)]['getDefaultRenderState'](_0x1855c9,_0x4952d4,_0x37a97e);return _0x5d7bba;},_0x592f83=function(_0x320ebd){const _0x28a92b=_0x21a1,_0x457f32={},_0x1de722=Cesium$5[_0x28a92b(0x21d)][_0x28a92b(0x1bc)](_0x320ebd['west'],Cesium$5['Math'][_0x28a92b(0x232)]),_0x22e432=Cesium$5['Math'][_0x28a92b(0x1bc)](_0x320ebd['east'],Cesium$5['Math']['TWO_PI']),_0x124f0e=_0x320ebd['width'];let _0xe4c40b,_0x33d5dc;_0x124f0e>Cesium$5[_0x28a92b(0x21d)]['THREE_PI_OVER_TWO']?(_0xe4c40b=0x0,_0x33d5dc=Cesium$5['Math'][_0x28a92b(0x232)]):_0x22e432-_0x1de722<_0x124f0e?(_0xe4c40b=_0x1de722,_0x33d5dc=_0x1de722+_0x124f0e):(_0xe4c40b=_0x1de722,_0x33d5dc=_0x22e432);_0x457f32['lon']={'min':Cesium$5['Math']['toDegrees'](_0xe4c40b),'max':Cesium$5['Math'][_0x28a92b(0x1d3)](_0x33d5dc)};const _0x4528b6=_0x320ebd[_0x28a92b(0x21a)],_0x5631e7=_0x320ebd[_0x28a92b(0x1e2)],_0x43bbef=_0x320ebd['height'],_0x403735=_0x43bbef>Cesium$5[_0x28a92b(0x21d)]['PI']/0xc?_0x43bbef/0x2:0x0;let _0xcb641e=Cesium$5['Math']['clampToLatitudeRange'](_0x4528b6-_0x403735),_0x524386=Cesium$5[_0x28a92b(0x21d)][_0x28a92b(0x228)](_0x5631e7+_0x403735);return _0xcb641e<-Cesium$5[_0x28a92b(0x21d)]['PI_OVER_THREE']&&(_0xcb641e=-Cesium$5['Math']['PI_OVER_TWO']),_0x524386>Cesium$5['Math']['PI_OVER_THREE']&&(_0x524386=Cesium$5['Math']['PI_OVER_TWO']),_0x457f32['lat']={'min':Cesium$5['Math']['toDegrees'](_0xcb641e),'max':Cesium$5['Math']['toDegrees'](_0x524386)},_0x457f32;};return{'getFullscreenQuad':_0x3f9946,'createTexture':_0x31d99f,'createFramebuffer':_0x4ddf54,'createRawRenderState':_0x5631ca,'viewRectangleToLonLatRange':_0x592f83};}());function _0x21a1(_0x1a39e2,_0xcdb163){const _0x3469de=_0x3469();return _0x21a1=function(_0x21a1a6,_0x2d734b){_0x21a1a6=_0x21a1a6-0x191;let _0x1b1231=_0x3469de[_0x21a1a6];return _0x1b1231;},_0x21a1(_0x1a39e2,_0xcdb163);}var segmentDraw_vert='in\x20vec2\x20st;\x0a//\x20it\x20is\x20not\x20normal\x20itself,\x20but\x20used\x20to\x20control\x20normal\x0ain\x20vec3\x20normal;\x20//\x20(point\x20to\x20use,\x20offset\x20sign,\x20not\x20used\x20component)\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x0auniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20postProcessingSpeed;\x0a\x0auniform\x20float\x20particleHeight;\x0a\x0auniform\x20float\x20aspect;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20lineWidth;\x0a\x0aout\x20float\x20speedNormalization;\x0a\x0avec3\x20convertCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20WGS84\x20(lon,\x20lat,\x20lev)\x20->\x20ECEF\x20(x,\x20y,\x20z)\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_conversion#From_geodetic_to_ECEF_coordinates\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20WGS\x2084\x20geometric\x20constants\x0a\x20\x20\x20\x20float\x20a\x20=\x206378137.0;\x20//\x20Semi-major\x20axis\x0a\x20\x20\x20\x20float\x20b\x20=\x206356752.3142;\x20//\x20Semi-minor\x20axis\x0a\x20\x20\x20\x20float\x20e2\x20=\x206.69437999014e-3;\x20//\x20First\x20eccentricity\x20squared\x0a\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x20\x20\x20\x20float\x20longitude\x20=\x20radians(lonLatLev.x);\x0a\x0a\x20\x20\x20\x20float\x20cosLat\x20=\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20sinLat\x20=\x20sin(latitude);\x0a\x20\x20\x20\x20float\x20cosLon\x20=\x20cos(longitude);\x0a\x20\x20\x20\x20float\x20sinLon\x20=\x20sin(longitude);\x0a\x0a\x20\x20\x20\x20float\x20N_Phi\x20=\x20a\x20/\x20sqrt(1.0\x20-\x20e2\x20*\x20sinLat\x20*\x20sinLat);\x0a\x20\x20\x20\x20float\x20h\x20=\x20particleHeight;\x20//\x20it\x20should\x20be\x20high\x20enough\x20otherwise\x20the\x20particle\x20may\x20not\x20pass\x20the\x20terrain\x20depth\x20test\x0a\x0a\x20\x20\x20\x20vec3\x20cartesian\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20cartesian.x\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20cosLon;\x0a\x20\x20\x20\x20cartesian.y\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20sinLon;\x0a\x20\x20\x20\x20cartesian.z\x20=\x20((b\x20*\x20b)\x20/\x20(a\x20*\x20a)\x20*\x20N_Phi\x20+\x20h)\x20*\x20sinLat;\x0a\x20\x20\x20\x20return\x20cartesian;\x0a}\x0a\x0avec4\x20calcProjectedCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20the\x20range\x20of\x20longitude\x20in\x20Cesium\x20is\x20[-180,\x20180]\x20but\x20the\x20range\x20of\x20longitude\x20in\x20the\x20NetCDF\x20file\x20is\x20[0,\x20360]\x0a\x20\x20\x20\x20//\x20[0,\x20180]\x20is\x20corresponding\x20to\x20[0,\x20180]\x20and\x20[180,\x20360]\x20is\x20corresponding\x20to\x20[-180,\x200]\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x\x20+\x20180.0,\x20360.0)\x20-\x20180.0;\x0a\x20\x20\x20\x20vec3\x20particlePosition\x20=\x20convertCoordinate(lonLatLev);\x0a\x20\x20\x20\x20vec4\x20projectedCoordinate\x20=\x20czm_modelViewProjection\x20*\x20vec4(particlePosition,\x201.0);\x0a\x20\x20\x20\x20return\x20projectedCoordinate;\x0a}\x0a\x0avec4\x20calcOffset(vec4\x20currentProjectedCoordinate,\x20vec4\x20nextProjectedCoordinate,\x20float\x20offsetSign)\x20{\x0a\x20\x20\x20\x20vec2\x20aspectVec2\x20=\x20vec2(aspect,\x201.0);\x0a\x20\x20\x20\x20vec2\x20currentXY\x20=\x20(currentProjectedCoordinate.xy\x20/\x20currentProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x20\x20\x20\x20vec2\x20nextXY\x20=\x20(nextProjectedCoordinate.xy\x20/\x20nextProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x0a\x20\x20\x20\x20float\x20offsetLength\x20=\x20lineWidth\x20/\x202.0;\x0a\x20\x20\x20\x20vec2\x20direction\x20=\x20normalize(nextXY\x20-\x20currentXY);\x0a\x20\x20\x20\x20vec2\x20normalVector\x20=\x20vec2(-direction.y,\x20direction.x);\x0a\x20\x20\x20\x20normalVector.x\x20=\x20normalVector.x\x20/\x20aspect;\x0a\x20\x20\x20\x20normalVector\x20=\x20offsetLength\x20*\x20normalVector;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20vec4(offsetSign\x20*\x20normalVector,\x200.0,\x200.0);\x0a\x20\x20\x20\x20return\x20offset;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec2\x20particleIndex\x20=\x20st;\x0a\x0a\x20\x20\x20\x20vec3\x20currentPosition\x20=\x20texture(currentParticlesPosition,\x20particleIndex).rgb;\x0a\x20\x20\x20\x20vec4\x20nextPosition\x20=\x20texture(postProcessingPosition,\x20particleIndex);\x0a\x0a\x20\x20\x20\x20vec4\x20currentProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20vec4\x20nextProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(nextPosition.w\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(nextPosition.xyz);\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20float\x20pointToUse\x20=\x20normal.x;\x20//\x20-1\x20is\x20currentProjectedCoordinate\x20and\x20+1\x20is\x20nextProjectedCoordinate\x0a\x20\x20\x20\x20float\x20offsetSign\x20=\x20normal.y;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20pixelSize\x20*\x20calcOffset(currentProjectedCoordinate,\x20nextProjectedCoordinate,\x20offsetSign);\x0a\x20\x20\x20\x20if\x20(pointToUse\x20<\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20currentProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20nextProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20speedNormalization\x20=\x20texture(postProcessingSpeed,\x20particleIndex).a;\x0a}\x0a',segmentDraw_frag='uniform\x20sampler2D\x20colorTable;\x0a\x0ain\x20float\x20speedNormalization;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20out_FragColor\x20=\x20texture(colorTable,\x20vec2(speedNormalization,\x200.0));\x0a}\x0a',fullscreen_vert='in\x20vec3\x20position;\x0ain\x20vec2\x20st;\x0a\x0aout\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20textureCoordinate\x20=\x20st;\x0a\x20\x20\x20\x20gl_Position\x20=\x20vec4(position,\x201.0);\x0a}\x0a',trailDraw_frag=_0x3a25a4(0x1f3),screenDraw_frag='uniform\x20sampler2D\x20trailsColorTexture;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(trailsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20trailsColor;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$4=mars3d__namespace['Cesium'];class ParticlesRendering{constructor(_0x25a4cb,_0x5c68ac,_0x509fe9,_0x1fe9f6,_0x284a79){const _0x34e78e=_0x3a25a4;this['createRenderingTextures'](_0x25a4cb,_0x5c68ac,_0x509fe9['colors']),this['createRenderingFramebuffers'](_0x25a4cb),this[_0x34e78e(0x225)](_0x25a4cb,_0x509fe9,_0x1fe9f6,_0x284a79);}['createRenderingTextures'](_0x479028,_0x2c390e,_0x35ed24){const _0x513695=_0x3a25a4,_0x1bde12={'context':_0x479028,'width':_0x479028['drawingBufferWidth'],'height':_0x479028['drawingBufferHeight'],'pixelFormat':Cesium$4[_0x513695(0x1b2)][_0x513695(0x1b0)],'pixelDatatype':Cesium$4['PixelDatatype']['UNSIGNED_BYTE']},_0x110348={'context':_0x479028,'width':_0x479028['drawingBufferWidth'],'height':_0x479028['drawingBufferHeight'],'pixelFormat':Cesium$4['PixelFormat'][_0x513695(0x20b)],'pixelDatatype':Cesium$4[_0x513695(0x236)][_0x513695(0x1d6)]},_0x118f54=_0x35ed24['length'],_0x1c9841=new Float32Array(_0x118f54*0x3);for(let _0x47cdbb=0x0;_0x47cdbb<_0x118f54;_0x47cdbb++){const _0x4a0835=Cesium$4[_0x513695(0x1f9)][_0x513695(0x1f7)](_0x35ed24[_0x47cdbb]);_0x1c9841[0x3*_0x47cdbb]=_0x4a0835['red'],_0x1c9841[0x3*_0x47cdbb+0x1]=_0x4a0835['green'],_0x1c9841[0x3*_0x47cdbb+0x2]=_0x4a0835[_0x513695(0x289)];}const _0x5b308a={'context':_0x479028,'width':_0x118f54,'height':0x1,'pixelFormat':Cesium$4[_0x513695(0x1b2)][_0x513695(0x1d1)],'pixelDatatype':Cesium$4[_0x513695(0x236)]['FLOAT'],'sampler':new Cesium$4[(_0x513695(0x1b7))]({'minificationFilter':Cesium$4['TextureMinificationFilter']['LINEAR'],'magnificationFilter':Cesium$4['TextureMagnificationFilter'][_0x513695(0x1a0)]})};this['textures']={'segmentsColor':Util['createTexture'](_0x1bde12),'segmentsDepth':Util['createTexture'](_0x110348),'currentTrailsColor':Util[_0x513695(0x250)](_0x1bde12),'currentTrailsDepth':Util['createTexture'](_0x110348),'nextTrailsColor':Util['createTexture'](_0x1bde12),'nextTrailsDepth':Util['createTexture'](_0x110348),'colorTable':Util['createTexture'](_0x5b308a,_0x1c9841)};}['createRenderingFramebuffers'](_0xc4c646){const _0x2894ea=_0x3a25a4;this['framebuffers']={'segments':Util[_0x2894ea(0x1fb)](_0xc4c646,this['textures']['segmentsColor'],this[_0x2894ea(0x27d)]['segmentsDepth']),'currentTrails':Util['createFramebuffer'](_0xc4c646,this['textures']['currentTrailsColor'],this[_0x2894ea(0x27d)]['currentTrailsDepth']),'nextTrails':Util[_0x2894ea(0x1fb)](_0xc4c646,this['textures']['nextTrailsColor'],this[_0x2894ea(0x27d)][_0x2894ea(0x260)])};}[_0x3a25a4(0x19f)](_0x2d8519){const _0x4f05ef=_0x3a25a4,_0x30c773=0x4;let _0x9182c3=[];for(let _0x396731=0x0;_0x396731<_0x2d8519['particlesTextureSize'];_0x396731++){for(let _0xee1f07=0x0;_0xee1f07<_0x2d8519['particlesTextureSize'];_0xee1f07++){for(let _0x2de4d5=0x0;_0x2de4d5<_0x30c773;_0x2de4d5++){_0x9182c3['push'](_0x396731/_0x2d8519[_0x4f05ef(0x19a)]),_0x9182c3['push'](_0xee1f07/_0x2d8519[_0x4f05ef(0x19a)]);}}}_0x9182c3=new Float32Array(_0x9182c3);let _0x180cfd=[];const _0x53fcb7=[-0x1,0x1],_0x4e89ff=[-0x1,0x1];for(let _0x4ef200=0x0;_0x4ef200<_0x2d8519['maxParticles'];_0x4ef200++){for(let _0x32a8d1=0x0;_0x32a8d1<_0x30c773/0x2;_0x32a8d1++){for(let _0x1451a2=0x0;_0x1451a2<_0x30c773/0x2;_0x1451a2++){_0x180cfd[_0x4f05ef(0x27e)](_0x53fcb7[_0x32a8d1]),_0x180cfd[_0x4f05ef(0x27e)](_0x4e89ff[_0x1451a2]),_0x180cfd[_0x4f05ef(0x27e)](0x0);}}}_0x180cfd=new Float32Array(_0x180cfd);const _0x34889e=0x6*_0x2d8519['maxParticles'],_0x211bb1=new Uint32Array(_0x34889e);for(let _0xb849ed=0x0,_0x5995b4=0x0,_0x456c36=0x0;_0xb849ed<_0x2d8519['maxParticles'];_0xb849ed++){_0x211bb1[_0x5995b4++]=_0x456c36+0x0,_0x211bb1[_0x5995b4++]=_0x456c36+0x1,_0x211bb1[_0x5995b4++]=_0x456c36+0x2,_0x211bb1[_0x5995b4++]=_0x456c36+0x2,_0x211bb1[_0x5995b4++]=_0x456c36+0x1,_0x211bb1[_0x5995b4++]=_0x456c36+0x3,_0x456c36+=0x4;}const _0x54e7d5=new Cesium$4['Geometry']({'attributes':new Cesium$4['GeometryAttributes']({'st':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4[_0x4f05ef(0x194)][_0x4f05ef(0x21f)],'componentsPerAttribute':0x2,'values':_0x9182c3}),'normal':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4['ComponentDatatype'][_0x4f05ef(0x21f)],'componentsPerAttribute':0x3,'values':_0x180cfd})}),'indices':_0x211bb1});return _0x54e7d5;}['createRenderingPrimitives'](_0x20ae77,_0x474c03,_0x25da07,_0x3bf304){const _0x50d68d=_0x3a25a4,_0x338f0f=this;this[_0x50d68d(0x270)]={'segments':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'st':0x0,'normal':0x1},'geometry':this['createSegmentsGeometry'](_0x474c03),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'currentParticlesPosition':function(){return _0x3bf304['particlesTextures']['currentParticlesPosition'];},'postProcessingPosition':function(){return _0x3bf304['particlesTextures']['postProcessingPosition'];},'postProcessingSpeed':function(){const _0x43e810=_0x50d68d;return _0x3bf304[_0x43e810(0x222)][_0x43e810(0x1ef)];},'colorTable':function(){const _0x55080a=_0x50d68d;return _0x338f0f[_0x55080a(0x27d)]['colorTable'];},'aspect':function(){return _0x20ae77['drawingBufferWidth']/_0x20ae77['drawingBufferHeight'];},'pixelSize':function(){const _0x87a6ed=_0x50d68d;return _0x25da07[_0x87a6ed(0x20f)];},'lineWidth':function(){const _0x44f13c=_0x50d68d;return _0x474c03[_0x44f13c(0x26d)];},'particleHeight':function(){const _0x9aa90f=_0x50d68d;return _0x474c03[_0x9aa90f(0x1ea)];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_vert]}),'fragmentShaderSource':new Cesium$4[(_0x50d68d(0x210))]({'sources':[segmentDraw_frag]}),'rawRenderState':Util[_0x50d68d(0x27c)]({'viewport':undefined,'depthTest':{'enabled':!![]},'depthMask':!![]}),'framebuffer':this[_0x50d68d(0x1f5)]['segments'],'autoClear':!![]}),'trails':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'segmentsColorTexture':function(){return _0x338f0f['textures']['segmentsColor'];},'segmentsDepthTexture':function(){return _0x338f0f['textures']['segmentsDepth'];},'currentTrailsColor':function(){const _0x25ada7=_0x50d68d;return _0x338f0f[_0x25ada7(0x1f5)][_0x25ada7(0x280)][_0x25ada7(0x1da)](0x0);},'trailsDepthTexture':function(){const _0x312292=_0x50d68d;return _0x338f0f[_0x312292(0x1f5)]['currentTrails'][_0x312292(0x1cb)];},'fadeOpacity':function(){const _0xaf4b76=_0x50d68d;return _0x474c03[_0xaf4b76(0x25c)];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':[_0x50d68d(0x205)],'sources':[trailDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![],'func':Cesium$4[_0x50d68d(0x19b)]['ALWAYS']},'depthMask':!![]}),'framebuffer':this['framebuffers']['nextTrails'],'autoClear':!![],'preExecute':function(){const _0x59886f=_0x50d68d,_0x416389=_0x338f0f['framebuffers']['currentTrails'];_0x338f0f['framebuffers'][_0x59886f(0x280)]=_0x338f0f['framebuffers'][_0x59886f(0x1dc)],_0x338f0f['framebuffers']['nextTrails']=_0x416389,_0x338f0f[_0x59886f(0x270)]['trails']['commandToExecute'][_0x59886f(0x195)]=_0x338f0f['framebuffers']['nextTrails'],_0x338f0f['primitives']['trails']['clearCommand']['framebuffer']=_0x338f0f['framebuffers']['nextTrails'];}}),'screen':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4['PrimitiveType'][_0x50d68d(0x263)],'uniformMap':{'trailsColorTexture':function(){return _0x338f0f['framebuffers']['nextTrails']['getColorTexture'](0x0);},'trailsDepthTexture':function(){const _0x54f813=_0x50d68d;return _0x338f0f['framebuffers']['nextTrails'][_0x54f813(0x1cb)];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':[_0x50d68d(0x205)],'sources':[screenDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':![]},'depthMask':!![],'blending':{'enabled':!![]}}),'framebuffer':undefined})};}}var getWind_frag=_0x3a25a4(0x1c7),updateSpeed_frag='uniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0auniform\x20sampler2D\x20particlesWind;\x0a\x0a//\x20used\x20to\x20calculate\x20the\x20wind\x20norm\x0auniform\x20vec2\x20uSpeedRange;\x20//\x20(min,\x20max);\x0auniform\x20vec2\x20vSpeedRange;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20speedFactor;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0afloat\x20calculateWindNorm(vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec3\x20percent\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20percent.x\x20=\x20(speed.x\x20-\x20uSpeedRange.x)\x20/\x20(uSpeedRange.y\x20-\x20uSpeedRange.x);\x0a\x20\x20\x20\x20percent.y\x20=\x20(speed.y\x20-\x20vSpeedRange.x)\x20/\x20(vSpeedRange.y\x20-\x20vSpeedRange.x);\x0a\x20\x20\x20\x20float\x20normalization\x20=\x20length(percent);\x0a\x0a\x20\x20\x20\x20return\x20normalization;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20//\x20vec3\x20currentSpeed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20texture(particlesWind,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20vec4(speedFactor\x20*\x20pixelSize\x20*\x20windVector,\x20calculateWindNorm(windVector));\x0a\x20\x20\x20\x20out_FragColor\x20=\x20nextSpeed;\x0a}\x0a',updatePosition_frag='uniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20lengthOfLonLat(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20unit\x20conversion:\x20meters\x20->\x20longitude\x20latitude\x20degrees\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_system#Length_of_a_degree\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20Calculate\x20the\x20length\x20of\x20a\x20degree\x20of\x20latitude\x20and\x20longitude\x20in\x20meters\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x0a\x20\x20\x20\x20float\x20term1\x20=\x20111132.92;\x0a\x20\x20\x20\x20float\x20term2\x20=\x20559.82\x20*\x20cos(2.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term3\x20=\x201.175\x20*\x20cos(4.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term4\x20=\x200.0023\x20*\x20cos(6.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20latLength\x20=\x20term1\x20-\x20term2\x20+\x20term3\x20-\x20term4;\x0a\x0a\x20\x20\x20\x20float\x20term5\x20=\x20111412.84\x20*\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20term6\x20=\x2093.5\x20*\x20cos(3.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term7\x20=\x200.118\x20*\x20cos(5.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20longLength\x20=\x20term5\x20-\x20term6\x20+\x20term7;\x0a\x0a\x20\x20\x20\x20return\x20vec2(longLength,\x20latLength);\x0a}\x0a\x0avoid\x20updatePosition(vec3\x20lonLatLev,\x20vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec2\x20lonLatLength\x20=\x20lengthOfLonLat(lonLatLev);\x0a\x20\x20\x20\x20float\x20u\x20=\x20speed.x\x20/\x20lonLatLength.x;\x0a\x20\x20\x20\x20float\x20v\x20=\x20speed.y\x20/\x20lonLatLength.y;\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20vec3\x20windVectorInLonLatLev\x20=\x20vec3(u,\x20v,\x20w);\x0a\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20lonLatLev\x20+\x20windVectorInLonLatLev;\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20speed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20updatePosition(lonLatLev,\x20speed);\x0a}\x0a',postProcessingPosition_frag='uniform\x20sampler2D\x20nextParticlesPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0a//\x20range\x20(min,\x20max)\x0auniform\x20vec2\x20lonRange;\x0auniform\x20vec2\x20latRange;\x0a\x0auniform\x20float\x20randomCoefficient;\x20//\x20use\x20to\x20improve\x20the\x20pseudo-random\x20generator\x0auniform\x20float\x20dropRate;\x20//\x20drop\x20rate\x20is\x20a\x20chance\x20a\x20particle\x20will\x20restart\x20at\x20random\x20position\x20to\x20avoid\x20degeneration\x0auniform\x20float\x20dropRateBump;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0a//\x20pseudo-random\x20generator\x0aconst\x20vec3\x20randomConstants\x20=\x20vec3(12.9898,\x2078.233,\x204375.85453);\x0aconst\x20vec2\x20normalRange\x20=\x20vec2(0.0,\x201.0);\x0afloat\x20rand(vec2\x20seed,\x20vec2\x20range)\x20{\x0a\x20\x20\x20\x20vec2\x20randomSeed\x20=\x20randomCoefficient\x20*\x20seed;\x0a\x20\x20\x20\x20float\x20temp\x20=\x20dot(randomConstants.xy,\x20randomSeed);\x0a\x20\x20\x20\x20temp\x20=\x20fract(sin(temp)\x20*\x20(randomConstants.z\x20+\x20temp));\x0a\x20\x20\x20\x20return\x20temp\x20*\x20(range.y\x20-\x20range.x)\x20+\x20range.x;\x0a}\x0a\x0avec3\x20generateRandomParticle(vec2\x20seed,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20longitude\x20is\x20in\x20[0,\x20360]\x0a\x20\x20\x20\x20float\x20randomLon\x20=\x20mod(rand(seed,\x20lonRange),\x20360.0);\x0a\x20\x20\x20\x20float\x20randomLat\x20=\x20rand(-seed,\x20latRange);\x0a\x0a\x20\x20\x20\x20return\x20vec3(randomLon,\x20randomLat,\x20lev);\x0a}\x0a\x0abool\x20particleOutbound(vec3\x20particle)\x20{\x0a\x20\x20\x20\x20return\x20particle.y\x20<\x20-90.0\x20||\x20particle.y\x20>\x2090.0;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20texture(nextParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20float\x20particleDropRate\x20=\x20dropRate\x20+\x20dropRateBump\x20*\x20nextSpeed.a;\x0a\x0a\x20\x20\x20\x20vec2\x20seed1\x20=\x20nextParticle.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec2\x20seed2\x20=\x20nextSpeed.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec3\x20randomParticle\x20=\x20generateRandomParticle(seed1,\x20nextParticle.z);\x0a\x20\x20\x20\x20float\x20randomNumber\x20=\x20rand(seed2,\x20normalRange);\x0a\x0a\x20\x20\x20\x20if\x20(randomNumber\x20<\x20particleDropRate\x20||\x20particleOutbound(nextParticle))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(randomParticle,\x201.0);\x20//\x201.0\x20means\x20this\x20is\x20a\x20random\x20particle\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a\x20\x20\x20\x20}\x0a}\x0a',postProcessingSpeed_frag=_0x3a25a4(0x213);const Cesium$3=mars3d__namespace['Cesium'];class ParticlesComputing{constructor(_0x4cc29c,_0xe5cc8c,_0xa5f374,_0x299be0){const _0x5ea126=_0x3a25a4;this['data']=_0xe5cc8c,this[_0x5ea126(0x219)](_0x4cc29c,_0xe5cc8c),this['createParticlesTextures'](_0x4cc29c,_0xa5f374,_0x299be0),this['createComputingPrimitives'](_0xe5cc8c,_0xa5f374,_0x299be0);}[_0x3a25a4(0x219)](_0x43fb4c,_0x4b54f7){const _0x1d60c9=_0x3a25a4,_0x3a6adf={'context':_0x43fb4c,'width':_0x4b54f7['dimensions']['lon'],'height':_0x4b54f7['dimensions']['lat']*(_0x4b54f7['dimensions']['lev']||0x1),'pixelFormat':Cesium$3[_0x1d60c9(0x1b2)]['LUMINANCE'],'pixelDatatype':Cesium$3[_0x1d60c9(0x236)]['FLOAT'],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3['TextureMinificationFilter']['NEAREST'],'magnificationFilter':Cesium$3['TextureMagnificationFilter'][_0x1d60c9(0x1c8)]})};this['windTextures']={'U':Util[_0x1d60c9(0x250)](_0x3a6adf,_0x4b54f7['U']['array']),'V':Util[_0x1d60c9(0x250)](_0x3a6adf,_0x4b54f7['V']['array'])};}[_0x3a25a4(0x19c)](_0x3a1833,_0x59bd00,_0x5cab53){const _0x583939=_0x3a25a4,_0x24cee5={'context':_0x3a1833,'width':_0x59bd00['particlesTextureSize'],'height':_0x59bd00['particlesTextureSize'],'pixelFormat':Cesium$3[_0x583939(0x1b2)]['RGBA'],'pixelDatatype':Cesium$3[_0x583939(0x236)]['FLOAT'],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3['TextureMinificationFilter']['NEAREST'],'magnificationFilter':Cesium$3['TextureMagnificationFilter']['NEAREST']})},_0x2dd4b7=this[_0x583939(0x255)](_0x59bd00['maxParticles'],_0x5cab53),_0x8d0b0=new Float32Array(0x4*_0x59bd00[_0x583939(0x214)])['fill'](0x0);this[_0x583939(0x222)]={'particlesWind':Util['createTexture'](_0x24cee5),'currentParticlesPosition':Util['createTexture'](_0x24cee5,_0x2dd4b7),'nextParticlesPosition':Util['createTexture'](_0x24cee5,_0x2dd4b7),'currentParticlesSpeed':Util['createTexture'](_0x24cee5,_0x8d0b0),'nextParticlesSpeed':Util[_0x583939(0x250)](_0x24cee5,_0x8d0b0),'postProcessingPosition':Util[_0x583939(0x250)](_0x24cee5,_0x2dd4b7),'postProcessingSpeed':Util['createTexture'](_0x24cee5,_0x8d0b0)};}['randomizeParticles'](_0x4c8ee0,_0x27c9ef){const _0xc13f8f=_0x3a25a4,_0x5d7d59=new Float32Array(0x4*_0x4c8ee0);for(let _0x192fc6=0x0;_0x192fc6<_0x4c8ee0;_0x192fc6++){_0x5d7d59[0x4*_0x192fc6]=Cesium$3['Math']['randomBetween'](_0x27c9ef['lonRange']['x'],_0x27c9ef['lonRange']['y']),_0x5d7d59[0x4*_0x192fc6+0x1]=Cesium$3[_0xc13f8f(0x21d)]['randomBetween'](_0x27c9ef['latRange']['x'],_0x27c9ef['latRange']['y']),_0x5d7d59[0x4*_0x192fc6+0x2]=Cesium$3['Math']['randomBetween'](this['data']['lev'][_0xc13f8f(0x1ce)],this[_0xc13f8f(0x1e9)]['lev'][_0xc13f8f(0x23c)]),_0x5d7d59[0x4*_0x192fc6+0x3]=0x0;}return _0x5d7d59;}['destroyParticlesTextures'](){const _0x5b7520=_0x3a25a4;Object[_0x5b7520(0x1f6)](this['particlesTextures'])[_0x5b7520(0x1c4)](_0x191b46=>{const _0x2601a0=_0x5b7520;this['particlesTextures'][_0x191b46][_0x2601a0(0x1ad)]();});}['createComputingPrimitives'](_0x2e47be,_0x3e767d,_0x200cb2){const _0x3a6b35=_0x3a25a4,_0x57672a=new Cesium$3[(_0x3a6b35(0x21b))](_0x2e47be[_0x3a6b35(0x22f)]['lon'],_0x2e47be['dimensions']['lat'],_0x2e47be['dimensions']['lev']),_0x3c8a92=new Cesium$3['Cartesian3'](_0x2e47be['lon'][_0x3a6b35(0x1ce)],_0x2e47be['lat'][_0x3a6b35(0x1ce)],_0x2e47be[_0x3a6b35(0x22b)]['min']),_0x34490a=new Cesium$3['Cartesian3'](_0x2e47be['lon'][_0x3a6b35(0x23c)],_0x2e47be[_0x3a6b35(0x1c3)]['max'],_0x2e47be[_0x3a6b35(0x22b)]['max']),_0x37f8ee=new Cesium$3['Cartesian3']((_0x34490a['x']-_0x3c8a92['x'])/(_0x57672a['x']-0x1),(_0x34490a['y']-_0x3c8a92['y'])/(_0x57672a['y']-0x1),_0x57672a['z']>0x1?(_0x34490a['z']-_0x3c8a92['z'])/(_0x57672a['z']-0x1):0x1),_0x55122a=new Cesium$3['Cartesian2'](_0x2e47be['U']['min'],_0x2e47be['U']['max']),_0xbe23ed=new Cesium$3['Cartesian2'](_0x2e47be['V'][_0x3a6b35(0x1ce)],_0x2e47be['V']['max']),_0x12a61a=this;this[_0x3a6b35(0x270)]={'getWind':new CustomPrimitive({'commandType':'Compute','uniformMap':{'U':function(){return _0x12a61a['windTextures']['U'];},'V':function(){return _0x12a61a['windTextures']['V'];},'currentParticlesPosition':function(){const _0x353e09=_0x3a6b35;return _0x12a61a[_0x353e09(0x222)]['currentParticlesPosition'];},'dimension':function(){return _0x57672a;},'minimum':function(){return _0x3c8a92;},'maximum':function(){return _0x34490a;},'interval':function(){return _0x37f8ee;}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[getWind_frag]}),'outputTexture':this['particlesTextures'][_0x3a6b35(0x1b8)],'preExecute':function(){const _0x57a78c=_0x3a6b35;_0x12a61a['primitives']['getWind'][_0x57a78c(0x274)]['outputTexture']=_0x12a61a['particlesTextures']['particlesWind'];}}),'updateSpeed':new CustomPrimitive({'commandType':_0x3a6b35(0x1e8),'uniformMap':{'currentParticlesSpeed':function(){const _0x436e0d=_0x3a6b35;return _0x12a61a[_0x436e0d(0x222)]['currentParticlesSpeed'];},'particlesWind':function(){return _0x12a61a['particlesTextures']['particlesWind'];},'uSpeedRange':function(){return _0x55122a;},'vSpeedRange':function(){return _0xbe23ed;},'pixelSize':function(){return _0x200cb2['pixelSize'];},'speedFactor':function(){const _0x4b1fbf=_0x3a6b35;return _0x3e767d[_0x4b1fbf(0x1dd)];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updateSpeed_frag]}),'outputTexture':this['particlesTextures']['nextParticlesSpeed'],'preExecute':function(){const _0x1de666=_0x3a6b35,_0x364dbe=_0x12a61a['particlesTextures']['currentParticlesSpeed'];_0x12a61a['particlesTextures']['currentParticlesSpeed']=_0x12a61a['particlesTextures'][_0x1de666(0x1ef)],_0x12a61a[_0x1de666(0x222)]['postProcessingSpeed']=_0x364dbe,_0x12a61a['primitives'][_0x1de666(0x1c1)]['commandToExecute']['outputTexture']=_0x12a61a['particlesTextures']['nextParticlesSpeed'];}}),'updatePosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesPosition':function(){const _0x20d9e1=_0x3a6b35;return _0x12a61a[_0x20d9e1(0x222)]['currentParticlesPosition'];},'currentParticlesSpeed':function(){return _0x12a61a['particlesTextures']['currentParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updatePosition_frag]}),'outputTexture':this['particlesTextures']['nextParticlesPosition'],'preExecute':function(){const _0x39001d=_0x3a6b35,_0x5b0f0c=_0x12a61a[_0x39001d(0x222)]['currentParticlesPosition'];_0x12a61a[_0x39001d(0x222)][_0x39001d(0x1bb)]=_0x12a61a['particlesTextures']['postProcessingPosition'],_0x12a61a['particlesTextures'][_0x39001d(0x278)]=_0x5b0f0c,_0x12a61a['primitives'][_0x39001d(0x1b1)]['commandToExecute']['outputTexture']=_0x12a61a['particlesTextures']['nextParticlesPosition'];}}),'postProcessingPosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'nextParticlesPosition':function(){return _0x12a61a['particlesTextures']['nextParticlesPosition'];},'nextParticlesSpeed':function(){return _0x12a61a['particlesTextures']['nextParticlesSpeed'];},'lonRange':function(){return _0x200cb2['lonRange'];},'latRange':function(){return _0x200cb2['latRange'];},'randomCoefficient':function(){const _0x5825a6=Math['random']();return _0x5825a6;},'dropRate':function(){return _0x3e767d['dropRate'];},'dropRateBump':function(){return _0x3e767d['dropRateBump'];}},'fragmentShaderSource':new Cesium$3[(_0x3a6b35(0x210))]({'sources':[postProcessingPosition_frag]}),'outputTexture':this[_0x3a6b35(0x222)][_0x3a6b35(0x278)],'preExecute':function(){const _0x265d84=_0x3a6b35;_0x12a61a[_0x265d84(0x270)][_0x265d84(0x278)]['commandToExecute'][_0x265d84(0x258)]=_0x12a61a['particlesTextures']['postProcessingPosition'];}}),'postProcessingSpeed':new CustomPrimitive({'commandType':_0x3a6b35(0x1e8),'uniformMap':{'postProcessingPosition':function(){return _0x12a61a['particlesTextures']['postProcessingPosition'];},'nextParticlesSpeed':function(){return _0x12a61a['particlesTextures']['nextParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3[(_0x3a6b35(0x210))]({'sources':[postProcessingSpeed_frag]}),'outputTexture':this['particlesTextures']['postProcessingSpeed'],'preExecute':function(){const _0x4a7771=_0x3a6b35;_0x12a61a[_0x4a7771(0x270)]['postProcessingSpeed']['commandToExecute'][_0x4a7771(0x258)]=_0x12a61a['particlesTextures']['postProcessingSpeed'];}})};}}const Cesium$2=mars3d__namespace['Cesium'];class ParticleSystem{constructor(_0x22540d,_0x590e57,_0x81ec3d,_0x1a3809){const _0x2d1f4c=_0x3a25a4;this[_0x2d1f4c(0x198)]=_0x22540d,_0x590e57={..._0x590e57},_0x590e57['udata']&&_0x590e57['vdata']&&(_0x590e57['dimensions']={},_0x590e57[_0x2d1f4c(0x22f)]['lon']=_0x590e57['cols'],_0x590e57[_0x2d1f4c(0x22f)]['lat']=_0x590e57['rows'],_0x590e57['dimensions']['lev']=_0x590e57['lev']||0x1,_0x590e57[_0x2d1f4c(0x22d)]={},_0x590e57['lon']['min']=_0x590e57[_0x2d1f4c(0x285)],_0x590e57['lon']['max']=_0x590e57['xmax'],_0x590e57['lat']={},_0x590e57[_0x2d1f4c(0x1c3)]['min']=_0x590e57[_0x2d1f4c(0x26f)],_0x590e57['lat'][_0x2d1f4c(0x23c)]=_0x590e57['ymax'],_0x590e57[_0x2d1f4c(0x22b)]={},_0x590e57[_0x2d1f4c(0x22b)][_0x2d1f4c(0x1ce)]=_0x590e57['levmin']??0x1,_0x590e57['lev']['max']=_0x590e57['levmax']??0x1,_0x590e57['U']={},_0x590e57['U'][_0x2d1f4c(0x262)]=new Float32Array(_0x590e57[_0x2d1f4c(0x1d5)]),_0x590e57['U']['min']=_0x590e57['umin']??Math[_0x2d1f4c(0x1ce)](..._0x590e57[_0x2d1f4c(0x1d5)]),_0x590e57['U'][_0x2d1f4c(0x23c)]=_0x590e57['umax']??Math['max'](..._0x590e57['udata']),_0x590e57['V']={},_0x590e57['V']['array']=new Float32Array(_0x590e57[_0x2d1f4c(0x1fd)]),_0x590e57['V'][_0x2d1f4c(0x1ce)]=_0x590e57['vmin']??Math['min'](..._0x590e57['vdata']),_0x590e57['V']['max']=_0x590e57[_0x2d1f4c(0x192)]??Math[_0x2d1f4c(0x23c)](..._0x590e57['vdata'])),this['data']=_0x590e57,this['options']=_0x81ec3d,this[_0x2d1f4c(0x1cf)]=_0x1a3809,this[_0x2d1f4c(0x21c)]=new ParticlesComputing(this['context'],this['data'],this['options'],this[_0x2d1f4c(0x1cf)]),this['particlesRendering']=new ParticlesRendering(this['context'],this['data'],this[_0x2d1f4c(0x1ee)],this['viewerParameters'],this['particlesComputing']);}['canvasResize'](_0x1271e4){const _0x2a2290=_0x3a25a4;this['particlesComputing']['destroyParticlesTextures'](),Object['keys'](this['particlesComputing'][_0x2a2290(0x221)])[_0x2a2290(0x1c4)](_0x2e9f0b=>{const _0x592c58=_0x2a2290;this[_0x592c58(0x21c)]['windTextures'][_0x2e9f0b]['destroy']();}),this['particlesRendering']['textures']['colorTable']['destroy'](),Object['keys'](this[_0x2a2290(0x288)]['framebuffers'])[_0x2a2290(0x1c4)](_0x4a6808=>{const _0x4ebd5c=_0x2a2290;this[_0x4ebd5c(0x288)][_0x4ebd5c(0x1f5)][_0x4a6808]['destroy']();}),this['context']=_0x1271e4,this['particlesComputing']=new ParticlesComputing(this['context'],this['data'],this['options'],this[_0x2a2290(0x1cf)]),this['particlesRendering']=new ParticlesRendering(this[_0x2a2290(0x198)],this['data'],this['options'],this['viewerParameters'],this[_0x2a2290(0x21c)]);}[_0x3a25a4(0x234)](){const _0x1486b7=_0x3a25a4,_0x4e1775=new Cesium$2['ClearCommand']({'color':new Cesium$2[(_0x1486b7(0x1f9))](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':undefined,'pass':Cesium$2['Pass'][_0x1486b7(0x25d)]});Object['keys'](this['particlesRendering']['framebuffers'])['forEach'](_0x3818af=>{const _0x32803b=_0x1486b7;_0x4e1775['framebuffer']=this['particlesRendering'][_0x32803b(0x1f5)][_0x3818af],_0x4e1775[_0x32803b(0x237)](this[_0x32803b(0x198)]);});}['refreshParticles'](_0x108586){const _0x1b78e4=_0x3a25a4;this['clearFramebuffers'](),this['particlesComputing'][_0x1b78e4(0x1e6)](),this[_0x1b78e4(0x21c)]['createParticlesTextures'](this['context'],this[_0x1b78e4(0x1ee)],this[_0x1b78e4(0x1cf)]);if(_0x108586){var _0x60ccb5,_0x10c4ab;const _0xff3335=this[_0x1b78e4(0x288)]['createSegmentsGeometry'](this['options']);this['particlesRendering']['primitives']['segments'][_0x1b78e4(0x197)]=_0xff3335;const _0x4cffa0=Cesium$2[_0x1b78e4(0x223)][_0x1b78e4(0x265)]({'context':this['context'],'geometry':_0xff3335,'attributeLocations':this['particlesRendering'][_0x1b78e4(0x270)][_0x1b78e4(0x19d)][_0x1b78e4(0x19e)],'bufferUsage':Cesium$2[_0x1b78e4(0x246)]['STATIC_DRAW']});(_0x60ccb5=this['particlesRendering']['primitives'])!==null&&_0x60ccb5!==void 0x0&&(_0x10c4ab=_0x60ccb5['segments'])!==null&&_0x10c4ab!==void 0x0&&_0x10c4ab['commandToExecute']&&(this[_0x1b78e4(0x288)]['primitives']['segments'][_0x1b78e4(0x274)]['vertexArray']=_0x4cffa0);}}['setOptions'](_0x5142a2){const _0x47fdcc=_0x3a25a4;let _0x474dbc=![];this['options']['maxParticles']!==_0x5142a2['maxParticles']&&(_0x474dbc=!![]),Object[_0x47fdcc(0x1f6)](_0x5142a2)['forEach'](_0x206add=>{this['options'][_0x206add]=_0x5142a2[_0x206add];}),this['refreshParticles'](_0x474dbc);}['applyViewerParameters'](_0x407673){Object['keys'](_0x407673)['forEach'](_0x124229=>{this['viewerParameters'][_0x124229]=_0x407673[_0x124229];}),this['refreshParticles'](![]);}['destroy'](){const _0x390e5d=_0x3a25a4;clearTimeout(this[_0x390e5d(0x279)]),this[_0x390e5d(0x21c)][_0x390e5d(0x1e6)](),Object[_0x390e5d(0x1f6)](this[_0x390e5d(0x21c)]['windTextures'])['forEach'](_0x204ce3=>{const _0x24c76f=_0x390e5d;this[_0x24c76f(0x21c)]['windTextures'][_0x204ce3][_0x24c76f(0x1ad)]();}),this['particlesRendering'][_0x390e5d(0x27d)]['colorTable']['destroy'](),Object['keys'](this['particlesRendering']['framebuffers'])['forEach'](_0x2ed80c=>{const _0x21f651=_0x390e5d;this['particlesRendering'][_0x21f651(0x1f5)][_0x2ed80c]['destroy']();});for(const _0x4671a2 in this){delete this[_0x4671a2];}}}const Cesium$1=mars3d__namespace['Cesium'],BaseLayer$1=mars3d__namespace['layer']['BaseLayer'],DEF_OPTIONS={'particlesNumber':0x1000,'fixedHeight':0x0,'fadeOpacity':0.996,'dropRate':0.003,'dropRateBump':0.01,'speedFactor':0.5,'lineWidth':0x2,'colors':[_0x3a25a4(0x281)]};class WindLayer extends BaseLayer$1{constructor(_0x56a9d5={}){_0x56a9d5={...DEF_OPTIONS,..._0x56a9d5},super(_0x56a9d5),this['_setOptionsHook'](_0x56a9d5);}get['layer'](){const _0x117990=_0x3a25a4;return this[_0x117990(0x270)];}get['data'](){const _0x157dd4=_0x3a25a4;return this[_0x157dd4(0x24e)];}set['data'](_0x2d05e7){this['setData'](_0x2d05e7);}get['colors'](){return this['options']['colors'];}set['colors'](_0x132511){const _0x11cb04=_0x3a25a4;this['options']['colors']=_0x132511,this[_0x11cb04(0x1c9)]&&this['particleSystem'][_0x11cb04(0x22e)]({'colors':_0x132511}),this['resize']();}[_0x3a25a4(0x276)](){}['_addedHook'](){const _0x490bb1=_0x3a25a4;this[_0x490bb1(0x226)]=this['_map']['scene'],this['camera']=this[_0x490bb1(0x241)]['camera'],this['primitives']=new Cesium$1['PrimitiveCollection'](),this['_map']['scene']['primitives']['add'](this['primitives']),this['viewerParameters']={'lonRange':new Cesium$1['Cartesian2'](),'latRange':new Cesium$1['Cartesian2'](),'pixelSize':0x0},this[_0x490bb1(0x269)]=new Cesium$1['BoundingSphere'](Cesium$1['Cartesian3'][_0x490bb1(0x1b6)],0.99*0x615299),this[_0x490bb1(0x1ba)](),window['addEventListener'](_0x490bb1(0x26e),this['resize']['bind'](this),![]),this[_0x490bb1(0x240)]=![],this[_0x490bb1(0x25b)]=![],this['_map']['on'](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseDown'],this[_0x490bb1(0x1bd)],this),this['_map']['on'](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseMove'],this[_0x490bb1(0x1fe)],this),this['_data']&&this['setData'](this['_data']);}['_removedHook'](){const _0x2e8af0=_0x3a25a4;window['removeEventListener'](_0x2e8af0(0x26e),this['resize']),this['_map']['off'](mars3d__namespace[_0x2e8af0(0x1fc)]['preRender'],this['_onMap_preRenderEvent'],this),this['_map']['off'](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this['_map']['off'](mars3d__namespace['EventType'][_0x2e8af0(0x284)],this['_onMouseDownEvent'],this),this['_map']['off'](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this),this['_map']['off'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this[_0x2e8af0(0x270)]['removeAll'](),this[_0x2e8af0(0x241)]['scene'][_0x2e8af0(0x270)]['remove'](this[_0x2e8af0(0x270)]);}['resize'](){const _0x4b911d=_0x3a25a4;if(!this[_0x4b911d(0x208)]||!this['particleSystem'])return;this['primitives']['show']=![],this['primitives'][_0x4b911d(0x23e)](),this['_map'][_0x4b911d(0x253)](mars3d__namespace['EventType']['preRender'],this['_onMap_preRenderEvent'],this);}['_onMap_preRenderEvent'](_0x37b667){const _0x3c7722=_0x3a25a4;this['particleSystem']['canvasResize'](this['scene']['context']),this[_0x3c7722(0x1f0)](),this['primitives']['show']=!![];}[_0x3a25a4(0x27f)](_0x2b2b86){const _0x4c3426=_0x3a25a4;clearTimeout(this[_0x4c3426(0x22a)]);if(!this['show']||!this['particleSystem'])return;this['primitives']['show']=![],this[_0x4c3426(0x22a)]=setTimeout(()=>{if(!this['show'])return;this['redraw']();},0xc8);}[_0x3a25a4(0x1bd)](_0x274997){const _0x3d753d=_0x3a25a4;this[_0x3d753d(0x240)]=!![];}[_0x3a25a4(0x1fe)](_0xd78650){const _0x1c3efd=_0x3a25a4;if(!this['show']||!this['particleSystem'])return;this['mouse_down']&&(this[_0x1c3efd(0x270)]['show']=![],this['mouse_move']=!![]);}['_onMouseUpEvent'](_0xfeb4a8){const _0x146e62=_0x3a25a4;if(!this[_0x146e62(0x208)]||!this['particleSystem'])return;this['mouse_down']&&this['mouse_move']&&this['redraw'](),this['primitives']['show']=!![],this['mouse_down']=![],this[_0x146e62(0x25b)]=![];}['redraw'](){const _0x36606c=_0x3a25a4;if(!this[_0x36606c(0x241)]||!this['show'])return;this['updateViewerParameters'](),this['particleSystem']['applyViewerParameters'](this['viewerParameters']),this['primitives'][_0x36606c(0x208)]=!![];}[_0x3a25a4(0x249)](_0x32c41){const _0x168151=_0x3a25a4;this[_0x168151(0x24e)]=_0x32c41,this['particleSystem']&&this[_0x168151(0x1c9)]['destroy'](),this['particleSystem']=new ParticleSystem(this['scene'][_0x168151(0x198)],_0x32c41,this[_0x168151(0x1d8)](),this['viewerParameters']),this['addPrimitives']();}[_0x3a25a4(0x23d)](_0x5230e9,_0x47ef51){if(_0x5230e9)for(const _0x4d4ca5 in _0x5230e9){this[_0x4d4ca5]=_0x5230e9[_0x4d4ca5];}this['particleSystem']&&this['particleSystem']['setOptions'](this['getOptions']());}[_0x3a25a4(0x1d8)](){const _0x473560=_0x3a25a4,_0x3e7230=Math['ceil'](Math[_0x473560(0x224)](this['particlesNumber']));return this['particlesNumber']=_0x3e7230*_0x3e7230,{'particlesTextureSize':_0x3e7230,'maxParticles':this['particlesNumber'],'particleHeight':this['fixedHeight'],'fadeOpacity':this['fadeOpacity'],'dropRate':this['dropRate'],'dropRateBump':this['dropRateBump'],'speedFactor':this[_0x473560(0x1dd)],'lineWidth':this['lineWidth'],'colors':this['colors']};}['addPrimitives'](){const _0x4d1d7a=_0x3a25a4;this['primitives']['add'](this['particleSystem']['particlesComputing']['primitives']['getWind']),this[_0x4d1d7a(0x270)]['add'](this[_0x4d1d7a(0x1c9)]['particlesComputing'][_0x4d1d7a(0x270)]['updateSpeed']),this['primitives'][_0x4d1d7a(0x215)](this[_0x4d1d7a(0x1c9)]['particlesComputing']['primitives']['updatePosition']),this[_0x4d1d7a(0x270)]['add'](this['particleSystem']['particlesComputing'][_0x4d1d7a(0x270)][_0x4d1d7a(0x278)]),this['primitives'][_0x4d1d7a(0x215)](this['particleSystem']['particlesComputing'][_0x4d1d7a(0x270)][_0x4d1d7a(0x1ef)]),this['primitives']['add'](this[_0x4d1d7a(0x1c9)]['particlesRendering']['primitives']['segments']),this[_0x4d1d7a(0x270)][_0x4d1d7a(0x215)](this['particleSystem']['particlesRendering']['primitives'][_0x4d1d7a(0x243)]),this['primitives']['add'](this[_0x4d1d7a(0x1c9)][_0x4d1d7a(0x288)]['primitives']['screen']);}['updateViewerParameters'](){const _0x3de1c6=_0x3a25a4;let _0x2981ea=this['camera'][_0x3de1c6(0x245)](this['scene']['globe']['ellipsoid']);if(!_0x2981ea){const _0x34d39d=this['_map'][_0x3de1c6(0x1c2)]();_0x2981ea=Cesium$1[_0x3de1c6(0x1b5)]['fromDegrees'](_0x34d39d['xmin'],_0x34d39d['ymin'],_0x34d39d['xmax'],_0x34d39d['ymax']);}const _0x20823c=Util['viewRectangleToLonLatRange'](_0x2981ea);this['viewerParameters']['lonRange']['x']=_0x20823c['lon']['min'],this['viewerParameters']['lonRange']['y']=_0x20823c[_0x3de1c6(0x22d)][_0x3de1c6(0x23c)],this['viewerParameters'][_0x3de1c6(0x273)]['x']=_0x20823c['lat'][_0x3de1c6(0x1ce)],this[_0x3de1c6(0x1cf)][_0x3de1c6(0x273)]['y']=_0x20823c['lat'][_0x3de1c6(0x23c)];const _0x328897=this['camera']['getPixelSize'](this['globeBoundingSphere'],this['scene']['drawingBufferWidth'],this['scene'][_0x3de1c6(0x26a)]);_0x328897>0x0&&(this['viewerParameters']['pixelSize']=_0x328897);}}mars3d__namespace[_0x3a25a4(0x268)]['register']('wind',WindLayer),mars3d__namespace[_0x3a25a4(0x254)]['WindLayer']=WindLayer;class CanvasParticle{constructor(){const _0x4c92a1=_0x3a25a4;this['lng']=null,this['lat']=null,this['tlng']=null,this['tlat']=null,this[_0x4c92a1(0x286)]=null,this[_0x4c92a1(0x1e0)]=null;}['destroy'](){for(const _0x22eb77 in this){delete this[_0x22eb77];}}}class CanvasWindField{constructor(_0x5235e6){this['setOptions'](_0x5235e6);}get[_0x3a25a4(0x24b)](){return this['_speedRate'];}set[_0x3a25a4(0x24b)](_0xd22e10){const _0x3c59f1=_0x3a25a4;this['_speedRate']=(0x64-(_0xd22e10>0x63?0x63:_0xd22e10))*0x64,this[_0x3c59f1(0x242)]=[(this['xmax']-this['xmin'])/this[_0x3c59f1(0x256)],(this['ymax']-this[_0x3c59f1(0x26f)])/this['_speedRate']];}get[_0x3a25a4(0x231)](){return this['_maxAge'];}set['maxAge'](_0x989615){const _0x28e743=_0x3a25a4;this[_0x28e743(0x1a6)]=_0x989615;}[_0x3a25a4(0x22e)](_0x48f694){const _0x292410=_0x3a25a4;this[_0x292410(0x1ee)]=_0x48f694,this['maxAge']=_0x48f694['maxAge']||0x78,this['speedRate']=_0x48f694[_0x292410(0x24b)]||0x32,this[_0x292410(0x1e1)]=[];const _0x442f09=_0x48f694[_0x292410(0x1c0)]||0x1000;for(let _0x21561b=0x0;_0x21561b<_0x442f09;_0x21561b++){const _0x5c2571=this['_randomParticle'](new CanvasParticle());this['particles']['push'](_0x5c2571);}}['setDate'](_0x15ec16){const _0x5a384a=_0x3a25a4;this['rows']=_0x15ec16[_0x5a384a(0x27a)],this[_0x5a384a(0x1f1)]=_0x15ec16[_0x5a384a(0x1f1)],this[_0x5a384a(0x285)]=_0x15ec16[_0x5a384a(0x285)],this['xmax']=_0x15ec16['xmax'],this['ymin']=_0x15ec16['ymin'],this['ymax']=_0x15ec16['ymax'],this['grid']=[];const _0x4e85e3=_0x15ec16['udata'],_0x9f7fe3=_0x15ec16[_0x5a384a(0x1fd)];let _0x31853d=![];_0x4e85e3[_0x5a384a(0x27b)]===this['rows']&&_0x4e85e3[0x0]['length']===this['cols']&&(_0x31853d=!![]);let _0x57a358=0x0,_0x43b3c9=null,_0x235226=null;for(let _0x256d6d=0x0;_0x256d6d<this['rows'];_0x256d6d++){_0x43b3c9=[];for(let _0x40f651=0x0;_0x40f651<this[_0x5a384a(0x1f1)];_0x40f651++,_0x57a358++){_0x31853d?_0x235226=this['_calcUV'](_0x4e85e3[_0x256d6d][_0x40f651],_0x9f7fe3[_0x256d6d][_0x40f651]):_0x235226=this[_0x5a384a(0x28a)](_0x4e85e3[_0x57a358],_0x9f7fe3[_0x57a358]),_0x43b3c9[_0x5a384a(0x27e)](_0x235226);}this['grid']['push'](_0x43b3c9);}this[_0x5a384a(0x1ee)]['reverseY']&&this[_0x5a384a(0x1b4)]['reverse']();}['clear'](){const _0x28ec8e=_0x3a25a4;delete this['rows'],delete this['cols'],delete this[_0x28ec8e(0x285)],delete this['xmax'],delete this['ymin'],delete this['ymax'],delete this['grid'],delete this[_0x28ec8e(0x1e1)];}['toGridXY'](_0x567f37,_0xea3263){const _0xdf8a78=_0x3a25a4,_0x408566=(_0x567f37-this['xmin'])/(this['xmax']-this['xmin'])*(this[_0xdf8a78(0x1f1)]-0x1),_0x435a46=(this[_0xdf8a78(0x1a4)]-_0xea3263)/(this['ymax']-this['ymin'])*(this[_0xdf8a78(0x27a)]-0x1);return[_0x408566,_0x435a46];}['getUVByXY'](_0x273276,_0x54e969){const _0x2b97d8=_0x3a25a4;if(_0x273276<0x0||_0x273276>=this['cols']||_0x54e969>=this[_0x2b97d8(0x27a)])return[0x0,0x0,0x0];const _0x50e1e6=Math['floor'](_0x273276),_0x3584be=Math[_0x2b97d8(0x239)](_0x54e969);if(_0x50e1e6===_0x273276&&_0x3584be===_0x54e969)return this[_0x2b97d8(0x1b4)][_0x54e969][_0x273276];const _0x10a49d=_0x50e1e6+0x1,_0x5a8429=_0x3584be+0x1,_0x7be048=this['getUVByXY'](_0x50e1e6,_0x3584be),_0x246800=this['getUVByXY'](_0x10a49d,_0x3584be),_0x111d35=this[_0x2b97d8(0x23f)](_0x50e1e6,_0x5a8429),_0x22e073=this['getUVByXY'](_0x10a49d,_0x5a8429);let _0x101c73=null;try{_0x101c73=this[_0x2b97d8(0x275)](_0x273276-_0x50e1e6,_0x54e969-_0x3584be,_0x7be048,_0x246800,_0x111d35,_0x22e073);}catch(_0x3f8534){console['log'](_0x273276,_0x54e969);}return _0x101c73;}['_bilinearInterpolation'](_0x4d184f,_0x370c3c,_0x1ca1da,_0x26dda0,_0x2ed194,_0x1cfe18){const _0x5cb432=0x1-_0x4d184f,_0xaa2ebe=0x1-_0x370c3c,_0x4aae99=_0x5cb432*_0xaa2ebe,_0x2c926f=_0x4d184f*_0xaa2ebe,_0x31cedc=_0x5cb432*_0x370c3c,_0x1b550a=_0x4d184f*_0x370c3c,_0x1867a5=_0x1ca1da[0x0]*_0x4aae99+_0x26dda0[0x0]*_0x2c926f+_0x2ed194[0x0]*_0x31cedc+_0x1cfe18[0x0]*_0x1b550a,_0x5dec68=_0x1ca1da[0x1]*_0x4aae99+_0x26dda0[0x1]*_0x2c926f+_0x2ed194[0x1]*_0x31cedc+_0x1cfe18[0x1]*_0x1b550a;return this['_calcUV'](_0x1867a5,_0x5dec68);}['_calcUV'](_0x344375,_0x5eea83){return[+_0x344375,+_0x5eea83,Math['sqrt'](_0x344375*_0x344375+_0x5eea83*_0x5eea83)];}[_0x3a25a4(0x1aa)](_0x15b1f0,_0x29d887){const _0x3f4f76=_0x3a25a4;if(!this[_0x3f4f76(0x220)](_0x15b1f0,_0x29d887))return null;const _0x175f6b=this['toGridXY'](_0x15b1f0,_0x29d887),_0x92c1bc=this['getUVByXY'](_0x175f6b[0x0],_0x175f6b[0x1]);return _0x92c1bc;}['isInExtent'](_0x15b61f,_0xa8b812){return _0x15b61f>=this['xmin']&&_0x15b61f<=this['xmax']&&_0xa8b812>=this['ymin']&&_0xa8b812<=this['ymax']?!![]:![];}['getRandomLatLng'](){const _0x569708=_0x3a25a4,_0x38df50=fRandomByfloat(this[_0x569708(0x285)],this['xmax']),_0xa682aa=fRandomByfloat(this['ymin'],this['ymax']);return{'lat':_0xa682aa,'lng':_0x38df50};}['getParticles'](){const _0x5f3e27=_0x3a25a4;let _0x5a6629,_0x125767,_0x48c0e5;for(let _0x1e16db=0x0,_0x576876=this['particles'][_0x5f3e27(0x27b)];_0x1e16db<_0x576876;_0x1e16db++){let _0x1e3806=this['particles'][_0x1e16db];_0x1e3806['age']<=0x0&&(_0x1e3806=this['_randomParticle'](_0x1e3806));if(_0x1e3806[_0x5f3e27(0x286)]>0x0){const _0x540759=_0x1e3806['tlng'],_0x4d3f93=_0x1e3806['tlat'];_0x48c0e5=this['getUVByPoint'](_0x540759,_0x4d3f93),_0x48c0e5?(_0x5a6629=_0x540759+this['_calc_speedRate'][0x0]*_0x48c0e5[0x0],_0x125767=_0x4d3f93+this['_calc_speedRate'][0x1]*_0x48c0e5[0x1],_0x1e3806['lng']=_0x540759,_0x1e3806['lat']=_0x4d3f93,_0x1e3806[_0x5f3e27(0x1f2)]=_0x5a6629,_0x1e3806['tlat']=_0x125767,_0x1e3806['speed']=_0x48c0e5[0x2],_0x1e3806[_0x5f3e27(0x286)]--):_0x1e3806[_0x5f3e27(0x286)]=0x0;}}return this[_0x5f3e27(0x1e1)];}['_randomParticle'](_0x3804ee){const _0x41dca0=_0x3a25a4;let _0x13b98c,_0x83bae4;for(let _0xae5b58=0x0;_0xae5b58<0x1e;_0xae5b58++){_0x13b98c=this['getRandomLatLng'](),_0x83bae4=this['getUVByPoint'](_0x13b98c['lng'],_0x13b98c['lat']);if(_0x83bae4&&_0x83bae4[0x2]>0x0)break;}if(!_0x83bae4)return _0x3804ee;const _0x253826=_0x13b98c['lng']+this[_0x41dca0(0x242)][0x0]*_0x83bae4[0x0],_0x4e6b33=_0x13b98c[_0x41dca0(0x1c3)]+this['_calc_speedRate'][0x1]*_0x83bae4[0x1];return _0x3804ee['lng']=_0x13b98c['lng'],_0x3804ee['lat']=_0x13b98c[_0x41dca0(0x1c3)],_0x3804ee['tlng']=_0x253826,_0x3804ee['tlat']=_0x4e6b33,_0x3804ee['age']=Math['round'](Math[_0x41dca0(0x1af)]()*this['maxAge']),_0x3804ee['speed']=_0x83bae4[0x2],_0x3804ee;}['destroy'](){for(const _0x772e80 in this){delete this[_0x772e80];}}}function fRandomByfloat(_0x1eaf5e,_0x4acf55){const _0x2ca52e=_0x3a25a4;return _0x1eaf5e+Math[_0x2ca52e(0x1af)]()*(_0x4acf55-_0x1eaf5e);}const Cesium=mars3d__namespace['Cesium'],BaseLayer=mars3d__namespace[_0x3a25a4(0x254)]['BaseLayer'];class CanvasWindLayer extends BaseLayer{constructor(_0x43a917={}){const _0x20176f=_0x3a25a4;super(_0x43a917),this[_0x20176f(0x23d)](_0x43a917),this[_0x20176f(0x266)]=null,_0x43a917['colors']&&_0x43a917['steps']&&(this['_colorRamp']=new mars3d__namespace['ColorRamp'](_0x43a917));}[_0x3a25a4(0x23d)](_0x1990af,_0x8b5af2){const _0x51d747=_0x3a25a4;this['frameTime']=0x3e8/(_0x1990af['frameRate']||0xa),this['_pointerEvents']=this[_0x51d747(0x1ee)][_0x51d747(0x227)]??![],this['color']=_0x1990af[_0x51d747(0x204)]||'#ffffff',this['lineWidth']=_0x1990af['lineWidth']||0x1,this['fixedHeight']=_0x1990af['fixedHeight']??0x0,this['reverseY']=_0x1990af['reverseY']??![],this['windField']&&this[_0x51d747(0x1a9)]['setOptions'](_0x1990af);}get['layer'](){return this['canvas'];}get['canvasWidth'](){const _0x318bd5=_0x3a25a4;return this[_0x318bd5(0x241)][_0x318bd5(0x226)]['canvas']['clientWidth'];}get['canvasHeight'](){const _0x560e46=_0x3a25a4;return this['_map']['scene']['canvas'][_0x560e46(0x1cc)];}get['pointerEvents'](){return this['_pointerEvents'];}set['pointerEvents'](_0x6dec37){const _0x4bea6c=_0x3a25a4;this[_0x4bea6c(0x1ac)]=_0x6dec37;if(!this[_0x4bea6c(0x266)])return;_0x6dec37?this['canvas']['style'][_0x4bea6c(0x20c)]='all':this['canvas']['style']['pointer-events']=_0x4bea6c(0x24c);}get['particlesNumber'](){const _0x46f558=_0x3a25a4;return this['options'][_0x46f558(0x1c0)];}set['particlesNumber'](_0x17be3c){const _0x56ca6a=_0x3a25a4;this[_0x56ca6a(0x1ee)][_0x56ca6a(0x1c0)]=_0x17be3c,clearTimeout(this['_canrefresh']),this['_canrefresh']=setTimeout(()=>{this['redraw']();},0x1f4);}get['speedRate'](){return this['options']['speedRate'];}set[_0x3a25a4(0x24b)](_0x12017f){const _0x25b26b=_0x3a25a4;this['options']['speedRate']=_0x12017f,this['windField']&&(this[_0x25b26b(0x1a9)]['speedRate']=_0x12017f);}get['maxAge'](){const _0x2cd507=_0x3a25a4;return this['options'][_0x2cd507(0x231)];}set['maxAge'](_0x234556){const _0x150bd1=_0x3a25a4;this['options'][_0x150bd1(0x231)]=_0x234556,this[_0x150bd1(0x1a9)]&&(this['windField']['maxAge']=_0x234556);}get[_0x3a25a4(0x1e9)](){return this['windData'];}set[_0x3a25a4(0x1e9)](_0x3b0432){this['setData'](_0x3b0432);}['_showHook'](_0x191d68){_0x191d68?this['_addedHook']():(this['windData']&&(this['options']['data']=this['windData']),this['_removedHook']());}['_mountedHook'](){const _0x47c81e=_0x3a25a4;this['options'][_0x47c81e(0x1ec)]?this['initWorker']():this['windField']=new CanvasWindField(this[_0x47c81e(0x1ee)]);}[_0x3a25a4(0x20e)](){this['canvas']=this['_createCanvas'](),this['canvasContext']=this['canvas']['getContext']('2d',{'willReadFrequently':!![]}),this['bindEvent'](),this['options']['data']&&this['setData'](this['options']['data']);}['_removedHook'](){const _0x25829d=_0x3a25a4;this[_0x25829d(0x1c6)](),this['unbindEvent'](),this[_0x25829d(0x266)]&&(this['_map']['container']['removeChild'](this[_0x25829d(0x266)]),delete this['canvas']);}['_createCanvas'](){const _0x2a7eaf=_0x3a25a4,_0x4a2175=mars3d__namespace['DomUtil']['create'](_0x2a7eaf(0x266),_0x2a7eaf(0x248),this[_0x2a7eaf(0x241)]['container']);return _0x4a2175['style']['position']='absolute',_0x4a2175['style']['top']=_0x2a7eaf(0x233),_0x4a2175['style']['left']='0px',_0x4a2175['style'][_0x2a7eaf(0x1fa)]=this[_0x2a7eaf(0x241)]['scene'][_0x2a7eaf(0x266)]['clientWidth']+'px',_0x4a2175[_0x2a7eaf(0x1a7)]['height']=this['_map'][_0x2a7eaf(0x226)]['canvas']['clientHeight']+'px',_0x4a2175['style']['pointerEvents']=this['_pointerEvents']?'auto':'none',_0x4a2175['style'][_0x2a7eaf(0x196)]=this['options']['zIndex']??0x9,_0x4a2175[_0x2a7eaf(0x1fa)]=this['_map'][_0x2a7eaf(0x226)]['canvas'][_0x2a7eaf(0x261)],_0x4a2175['height']=this['_map'][_0x2a7eaf(0x226)][_0x2a7eaf(0x266)]['clientHeight'],_0x4a2175;}[_0x3a25a4(0x26e)](){const _0x3f7f94=_0x3a25a4;this[_0x3f7f94(0x266)]&&(this['canvas'][_0x3f7f94(0x1a7)][_0x3f7f94(0x1fa)]=this[_0x3f7f94(0x241)][_0x3f7f94(0x226)]['canvas'][_0x3f7f94(0x261)]+'px',this[_0x3f7f94(0x266)]['style'][_0x3f7f94(0x229)]=this['_map']['scene'][_0x3f7f94(0x266)]['clientHeight']+'px',this['canvas']['width']=this[_0x3f7f94(0x241)][_0x3f7f94(0x226)]['canvas']['clientWidth'],this['canvas']['height']=this['_map'][_0x3f7f94(0x226)]['canvas'][_0x3f7f94(0x1cc)]);}['bindEvent'](){const _0x525ed6=_0x3a25a4,_0x3bf891=this;let _0x1a7e38=Date[_0x525ed6(0x1d4)]();(function _0x5b3da6(){const _0x1dd666=_0x525ed6;_0x3bf891['animateFrame']=window[_0x1dd666(0x1ab)](_0x5b3da6);if(_0x3bf891['show']&&_0x3bf891['windField']){const _0x318b28=Date[_0x1dd666(0x1d4)](),_0x892b66=_0x318b28-_0x1a7e38;_0x892b66>_0x3bf891[_0x1dd666(0x1a1)]&&(_0x1a7e38=_0x318b28-_0x892b66%_0x3bf891['frameTime'],_0x3bf891['update']());}}(),window['addEventListener']('resize',this['resize'][_0x525ed6(0x1e4)](this),![]),this[_0x525ed6(0x240)]=![],this['mouse_move']=![],this[_0x525ed6(0x1ee)]['mouseHidden']&&(this[_0x525ed6(0x241)]['on'](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this[_0x525ed6(0x241)]['on'](mars3d__namespace['EventType']['mouseDown'],this[_0x525ed6(0x1bd)],this),this['_map']['on'](mars3d__namespace['EventType']['mouseUp'],this[_0x525ed6(0x1d7)],this)));}['unbindEvent'](){const _0x19117f=_0x3a25a4;window[_0x19117f(0x1ed)](this['animateFrame']),delete this[_0x19117f(0x230)],window['removeEventListener'](_0x19117f(0x26e),this['resize']),this['options']['mouseHidden']&&(this[_0x19117f(0x241)]['off'](mars3d__namespace['EventType']['wheel'],this[_0x19117f(0x27f)],this),this['_map']['off'](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['off'](mars3d__namespace['EventType'][_0x19117f(0x22c)],this['_onMouseUpEvent'],this),this['_map']['off'](mars3d__namespace[_0x19117f(0x1fc)]['mouseMove'],this['_onMouseMoveEvent'],this));}['_onMapWhellEvent'](_0x3fa8ff){const _0x3469be=_0x3a25a4;clearTimeout(this['refreshTimer']);if(!this['show']||!this['canvas'])return;this['canvas']['style']['visibility']=_0x3469be(0x1df),this['refreshTimer']=setTimeout(()=>{const _0x470af7=_0x3469be;if(!this['show'])return;this['redraw'](),this[_0x470af7(0x266)]['style']['visibility']='visible';},0xc8);}['_onMouseDownEvent'](_0x32fecc){const _0x1ddc83=_0x3a25a4;this[_0x1ddc83(0x240)]=!![],this['_map'][_0x1ddc83(0x218)](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this[_0x1ddc83(0x241)]['on'](mars3d__namespace['EventType'][_0x1ddc83(0x283)],this['_onMouseMoveEvent'],this);}['_onMouseMoveEvent'](_0x2fdad7){const _0x3edbd8=_0x3a25a4;if(!this['show']||!this['canvas'])return;this[_0x3edbd8(0x240)]&&(this['canvas'][_0x3edbd8(0x1a7)]['visibility']='hidden',this[_0x3edbd8(0x25b)]=!![]);}['_onMouseUpEvent'](_0x31b774){const _0x3c6836=_0x3a25a4;if(!this['show']||!this[_0x3c6836(0x266)])return;this[_0x3c6836(0x241)]['off'](mars3d__namespace[_0x3c6836(0x1fc)][_0x3c6836(0x283)],this['_onMouseMoveEvent'],this),this['mouse_down']&&this[_0x3c6836(0x25b)]&&this['redraw'](),this['canvas']['style']['visibility']=_0x3c6836(0x206),this['mouse_down']=![],this['mouse_move']=![];}['setData'](_0x339f9c){this['clear'](),this['windData']=_0x339f9c,this['windField']['setDate'](_0x339f9c),this['redraw']();}['redraw'](){const _0x2c9e67=_0x3a25a4;if(!this[_0x2c9e67(0x208)])return;this[_0x2c9e67(0x1a9)]['setOptions'](this[_0x2c9e67(0x1ee)]),this[_0x2c9e67(0x209)]();}['update'](){const _0xc97b76=_0x3a25a4;if(this['_updateIng'])return;this['_updateIng']=!![];if(this[_0xc97b76(0x1ec)])this['windField'][_0xc97b76(0x209)]();else{const _0x491935=this['windField']['getParticles']();this[_0xc97b76(0x277)](_0x491935);}this['_updateIng']=![];}['_drawLines'](_0x26d24e){const _0x42dd15=_0x3a25a4;this[_0x42dd15(0x216)][_0x42dd15(0x287)]='destination-in',this['canvasContext']['fillRect'](0x0,0x0,this['canvasWidth'],this[_0x42dd15(0x1a5)]),this['canvasContext'][_0x42dd15(0x287)]='lighter',this['canvasContext']['globalAlpha']=0.9;const _0x293110=this[_0x42dd15(0x241)]['scene']['mode']!==Cesium['SceneMode']['SCENE3D'],_0xa96631=this[_0x42dd15(0x1b3)]*0.25;if(this[_0x42dd15(0x201)])for(let _0x27c63e=0x0,_0x374749=_0x26d24e['length'];_0x27c63e<_0x374749;_0x27c63e++){const _0x4f44fa=_0x26d24e[_0x27c63e],_0x61aeb=this['_tomap'](_0x4f44fa['lng'],_0x4f44fa['lat'],_0x4f44fa),_0x3c3b1c=this['_tomap'](_0x4f44fa['tlng'],_0x4f44fa[_0x42dd15(0x235)],_0x4f44fa);if(!_0x61aeb||!_0x3c3b1c)continue;if(_0x293110&&Math[_0x42dd15(0x1d2)](_0x61aeb[0x0]-_0x3c3b1c[0x0])>=_0xa96631)continue;this[_0x42dd15(0x216)][_0x42dd15(0x25a)](),this[_0x42dd15(0x216)][_0x42dd15(0x26d)]=this['lineWidth'],this[_0x42dd15(0x216)]['strokeStyle']=this['_colorRamp'][_0x42dd15(0x23a)](_0x4f44fa[_0x42dd15(0x1e0)]),this['canvasContext'][_0x42dd15(0x21e)](_0x61aeb[0x0],_0x61aeb[0x1]),this[_0x42dd15(0x216)]['lineTo'](_0x3c3b1c[0x0],_0x3c3b1c[0x1]),this['canvasContext']['stroke']();}else{this['canvasContext'][_0x42dd15(0x25a)](),this['canvasContext']['lineWidth']=this['lineWidth'],this[_0x42dd15(0x216)]['strokeStyle']=this[_0x42dd15(0x204)];for(let _0x183865=0x0,_0xccd157=_0x26d24e[_0x42dd15(0x27b)];_0x183865<_0xccd157;_0x183865++){const _0x55d41b=_0x26d24e[_0x183865],_0x59c55f=this['_tomap'](_0x55d41b['lng'],_0x55d41b[_0x42dd15(0x1c3)],_0x55d41b),_0x3a28c3=this[_0x42dd15(0x267)](_0x55d41b['tlng'],_0x55d41b['tlat'],_0x55d41b);if(!_0x59c55f||!_0x3a28c3)continue;if(_0x293110&&Math['abs'](_0x59c55f[0x0]-_0x3a28c3[0x0])>=_0xa96631)continue;this['canvasContext'][_0x42dd15(0x21e)](_0x59c55f[0x0],_0x59c55f[0x1]),this['canvasContext'][_0x42dd15(0x25e)](_0x3a28c3[0x0],_0x3a28c3[0x1]);}this[_0x42dd15(0x216)][_0x42dd15(0x252)]();}}[_0x3a25a4(0x267)](_0x4ce910,_0x5856cd,_0x1faf6f){const _0x5e40ef=_0x3a25a4,_0x535323=Cesium[_0x5e40ef(0x21b)]['fromDegrees'](_0x4ce910,_0x5856cd,this['fixedHeight']),_0x131f4e=this['_map']['scene'];if(_0x131f4e['mode']===Cesium['SceneMode']['SCENE3D']){const _0x5954a9=new Cesium['EllipsoidalOccluder'](_0x131f4e[_0x5e40ef(0x200)][_0x5e40ef(0x26b)],_0x131f4e[_0x5e40ef(0x217)]['positionWC']),_0x12577c=_0x5954a9['isPointVisible'](_0x535323);if(!_0x12577c)return _0x1faf6f[_0x5e40ef(0x286)]=0x0,null;}const _0xa30dfb=Cesium[_0x5e40ef(0x1eb)][_0x5e40ef(0x211)](this['_map']['scene'],_0x535323);return _0xa30dfb?[_0xa30dfb['x'],_0xa30dfb['y']]:null;}['clear'](){const _0x46e968=_0x3a25a4;this[_0x46e968(0x1a9)][_0x46e968(0x1c6)](),delete this['windData'];}[_0x3a25a4(0x1f4)](){const _0x43a118=_0x3a25a4;this['worker']=new Worker(this['options']['worker']),this['worker'][_0x43a118(0x1a3)]=_0x1dcd17=>{const _0x242e48=_0x43a118;this[_0x242e48(0x277)](_0x1dcd17['data'][_0x242e48(0x1e1)]),this[_0x242e48(0x24f)]=![];},this['windField']={'init':_0x1ad2b6=>{const _0x3eab3e=_0x43a118;this['worker']['postMessage']({'type':_0x3eab3e(0x1e3),'options':_0x1ad2b6});},'setOptions':_0x35c6ea=>{this['worker']['postMessage']({'type':'setOptions','options':_0x35c6ea});},'setDate':_0x9da90e=>{const _0x4166e9=_0x43a118;this['worker']['postMessage']({'type':_0x4166e9(0x1ae),'data':_0x9da90e});},'update':()=>{const _0x31fd92=_0x43a118;if(this[_0x31fd92(0x24f)])return;this['_updateIng2']=!![],this['worker']['postMessage']({'type':'update'});},'clear':()=>{const _0x5f587d=_0x43a118;this[_0x5f587d(0x1ec)]['postMessage']({'type':'clear'});}},this['windField']['init'](this['options']);}}mars3d__namespace['LayerUtil'][_0x3a25a4(0x1cd)]('canvasWind',CanvasWindLayer),mars3d__namespace['layer']['CanvasWindLayer']=CanvasWindLayer,mars3d__namespace['CanvasWindField']=CanvasWindField,mars3d__namespace['WindUtil']=WindUtil,exports['CanvasWindField']=CanvasWindField,exports['CanvasWindLayer']=CanvasWindLayer,exports[_0x3a25a4(0x212)]=WindLayer,exports[_0x3a25a4(0x1c5)]=WindUtil,Object['defineProperty'](exports,'__esModule',{'value':!![]});
}));
