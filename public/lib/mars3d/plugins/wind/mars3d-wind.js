/**
 * Mars3D平台插件,支持气象 风向图 功能插件  mars3d-wind
 *
 * 版本信息：v3.6.7
 * 编译日期：2023-09-25 10:02:02
 * 版权所有：Copyright by 火星科技  http://mars3d.cn
 * 使用单位：免费公开版 ，2023-03-17
 */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, (window.mars3d || require('mars3d'))) :
  typeof define === 'function' && define.amd ? define(['exports', 'mars3d'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global["mars3d-wind"] = {}, global.mars3d));
})(this, (function (exports, mars3d) { 
'use strict';const _0x56db01=_0x31b4;(function(_0x56ffce,_0x5f581e){const _0x57ba48=_0x31b4,_0x195be2=_0x56ffce();while(!![]){try{const _0x7d7146=-parseInt(_0x57ba48(0x1db))/0x1+-parseInt(_0x57ba48(0x1b5))/0x2+-parseInt(_0x57ba48(0x121))/0x3*(parseInt(_0x57ba48(0x164))/0x4)+parseInt(_0x57ba48(0x137))/0x5+-parseInt(_0x57ba48(0x1d3))/0x6+-parseInt(_0x57ba48(0x19f))/0x7+-parseInt(_0x57ba48(0x1bc))/0x8*(-parseInt(_0x57ba48(0x142))/0x9);if(_0x7d7146===_0x5f581e)break;else _0x195be2['push'](_0x195be2['shift']());}catch(_0x33a582){_0x195be2['push'](_0x195be2['shift']());}}}(_0x3c23,0x1beba));function _interopNamespace(_0x3a0445){const _0x3e6fc2=_0x31b4;if(_0x3a0445&&_0x3a0445[_0x3e6fc2(0x113)])return _0x3a0445;var _0x2c882c=Object['create'](null);return _0x3a0445&&Object['keys'](_0x3a0445)['forEach'](function(_0x2bcc78){if(_0x2bcc78!=='default'){var _0x18e64d=Object['getOwnPropertyDescriptor'](_0x3a0445,_0x2bcc78);Object['defineProperty'](_0x2c882c,_0x2bcc78,_0x18e64d['get']?_0x18e64d:{'enumerable':!![],'get':function(){return _0x3a0445[_0x2bcc78];}});}}),_0x2c882c['default']=_0x3a0445,_0x2c882c;}var mars3d__namespace=_interopNamespace(mars3d);const Cesium$7=mars3d__namespace['Cesium'];function getU(_0x282621,_0x532e3a){const _0xd5b3e3=_0x31b4,_0x288ba0=_0x282621*Math['cos'](Cesium$7['Math'][_0xd5b3e3(0x1ee)](_0x532e3a));return _0x288ba0;}function getV(_0x19452d,_0x481cea){const _0x215816=_0x31b4,_0x37c73f=_0x19452d*Math['sin'](Cesium$7[_0x215816(0x145)]['toRadians'](_0x481cea));return _0x37c73f;}function getSpeed(_0x2f7fd5,_0x5854ac){const _0x9a6545=_0x31b4,_0x15c4f7=Math[_0x9a6545(0x124)](Math['pow'](_0x2f7fd5,0x2)+Math['pow'](_0x5854ac,0x2));return _0x15c4f7;}function _0x3c23(){const _0x5220ad=['onmessage','sqrt','canvas','camera','lineTo','currentTrailsColor','_map','mouseHidden','globeBoundingSphere','speedRate','vertexShaderSource','visibility','PixelDatatype','BaseLayer','UNSIGNED_BYTE','arrayBufferView','lat','mouseUp','Cesium','fillRect','48375MLSGvz','Framebuffer','lighter','mouseDown','particlesRendering','PixelFormat','Texture','umin','WindUtil','resize','abs','9KTVBMw','windField','nextTrailsColor','Math','dimensions','requestAnimationFrame','PrimitiveType','lonRange','toDegrees','fromDegrees','red','addPrimitives','viewport','DomUtil','speedFactor','updatePosition','beginPath','commandType','textures','mod','canvasContext','dropRateBump','clientHeight','options','colors','framebuffers','particlesTextureSize','context','mouseMove','postProcessingPosition','push','latRange','now','STATIC_DRAW','9612qXIJtH','lng','TWO_PI','segments','_onMouseMoveEvent','updateSpeed','createRawRenderState','age','vdata','lev','destroyParticlesTextures','windTextures','wheel','ComponentDatatype','_updateIng','createComputingPrimitives','style','_onMouseDownEvent','currentTrails','setGeometry','drawingBufferHeight','LUMINANCE','outputTexture','max','mouse_move','Cartesian3','_showHook','createTexture','array','setData','postMessage','ymin','show','particles','Color','OPAQUE','add','position','commandList','mars3d-canvasWind','setOptions','moveTo','lineWidth','Compute','removeAll','getColorTexture','TextureMagnificationFilter','globe','ColorRamp','reverseY','RGB','cols','vertexArray','windData','PI_OVER_TWO','floor','viewerParameters','_drawLines','currentParticlesPosition','1232952aZCzxk','_calcUV','animateFrame','updateViewerParameters','width','log','createRenderingPrimitives','getUVByXY','particleSystem','currentParticlesSpeed','clearCommand','FLOAT','RGBA','colorTable','grid','getOptions','0px','register','data','_onMapWhellEvent','nextParticlesSpeed','PI_OVER_THREE','71612ijsvVX','tlng','xmax','_updateIng2','canvasWind','clear','createParticlesTextures','3924464RMlLCD','mode','framebuffer','SceneMode','ClearCommand','removeEventListener','execute','min','once','geometry','color','EventType','randomBetween','particlesTextures','left','createFramebuffer','_onMouseUpEvent','lon','trails','forEach','Rectangle','shaderProgram','maxAge','217560aAEAiJ','none','off','applyViewerParameters','pointer-events','ShaderSource','_colorRamp','attributeLocations','12713LKpwOD','tlat','east','in\x20vec2\x20st;\x0a//\x20it\x20is\x20not\x20normal\x20itself,\x20but\x20used\x20to\x20control\x20normal\x0ain\x20vec3\x20normal;\x20//\x20(point\x20to\x20use,\x20offset\x20sign,\x20not\x20used\x20component)\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x0auniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20postProcessingSpeed;\x0a\x0auniform\x20float\x20particleHeight;\x0a\x0auniform\x20float\x20aspect;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20lineWidth;\x0a\x0aout\x20float\x20speedNormalization;\x0a\x0avec3\x20convertCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20WGS84\x20(lon,\x20lat,\x20lev)\x20->\x20ECEF\x20(x,\x20y,\x20z)\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_conversion#From_geodetic_to_ECEF_coordinates\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20WGS\x2084\x20geometric\x20constants\x0a\x20\x20\x20\x20float\x20a\x20=\x206378137.0;\x20//\x20Semi-major\x20axis\x0a\x20\x20\x20\x20float\x20b\x20=\x206356752.3142;\x20//\x20Semi-minor\x20axis\x0a\x20\x20\x20\x20float\x20e2\x20=\x206.69437999014e-3;\x20//\x20First\x20eccentricity\x20squared\x0a\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x20\x20\x20\x20float\x20longitude\x20=\x20radians(lonLatLev.x);\x0a\x0a\x20\x20\x20\x20float\x20cosLat\x20=\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20sinLat\x20=\x20sin(latitude);\x0a\x20\x20\x20\x20float\x20cosLon\x20=\x20cos(longitude);\x0a\x20\x20\x20\x20float\x20sinLon\x20=\x20sin(longitude);\x0a\x0a\x20\x20\x20\x20float\x20N_Phi\x20=\x20a\x20/\x20sqrt(1.0\x20-\x20e2\x20*\x20sinLat\x20*\x20sinLat);\x0a\x20\x20\x20\x20float\x20h\x20=\x20particleHeight;\x20//\x20it\x20should\x20be\x20high\x20enough\x20otherwise\x20the\x20particle\x20may\x20not\x20pass\x20the\x20terrain\x20depth\x20test\x0a\x0a\x20\x20\x20\x20vec3\x20cartesian\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20cartesian.x\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20cosLon;\x0a\x20\x20\x20\x20cartesian.y\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20sinLon;\x0a\x20\x20\x20\x20cartesian.z\x20=\x20((b\x20*\x20b)\x20/\x20(a\x20*\x20a)\x20*\x20N_Phi\x20+\x20h)\x20*\x20sinLat;\x0a\x20\x20\x20\x20return\x20cartesian;\x0a}\x0a\x0avec4\x20calcProjectedCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20the\x20range\x20of\x20longitude\x20in\x20Cesium\x20is\x20[-180,\x20180]\x20but\x20the\x20range\x20of\x20longitude\x20in\x20the\x20NetCDF\x20file\x20is\x20[0,\x20360]\x0a\x20\x20\x20\x20//\x20[0,\x20180]\x20is\x20corresponding\x20to\x20[0,\x20180]\x20and\x20[180,\x20360]\x20is\x20corresponding\x20to\x20[-180,\x200]\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x\x20+\x20180.0,\x20360.0)\x20-\x20180.0;\x0a\x20\x20\x20\x20vec3\x20particlePosition\x20=\x20convertCoordinate(lonLatLev);\x0a\x20\x20\x20\x20vec4\x20projectedCoordinate\x20=\x20czm_modelViewProjection\x20*\x20vec4(particlePosition,\x201.0);\x0a\x20\x20\x20\x20return\x20projectedCoordinate;\x0a}\x0a\x0avec4\x20calcOffset(vec4\x20currentProjectedCoordinate,\x20vec4\x20nextProjectedCoordinate,\x20float\x20offsetSign)\x20{\x0a\x20\x20\x20\x20vec2\x20aspectVec2\x20=\x20vec2(aspect,\x201.0);\x0a\x20\x20\x20\x20vec2\x20currentXY\x20=\x20(currentProjectedCoordinate.xy\x20/\x20currentProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x20\x20\x20\x20vec2\x20nextXY\x20=\x20(nextProjectedCoordinate.xy\x20/\x20nextProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x0a\x20\x20\x20\x20float\x20offsetLength\x20=\x20lineWidth\x20/\x202.0;\x0a\x20\x20\x20\x20vec2\x20direction\x20=\x20normalize(nextXY\x20-\x20currentXY);\x0a\x20\x20\x20\x20vec2\x20normalVector\x20=\x20vec2(-direction.y,\x20direction.x);\x0a\x20\x20\x20\x20normalVector.x\x20=\x20normalVector.x\x20/\x20aspect;\x0a\x20\x20\x20\x20normalVector\x20=\x20offsetLength\x20*\x20normalVector;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20vec4(offsetSign\x20*\x20normalVector,\x200.0,\x200.0);\x0a\x20\x20\x20\x20return\x20offset;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec2\x20particleIndex\x20=\x20st;\x0a\x0a\x20\x20\x20\x20vec3\x20currentPosition\x20=\x20texture(currentParticlesPosition,\x20particleIndex).rgb;\x0a\x20\x20\x20\x20vec4\x20nextPosition\x20=\x20texture(postProcessingPosition,\x20particleIndex);\x0a\x0a\x20\x20\x20\x20vec4\x20currentProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20vec4\x20nextProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(nextPosition.w\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(nextPosition.xyz);\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20float\x20pointToUse\x20=\x20normal.x;\x20//\x20-1\x20is\x20currentProjectedCoordinate\x20and\x20+1\x20is\x20nextProjectedCoordinate\x0a\x20\x20\x20\x20float\x20offsetSign\x20=\x20normal.y;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20pixelSize\x20*\x20calcOffset(currentProjectedCoordinate,\x20nextProjectedCoordinate,\x20offsetSign);\x0a\x20\x20\x20\x20if\x20(pointToUse\x20<\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20currentProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20nextProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20speedNormalization\x20=\x20texture(postProcessingSpeed,\x20particleIndex).a;\x0a}\x0a','hidden','GeometryAttribute','primitives','destroy','TRIANGLES','bindEvent','height','destroyObject','_pointerEvents','green','fixedHeight','frameTime','_calc_speedRate','scene','wind','toRadians','PrimitiveCollection','toGridXY','_setOptionsHook','CanvasWindLayer','globalCompositeOperation','length','redraw','keys','commandToExecute','frameRate','layer','particlesNumber','getPixelSize','worker','_removedHook','TextureMinificationFilter','particlesComputing','container','NEAREST','BufferUsage','__esModule','fadeOpacity','setDate','rows','xmin','#ffffff','nextParticlesPosition','clientWidth','ymax','drawingBufferWidth','canvasHeight','SCENE3D','update','VertexArray','156qCbJIF','ZERO'];_0x3c23=function(){return _0x5220ad;};return _0x3c23();}function getDirection(_0xe2ad43,_0x36f019){const _0x45d910=_0x31b4;let _0xe9e77d=Cesium$7[_0x45d910(0x145)][_0x45d910(0x14a)](Math['atan2'](_0x36f019,_0xe2ad43));return _0xe9e77d+=_0xe9e77d<0x0?0x168:0x0,_0xe9e77d;}var WindUtil={'__proto__':null,'getU':getU,'getV':getV,'getSpeed':getSpeed,'getDirection':getDirection};const Cesium$6=mars3d__namespace[_0x56db01(0x135)];class CustomPrimitive{constructor(_0x5f284e){const _0x15e017=_0x56db01;this['commandType']=_0x5f284e[_0x15e017(0x153)],this[_0x15e017(0x1c5)]=_0x5f284e['geometry'],this[_0x15e017(0x1da)]=_0x5f284e['attributeLocations'],this['primitiveType']=_0x5f284e['primitiveType'],this['uniformMap']=_0x5f284e['uniformMap'],this['vertexShaderSource']=_0x5f284e[_0x15e017(0x12d)],this['fragmentShaderSource']=_0x5f284e['fragmentShaderSource'],this['rawRenderState']=_0x5f284e['rawRenderState'],this[_0x15e017(0x1be)]=_0x5f284e['framebuffer'],this['outputTexture']=_0x5f284e['outputTexture'],this['autoClear']=_0x5f284e['autoClear']??![],this['preExecute']=_0x5f284e['preExecute'],this['show']=!![],this[_0x15e017(0x1f7)]=undefined,this[_0x15e017(0x1a9)]=undefined,this['autoClear']&&(this['clearCommand']=new Cesium$6['ClearCommand']({'color':new Cesium$6[(_0x15e017(0x186))](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':this['framebuffer'],'pass':Cesium$6['Pass']['OPAQUE']}));}['createCommand'](_0x12c1c4){const _0x535e3a=_0x56db01;switch(this[_0x535e3a(0x153)]){case'Draw':{const _0x4d9340=Cesium$6['VertexArray']['fromGeometry']({'context':_0x12c1c4,'geometry':this[_0x535e3a(0x1c5)],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6['BufferUsage']['STATIC_DRAW']}),_0x521e69=Cesium$6['ShaderProgram']['fromCache']({'context':_0x12c1c4,'attributeLocations':this['attributeLocations'],'vertexShaderSource':this['vertexShaderSource'],'fragmentShaderSource':this['fragmentShaderSource']}),_0x324e47=Cesium$6['RenderState']['fromCache'](this['rawRenderState']);return new Cesium$6['DrawCommand']({'primitiveType':this['primitiveType'],'shaderProgram':_0x521e69,'vertexArray':_0x4d9340,'modelMatrix':Cesium$6['Matrix4']['IDENTITY'],'renderState':_0x324e47,'uniformMap':this['uniformMap'],'castShadows':![],'receiveShadows':![],'framebuffer':this['framebuffer'],'pass':Cesium$6['Pass']['OPAQUE'],'pickOnly':!![],'owner':this});}case'Compute':{return new Cesium$6['ComputeCommand']({'owner':this,'fragmentShaderSource':this['fragmentShaderSource'],'uniformMap':this['uniformMap'],'outputTexture':this[_0x535e3a(0x17a)],'persists':!![]});}}}[_0x56db01(0x177)](_0x5aa8eb,_0x3ae455){const _0x163f10=_0x56db01;this['geometry']=_0x3ae455;const _0x59304c=Cesium$6['VertexArray']['fromGeometry']({'context':_0x5aa8eb,'geometry':this['geometry'],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6[_0x163f10(0x112)][_0x163f10(0x163)]});this['commandToExecute']['vertexArray']=_0x59304c;}[_0x56db01(0x11f)](_0x58b8ee){const _0x37f95f=_0x56db01;if(!this['show'])return;if(_0x58b8ee[_0x37f95f(0x1bd)]!==Cesium$6['SceneMode'][_0x37f95f(0x11e)])return;!Cesium$6['defined'](this[_0x37f95f(0x1f7)])&&(this['commandToExecute']=this['createCommand'](_0x58b8ee['context'])),Cesium$6['defined'](this['preExecute'])&&this['preExecute'](),Cesium$6['defined'](this['clearCommand'])&&_0x58b8ee[_0x37f95f(0x18a)]['push'](this['clearCommand']),_0x58b8ee['commandList']['push'](this['commandToExecute']);}['isDestroyed'](){return![];}[_0x56db01(0x1e2)](){const _0x32783f=_0x56db01;if(this[_0x32783f(0x1a9)]){var _0x30e466,_0x3c4669;(_0x30e466=this['clearCommand'])!==null&&_0x30e466!==void 0x0&&_0x30e466['vertexArray']&&this['clearCommand']['vertexArray'][_0x32783f(0x1e2)](),(_0x3c4669=this[_0x32783f(0x1a9)])!==null&&_0x3c4669!==void 0x0&&_0x3c4669['shaderProgram']&&this['clearCommand']['shaderProgram'][_0x32783f(0x1e2)](),delete this['clearCommand'];}return this['commandToExecute']&&(this['commandToExecute'][_0x32783f(0x198)]&&this['commandToExecute']['vertexArray']['destroy'](),this['commandToExecute']['shaderProgram']&&this[_0x32783f(0x1f7)][_0x32783f(0x1d1)][_0x32783f(0x1e2)](),delete this['commandToExecute']),Cesium$6[_0x32783f(0x1e6)](this);}}function _0x31b4(_0x22fae2,_0x379fd7){const _0x3c23a1=_0x3c23();return _0x31b4=function(_0x31b4db,_0x28881e){_0x31b4db=_0x31b4db-0x10a;let _0x3100cf=_0x3c23a1[_0x31b4db];return _0x3100cf;},_0x31b4(_0x22fae2,_0x379fd7);}const Cesium$5=mars3d__namespace['Cesium'],Util=(function(){const _0x41d28d=function(){const _0x460c3d=new Cesium$5['Geometry']({'attributes':new Cesium$5['GeometryAttributes']({'position':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x3,'values':new Float32Array([-0x1,-0x1,0x0,0x1,-0x1,0x0,0x1,0x1,0x0,-0x1,0x1,0x0])}),'st':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x2,'values':new Float32Array([0x0,0x0,0x1,0x0,0x1,0x1,0x0,0x1])})}),'indices':new Uint32Array([0x3,0x2,0x0,0x0,0x2,0x1])});return _0x460c3d;},_0x1cdf13=function(_0x164e94,_0x2af11){const _0xdfc49c=_0x31b4;if(Cesium$5['defined'](_0x2af11)){const _0x56805d={};_0x56805d[_0xdfc49c(0x132)]=_0x2af11,_0x164e94['source']=_0x56805d;}const _0x4c32e2=new Cesium$5[(_0xdfc49c(0x13d))](_0x164e94);return _0x4c32e2;},_0x2f3cc5=function(_0x38a140,_0x34496b,_0xd9a4b1){const _0x345b16=_0x31b4,_0x45231c=new Cesium$5[(_0x345b16(0x138))]({'context':_0x38a140,'colorTextures':[_0x34496b],'depthTexture':_0xd9a4b1});return _0x45231c;},_0x33c66b=function(_0x51bbd4){const _0x5efe42=_0x31b4,_0x40640f=!![],_0x50b777=![],_0x3ab2eb={'viewport':_0x51bbd4[_0x5efe42(0x14e)],'depthTest':_0x51bbd4['depthTest'],'depthMask':_0x51bbd4['depthMask'],'blending':_0x51bbd4['blending']},_0x140f75=Cesium$5['Appearance']['getDefaultRenderState'](_0x40640f,_0x50b777,_0x3ab2eb);return _0x140f75;},_0x194d88=function(_0x1e40f3){const _0x595697=_0x31b4,_0x273ad5={},_0x13338a=Cesium$5['Math'][_0x595697(0x155)](_0x1e40f3['west'],Cesium$5['Math']['TWO_PI']),_0x4eec65=Cesium$5['Math'][_0x595697(0x155)](_0x1e40f3[_0x595697(0x1dd)],Cesium$5['Math']['TWO_PI']),_0x51bf62=_0x1e40f3['width'];let _0x3b0c34,_0x4fb039;_0x51bf62>Cesium$5['Math']['THREE_PI_OVER_TWO']?(_0x3b0c34=0x0,_0x4fb039=Cesium$5['Math'][_0x595697(0x166)]):_0x4eec65-_0x13338a<_0x51bf62?(_0x3b0c34=_0x13338a,_0x4fb039=_0x13338a+_0x51bf62):(_0x3b0c34=_0x13338a,_0x4fb039=_0x4eec65);_0x273ad5[_0x595697(0x1cd)]={'min':Cesium$5[_0x595697(0x145)]['toDegrees'](_0x3b0c34),'max':Cesium$5['Math']['toDegrees'](_0x4fb039)};const _0xbe2671=_0x1e40f3['south'],_0x293d58=_0x1e40f3['north'],_0x1a5a51=_0x1e40f3['height'],_0x5ccfed=_0x1a5a51>Cesium$5['Math']['PI']/0xc?_0x1a5a51/0x2:0x0;let _0x5597e4=Cesium$5[_0x595697(0x145)]['clampToLatitudeRange'](_0xbe2671-_0x5ccfed),_0x207304=Cesium$5['Math']['clampToLatitudeRange'](_0x293d58+_0x5ccfed);return _0x5597e4<-Cesium$5['Math'][_0x595697(0x1b4)]&&(_0x5597e4=-Cesium$5[_0x595697(0x145)]['PI_OVER_TWO']),_0x207304>Cesium$5[_0x595697(0x145)]['PI_OVER_THREE']&&(_0x207304=Cesium$5[_0x595697(0x145)][_0x595697(0x19a)]),_0x273ad5['lat']={'min':Cesium$5['Math']['toDegrees'](_0x5597e4),'max':Cesium$5['Math']['toDegrees'](_0x207304)},_0x273ad5;};return{'getFullscreenQuad':_0x41d28d,'createTexture':_0x1cdf13,'createFramebuffer':_0x2f3cc5,'createRawRenderState':_0x33c66b,'viewRectangleToLonLatRange':_0x194d88};}());var segmentDraw_vert=_0x56db01(0x1de),segmentDraw_frag='uniform\x20sampler2D\x20colorTable;\x0a\x0ain\x20float\x20speedNormalization;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20out_FragColor\x20=\x20texture(colorTable,\x20vec2(speedNormalization,\x200.0));\x0a}\x0a',fullscreen_vert='in\x20vec3\x20position;\x0ain\x20vec2\x20st;\x0a\x0aout\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20textureCoordinate\x20=\x20st;\x0a\x20\x20\x20\x20gl_Position\x20=\x20vec4(position,\x201.0);\x0a}\x0a',trailDraw_frag='uniform\x20sampler2D\x20segmentsColorTexture;\x0auniform\x20sampler2D\x20segmentsDepthTexture;\x0a\x0auniform\x20sampler2D\x20currentTrailsColor;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0auniform\x20float\x20fadeOpacity;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20pointsColor\x20=\x20texture(segmentsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(currentTrailsColor,\x20textureCoordinate);\x0a\x0a\x20\x20\x20\x20trailsColor\x20=\x20floor(fadeOpacity\x20*\x20255.0\x20*\x20trailsColor)\x20/\x20255.0;\x20//\x20make\x20sure\x20the\x20trailsColor\x20will\x20be\x20strictly\x20decreased\x0a\x0a\x20\x20\x20\x20float\x20pointsDepth\x20=\x20texture(segmentsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(pointsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20pointsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20trailsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20gl_FragDepth\x20=\x20min(pointsDepth,\x20trailsDepth);\x0a}\x0a',screenDraw_frag='uniform\x20sampler2D\x20trailsColorTexture;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(trailsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20trailsColor;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$4=mars3d__namespace['Cesium'];class ParticlesRendering{constructor(_0x3d4533,_0x1e49ee,_0x2dcf53,_0x4ded2b,_0x170bd2){this['createRenderingTextures'](_0x3d4533,_0x1e49ee,_0x2dcf53['colors']),this['createRenderingFramebuffers'](_0x3d4533),this['createRenderingPrimitives'](_0x3d4533,_0x2dcf53,_0x4ded2b,_0x170bd2);}['createRenderingTextures'](_0x4a692e,_0x1fe274,_0x34e4ba){const _0x58af60=_0x56db01,_0x40b555={'context':_0x4a692e,'width':_0x4a692e['drawingBufferWidth'],'height':_0x4a692e['drawingBufferHeight'],'pixelFormat':Cesium$4['PixelFormat'][_0x58af60(0x1ab)],'pixelDatatype':Cesium$4['PixelDatatype'][_0x58af60(0x131)]},_0x38fbbf={'context':_0x4a692e,'width':_0x4a692e[_0x58af60(0x11c)],'height':_0x4a692e['drawingBufferHeight'],'pixelFormat':Cesium$4['PixelFormat']['DEPTH_COMPONENT'],'pixelDatatype':Cesium$4['PixelDatatype']['UNSIGNED_INT']},_0x265665=_0x34e4ba[_0x58af60(0x1f4)],_0x253245=new Float32Array(_0x265665*0x3);for(let _0x1dd0b9=0x0;_0x1dd0b9<_0x265665;_0x1dd0b9++){const _0x2eabc5=Cesium$4['Color']['fromCssColorString'](_0x34e4ba[_0x1dd0b9]);_0x253245[0x3*_0x1dd0b9]=_0x2eabc5[_0x58af60(0x14c)],_0x253245[0x3*_0x1dd0b9+0x1]=_0x2eabc5[_0x58af60(0x1e8)],_0x253245[0x3*_0x1dd0b9+0x2]=_0x2eabc5['blue'];}const _0x2fee41={'context':_0x4a692e,'width':_0x265665,'height':0x1,'pixelFormat':Cesium$4[_0x58af60(0x13c)][_0x58af60(0x196)],'pixelDatatype':Cesium$4['PixelDatatype']['FLOAT'],'sampler':new Cesium$4['Sampler']({'minificationFilter':Cesium$4['TextureMinificationFilter']['LINEAR'],'magnificationFilter':Cesium$4[_0x58af60(0x192)]['LINEAR']})};this['textures']={'segmentsColor':Util[_0x58af60(0x17f)](_0x40b555),'segmentsDepth':Util['createTexture'](_0x38fbbf),'currentTrailsColor':Util[_0x58af60(0x17f)](_0x40b555),'currentTrailsDepth':Util[_0x58af60(0x17f)](_0x38fbbf),'nextTrailsColor':Util['createTexture'](_0x40b555),'nextTrailsDepth':Util['createTexture'](_0x38fbbf),'colorTable':Util[_0x58af60(0x17f)](_0x2fee41,_0x253245)};}['createRenderingFramebuffers'](_0x512c21){const _0x37fadf=_0x56db01;this['framebuffers']={'segments':Util['createFramebuffer'](_0x512c21,this['textures']['segmentsColor'],this['textures']['segmentsDepth']),'currentTrails':Util['createFramebuffer'](_0x512c21,this[_0x37fadf(0x154)][_0x37fadf(0x128)],this[_0x37fadf(0x154)]['currentTrailsDepth']),'nextTrails':Util[_0x37fadf(0x1cb)](_0x512c21,this['textures'][_0x37fadf(0x144)],this[_0x37fadf(0x154)]['nextTrailsDepth'])};}['createSegmentsGeometry'](_0x19fe6e){const _0x471cfa=_0x56db01,_0x4a714c=0x4;let _0x4ec057=[];for(let _0x5c4046=0x0;_0x5c4046<_0x19fe6e['particlesTextureSize'];_0x5c4046++){for(let _0x30eeae=0x0;_0x30eeae<_0x19fe6e['particlesTextureSize'];_0x30eeae++){for(let _0xa91423=0x0;_0xa91423<_0x4a714c;_0xa91423++){_0x4ec057['push'](_0x5c4046/_0x19fe6e[_0x471cfa(0x15c)]),_0x4ec057['push'](_0x30eeae/_0x19fe6e['particlesTextureSize']);}}}_0x4ec057=new Float32Array(_0x4ec057);let _0x5a4df7=[];const _0x7a4d0d=[-0x1,0x1],_0x1041fd=[-0x1,0x1];for(let _0x916a1a=0x0;_0x916a1a<_0x19fe6e['maxParticles'];_0x916a1a++){for(let _0x58ec9c=0x0;_0x58ec9c<_0x4a714c/0x2;_0x58ec9c++){for(let _0xa244e1=0x0;_0xa244e1<_0x4a714c/0x2;_0xa244e1++){_0x5a4df7['push'](_0x7a4d0d[_0x58ec9c]),_0x5a4df7['push'](_0x1041fd[_0xa244e1]),_0x5a4df7['push'](0x0);}}}_0x5a4df7=new Float32Array(_0x5a4df7);const _0x40e03c=0x6*_0x19fe6e['maxParticles'],_0x322a6d=new Uint32Array(_0x40e03c);for(let _0x4cf91b=0x0,_0x3ff1af=0x0,_0x5a3c84=0x0;_0x4cf91b<_0x19fe6e['maxParticles'];_0x4cf91b++){_0x322a6d[_0x3ff1af++]=_0x5a3c84+0x0,_0x322a6d[_0x3ff1af++]=_0x5a3c84+0x1,_0x322a6d[_0x3ff1af++]=_0x5a3c84+0x2,_0x322a6d[_0x3ff1af++]=_0x5a3c84+0x2,_0x322a6d[_0x3ff1af++]=_0x5a3c84+0x1,_0x322a6d[_0x3ff1af++]=_0x5a3c84+0x3,_0x5a3c84+=0x4;}const _0x30eef2=new Cesium$4['Geometry']({'attributes':new Cesium$4['GeometryAttributes']({'st':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x2,'values':_0x4ec057}),'normal':new Cesium$4[(_0x471cfa(0x1e0))]({'componentDatatype':Cesium$4[_0x471cfa(0x171)][_0x471cfa(0x1aa)],'componentsPerAttribute':0x3,'values':_0x5a4df7})}),'indices':_0x322a6d});return _0x30eef2;}[_0x56db01(0x1a5)](_0x5af00e,_0x105ef7,_0x256614,_0x5f2cf8){const _0x23515b=_0x56db01,_0x115d82=this;this['primitives']={'segments':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'st':0x0,'normal':0x1},'geometry':this['createSegmentsGeometry'](_0x105ef7),'primitiveType':Cesium$4['PrimitiveType'][_0x23515b(0x1e3)],'uniformMap':{'currentParticlesPosition':function(){const _0x1cb975=_0x23515b;return _0x5f2cf8['particlesTextures'][_0x1cb975(0x19e)];},'postProcessingPosition':function(){const _0x3e63a7=_0x23515b;return _0x5f2cf8[_0x3e63a7(0x1c9)]['postProcessingPosition'];},'postProcessingSpeed':function(){const _0x592da3=_0x23515b;return _0x5f2cf8[_0x592da3(0x1c9)]['postProcessingSpeed'];},'colorTable':function(){return _0x115d82['textures']['colorTable'];},'aspect':function(){return _0x5af00e['drawingBufferWidth']/_0x5af00e['drawingBufferHeight'];},'pixelSize':function(){return _0x256614['pixelSize'];},'lineWidth':function(){return _0x105ef7['lineWidth'];},'particleHeight':function(){return _0x105ef7['particleHeight'];}},'vertexShaderSource':new Cesium$4[(_0x23515b(0x1d8))]({'sources':[segmentDraw_vert]}),'fragmentShaderSource':new Cesium$4[(_0x23515b(0x1d8))]({'sources':[segmentDraw_frag]}),'rawRenderState':Util[_0x23515b(0x16a)]({'viewport':undefined,'depthTest':{'enabled':!![]},'depthMask':!![]}),'framebuffer':this['framebuffers']['segments'],'autoClear':!![]}),'trails':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'segmentsColorTexture':function(){return _0x115d82['textures']['segmentsColor'];},'segmentsDepthTexture':function(){return _0x115d82['textures']['segmentsDepth'];},'currentTrailsColor':function(){const _0x237b27=_0x23515b;return _0x115d82[_0x237b27(0x15b)]['currentTrails'][_0x237b27(0x191)](0x0);},'trailsDepthTexture':function(){return _0x115d82['framebuffers']['currentTrails']['depthTexture'];},'fadeOpacity':function(){return _0x105ef7['fadeOpacity'];}},'vertexShaderSource':new Cesium$4[(_0x23515b(0x1d8))]({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[trailDraw_frag]}),'rawRenderState':Util[_0x23515b(0x16a)]({'viewport':undefined,'depthTest':{'enabled':!![],'func':Cesium$4['DepthFunction']['ALWAYS']},'depthMask':!![]}),'framebuffer':this['framebuffers']['nextTrails'],'autoClear':!![],'preExecute':function(){const _0x2be1f0=_0x23515b,_0x3a9561=_0x115d82[_0x2be1f0(0x15b)]['currentTrails'];_0x115d82[_0x2be1f0(0x15b)][_0x2be1f0(0x176)]=_0x115d82['framebuffers']['nextTrails'],_0x115d82[_0x2be1f0(0x15b)]['nextTrails']=_0x3a9561,_0x115d82['primitives']['trails']['commandToExecute']['framebuffer']=_0x115d82['framebuffers']['nextTrails'],_0x115d82[_0x2be1f0(0x1e1)]['trails'][_0x2be1f0(0x1a9)]['framebuffer']=_0x115d82['framebuffers']['nextTrails'];}}),'screen':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4[_0x23515b(0x148)][_0x23515b(0x1e3)],'uniformMap':{'trailsColorTexture':function(){const _0x426c3e=_0x23515b;return _0x115d82[_0x426c3e(0x15b)]['nextTrails'][_0x426c3e(0x191)](0x0);},'trailsDepthTexture':function(){return _0x115d82['framebuffers']['nextTrails']['depthTexture'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[screenDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':![]},'depthMask':!![],'blending':{'enabled':!![]}}),'framebuffer':undefined})};}}var getWind_frag='//\x20the\x20size\x20of\x20UV\x20textures:\x20width\x20=\x20lon,\x20height\x20=\x20lat*lev\x0auniform\x20sampler2D\x20U;\x20//\x20eastward\x20wind\x0auniform\x20sampler2D\x20V;\x20//\x20northward\x20wind\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0a\x0auniform\x20vec3\x20dimension;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20vec3\x20minimum;\x20//\x20minimum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20maximum;\x20//\x20maximum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20interval;\x20//\x20interval\x20of\x20each\x20dimension\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20mapPositionToNormalizedIndex2D(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20range\x20of\x20longitude\x20and\x20latitude\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x,\x20360.0);\x0a\x20\x20\x20\x20lonLatLev.y\x20=\x20clamp(lonLatLev.y,\x20-90.0,\x2090.0);\x0a\x0a\x20\x20\x20\x20vec3\x20index3D\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20index3D.x\x20=\x20(lonLatLev.x\x20-\x20minimum.x)\x20/\x20interval.x;\x0a\x20\x20\x20\x20index3D.y\x20=\x20(lonLatLev.y\x20-\x20minimum.y)\x20/\x20interval.y;\x0a\x20\x20\x20\x20index3D.z\x20=\x20(lonLatLev.z\x20-\x20minimum.z)\x20/\x20interval.z;\x0a\x0a\x20\x20\x20\x20//\x20the\x20st\x20texture\x20coordinate\x20corresponding\x20to\x20(col,\x20row)\x20index\x0a\x20\x20\x20\x20//\x20example\x0a\x20\x20\x20\x20//\x20data\x20array\x20is\x20[0,\x201,\x202,\x203,\x204,\x205],\x20width\x20=\x203,\x20height\x20=\x202\x0a\x20\x20\x20\x20//\x20the\x20content\x20of\x20texture\x20will\x20be\x0a\x20\x20\x20\x20//\x20t\x201.0\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x203\x204\x205\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x200\x201\x202\x0a\x20\x20\x20\x20//\x20\x20\x200.0------1.0\x20s\x0a\x0a\x20\x20\x20\x20vec2\x20index2D\x20=\x20vec2(index3D.x,\x20index3D.z\x20*\x20dimension.y\x20+\x20index3D.y);\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20vec2(index2D.x\x20/\x20dimension.x,\x20index2D.y\x20/\x20(dimension.y\x20*\x20dimension.z));\x0a\x20\x20\x20\x20return\x20normalizedIndex2D;\x0a}\x0a\x0afloat\x20getWind(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20mapPositionToNormalizedIndex2D(lonLatLev);\x0a\x20\x20\x20\x20float\x20result\x20=\x20texture(windTexture,\x20normalizedIndex2D).r;\x0a\x20\x20\x20\x20return\x20result;\x0a}\x0a\x0aconst\x20mat4\x20kernelMatrix\x20=\x20mat4(\x0a\x20\x20\x20\x200.0,\x20-1.0,\x202.0,\x20-1.0,\x20//\x20first\x20column\x0a\x20\x20\x20\x202.0,\x200.0,\x20-5.0,\x203.0,\x20//\x20second\x20column\x0a\x20\x20\x20\x200.0,\x201.0,\x204.0,\x20-3.0,\x20//\x20third\x20column\x0a\x20\x20\x20\x200.0,\x200.0,\x20-1.0,\x201.0\x20//\x20fourth\x20column\x0a);\x0afloat\x20oneDimensionInterpolation(float\x20t,\x20float\x20p0,\x20float\x20p1,\x20float\x20p2,\x20float\x20p3)\x20{\x0a\x20\x20\x20\x20vec4\x20tVec4\x20=\x20vec4(1.0,\x20t,\x20t\x20*\x20t,\x20t\x20*\x20t\x20*\x20t);\x0a\x20\x20\x20\x20tVec4\x20=\x20tVec4\x20/\x202.0;\x0a\x20\x20\x20\x20vec4\x20pVec4\x20=\x20vec4(p0,\x20p1,\x20p2,\x20p3);\x0a\x20\x20\x20\x20return\x20dot((tVec4\x20*\x20kernelMatrix),\x20pVec4);\x0a}\x0a\x0afloat\x20calculateB(sampler2D\x20windTexture,\x20float\x20t,\x20float\x20lon,\x20float\x20lat,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20float\x20lon0\x20=\x20floor(lon)\x20-\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon1\x20=\x20floor(lon);\x0a\x20\x20\x20\x20float\x20lon2\x20=\x20floor(lon)\x20+\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon3\x20=\x20floor(lon)\x20+\x202.0\x20*\x20interval.x;\x0a\x0a\x20\x20\x20\x20float\x20p0\x20=\x20getWind(windTexture,\x20vec3(lon0,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p1\x20=\x20getWind(windTexture,\x20vec3(lon1,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p2\x20=\x20getWind(windTexture,\x20vec3(lon2,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p3\x20=\x20getWind(windTexture,\x20vec3(lon3,\x20lat,\x20lev));\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(t,\x20p0,\x20p1,\x20p2,\x20p3);\x0a}\x0a\x0afloat\x20interpolateOneTexture(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20float\x20lon\x20=\x20lonLatLev.x;\x0a\x20\x20\x20\x20float\x20lat\x20=\x20lonLatLev.y;\x0a\x20\x20\x20\x20float\x20lev\x20=\x20lonLatLev.z;\x0a\x0a\x20\x20\x20\x20float\x20lat0\x20=\x20floor(lat)\x20-\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat1\x20=\x20floor(lat);\x0a\x20\x20\x20\x20float\x20lat2\x20=\x20floor(lat)\x20+\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat3\x20=\x20floor(lat)\x20+\x202.0\x20*\x20interval.y;\x0a\x0a\x20\x20\x20\x20vec2\x20coefficient\x20=\x20lonLatLev.xy\x20-\x20floor(lonLatLev.xy);\x0a\x20\x20\x20\x20float\x20b0\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat0,\x20lev);\x0a\x20\x20\x20\x20float\x20b1\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat1,\x20lev);\x0a\x20\x20\x20\x20float\x20b2\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat2,\x20lev);\x0a\x20\x20\x20\x20float\x20b3\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat3,\x20lev);\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(coefficient.y,\x20b0,\x20b1,\x20b2,\x20b3);\x0a}\x0a\x0avec3\x20bicubic(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20https://en.wikipedia.org/wiki/Bicubic_interpolation#Bicubic_convolution_algorithm\x0a\x20\x20\x20\x20float\x20u\x20=\x20interpolateOneTexture(U,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20v\x20=\x20interpolateOneTexture(V,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20return\x20vec3(u,\x20v,\x20w);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20bicubic(lonLatLev);\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(windVector,\x200.0);\x0a}\x0a',updateSpeed_frag='uniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0auniform\x20sampler2D\x20particlesWind;\x0a\x0a//\x20used\x20to\x20calculate\x20the\x20wind\x20norm\x0auniform\x20vec2\x20uSpeedRange;\x20//\x20(min,\x20max);\x0auniform\x20vec2\x20vSpeedRange;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20speedFactor;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0afloat\x20calculateWindNorm(vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec3\x20percent\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20percent.x\x20=\x20(speed.x\x20-\x20uSpeedRange.x)\x20/\x20(uSpeedRange.y\x20-\x20uSpeedRange.x);\x0a\x20\x20\x20\x20percent.y\x20=\x20(speed.y\x20-\x20vSpeedRange.x)\x20/\x20(vSpeedRange.y\x20-\x20vSpeedRange.x);\x0a\x20\x20\x20\x20float\x20normalization\x20=\x20length(percent);\x0a\x0a\x20\x20\x20\x20return\x20normalization;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20//\x20vec3\x20currentSpeed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20texture(particlesWind,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20vec4(speedFactor\x20*\x20pixelSize\x20*\x20windVector,\x20calculateWindNorm(windVector));\x0a\x20\x20\x20\x20out_FragColor\x20=\x20nextSpeed;\x0a}\x0a',updatePosition_frag='uniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20lengthOfLonLat(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20unit\x20conversion:\x20meters\x20->\x20longitude\x20latitude\x20degrees\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_system#Length_of_a_degree\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20Calculate\x20the\x20length\x20of\x20a\x20degree\x20of\x20latitude\x20and\x20longitude\x20in\x20meters\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x0a\x20\x20\x20\x20float\x20term1\x20=\x20111132.92;\x0a\x20\x20\x20\x20float\x20term2\x20=\x20559.82\x20*\x20cos(2.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term3\x20=\x201.175\x20*\x20cos(4.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term4\x20=\x200.0023\x20*\x20cos(6.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20latLength\x20=\x20term1\x20-\x20term2\x20+\x20term3\x20-\x20term4;\x0a\x0a\x20\x20\x20\x20float\x20term5\x20=\x20111412.84\x20*\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20term6\x20=\x2093.5\x20*\x20cos(3.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term7\x20=\x200.118\x20*\x20cos(5.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20longLength\x20=\x20term5\x20-\x20term6\x20+\x20term7;\x0a\x0a\x20\x20\x20\x20return\x20vec2(longLength,\x20latLength);\x0a}\x0a\x0avoid\x20updatePosition(vec3\x20lonLatLev,\x20vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec2\x20lonLatLength\x20=\x20lengthOfLonLat(lonLatLev);\x0a\x20\x20\x20\x20float\x20u\x20=\x20speed.x\x20/\x20lonLatLength.x;\x0a\x20\x20\x20\x20float\x20v\x20=\x20speed.y\x20/\x20lonLatLength.y;\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20vec3\x20windVectorInLonLatLev\x20=\x20vec3(u,\x20v,\x20w);\x0a\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20lonLatLev\x20+\x20windVectorInLonLatLev;\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20speed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20updatePosition(lonLatLev,\x20speed);\x0a}\x0a',postProcessingPosition_frag='uniform\x20sampler2D\x20nextParticlesPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0a//\x20range\x20(min,\x20max)\x0auniform\x20vec2\x20lonRange;\x0auniform\x20vec2\x20latRange;\x0a\x0auniform\x20float\x20randomCoefficient;\x20//\x20use\x20to\x20improve\x20the\x20pseudo-random\x20generator\x0auniform\x20float\x20dropRate;\x20//\x20drop\x20rate\x20is\x20a\x20chance\x20a\x20particle\x20will\x20restart\x20at\x20random\x20position\x20to\x20avoid\x20degeneration\x0auniform\x20float\x20dropRateBump;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0a//\x20pseudo-random\x20generator\x0aconst\x20vec3\x20randomConstants\x20=\x20vec3(12.9898,\x2078.233,\x204375.85453);\x0aconst\x20vec2\x20normalRange\x20=\x20vec2(0.0,\x201.0);\x0afloat\x20rand(vec2\x20seed,\x20vec2\x20range)\x20{\x0a\x20\x20\x20\x20vec2\x20randomSeed\x20=\x20randomCoefficient\x20*\x20seed;\x0a\x20\x20\x20\x20float\x20temp\x20=\x20dot(randomConstants.xy,\x20randomSeed);\x0a\x20\x20\x20\x20temp\x20=\x20fract(sin(temp)\x20*\x20(randomConstants.z\x20+\x20temp));\x0a\x20\x20\x20\x20return\x20temp\x20*\x20(range.y\x20-\x20range.x)\x20+\x20range.x;\x0a}\x0a\x0avec3\x20generateRandomParticle(vec2\x20seed,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20longitude\x20is\x20in\x20[0,\x20360]\x0a\x20\x20\x20\x20float\x20randomLon\x20=\x20mod(rand(seed,\x20lonRange),\x20360.0);\x0a\x20\x20\x20\x20float\x20randomLat\x20=\x20rand(-seed,\x20latRange);\x0a\x0a\x20\x20\x20\x20return\x20vec3(randomLon,\x20randomLat,\x20lev);\x0a}\x0a\x0abool\x20particleOutbound(vec3\x20particle)\x20{\x0a\x20\x20\x20\x20return\x20particle.y\x20<\x20-90.0\x20||\x20particle.y\x20>\x2090.0;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20texture(nextParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20float\x20particleDropRate\x20=\x20dropRate\x20+\x20dropRateBump\x20*\x20nextSpeed.a;\x0a\x0a\x20\x20\x20\x20vec2\x20seed1\x20=\x20nextParticle.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec2\x20seed2\x20=\x20nextSpeed.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec3\x20randomParticle\x20=\x20generateRandomParticle(seed1,\x20nextParticle.z);\x0a\x20\x20\x20\x20float\x20randomNumber\x20=\x20rand(seed2,\x20normalRange);\x0a\x0a\x20\x20\x20\x20if\x20(randomNumber\x20<\x20particleDropRate\x20||\x20particleOutbound(nextParticle))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(randomParticle,\x201.0);\x20//\x201.0\x20means\x20this\x20is\x20a\x20random\x20particle\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a\x20\x20\x20\x20}\x0a}\x0a',postProcessingSpeed_frag='uniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20randomParticle\x20=\x20texture(postProcessingPosition,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20vec4\x20particleSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x0a\x20\x20\x20\x20if\x20(randomParticle.a\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20particleSpeed;\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$3=mars3d__namespace[_0x56db01(0x135)];class ParticlesComputing{constructor(_0x294c22,_0x4d9848,_0x11e22d,_0x25ddaa){const _0x6c0e8c=_0x56db01;this['data']=_0x4d9848,this['createWindTextures'](_0x294c22,_0x4d9848),this[_0x6c0e8c(0x1bb)](_0x294c22,_0x11e22d,_0x25ddaa),this[_0x6c0e8c(0x173)](_0x4d9848,_0x11e22d,_0x25ddaa);}['createWindTextures'](_0x32069c,_0x37ed48){const _0x55d195=_0x56db01,_0x1b588b={'context':_0x32069c,'width':_0x37ed48['dimensions']['lon'],'height':_0x37ed48['dimensions'][_0x55d195(0x133)]*(_0x37ed48['dimensions'][_0x55d195(0x16d)]||0x1),'pixelFormat':Cesium$3['PixelFormat'][_0x55d195(0x179)],'pixelDatatype':Cesium$3['PixelDatatype']['FLOAT'],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3[_0x55d195(0x10e)][_0x55d195(0x111)],'magnificationFilter':Cesium$3['TextureMagnificationFilter']['NEAREST']})};this['windTextures']={'U':Util['createTexture'](_0x1b588b,_0x37ed48['U'][_0x55d195(0x180)]),'V':Util[_0x55d195(0x17f)](_0x1b588b,_0x37ed48['V']['array'])};}['createParticlesTextures'](_0x5e9bdf,_0x8b122d,_0x101ce8){const _0x2740c9=_0x56db01,_0x395ba4={'context':_0x5e9bdf,'width':_0x8b122d[_0x2740c9(0x15c)],'height':_0x8b122d[_0x2740c9(0x15c)],'pixelFormat':Cesium$3['PixelFormat'][_0x2740c9(0x1ab)],'pixelDatatype':Cesium$3[_0x2740c9(0x12f)]['FLOAT'],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3[_0x2740c9(0x10e)]['NEAREST'],'magnificationFilter':Cesium$3['TextureMagnificationFilter'][_0x2740c9(0x111)]})},_0x2272e5=this['randomizeParticles'](_0x8b122d['maxParticles'],_0x101ce8),_0x2379e9=new Float32Array(0x4*_0x8b122d['maxParticles'])['fill'](0x0);this[_0x2740c9(0x1c9)]={'particlesWind':Util['createTexture'](_0x395ba4),'currentParticlesPosition':Util['createTexture'](_0x395ba4,_0x2272e5),'nextParticlesPosition':Util['createTexture'](_0x395ba4,_0x2272e5),'currentParticlesSpeed':Util['createTexture'](_0x395ba4,_0x2379e9),'nextParticlesSpeed':Util['createTexture'](_0x395ba4,_0x2379e9),'postProcessingPosition':Util['createTexture'](_0x395ba4,_0x2272e5),'postProcessingSpeed':Util['createTexture'](_0x395ba4,_0x2379e9)};}['randomizeParticles'](_0x3772b9,_0x12db4b){const _0x39474d=_0x56db01,_0xf563c3=new Float32Array(0x4*_0x3772b9);for(let _0x1a6884=0x0;_0x1a6884<_0x3772b9;_0x1a6884++){_0xf563c3[0x4*_0x1a6884]=Cesium$3['Math'][_0x39474d(0x1c8)](_0x12db4b[_0x39474d(0x149)]['x'],_0x12db4b['lonRange']['y']),_0xf563c3[0x4*_0x1a6884+0x1]=Cesium$3['Math']['randomBetween'](_0x12db4b[_0x39474d(0x161)]['x'],_0x12db4b['latRange']['y']),_0xf563c3[0x4*_0x1a6884+0x2]=Cesium$3['Math']['randomBetween'](this[_0x39474d(0x1b1)][_0x39474d(0x16d)][_0x39474d(0x1c3)],this['data']['lev']['max']),_0xf563c3[0x4*_0x1a6884+0x3]=0x0;}return _0xf563c3;}[_0x56db01(0x16e)](){const _0x25a2e4=_0x56db01;Object[_0x25a2e4(0x1f6)](this[_0x25a2e4(0x1c9)])['forEach'](_0x370550=>{this['particlesTextures'][_0x370550]['destroy']();});}['createComputingPrimitives'](_0x29fbc8,_0x470f96,_0x4eb12d){const _0x1f4c42=_0x56db01,_0x1cf452=new Cesium$3['Cartesian3'](_0x29fbc8[_0x1f4c42(0x146)]['lon'],_0x29fbc8[_0x1f4c42(0x146)][_0x1f4c42(0x133)],_0x29fbc8['dimensions']['lev']),_0x360bd6=new Cesium$3['Cartesian3'](_0x29fbc8['lon'][_0x1f4c42(0x1c3)],_0x29fbc8['lat']['min'],_0x29fbc8['lev']['min']),_0x49bea8=new Cesium$3[(_0x1f4c42(0x17d))](_0x29fbc8['lon'][_0x1f4c42(0x17b)],_0x29fbc8['lat']['max'],_0x29fbc8['lev']['max']),_0x2ca1e4=new Cesium$3['Cartesian3']((_0x49bea8['x']-_0x360bd6['x'])/(_0x1cf452['x']-0x1),(_0x49bea8['y']-_0x360bd6['y'])/(_0x1cf452['y']-0x1),_0x1cf452['z']>0x1?(_0x49bea8['z']-_0x360bd6['z'])/(_0x1cf452['z']-0x1):0x1),_0x113244=new Cesium$3['Cartesian2'](_0x29fbc8['U']['min'],_0x29fbc8['U']['max']),_0x343201=new Cesium$3['Cartesian2'](_0x29fbc8['V'][_0x1f4c42(0x1c3)],_0x29fbc8['V'][_0x1f4c42(0x17b)]),_0x5debcb=this;this[_0x1f4c42(0x1e1)]={'getWind':new CustomPrimitive({'commandType':_0x1f4c42(0x18f),'uniformMap':{'U':function(){return _0x5debcb['windTextures']['U'];},'V':function(){return _0x5debcb['windTextures']['V'];},'currentParticlesPosition':function(){return _0x5debcb['particlesTextures']['currentParticlesPosition'];},'dimension':function(){return _0x1cf452;},'minimum':function(){return _0x360bd6;},'maximum':function(){return _0x49bea8;},'interval':function(){return _0x2ca1e4;}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[getWind_frag]}),'outputTexture':this['particlesTextures']['particlesWind'],'preExecute':function(){const _0xf5ea97=_0x1f4c42;_0x5debcb[_0xf5ea97(0x1e1)]['getWind']['commandToExecute'][_0xf5ea97(0x17a)]=_0x5debcb[_0xf5ea97(0x1c9)]['particlesWind'];}}),'updateSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesSpeed':function(){const _0x12c851=_0x1f4c42;return _0x5debcb['particlesTextures'][_0x12c851(0x1a8)];},'particlesWind':function(){const _0x3db0a7=_0x1f4c42;return _0x5debcb[_0x3db0a7(0x1c9)]['particlesWind'];},'uSpeedRange':function(){return _0x113244;},'vSpeedRange':function(){return _0x343201;},'pixelSize':function(){return _0x4eb12d['pixelSize'];},'speedFactor':function(){return _0x470f96['speedFactor'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updateSpeed_frag]}),'outputTexture':this['particlesTextures'][_0x1f4c42(0x1b3)],'preExecute':function(){const _0x5b95c3=_0x1f4c42,_0x1ad33c=_0x5debcb['particlesTextures'][_0x5b95c3(0x1a8)];_0x5debcb['particlesTextures'][_0x5b95c3(0x1a8)]=_0x5debcb['particlesTextures']['postProcessingSpeed'],_0x5debcb['particlesTextures']['postProcessingSpeed']=_0x1ad33c,_0x5debcb['primitives']['updateSpeed']['commandToExecute']['outputTexture']=_0x5debcb['particlesTextures']['nextParticlesSpeed'];}}),'updatePosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesPosition':function(){return _0x5debcb['particlesTextures']['currentParticlesPosition'];},'currentParticlesSpeed':function(){return _0x5debcb['particlesTextures']['currentParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3[(_0x1f4c42(0x1d8))]({'sources':[updatePosition_frag]}),'outputTexture':this[_0x1f4c42(0x1c9)]['nextParticlesPosition'],'preExecute':function(){const _0x5c7f08=_0x1f4c42,_0x5df6bd=_0x5debcb[_0x5c7f08(0x1c9)]['currentParticlesPosition'];_0x5debcb['particlesTextures']['currentParticlesPosition']=_0x5debcb['particlesTextures']['postProcessingPosition'],_0x5debcb['particlesTextures']['postProcessingPosition']=_0x5df6bd,_0x5debcb[_0x5c7f08(0x1e1)][_0x5c7f08(0x151)]['commandToExecute']['outputTexture']=_0x5debcb[_0x5c7f08(0x1c9)][_0x5c7f08(0x119)];}}),'postProcessingPosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'nextParticlesPosition':function(){return _0x5debcb['particlesTextures']['nextParticlesPosition'];},'nextParticlesSpeed':function(){return _0x5debcb['particlesTextures']['nextParticlesSpeed'];},'lonRange':function(){const _0x1cb918=_0x1f4c42;return _0x4eb12d[_0x1cb918(0x149)];},'latRange':function(){const _0x4f5283=_0x1f4c42;return _0x4eb12d[_0x4f5283(0x161)];},'randomCoefficient':function(){const _0x3b0fe5=Math['random']();return _0x3b0fe5;},'dropRate':function(){return _0x470f96['dropRate'];},'dropRateBump':function(){const _0x1c22d7=_0x1f4c42;return _0x470f96[_0x1c22d7(0x157)];}},'fragmentShaderSource':new Cesium$3[(_0x1f4c42(0x1d8))]({'sources':[postProcessingPosition_frag]}),'outputTexture':this[_0x1f4c42(0x1c9)]['postProcessingPosition'],'preExecute':function(){const _0x1137d8=_0x1f4c42;_0x5debcb['primitives']['postProcessingPosition']['commandToExecute']['outputTexture']=_0x5debcb[_0x1137d8(0x1c9)]['postProcessingPosition'];}}),'postProcessingSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'postProcessingPosition':function(){const _0x19901a=_0x1f4c42;return _0x5debcb['particlesTextures'][_0x19901a(0x15f)];},'nextParticlesSpeed':function(){return _0x5debcb['particlesTextures']['nextParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3[(_0x1f4c42(0x1d8))]({'sources':[postProcessingSpeed_frag]}),'outputTexture':this['particlesTextures']['postProcessingSpeed'],'preExecute':function(){const _0x5def5f=_0x1f4c42;_0x5debcb['primitives']['postProcessingSpeed']['commandToExecute'][_0x5def5f(0x17a)]=_0x5debcb['particlesTextures']['postProcessingSpeed'];}})};}}const Cesium$2=mars3d__namespace[_0x56db01(0x135)];class ParticleSystem{constructor(_0x2ee24b,_0x4413a7,_0x25296b,_0x295774){const _0x29c3f7=_0x56db01;this['context']=_0x2ee24b,_0x4413a7={..._0x4413a7},_0x4413a7['udata']&&_0x4413a7['vdata']&&(_0x4413a7['dimensions']={},_0x4413a7[_0x29c3f7(0x146)]['lon']=_0x4413a7['cols'],_0x4413a7['dimensions'][_0x29c3f7(0x133)]=_0x4413a7['rows'],_0x4413a7[_0x29c3f7(0x146)]['lev']=_0x4413a7['lev']||0x1,_0x4413a7['lon']={},_0x4413a7['lon']['min']=_0x4413a7['xmin'],_0x4413a7[_0x29c3f7(0x1cd)]['max']=_0x4413a7[_0x29c3f7(0x1b7)],_0x4413a7[_0x29c3f7(0x133)]={},_0x4413a7['lat']['min']=_0x4413a7['ymin'],_0x4413a7['lat'][_0x29c3f7(0x17b)]=_0x4413a7['ymax'],_0x4413a7[_0x29c3f7(0x16d)]={},_0x4413a7['lev'][_0x29c3f7(0x1c3)]=_0x4413a7['levmin']??0x1,_0x4413a7['lev'][_0x29c3f7(0x17b)]=_0x4413a7['levmax']??0x1,_0x4413a7['U']={},_0x4413a7['U']['array']=new Float32Array(_0x4413a7['udata']),_0x4413a7['U'][_0x29c3f7(0x1c3)]=_0x4413a7[_0x29c3f7(0x13e)]??Math['min'](..._0x4413a7['udata']),_0x4413a7['U']['max']=_0x4413a7['umax']??Math['max'](..._0x4413a7['udata']),_0x4413a7['V']={},_0x4413a7['V'][_0x29c3f7(0x180)]=new Float32Array(_0x4413a7['vdata']),_0x4413a7['V']['min']=_0x4413a7['vmin']??Math[_0x29c3f7(0x1c3)](..._0x4413a7[_0x29c3f7(0x16c)]),_0x4413a7['V']['max']=_0x4413a7['vmax']??Math[_0x29c3f7(0x17b)](..._0x4413a7['vdata'])),this[_0x29c3f7(0x1b1)]=_0x4413a7,this['options']=_0x25296b,this['viewerParameters']=_0x295774,this[_0x29c3f7(0x10f)]=new ParticlesComputing(this['context'],this['data'],this['options'],this['viewerParameters']),this[_0x29c3f7(0x13b)]=new ParticlesRendering(this[_0x29c3f7(0x15d)],this[_0x29c3f7(0x1b1)],this[_0x29c3f7(0x159)],this['viewerParameters'],this['particlesComputing']);}['canvasResize'](_0x4bbf3b){const _0x3a9e19=_0x56db01;this['particlesComputing'][_0x3a9e19(0x16e)](),Object['keys'](this[_0x3a9e19(0x10f)][_0x3a9e19(0x16f)])['forEach'](_0x365f2b=>{this['particlesComputing']['windTextures'][_0x365f2b]['destroy']();}),this['particlesRendering']['textures'][_0x3a9e19(0x1ac)][_0x3a9e19(0x1e2)](),Object['keys'](this['particlesRendering']['framebuffers'])[_0x3a9e19(0x1cf)](_0x8b06d5=>{this['particlesRendering']['framebuffers'][_0x8b06d5]['destroy']();}),this[_0x3a9e19(0x15d)]=_0x4bbf3b,this['particlesComputing']=new ParticlesComputing(this[_0x3a9e19(0x15d)],this['data'],this[_0x3a9e19(0x159)],this['viewerParameters']),this['particlesRendering']=new ParticlesRendering(this[_0x3a9e19(0x15d)],this[_0x3a9e19(0x1b1)],this[_0x3a9e19(0x159)],this['viewerParameters'],this[_0x3a9e19(0x10f)]);}['clearFramebuffers'](){const _0x453125=_0x56db01,_0x3dc068=new Cesium$2[(_0x453125(0x1c0))]({'color':new Cesium$2[(_0x453125(0x186))](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':undefined,'pass':Cesium$2['Pass'][_0x453125(0x187)]});Object['keys'](this['particlesRendering'][_0x453125(0x15b)])[_0x453125(0x1cf)](_0x52f6c8=>{const _0x517ed4=_0x453125;_0x3dc068['framebuffer']=this['particlesRendering']['framebuffers'][_0x52f6c8],_0x3dc068[_0x517ed4(0x1c2)](this[_0x517ed4(0x15d)]);});}['refreshParticles'](_0x3318b3){const _0x36812c=_0x56db01;this['clearFramebuffers'](),this['particlesComputing']['destroyParticlesTextures'](),this[_0x36812c(0x10f)][_0x36812c(0x1bb)](this['context'],this['options'],this['viewerParameters']);if(_0x3318b3){var _0xef9b11,_0x11fd53;const _0x58874d=this['particlesRendering']['createSegmentsGeometry'](this[_0x36812c(0x159)]);this['particlesRendering']['primitives']['segments']['geometry']=_0x58874d;const _0x1a9e4c=Cesium$2[_0x36812c(0x120)]['fromGeometry']({'context':this[_0x36812c(0x15d)],'geometry':_0x58874d,'attributeLocations':this['particlesRendering'][_0x36812c(0x1e1)][_0x36812c(0x167)]['attributeLocations'],'bufferUsage':Cesium$2['BufferUsage']['STATIC_DRAW']});(_0xef9b11=this['particlesRendering'][_0x36812c(0x1e1)])!==null&&_0xef9b11!==void 0x0&&(_0x11fd53=_0xef9b11['segments'])!==null&&_0x11fd53!==void 0x0&&_0x11fd53['commandToExecute']&&(this['particlesRendering'][_0x36812c(0x1e1)][_0x36812c(0x167)][_0x36812c(0x1f7)]['vertexArray']=_0x1a9e4c);}}['setOptions'](_0x317c62){const _0x512eb8=_0x56db01;let _0x568627=![];this['options']['maxParticles']!==_0x317c62['maxParticles']&&(_0x568627=!![]),Object[_0x512eb8(0x1f6)](_0x317c62)['forEach'](_0x40d919=>{this['options'][_0x40d919]=_0x317c62[_0x40d919];}),this['refreshParticles'](_0x568627);}['applyViewerParameters'](_0x3e7ace){Object['keys'](_0x3e7ace)['forEach'](_0x2130a6=>{this['viewerParameters'][_0x2130a6]=_0x3e7ace[_0x2130a6];}),this['refreshParticles'](![]);}['destroy'](){const _0x1ad086=_0x56db01;clearTimeout(this['canrefresh']),this['particlesComputing'][_0x1ad086(0x16e)](),Object['keys'](this['particlesComputing'][_0x1ad086(0x16f)])[_0x1ad086(0x1cf)](_0x290997=>{const _0x4bf901=_0x1ad086;this['particlesComputing']['windTextures'][_0x290997][_0x4bf901(0x1e2)]();}),this['particlesRendering']['textures']['colorTable']['destroy'](),Object['keys'](this['particlesRendering'][_0x1ad086(0x15b)])['forEach'](_0x20be90=>{this['particlesRendering']['framebuffers'][_0x20be90]['destroy']();});for(const _0x1a0931 in this){delete this[_0x1a0931];}}}const Cesium$1=mars3d__namespace['Cesium'],BaseLayer$1=mars3d__namespace['layer'][_0x56db01(0x130)],DEF_OPTIONS={'particlesNumber':0x1000,'fixedHeight':0x0,'fadeOpacity':0.996,'dropRate':0.003,'dropRateBump':0.01,'speedFactor':0.5,'lineWidth':0x2,'colors':['rgb(206,255,255)']};class WindLayer extends BaseLayer$1{constructor(_0x408b75={}){const _0x4a4511=_0x56db01;_0x408b75={...DEF_OPTIONS,..._0x408b75},super(_0x408b75),this[_0x4a4511(0x1f1)](_0x408b75);}get[_0x56db01(0x1f9)](){return this['primitives'];}get[_0x56db01(0x1b1)](){return this['_data'];}set['data'](_0x23da87){this['setData'](_0x23da87);}get['colors'](){return this['options']['colors'];}set[_0x56db01(0x15a)](_0x24678a){const _0x5d00e2=_0x56db01;this['options'][_0x5d00e2(0x15a)]=_0x24678a,this['particleSystem']&&this['particleSystem']['setOptions']({'colors':_0x24678a}),this['resize']();}['_mountedHook'](){}['_addedHook'](){const _0x9e0566=_0x56db01;this['scene']=this[_0x9e0566(0x129)][_0x9e0566(0x1ec)],this['camera']=this['_map']['camera'],this[_0x9e0566(0x1e1)]=new Cesium$1[(_0x9e0566(0x1ef))](),this[_0x9e0566(0x129)][_0x9e0566(0x1ec)][_0x9e0566(0x1e1)][_0x9e0566(0x188)](this['primitives']),this['viewerParameters']={'lonRange':new Cesium$1['Cartesian2'](),'latRange':new Cesium$1['Cartesian2'](),'pixelSize':0x0},this[_0x9e0566(0x12b)]=new Cesium$1['BoundingSphere'](Cesium$1['Cartesian3'][_0x9e0566(0x122)],0.99*0x615299),this['updateViewerParameters'](),window['addEventListener'](_0x9e0566(0x140),this['resize']['bind'](this),![]),this['mouse_down']=![],this['mouse_move']=![],this['_map']['on'](mars3d__namespace['EventType'][_0x9e0566(0x170)],this['_onMapWhellEvent'],this),this['_map']['on'](mars3d__namespace['EventType'][_0x9e0566(0x13a)],this[_0x9e0566(0x175)],this),this['_map']['on'](mars3d__namespace['EventType'][_0x9e0566(0x134)],this[_0x9e0566(0x1cc)],this),this['_map']['on'](mars3d__namespace['EventType']['mouseMove'],this[_0x9e0566(0x168)],this),this['_data']&&this['setData'](this['_data']);}[_0x56db01(0x10d)](){const _0x1387e9=_0x56db01;window['removeEventListener']('resize',this['resize']),this[_0x1387e9(0x129)]['off'](mars3d__namespace['EventType']['preRender'],this['_onMap_preRenderEvent'],this),this['_map'][_0x1387e9(0x1d5)](mars3d__namespace[_0x1387e9(0x1c7)]['wheel'],this['_onMapWhellEvent'],this),this['_map']['off'](mars3d__namespace['EventType'][_0x1387e9(0x13a)],this[_0x1387e9(0x175)],this),this['_map'][_0x1387e9(0x1d5)](mars3d__namespace['EventType']['mouseUp'],this[_0x1387e9(0x1cc)],this),this['_map']['off'](mars3d__namespace['EventType'][_0x1387e9(0x15e)],this[_0x1387e9(0x168)],this),this[_0x1387e9(0x1e1)][_0x1387e9(0x190)](),this['_map']['scene']['primitives']['remove'](this['primitives']);}[_0x56db01(0x140)](){const _0x32d7c3=_0x56db01;if(!this['show']||!this['particleSystem'])return;this['primitives'][_0x32d7c3(0x184)]=![],this['primitives']['removeAll'](),this['_map'][_0x32d7c3(0x1c4)](mars3d__namespace['EventType']['preRender'],this['_onMap_preRenderEvent'],this);}['_onMap_preRenderEvent'](_0x435864){const _0xa5394=_0x56db01;this['particleSystem']['canvasResize'](this['scene']['context']),this[_0xa5394(0x14d)](),this[_0xa5394(0x1e1)]['show']=!![];}['_onMapWhellEvent'](_0x10a327){clearTimeout(this['refreshTimer']);if(!this['show']||!this['particleSystem'])return;this['primitives']['show']=![],this['refreshTimer']=setTimeout(()=>{if(!this['show'])return;this['redraw']();},0xc8);}['_onMouseDownEvent'](_0x3e6b39){this['mouse_down']=!![];}['_onMouseMoveEvent'](_0x1b8acb){const _0x8477ab=_0x56db01;if(!this['show']||!this[_0x8477ab(0x1a7)])return;this['mouse_down']&&(this['primitives'][_0x8477ab(0x184)]=![],this[_0x8477ab(0x17c)]=!![]);}['_onMouseUpEvent'](_0x4cea57){const _0x2c7490=_0x56db01;if(!this['show']||!this[_0x2c7490(0x1a7)])return;this['mouse_down']&&this[_0x2c7490(0x17c)]&&this[_0x2c7490(0x1f5)](),this['primitives']['show']=!![],this['mouse_down']=![],this['mouse_move']=![];}['redraw'](){const _0x1052db=_0x56db01;if(!this['_map']||!this['show'])return;this[_0x1052db(0x1a2)](),this['particleSystem'][_0x1052db(0x1d6)](this[_0x1052db(0x19c)]),this['primitives']['show']=!![];}[_0x56db01(0x181)](_0x5f12dc){const _0x2a0236=_0x56db01;this['_data']=_0x5f12dc,this['particleSystem']&&this[_0x2a0236(0x1a7)]['destroy'](),this[_0x2a0236(0x1a7)]=new ParticleSystem(this['scene']['context'],_0x5f12dc,this[_0x2a0236(0x1ae)](),this[_0x2a0236(0x19c)]),this['addPrimitives']();}['_setOptionsHook'](_0x3f787d,_0x4a359b){const _0x1c3469=_0x56db01;if(_0x3f787d)for(const _0x167f74 in _0x3f787d){this[_0x167f74]=_0x3f787d[_0x167f74];}this[_0x1c3469(0x1a7)]&&this['particleSystem']['setOptions'](this[_0x1c3469(0x1ae)]());}['getOptions'](){const _0x53a29c=_0x56db01,_0x456250=Math['ceil'](Math['sqrt'](this['particlesNumber']));return this['particlesNumber']=_0x456250*_0x456250,{'particlesTextureSize':_0x456250,'maxParticles':this['particlesNumber'],'particleHeight':this['fixedHeight'],'fadeOpacity':this[_0x53a29c(0x114)],'dropRate':this['dropRate'],'dropRateBump':this[_0x53a29c(0x157)],'speedFactor':this[_0x53a29c(0x150)],'lineWidth':this['lineWidth'],'colors':this['colors']};}[_0x56db01(0x14d)](){const _0x140480=_0x56db01;this['primitives']['add'](this[_0x140480(0x1a7)][_0x140480(0x10f)][_0x140480(0x1e1)]['getWind']),this['primitives']['add'](this[_0x140480(0x1a7)]['particlesComputing'][_0x140480(0x1e1)][_0x140480(0x169)]),this[_0x140480(0x1e1)]['add'](this['particleSystem'][_0x140480(0x10f)][_0x140480(0x1e1)]['updatePosition']),this['primitives']['add'](this['particleSystem'][_0x140480(0x10f)]['primitives'][_0x140480(0x15f)]),this['primitives']['add'](this['particleSystem']['particlesComputing']['primitives']['postProcessingSpeed']),this['primitives']['add'](this['particleSystem']['particlesRendering']['primitives']['segments']),this[_0x140480(0x1e1)]['add'](this[_0x140480(0x1a7)]['particlesRendering']['primitives'][_0x140480(0x1ce)]),this['primitives']['add'](this['particleSystem']['particlesRendering']['primitives']['screen']);}['updateViewerParameters'](){const _0x942677=_0x56db01;let _0x5501d0=this['camera']['computeViewRectangle'](this['scene'][_0x942677(0x193)]['ellipsoid']);if(!_0x5501d0){const _0x1c3cbd=this['_map']['getExtent']();_0x5501d0=Cesium$1[_0x942677(0x1d0)]['fromDegrees'](_0x1c3cbd['xmin'],_0x1c3cbd[_0x942677(0x183)],_0x1c3cbd[_0x942677(0x1b7)],_0x1c3cbd[_0x942677(0x11b)]);}const _0x57cc61=Util['viewRectangleToLonLatRange'](_0x5501d0);this['viewerParameters']['lonRange']['x']=_0x57cc61['lon']['min'],this['viewerParameters']['lonRange']['y']=_0x57cc61['lon']['max'],this[_0x942677(0x19c)]['latRange']['x']=_0x57cc61['lat']['min'],this[_0x942677(0x19c)][_0x942677(0x161)]['y']=_0x57cc61['lat']['max'];const _0x268c9f=this[_0x942677(0x126)][_0x942677(0x10b)](this[_0x942677(0x12b)],this[_0x942677(0x1ec)]['drawingBufferWidth'],this['scene'][_0x942677(0x178)]);_0x268c9f>0x0&&(this[_0x942677(0x19c)]['pixelSize']=_0x268c9f);}}mars3d__namespace['LayerUtil']['register'](_0x56db01(0x1ed),WindLayer),mars3d__namespace['layer']['WindLayer']=WindLayer;class CanvasParticle{constructor(){const _0x52d9d9=_0x56db01;this['lng']=null,this[_0x52d9d9(0x133)]=null,this['tlng']=null,this['tlat']=null,this[_0x52d9d9(0x16b)]=null,this['speed']=null;}['destroy'](){for(const _0x50fb6c in this){delete this[_0x50fb6c];}}}class CanvasWindField{constructor(_0x4fdc10){this['setOptions'](_0x4fdc10);}get['speedRate'](){return this['_speedRate'];}set['speedRate'](_0x34a0f9){this['_speedRate']=(0x64-(_0x34a0f9>0x63?0x63:_0x34a0f9))*0x64,this['_calc_speedRate']=[(this['xmax']-this['xmin'])/this['_speedRate'],(this['ymax']-this['ymin'])/this['_speedRate']];}get[_0x56db01(0x1d2)](){return this['_maxAge'];}set[_0x56db01(0x1d2)](_0x119cfd){this['_maxAge']=_0x119cfd;}['setOptions'](_0x58f69b){const _0x2340ab=_0x56db01;this['options']=_0x58f69b,this['maxAge']=_0x58f69b['maxAge']||0x78,this['speedRate']=_0x58f69b[_0x2340ab(0x12c)]||0x32,this['particles']=[];const _0x4149b9=_0x58f69b[_0x2340ab(0x10a)]||0x1000;for(let _0x484085=0x0;_0x484085<_0x4149b9;_0x484085++){const _0x5bdbb7=this['_randomParticle'](new CanvasParticle());this['particles']['push'](_0x5bdbb7);}}['setDate'](_0x1d85b2){const _0x3d5790=_0x56db01;this[_0x3d5790(0x116)]=_0x1d85b2['rows'],this['cols']=_0x1d85b2['cols'],this['xmin']=_0x1d85b2[_0x3d5790(0x117)],this[_0x3d5790(0x1b7)]=_0x1d85b2['xmax'],this[_0x3d5790(0x183)]=_0x1d85b2[_0x3d5790(0x183)],this['ymax']=_0x1d85b2[_0x3d5790(0x11b)],this['grid']=[];const _0x480346=_0x1d85b2['udata'],_0x375f74=_0x1d85b2[_0x3d5790(0x16c)];let _0x3f38c5=![];_0x480346[_0x3d5790(0x1f4)]===this['rows']&&_0x480346[0x0]['length']===this[_0x3d5790(0x197)]&&(_0x3f38c5=!![]);let _0x19347c=0x0,_0x4362f1=null,_0x4f6889=null;for(let _0x535896=0x0;_0x535896<this['rows'];_0x535896++){_0x4362f1=[];for(let _0x446ab8=0x0;_0x446ab8<this['cols'];_0x446ab8++,_0x19347c++){_0x3f38c5?_0x4f6889=this[_0x3d5790(0x1a0)](_0x480346[_0x535896][_0x446ab8],_0x375f74[_0x535896][_0x446ab8]):_0x4f6889=this[_0x3d5790(0x1a0)](_0x480346[_0x19347c],_0x375f74[_0x19347c]),_0x4362f1['push'](_0x4f6889);}this['grid'][_0x3d5790(0x160)](_0x4362f1);}this[_0x3d5790(0x159)][_0x3d5790(0x195)]&&this['grid']['reverse']();}['clear'](){const _0x21f1b4=_0x56db01;delete this[_0x21f1b4(0x116)],delete this[_0x21f1b4(0x197)],delete this['xmin'],delete this[_0x21f1b4(0x1b7)],delete this['ymin'],delete this['ymax'],delete this['grid'],delete this[_0x21f1b4(0x185)];}['toGridXY'](_0x3ad68a,_0x41da4b){const _0x3733df=_0x56db01,_0x4dcffc=(_0x3ad68a-this[_0x3733df(0x117)])/(this['xmax']-this['xmin'])*(this['cols']-0x1),_0xb855fe=(this['ymax']-_0x41da4b)/(this['ymax']-this[_0x3733df(0x183)])*(this['rows']-0x1);return[_0x4dcffc,_0xb855fe];}['getUVByXY'](_0x32903f,_0x177b70){const _0xa32e62=_0x56db01;if(_0x32903f<0x0||_0x32903f>=this[_0xa32e62(0x197)]||_0x177b70>=this['rows'])return[0x0,0x0,0x0];const _0x1e9960=Math['floor'](_0x32903f),_0x1db7ac=Math[_0xa32e62(0x19b)](_0x177b70);if(_0x1e9960===_0x32903f&&_0x1db7ac===_0x177b70)return this[_0xa32e62(0x1ad)][_0x177b70][_0x32903f];const _0x1931a2=_0x1e9960+0x1,_0x4d9059=_0x1db7ac+0x1,_0x33c5db=this['getUVByXY'](_0x1e9960,_0x1db7ac),_0x31844d=this[_0xa32e62(0x1a6)](_0x1931a2,_0x1db7ac),_0x3fa0bc=this['getUVByXY'](_0x1e9960,_0x4d9059),_0x57f0c4=this['getUVByXY'](_0x1931a2,_0x4d9059);let _0x289ecd=null;try{_0x289ecd=this['_bilinearInterpolation'](_0x32903f-_0x1e9960,_0x177b70-_0x1db7ac,_0x33c5db,_0x31844d,_0x3fa0bc,_0x57f0c4);}catch(_0x13e5aa){console[_0xa32e62(0x1a4)](_0x32903f,_0x177b70);}return _0x289ecd;}['_bilinearInterpolation'](_0x21736c,_0x4eee85,_0x32157f,_0xe67668,_0x29d0f1,_0x3c470f){const _0x205f28=0x1-_0x21736c,_0x4f27fd=0x1-_0x4eee85,_0x3aaeb3=_0x205f28*_0x4f27fd,_0x13ddfb=_0x21736c*_0x4f27fd,_0x5ee8b7=_0x205f28*_0x4eee85,_0x57c023=_0x21736c*_0x4eee85,_0x184629=_0x32157f[0x0]*_0x3aaeb3+_0xe67668[0x0]*_0x13ddfb+_0x29d0f1[0x0]*_0x5ee8b7+_0x3c470f[0x0]*_0x57c023,_0x41e3e2=_0x32157f[0x1]*_0x3aaeb3+_0xe67668[0x1]*_0x13ddfb+_0x29d0f1[0x1]*_0x5ee8b7+_0x3c470f[0x1]*_0x57c023;return this['_calcUV'](_0x184629,_0x41e3e2);}['_calcUV'](_0x958451,_0x3b2ae1){const _0x1c0a99=_0x56db01;return[+_0x958451,+_0x3b2ae1,Math[_0x1c0a99(0x124)](_0x958451*_0x958451+_0x3b2ae1*_0x3b2ae1)];}['getUVByPoint'](_0x1a3887,_0x3d7e2a){const _0x15ff1d=_0x56db01;if(!this['isInExtent'](_0x1a3887,_0x3d7e2a))return null;const _0x3e0f6e=this[_0x15ff1d(0x1f0)](_0x1a3887,_0x3d7e2a),_0x39c247=this['getUVByXY'](_0x3e0f6e[0x0],_0x3e0f6e[0x1]);return _0x39c247;}['isInExtent'](_0x33c284,_0x3fa39d){const _0x232d5c=_0x56db01;return _0x33c284>=this['xmin']&&_0x33c284<=this['xmax']&&_0x3fa39d>=this['ymin']&&_0x3fa39d<=this[_0x232d5c(0x11b)]?!![]:![];}['getRandomLatLng'](){const _0xa5e8=fRandomByfloat(this['xmin'],this['xmax']),_0x11be34=fRandomByfloat(this['ymin'],this['ymax']);return{'lat':_0x11be34,'lng':_0xa5e8};}['getParticles'](){const _0x53f2ed=_0x56db01;let _0x4dd96d,_0x4d0c5b,_0x583eb1;for(let _0x1cc9ef=0x0,_0x27f1cd=this['particles']['length'];_0x1cc9ef<_0x27f1cd;_0x1cc9ef++){let _0x4287a4=this['particles'][_0x1cc9ef];_0x4287a4[_0x53f2ed(0x16b)]<=0x0&&(_0x4287a4=this['_randomParticle'](_0x4287a4));if(_0x4287a4['age']>0x0){const _0x1f3c9f=_0x4287a4[_0x53f2ed(0x1b6)],_0x2e6d64=_0x4287a4['tlat'];_0x583eb1=this['getUVByPoint'](_0x1f3c9f,_0x2e6d64),_0x583eb1?(_0x4dd96d=_0x1f3c9f+this[_0x53f2ed(0x1eb)][0x0]*_0x583eb1[0x0],_0x4d0c5b=_0x2e6d64+this['_calc_speedRate'][0x1]*_0x583eb1[0x1],_0x4287a4[_0x53f2ed(0x165)]=_0x1f3c9f,_0x4287a4['lat']=_0x2e6d64,_0x4287a4['tlng']=_0x4dd96d,_0x4287a4['tlat']=_0x4d0c5b,_0x4287a4['speed']=_0x583eb1[0x2],_0x4287a4['age']--):_0x4287a4['age']=0x0;}}return this[_0x53f2ed(0x185)];}['_randomParticle'](_0x1c553a){const _0x453e6b=_0x56db01;let _0x385cc4,_0x2ab6fc;for(let _0x41ffac=0x0;_0x41ffac<0x1e;_0x41ffac++){_0x385cc4=this['getRandomLatLng'](),_0x2ab6fc=this['getUVByPoint'](_0x385cc4[_0x453e6b(0x165)],_0x385cc4['lat']);if(_0x2ab6fc&&_0x2ab6fc[0x2]>0x0)break;}if(!_0x2ab6fc)return _0x1c553a;const _0x2695f2=_0x385cc4['lng']+this['_calc_speedRate'][0x0]*_0x2ab6fc[0x0],_0x56b601=_0x385cc4['lat']+this[_0x453e6b(0x1eb)][0x1]*_0x2ab6fc[0x1];return _0x1c553a[_0x453e6b(0x165)]=_0x385cc4['lng'],_0x1c553a[_0x453e6b(0x133)]=_0x385cc4['lat'],_0x1c553a['tlng']=_0x2695f2,_0x1c553a[_0x453e6b(0x1dc)]=_0x56b601,_0x1c553a['age']=Math['round'](Math['random']()*this['maxAge']),_0x1c553a['speed']=_0x2ab6fc[0x2],_0x1c553a;}['destroy'](){for(const _0x14edf4 in this){delete this[_0x14edf4];}}}function fRandomByfloat(_0x5c8037,_0x411a71){return _0x5c8037+Math['random']()*(_0x411a71-_0x5c8037);}const Cesium=mars3d__namespace[_0x56db01(0x135)],BaseLayer=mars3d__namespace[_0x56db01(0x1f9)]['BaseLayer'];class CanvasWindLayer extends BaseLayer{constructor(_0x32beca={}){const _0x2348a0=_0x56db01;super(_0x32beca),this[_0x2348a0(0x1f1)](_0x32beca),this[_0x2348a0(0x125)]=null,_0x32beca[_0x2348a0(0x15a)]&&_0x32beca['steps']&&(this['_colorRamp']=new mars3d__namespace[(_0x2348a0(0x194))](_0x32beca));}[_0x56db01(0x1f1)](_0x8d6923,_0x1d38da){const _0x21c3ab=_0x56db01;this[_0x21c3ab(0x1ea)]=0x3e8/(_0x8d6923[_0x21c3ab(0x1f8)]||0xa),this[_0x21c3ab(0x1e7)]=this[_0x21c3ab(0x159)]['pointerEvents']??![],this['color']=_0x8d6923['color']||_0x21c3ab(0x118),this['lineWidth']=_0x8d6923[_0x21c3ab(0x18e)]||0x1,this[_0x21c3ab(0x1e9)]=_0x8d6923['fixedHeight']??0x0,this['reverseY']=_0x8d6923[_0x21c3ab(0x195)]??![],this['windField']&&this['windField']['setOptions'](_0x8d6923);}get['layer'](){return this['canvas'];}get['canvasWidth'](){const _0x3c929f=_0x56db01;return this['_map']['scene']['canvas'][_0x3c929f(0x11a)];}get['canvasHeight'](){const _0x1040c2=_0x56db01;return this['_map']['scene'][_0x1040c2(0x125)]['clientHeight'];}get['pointerEvents'](){return this['_pointerEvents'];}set['pointerEvents'](_0x39f8ac){const _0x1f9c78=_0x56db01;this['_pointerEvents']=_0x39f8ac;if(!this['canvas'])return;_0x39f8ac?this['canvas']['style']['pointer-events']='all':this['canvas'][_0x1f9c78(0x174)][_0x1f9c78(0x1d7)]=_0x1f9c78(0x1d4);}get['particlesNumber'](){const _0x2f301e=_0x56db01;return this[_0x2f301e(0x159)]['particlesNumber'];}set[_0x56db01(0x10a)](_0x446a66){this['options']['particlesNumber']=_0x446a66,clearTimeout(this['_canrefresh']),this['_canrefresh']=setTimeout(()=>{this['redraw']();},0x1f4);}get['speedRate'](){return this['options']['speedRate'];}set['speedRate'](_0x4612b3){this['options']['speedRate']=_0x4612b3,this['windField']&&(this['windField']['speedRate']=_0x4612b3);}get[_0x56db01(0x1d2)](){return this['options']['maxAge'];}set['maxAge'](_0x37ba82){const _0x2b2633=_0x56db01;this[_0x2b2633(0x159)]['maxAge']=_0x37ba82,this['windField']&&(this['windField']['maxAge']=_0x37ba82);}get['data'](){return this['windData'];}set[_0x56db01(0x1b1)](_0xa102b7){this['setData'](_0xa102b7);}[_0x56db01(0x17e)](_0x3ae8b2){const _0x548ca1=_0x56db01;_0x3ae8b2?this['_addedHook']():(this[_0x548ca1(0x199)]&&(this['options']['data']=this['windData']),this['_removedHook']());}['_mountedHook'](){this['options']['worker']?this['initWorker']():this['windField']=new CanvasWindField(this['options']);}['_addedHook'](){const _0x17ea28=_0x56db01;this[_0x17ea28(0x125)]=this['_createCanvas'](),this['canvasContext']=this['canvas']['getContext']('2d',{'willReadFrequently':!![]}),this[_0x17ea28(0x1e4)](),this['options']['data']&&this['setData'](this['options'][_0x17ea28(0x1b1)]);}['_removedHook'](){this['clear'](),this['unbindEvent'](),this['canvas']&&(this['_map']['container']['removeChild'](this['canvas']),delete this['canvas']);}['_createCanvas'](){const _0x3af8b3=_0x56db01,_0x58540b=mars3d__namespace[_0x3af8b3(0x14f)]['create'](_0x3af8b3(0x125),_0x3af8b3(0x18b),this[_0x3af8b3(0x129)][_0x3af8b3(0x110)]);return _0x58540b[_0x3af8b3(0x174)][_0x3af8b3(0x189)]='absolute',_0x58540b['style']['top']='0px',_0x58540b['style'][_0x3af8b3(0x1ca)]=_0x3af8b3(0x1af),_0x58540b['style'][_0x3af8b3(0x1a3)]=this['_map'][_0x3af8b3(0x1ec)][_0x3af8b3(0x125)]['clientWidth']+'px',_0x58540b['style'][_0x3af8b3(0x1e5)]=this['_map']['scene'][_0x3af8b3(0x125)]['clientHeight']+'px',_0x58540b['style']['pointerEvents']=this['_pointerEvents']?'auto':'none',_0x58540b['style']['zIndex']=this['options']['zIndex']??0x9,_0x58540b['width']=this['_map']['scene']['canvas'][_0x3af8b3(0x11a)],_0x58540b['height']=this[_0x3af8b3(0x129)]['scene']['canvas']['clientHeight'],_0x58540b;}['resize'](){const _0x5267e5=_0x56db01;this['canvas']&&(this['canvas'][_0x5267e5(0x174)]['width']=this[_0x5267e5(0x129)]['scene'][_0x5267e5(0x125)][_0x5267e5(0x11a)]+'px',this['canvas']['style']['height']=this['_map']['scene']['canvas'][_0x5267e5(0x158)]+'px',this['canvas']['width']=this['_map'][_0x5267e5(0x1ec)]['canvas']['clientWidth'],this['canvas']['height']=this['_map']['scene']['canvas'][_0x5267e5(0x158)]);}['bindEvent'](){const _0x203700=_0x56db01,_0x218d74=this;let _0x9c20bc=Date[_0x203700(0x162)]();(function _0x4b7e75(){const _0x38a02d=_0x203700;_0x218d74[_0x38a02d(0x1a1)]=window[_0x38a02d(0x147)](_0x4b7e75);if(_0x218d74['show']&&_0x218d74['windField']){const _0x52f8f4=Date[_0x38a02d(0x162)](),_0x3be0c3=_0x52f8f4-_0x9c20bc;_0x3be0c3>_0x218d74['frameTime']&&(_0x9c20bc=_0x52f8f4-_0x3be0c3%_0x218d74[_0x38a02d(0x1ea)],_0x218d74['update']());}}(),window['addEventListener']('resize',this['resize']['bind'](this),![]),this['mouse_down']=![],this[_0x203700(0x17c)]=![],this['options']['mouseHidden']&&(this[_0x203700(0x129)]['on'](mars3d__namespace['EventType'][_0x203700(0x170)],this['_onMapWhellEvent'],this),this[_0x203700(0x129)]['on'](mars3d__namespace[_0x203700(0x1c7)]['mouseDown'],this['_onMouseDownEvent'],this),this[_0x203700(0x129)]['on'](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this)));}['unbindEvent'](){const _0xed95f2=_0x56db01;window['cancelAnimationFrame'](this[_0xed95f2(0x1a1)]),delete this['animateFrame'],window[_0xed95f2(0x1c1)](_0xed95f2(0x140),this['resize']),this[_0xed95f2(0x159)][_0xed95f2(0x12a)]&&(this['_map'][_0xed95f2(0x1d5)](mars3d__namespace[_0xed95f2(0x1c7)]['wheel'],this[_0xed95f2(0x1b2)],this),this['_map']['off'](mars3d__namespace[_0xed95f2(0x1c7)]['mouseDown'],this[_0xed95f2(0x175)],this),this[_0xed95f2(0x129)][_0xed95f2(0x1d5)](mars3d__namespace['EventType'][_0xed95f2(0x134)],this['_onMouseUpEvent'],this),this['_map']['off'](mars3d__namespace['EventType']['mouseMove'],this[_0xed95f2(0x168)],this));}['_onMapWhellEvent'](_0x3901ae){const _0x3d9803=_0x56db01;clearTimeout(this['refreshTimer']);if(!this['show']||!this['canvas'])return;this['canvas']['style'][_0x3d9803(0x12e)]=_0x3d9803(0x1df),this['refreshTimer']=setTimeout(()=>{const _0x23c885=_0x3d9803;if(!this[_0x23c885(0x184)])return;this[_0x23c885(0x1f5)](),this['canvas']['style']['visibility']='visible';},0xc8);}['_onMouseDownEvent'](_0x761949){const _0x329ee6=_0x56db01;this['mouse_down']=!![],this['_map']['off'](mars3d__namespace['EventType']['mouseMove'],this[_0x329ee6(0x168)],this),this['_map']['on'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this);}['_onMouseMoveEvent'](_0x5998f4){const _0x50c204=_0x56db01;if(!this[_0x50c204(0x184)]||!this[_0x50c204(0x125)])return;this['mouse_down']&&(this['canvas']['style']['visibility']='hidden',this['mouse_move']=!![]);}[_0x56db01(0x1cc)](_0x33faf1){const _0x11881a=_0x56db01;if(!this[_0x11881a(0x184)]||!this['canvas'])return;this[_0x11881a(0x129)]['off'](mars3d__namespace['EventType'][_0x11881a(0x15e)],this['_onMouseMoveEvent'],this),this['mouse_down']&&this['mouse_move']&&this['redraw'](),this['canvas'][_0x11881a(0x174)]['visibility']='visible',this['mouse_down']=![],this['mouse_move']=![];}[_0x56db01(0x181)](_0x454993){const _0x50f0be=_0x56db01;this['clear'](),this['windData']=_0x454993,this['windField'][_0x50f0be(0x115)](_0x454993),this['redraw']();}[_0x56db01(0x1f5)](){const _0x877bce=_0x56db01;if(!this[_0x877bce(0x184)])return;this['windField'][_0x877bce(0x18c)](this[_0x877bce(0x159)]),this['update']();}[_0x56db01(0x11f)](){const _0xcb0a21=_0x56db01;if(this[_0xcb0a21(0x172)])return;this[_0xcb0a21(0x172)]=!![];if(this['worker'])this['windField']['update']();else{const _0x4e1681=this[_0xcb0a21(0x143)]['getParticles']();this['_drawLines'](_0x4e1681);}this['_updateIng']=![];}['_drawLines'](_0x221195){const _0x15f467=_0x56db01;this['canvasContext'][_0x15f467(0x1f3)]='destination-in',this['canvasContext'][_0x15f467(0x136)](0x0,0x0,this['canvasWidth'],this[_0x15f467(0x11d)]),this['canvasContext']['globalCompositeOperation']=_0x15f467(0x139),this['canvasContext']['globalAlpha']=0.9;const _0x59d95d=this[_0x15f467(0x129)]['scene']['mode']!==Cesium[_0x15f467(0x1bf)][_0x15f467(0x11e)],_0x3edee4=this['canvasWidth']*0.25;if(this[_0x15f467(0x1d9)])for(let _0x1026eb=0x0,_0xcb3a4d=_0x221195['length'];_0x1026eb<_0xcb3a4d;_0x1026eb++){const _0x3b9e96=_0x221195[_0x1026eb],_0x3bc0a7=this['_tomap'](_0x3b9e96['lng'],_0x3b9e96[_0x15f467(0x133)],_0x3b9e96),_0x3fb8f8=this['_tomap'](_0x3b9e96[_0x15f467(0x1b6)],_0x3b9e96['tlat'],_0x3b9e96);if(!_0x3bc0a7||!_0x3fb8f8)continue;if(_0x59d95d&&Math['abs'](_0x3bc0a7[0x0]-_0x3fb8f8[0x0])>=_0x3edee4)continue;this[_0x15f467(0x156)]['beginPath'](),this['canvasContext']['lineWidth']=this[_0x15f467(0x18e)],this['canvasContext']['strokeStyle']=this['_colorRamp']['getColor'](_0x3b9e96['speed']),this['canvasContext']['moveTo'](_0x3bc0a7[0x0],_0x3bc0a7[0x1]),this[_0x15f467(0x156)][_0x15f467(0x127)](_0x3fb8f8[0x0],_0x3fb8f8[0x1]),this[_0x15f467(0x156)]['stroke']();}else{this['canvasContext'][_0x15f467(0x152)](),this['canvasContext']['lineWidth']=this['lineWidth'],this['canvasContext']['strokeStyle']=this[_0x15f467(0x1c6)];for(let _0x5c4ab3=0x0,_0x10191f=_0x221195['length'];_0x5c4ab3<_0x10191f;_0x5c4ab3++){const _0xf9e327=_0x221195[_0x5c4ab3],_0x7b159e=this['_tomap'](_0xf9e327['lng'],_0xf9e327['lat'],_0xf9e327),_0x4634e8=this['_tomap'](_0xf9e327['tlng'],_0xf9e327['tlat'],_0xf9e327);if(!_0x7b159e||!_0x4634e8)continue;if(_0x59d95d&&Math[_0x15f467(0x141)](_0x7b159e[0x0]-_0x4634e8[0x0])>=_0x3edee4)continue;this['canvasContext'][_0x15f467(0x18d)](_0x7b159e[0x0],_0x7b159e[0x1]),this['canvasContext']['lineTo'](_0x4634e8[0x0],_0x4634e8[0x1]);}this['canvasContext']['stroke']();}}['_tomap'](_0x25adee,_0x5c4ea6,_0x43b858){const _0x96dc66=_0x56db01,_0x154716=Cesium['Cartesian3'][_0x96dc66(0x14b)](_0x25adee,_0x5c4ea6,this['fixedHeight']),_0x423255=this['_map']['scene'];if(_0x423255[_0x96dc66(0x1bd)]===Cesium[_0x96dc66(0x1bf)]['SCENE3D']){const _0x732491=new Cesium['EllipsoidalOccluder'](_0x423255[_0x96dc66(0x193)]['ellipsoid'],_0x423255[_0x96dc66(0x126)]['positionWC']),_0x1b0491=_0x732491['isPointVisible'](_0x154716);if(!_0x1b0491)return _0x43b858['age']=0x0,null;}const _0xa6b027=Cesium['SceneTransforms']['wgs84ToWindowCoordinates'](this['_map']['scene'],_0x154716);return _0xa6b027?[_0xa6b027['x'],_0xa6b027['y']]:null;}['clear'](){const _0x24f1c9=_0x56db01;this[_0x24f1c9(0x143)][_0x24f1c9(0x1ba)](),delete this[_0x24f1c9(0x199)];}['initWorker'](){const _0x125ca3=_0x56db01;this['worker']=new Worker(this['options'][_0x125ca3(0x10c)]),this[_0x125ca3(0x10c)][_0x125ca3(0x123)]=_0x43fb23=>{const _0xaec8ea=_0x125ca3;this[_0xaec8ea(0x19d)](_0x43fb23['data']['particles']),this['_updateIng2']=![];},this['windField']={'init':_0x434226=>{this['worker']['postMessage']({'type':'init','options':_0x434226});},'setOptions':_0x1b0e97=>{const _0x47fb9e=_0x125ca3;this['worker'][_0x47fb9e(0x182)]({'type':'setOptions','options':_0x1b0e97});},'setDate':_0x4c8aa0=>{const _0x257dff=_0x125ca3;this['worker'][_0x257dff(0x182)]({'type':'setDate','data':_0x4c8aa0});},'update':()=>{const _0x546441=_0x125ca3;if(this['_updateIng2'])return;this[_0x546441(0x1b8)]=!![],this['worker']['postMessage']({'type':'update'});},'clear':()=>{const _0x93adef=_0x125ca3;this[_0x93adef(0x10c)]['postMessage']({'type':_0x93adef(0x1ba)});}},this['windField']['init'](this[_0x125ca3(0x159)]);}}mars3d__namespace['LayerUtil'][_0x56db01(0x1b0)](_0x56db01(0x1b9),CanvasWindLayer),mars3d__namespace[_0x56db01(0x1f9)]['CanvasWindLayer']=CanvasWindLayer,mars3d__namespace['CanvasWindField']=CanvasWindField,mars3d__namespace['WindUtil']=WindUtil,exports['CanvasWindField']=CanvasWindField,exports[_0x56db01(0x1f2)]=CanvasWindLayer,exports['WindLayer']=WindLayer,exports[_0x56db01(0x13f)]=WindUtil,Object['defineProperty'](exports,'__esModule',{'value':!![]});
}));
