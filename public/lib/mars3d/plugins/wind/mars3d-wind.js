/**
 * Mars3D平台插件,支持气象 风向图 功能插件  mars3d-wind
 *
 * 版本信息：v3.6.4
 * 编译日期：2023-09-05 14:31:04
 * 版权所有：Copyright by 火星科技  http://mars3d.cn
 * 使用单位：免费公开版 ，2023-03-17
 */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, (window.mars3d || require('mars3d'))) :
  typeof define === 'function' && define.amd ? define(['exports', 'mars3d'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global["mars3d-wind"] = {}, global.mars3d));
})(this, (function (exports, mars3d) { 
'use strict';const _0x5ed415=_0x307d;(function(_0x32b3a5,_0x28262b){const _0x4681f8=_0x307d,_0x427d55=_0x32b3a5();while(!![]){try{const _0x47f2e3=parseInt(_0x4681f8(0x272))/0x1*(-parseInt(_0x4681f8(0x202))/0x2)+-parseInt(_0x4681f8(0x1fa))/0x3+parseInt(_0x4681f8(0x1dd))/0x4*(parseInt(_0x4681f8(0x1f4))/0x5)+parseInt(_0x4681f8(0x1ad))/0x6*(-parseInt(_0x4681f8(0x22c))/0x7)+parseInt(_0x4681f8(0x1c0))/0x8+-parseInt(_0x4681f8(0x1ef))/0x9+parseInt(_0x4681f8(0x1a7))/0xa;if(_0x47f2e3===_0x28262b)break;else _0x427d55['push'](_0x427d55['shift']());}catch(_0x1ff3c6){_0x427d55['push'](_0x427d55['shift']());}}}(_0x443b,0x6bf9e));function _interopNamespace(_0x562733){const _0x349e62=_0x307d;if(_0x562733&&_0x562733[_0x349e62(0x19a)])return _0x562733;var _0x572e62=Object[_0x349e62(0x1a4)](null);return _0x562733&&Object['keys'](_0x562733)['forEach'](function(_0x522ac1){const _0x42cd50=_0x349e62;if(_0x522ac1!==_0x42cd50(0x258)){var _0x41df90=Object['getOwnPropertyDescriptor'](_0x562733,_0x522ac1);Object[_0x42cd50(0x24c)](_0x572e62,_0x522ac1,_0x41df90['get']?_0x41df90:{'enumerable':!![],'get':function(){return _0x562733[_0x522ac1];}});}}),_0x572e62['default']=_0x562733,_0x572e62;}var mars3d__namespace=_interopNamespace(mars3d);const Cesium$7=mars3d__namespace[_0x5ed415(0x1ce)];function getU(_0x7bcadc,_0x2007f0){const _0x4c6820=_0x5ed415,_0x6dd448=_0x7bcadc*Math[_0x4c6820(0x279)](Cesium$7['Math'][_0x4c6820(0x1bb)](_0x2007f0));return _0x6dd448;}function getV(_0x3caf75,_0x5057a4){const _0x31e9b9=_0x3caf75*Math['sin'](Cesium$7['Math']['toRadians'](_0x5057a4));return _0x31e9b9;}function _0x443b(){const _0xa3a750=['GeometryAttribute','LayerUtil','cols','clearCommand','setOptions','west','canrefresh','Cesium','pow','DISABLE_GL_POSITION_LOG_DEPTH','globeBoundingSphere','defined','createComputingPrimitives','DepthFunction','auto','SceneMode','none','getContext','postProcessingPosition','canvasResize','canvas','Framebuffer','1688HjjVsR','keys','stroke','xmin','shaderProgram','clear','frameTime','tlng','fill','ymax','vertexShaderSource','segments','drawingBufferHeight','getOptions','ShaderProgram','0px','Cartesian3','particles','6398964vsbDSO','_onMouseUpEvent','style','round','tlat','10270jJpwMV','updatePosition','addEventListener','commandToExecute','createParticlesTextures','_onMouseDownEvent','7785CTqXhD','VertexArray','destroyObject','mouseHidden','vertexArray','reverse','container','colorTable','1189726vTVkdE','OPAQUE','depthMask','particlesRendering','colors','Pass','south','clientHeight','Draw','vmax','particlesTextures','mouse_down','windTextures','depthTexture','abs','createRawRenderState','_removedHook','textures','lonRange','ShaderSource','currentTrailsDepth','clampToLatitudeRange','TextureMagnificationFilter','worker','bind','_maxAge','depthTest','_addedHook','_onMouseMoveEvent','BufferUsage','_randomParticle','speedRate','PrimitiveType','destination-in','createFramebuffer','viewerParameters','DISABLE_LOG_DEPTH_FRAGMENT_WRITE','canvasContext','updateSpeed','add','mouseUp','age','49dhVLtZ','TextureMinificationFilter','TRIANGLES','particlesNumber','createRenderingFramebuffers','createRenderingPrimitives','Cartesian2','currentParticlesPosition','RGB','speed','options','nextTrails','animateFrame','top','getExtent','getUVByXY','lineWidth','canvasWidth','createRenderingTextures','lon','pointerEvents','absolute','lat','postProcessingSpeed','FLOAT','getUVByPoint','removeAll','CanvasWindField','beginPath','position','preExecute','createSegmentsGeometry','defineProperty','windData','_onMap_preRenderEvent','lighter','lev','postMessage','getColorTexture','scene','framebuffers','array','length','getFullscreenQuad','default','lng','commandList','ComputeCommand','visibility','outputTexture','blue','redraw','addPrimitives','nextParticlesSpeed','particlesComputing','EventType','color','attributeLocations','resize','EllipsoidalOccluder','createTexture','forEach','primitives','_mountedHook','xmax','ymin','destroy','NEAREST','grid','_tomap','1rvuYoF','remove','Geometry','PixelDatatype','max','updateViewerParameters','data','cos','Sampler','getParticles','clientWidth','currentTrailsColor','Math','pixelSize','uniform\x20sampler2D\x20trailsColorTexture;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(trailsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20trailsColor;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x0a}\x0a','viewRectangleToLonLatRange','update','min','_speedRate','getWind','dropRateBump','trails','globalCompositeOperation','CanvasWindLayer','commandType','uniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20randomParticle\x20=\x20texture(postProcessingPosition,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20vec4\x20particleSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x0a\x20\x20\x20\x20if\x20(randomParticle.a\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20particleSpeed;\x0a\x20\x20\x20\x20}\x0a}\x0a','layer','#ffffff','context','clearFramebuffers','fragmentShaderSource','createWindTextures','createCommand','autoClear','levmin','reverseY','ClearCommand','preRender','uniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20lengthOfLonLat(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20unit\x20conversion:\x20meters\x20->\x20longitude\x20latitude\x20degrees\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_system#Length_of_a_degree\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20Calculate\x20the\x20length\x20of\x20a\x20degree\x20of\x20latitude\x20and\x20longitude\x20in\x20meters\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x0a\x20\x20\x20\x20float\x20term1\x20=\x20111132.92;\x0a\x20\x20\x20\x20float\x20term2\x20=\x20559.82\x20*\x20cos(2.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term3\x20=\x201.175\x20*\x20cos(4.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term4\x20=\x200.0023\x20*\x20cos(6.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20latLength\x20=\x20term1\x20-\x20term2\x20+\x20term3\x20-\x20term4;\x0a\x0a\x20\x20\x20\x20float\x20term5\x20=\x20111412.84\x20*\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20term6\x20=\x2093.5\x20*\x20cos(3.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term7\x20=\x200.118\x20*\x20cos(5.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20longLength\x20=\x20term5\x20-\x20term6\x20+\x20term7;\x0a\x0a\x20\x20\x20\x20return\x20vec2(longLength,\x20latLength);\x0a}\x0a\x0avoid\x20updatePosition(vec3\x20lonLatLev,\x20vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec2\x20lonLatLength\x20=\x20lengthOfLonLat(lonLatLev);\x0a\x20\x20\x20\x20float\x20u\x20=\x20speed.x\x20/\x20lonLatLength.x;\x0a\x20\x20\x20\x20float\x20v\x20=\x20speed.y\x20/\x20lonLatLength.y;\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20vec3\x20windVectorInLonLatLev\x20=\x20vec3(u,\x20v,\x20w);\x0a\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20lonLatLev\x20+\x20windVectorInLonLatLev;\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20speed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20updatePosition(lonLatLev,\x20speed);\x0a}\x0a','__esModule','_calcUV','STATIC_DRAW','geometry','particleHeight','segmentsColor','particlesTextureSize','latRange','mouse_move','_calc_speedRate','create','_onMapWhellEvent','push','8547500ZZffuH','off','strokeStyle','maxAge','Color','PI_OVER_THREE','442842PBGhdg','_colorRamp','uniform\x20sampler2D\x20nextParticlesPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0a//\x20range\x20(min,\x20max)\x0auniform\x20vec2\x20lonRange;\x0auniform\x20vec2\x20latRange;\x0a\x0auniform\x20float\x20randomCoefficient;\x20//\x20use\x20to\x20improve\x20the\x20pseudo-random\x20generator\x0auniform\x20float\x20dropRate;\x20//\x20drop\x20rate\x20is\x20a\x20chance\x20a\x20particle\x20will\x20restart\x20at\x20random\x20position\x20to\x20avoid\x20degeneration\x0auniform\x20float\x20dropRateBump;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0a//\x20pseudo-random\x20generator\x0aconst\x20vec3\x20randomConstants\x20=\x20vec3(12.9898,\x2078.233,\x204375.85453);\x0aconst\x20vec2\x20normalRange\x20=\x20vec2(0.0,\x201.0);\x0afloat\x20rand(vec2\x20seed,\x20vec2\x20range)\x20{\x0a\x20\x20\x20\x20vec2\x20randomSeed\x20=\x20randomCoefficient\x20*\x20seed;\x0a\x20\x20\x20\x20float\x20temp\x20=\x20dot(randomConstants.xy,\x20randomSeed);\x0a\x20\x20\x20\x20temp\x20=\x20fract(sin(temp)\x20*\x20(randomConstants.z\x20+\x20temp));\x0a\x20\x20\x20\x20return\x20temp\x20*\x20(range.y\x20-\x20range.x)\x20+\x20range.x;\x0a}\x0a\x0avec3\x20generateRandomParticle(vec2\x20seed,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20longitude\x20is\x20in\x20[0,\x20360]\x0a\x20\x20\x20\x20float\x20randomLon\x20=\x20mod(rand(seed,\x20lonRange),\x20360.0);\x0a\x20\x20\x20\x20float\x20randomLat\x20=\x20rand(-seed,\x20latRange);\x0a\x0a\x20\x20\x20\x20return\x20vec3(randomLon,\x20randomLat,\x20lev);\x0a}\x0a\x0abool\x20particleOutbound(vec3\x20particle)\x20{\x0a\x20\x20\x20\x20return\x20particle.y\x20<\x20-90.0\x20||\x20particle.y\x20>\x2090.0;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20texture(nextParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20float\x20particleDropRate\x20=\x20dropRate\x20+\x20dropRateBump\x20*\x20nextSpeed.a;\x0a\x0a\x20\x20\x20\x20vec2\x20seed1\x20=\x20nextParticle.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec2\x20seed2\x20=\x20nextSpeed.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec3\x20randomParticle\x20=\x20generateRandomParticle(seed1,\x20nextParticle.z);\x0a\x20\x20\x20\x20float\x20randomNumber\x20=\x20rand(seed2,\x20normalRange);\x0a\x0a\x20\x20\x20\x20if\x20(randomNumber\x20<\x20particleDropRate\x20||\x20particleOutbound(nextParticle))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(randomParticle,\x201.0);\x20//\x201.0\x20means\x20this\x20is\x20a\x20random\x20particle\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a\x20\x20\x20\x20}\x0a}\x0a','dimensions','cancelAnimationFrame','fromGeometry','bindEvent','rows','floor','once','particleSystem','//\x20the\x20size\x20of\x20UV\x20textures:\x20width\x20=\x20lon,\x20height\x20=\x20lat*lev\x0auniform\x20sampler2D\x20U;\x20//\x20eastward\x20wind\x0auniform\x20sampler2D\x20V;\x20//\x20northward\x20wind\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0a\x0auniform\x20vec3\x20dimension;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20vec3\x20minimum;\x20//\x20minimum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20maximum;\x20//\x20maximum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20interval;\x20//\x20interval\x20of\x20each\x20dimension\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20mapPositionToNormalizedIndex2D(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20range\x20of\x20longitude\x20and\x20latitude\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x,\x20360.0);\x0a\x20\x20\x20\x20lonLatLev.y\x20=\x20clamp(lonLatLev.y,\x20-90.0,\x2090.0);\x0a\x0a\x20\x20\x20\x20vec3\x20index3D\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20index3D.x\x20=\x20(lonLatLev.x\x20-\x20minimum.x)\x20/\x20interval.x;\x0a\x20\x20\x20\x20index3D.y\x20=\x20(lonLatLev.y\x20-\x20minimum.y)\x20/\x20interval.y;\x0a\x20\x20\x20\x20index3D.z\x20=\x20(lonLatLev.z\x20-\x20minimum.z)\x20/\x20interval.z;\x0a\x0a\x20\x20\x20\x20//\x20the\x20st\x20texture\x20coordinate\x20corresponding\x20to\x20(col,\x20row)\x20index\x0a\x20\x20\x20\x20//\x20example\x0a\x20\x20\x20\x20//\x20data\x20array\x20is\x20[0,\x201,\x202,\x203,\x204,\x205],\x20width\x20=\x203,\x20height\x20=\x202\x0a\x20\x20\x20\x20//\x20the\x20content\x20of\x20texture\x20will\x20be\x0a\x20\x20\x20\x20//\x20t\x201.0\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x203\x204\x205\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x200\x201\x202\x0a\x20\x20\x20\x20//\x20\x20\x200.0------1.0\x20s\x0a\x0a\x20\x20\x20\x20vec2\x20index2D\x20=\x20vec2(index3D.x,\x20index3D.z\x20*\x20dimension.y\x20+\x20index3D.y);\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20vec2(index2D.x\x20/\x20dimension.x,\x20index2D.y\x20/\x20(dimension.y\x20*\x20dimension.z));\x0a\x20\x20\x20\x20return\x20normalizedIndex2D;\x0a}\x0a\x0afloat\x20getWind(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20mapPositionToNormalizedIndex2D(lonLatLev);\x0a\x20\x20\x20\x20float\x20result\x20=\x20texture(windTexture,\x20normalizedIndex2D).r;\x0a\x20\x20\x20\x20return\x20result;\x0a}\x0a\x0aconst\x20mat4\x20kernelMatrix\x20=\x20mat4(\x0a\x20\x20\x20\x200.0,\x20-1.0,\x202.0,\x20-1.0,\x20//\x20first\x20column\x0a\x20\x20\x20\x202.0,\x200.0,\x20-5.0,\x203.0,\x20//\x20second\x20column\x0a\x20\x20\x20\x200.0,\x201.0,\x204.0,\x20-3.0,\x20//\x20third\x20column\x0a\x20\x20\x20\x200.0,\x200.0,\x20-1.0,\x201.0\x20//\x20fourth\x20column\x0a);\x0afloat\x20oneDimensionInterpolation(float\x20t,\x20float\x20p0,\x20float\x20p1,\x20float\x20p2,\x20float\x20p3)\x20{\x0a\x20\x20\x20\x20vec4\x20tVec4\x20=\x20vec4(1.0,\x20t,\x20t\x20*\x20t,\x20t\x20*\x20t\x20*\x20t);\x0a\x20\x20\x20\x20tVec4\x20=\x20tVec4\x20/\x202.0;\x0a\x20\x20\x20\x20vec4\x20pVec4\x20=\x20vec4(p0,\x20p1,\x20p2,\x20p3);\x0a\x20\x20\x20\x20return\x20dot((tVec4\x20*\x20kernelMatrix),\x20pVec4);\x0a}\x0a\x0afloat\x20calculateB(sampler2D\x20windTexture,\x20float\x20t,\x20float\x20lon,\x20float\x20lat,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20float\x20lon0\x20=\x20floor(lon)\x20-\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon1\x20=\x20floor(lon);\x0a\x20\x20\x20\x20float\x20lon2\x20=\x20floor(lon)\x20+\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon3\x20=\x20floor(lon)\x20+\x202.0\x20*\x20interval.x;\x0a\x0a\x20\x20\x20\x20float\x20p0\x20=\x20getWind(windTexture,\x20vec3(lon0,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p1\x20=\x20getWind(windTexture,\x20vec3(lon1,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p2\x20=\x20getWind(windTexture,\x20vec3(lon2,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p3\x20=\x20getWind(windTexture,\x20vec3(lon3,\x20lat,\x20lev));\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(t,\x20p0,\x20p1,\x20p2,\x20p3);\x0a}\x0a\x0afloat\x20interpolateOneTexture(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20float\x20lon\x20=\x20lonLatLev.x;\x0a\x20\x20\x20\x20float\x20lat\x20=\x20lonLatLev.y;\x0a\x20\x20\x20\x20float\x20lev\x20=\x20lonLatLev.z;\x0a\x0a\x20\x20\x20\x20float\x20lat0\x20=\x20floor(lat)\x20-\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat1\x20=\x20floor(lat);\x0a\x20\x20\x20\x20float\x20lat2\x20=\x20floor(lat)\x20+\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat3\x20=\x20floor(lat)\x20+\x202.0\x20*\x20interval.y;\x0a\x0a\x20\x20\x20\x20vec2\x20coefficient\x20=\x20lonLatLev.xy\x20-\x20floor(lonLatLev.xy);\x0a\x20\x20\x20\x20float\x20b0\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat0,\x20lev);\x0a\x20\x20\x20\x20float\x20b1\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat1,\x20lev);\x0a\x20\x20\x20\x20float\x20b2\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat2,\x20lev);\x0a\x20\x20\x20\x20float\x20b3\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat3,\x20lev);\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(coefficient.y,\x20b0,\x20b1,\x20b2,\x20b3);\x0a}\x0a\x0avec3\x20bicubic(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20https://en.wikipedia.org/wiki/Bicubic_interpolation#Bicubic_convolution_algorithm\x0a\x20\x20\x20\x20float\x20u\x20=\x20interpolateOneTexture(U,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20v\x20=\x20interpolateOneTexture(V,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20return\x20vec3(u,\x20v,\x20w);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20bicubic(lonLatLev);\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(windVector,\x200.0);\x0a}\x0a','Compute','currentParticlesSpeed','toRadians','_map','_bilinearInterpolation','_drawLines','wheel','4366680AmOvkp','camera','framebuffer','windField','levmax','show','_updateIng2'];_0x443b=function(){return _0xa3a750;};return _0x443b();}function getSpeed(_0x210dd8,_0x456ce7){const _0x1028e3=_0x5ed415,_0x29629e=Math['sqrt'](Math[_0x1028e3(0x1cf)](_0x210dd8,0x2)+Math[_0x1028e3(0x1cf)](_0x456ce7,0x2));return _0x29629e;}function getDirection(_0x5db146,_0x1f6e9c){let _0x59d2bb=Cesium$7['Math']['toDegrees'](Math['atan2'](_0x1f6e9c,_0x5db146));return _0x59d2bb+=_0x59d2bb<0x0?0x168:0x0,_0x59d2bb;}var WindUtil={'__proto__':null,'getU':getU,'getV':getV,'getSpeed':getSpeed,'getDirection':getDirection};const Cesium$6=mars3d__namespace[_0x5ed415(0x1ce)];class CustomPrimitive{constructor(_0x1f1947){const _0x4f4b5a=_0x5ed415;this['commandType']=_0x1f1947[_0x4f4b5a(0x28a)],this['geometry']=_0x1f1947['geometry'],this[_0x4f4b5a(0x265)]=_0x1f1947['attributeLocations'],this['primitiveType']=_0x1f1947['primitiveType'],this['uniformMap']=_0x1f1947['uniformMap'],this[_0x4f4b5a(0x1e7)]=_0x1f1947['vertexShaderSource'],this['fragmentShaderSource']=_0x1f1947['fragmentShaderSource'],this['rawRenderState']=_0x1f1947['rawRenderState'],this['framebuffer']=_0x1f1947['framebuffer'],this['outputTexture']=_0x1f1947[_0x4f4b5a(0x25d)],this['autoClear']=_0x1f1947['autoClear']??![],this[_0x4f4b5a(0x24a)]=_0x1f1947[_0x4f4b5a(0x24a)],this[_0x4f4b5a(0x1c5)]=!![],this['commandToExecute']=undefined,this['clearCommand']=undefined,this[_0x4f4b5a(0x293)]&&(this['clearCommand']=new Cesium$6['ClearCommand']({'color':new Cesium$6[(_0x4f4b5a(0x1ab))](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':this['framebuffer'],'pass':Cesium$6['Pass']['OPAQUE']}));}['createCommand'](_0xeee76){const _0x173ebf=_0x5ed415;switch(this['commandType']){case _0x173ebf(0x20a):{const _0x25c531=Cesium$6['VertexArray']['fromGeometry']({'context':_0xeee76,'geometry':this['geometry'],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6[_0x173ebf(0x21f)]['STATIC_DRAW']}),_0x3f33ff=Cesium$6[_0x173ebf(0x1eb)]['fromCache']({'context':_0xeee76,'attributeLocations':this['attributeLocations'],'vertexShaderSource':this['vertexShaderSource'],'fragmentShaderSource':this[_0x173ebf(0x290)]}),_0x317c17=Cesium$6['RenderState']['fromCache'](this['rawRenderState']);return new Cesium$6['DrawCommand']({'primitiveType':this['primitiveType'],'shaderProgram':_0x3f33ff,'vertexArray':_0x25c531,'modelMatrix':Cesium$6['Matrix4']['IDENTITY'],'renderState':_0x317c17,'uniformMap':this['uniformMap'],'castShadows':![],'receiveShadows':![],'framebuffer':this['framebuffer'],'pass':Cesium$6[_0x173ebf(0x207)][_0x173ebf(0x203)],'pickOnly':!![],'owner':this});}case'Compute':{return new Cesium$6[(_0x173ebf(0x25b))]({'owner':this,'fragmentShaderSource':this[_0x173ebf(0x290)],'uniformMap':this['uniformMap'],'outputTexture':this['outputTexture'],'persists':!![]});}}}['setGeometry'](_0x4e9c69,_0x4358eb){const _0x27ec5f=_0x5ed415;this['geometry']=_0x4358eb;const _0x20c66d=Cesium$6[_0x27ec5f(0x1fb)]['fromGeometry']({'context':_0x4e9c69,'geometry':this['geometry'],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6['BufferUsage']['STATIC_DRAW']});this['commandToExecute']['vertexArray']=_0x20c66d;}['update'](_0x25bd48){const _0x454389=_0x5ed415;if(!this['show'])return;if(_0x25bd48['mode']!==Cesium$6['SceneMode']['SCENE3D'])return;!Cesium$6['defined'](this['commandToExecute'])&&(this['commandToExecute']=this[_0x454389(0x292)](_0x25bd48['context'])),Cesium$6['defined'](this['preExecute'])&&this['preExecute'](),Cesium$6['defined'](this[_0x454389(0x1ca)])&&_0x25bd48[_0x454389(0x25a)]['push'](this[_0x454389(0x1ca)]),_0x25bd48['commandList']['push'](this[_0x454389(0x1f7)]);}['isDestroyed'](){return![];}['destroy'](){const _0x24d42a=_0x5ed415;if(this['clearCommand']){var _0x3022ea,_0xa4ffb9;(_0x3022ea=this['clearCommand'])!==null&&_0x3022ea!==void 0x0&&_0x3022ea['vertexArray']&&this['clearCommand']['vertexArray']['destroy'](),(_0xa4ffb9=this['clearCommand'])!==null&&_0xa4ffb9!==void 0x0&&_0xa4ffb9['shaderProgram']&&this[_0x24d42a(0x1ca)]['shaderProgram']['destroy'](),delete this['clearCommand'];}return this['commandToExecute']&&(this['commandToExecute']['vertexArray']&&this[_0x24d42a(0x1f7)]['vertexArray'][_0x24d42a(0x26e)](),this[_0x24d42a(0x1f7)][_0x24d42a(0x1e1)]&&this[_0x24d42a(0x1f7)]['shaderProgram']['destroy'](),delete this[_0x24d42a(0x1f7)]),Cesium$6[_0x24d42a(0x1fc)](this);}}const Cesium$5=mars3d__namespace['Cesium'],Util=(function(){const _0x154464=function(){const _0x14457c=_0x307d,_0x22357e=new Cesium$5[(_0x14457c(0x274))]({'attributes':new Cesium$5['GeometryAttributes']({'position':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x3,'values':new Float32Array([-0x1,-0x1,0x0,0x1,-0x1,0x0,0x1,0x1,0x0,-0x1,0x1,0x0])}),'st':new Cesium$5[(_0x14457c(0x1c7))]({'componentDatatype':Cesium$5['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x2,'values':new Float32Array([0x0,0x0,0x1,0x0,0x1,0x1,0x0,0x1])})}),'indices':new Uint32Array([0x3,0x2,0x0,0x0,0x2,0x1])});return _0x22357e;},_0x48476a=function(_0x283da5,_0x52324e){const _0x4a80b5=_0x307d;if(Cesium$5[_0x4a80b5(0x1d2)](_0x52324e)){const _0xdfab00={};_0xdfab00['arrayBufferView']=_0x52324e,_0x283da5['source']=_0xdfab00;}const _0x4130ed=new Cesium$5['Texture'](_0x283da5);return _0x4130ed;},_0x398093=function(_0x14ac90,_0x2180bf,_0x5c3935){const _0x2083e6=_0x307d,_0xa8bd87=new Cesium$5[(_0x2083e6(0x1dc))]({'context':_0x14ac90,'colorTextures':[_0x2180bf],'depthTexture':_0x5c3935});return _0xa8bd87;},_0x58404a=function(_0x42986d){const _0x5d139c=_0x307d,_0x46bd76=!![],_0x1543b0=![],_0x228c3c={'viewport':_0x42986d['viewport'],'depthTest':_0x42986d[_0x5d139c(0x21c)],'depthMask':_0x42986d[_0x5d139c(0x204)],'blending':_0x42986d['blending']},_0xafdfb3=Cesium$5['Appearance']['getDefaultRenderState'](_0x46bd76,_0x1543b0,_0x228c3c);return _0xafdfb3;},_0xe6aecb=function(_0x1eeaf5){const _0x5a03cd=_0x307d,_0xaff0e3={},_0x4a7272=Cesium$5[_0x5a03cd(0x27e)]['mod'](_0x1eeaf5[_0x5a03cd(0x1cc)],Cesium$5[_0x5a03cd(0x27e)]['TWO_PI']),_0x5e7e71=Cesium$5['Math']['mod'](_0x1eeaf5['east'],Cesium$5['Math']['TWO_PI']),_0x363c9b=_0x1eeaf5['width'];let _0x4e2127,_0x1621be;_0x363c9b>Cesium$5['Math']['THREE_PI_OVER_TWO']?(_0x4e2127=0x0,_0x1621be=Cesium$5['Math']['TWO_PI']):_0x5e7e71-_0x4a7272<_0x363c9b?(_0x4e2127=_0x4a7272,_0x1621be=_0x4a7272+_0x363c9b):(_0x4e2127=_0x4a7272,_0x1621be=_0x5e7e71);_0xaff0e3['lon']={'min':Cesium$5[_0x5a03cd(0x27e)]['toDegrees'](_0x4e2127),'max':Cesium$5[_0x5a03cd(0x27e)]['toDegrees'](_0x1621be)};const _0x1aee84=_0x1eeaf5[_0x5a03cd(0x208)],_0xa91ecf=_0x1eeaf5['north'],_0x273ab0=_0x1eeaf5['height'],_0x38ea06=_0x273ab0>Cesium$5['Math']['PI']/0xc?_0x273ab0/0x2:0x0;let _0x3ce710=Cesium$5[_0x5a03cd(0x27e)]['clampToLatitudeRange'](_0x1aee84-_0x38ea06),_0x266bbc=Cesium$5[_0x5a03cd(0x27e)][_0x5a03cd(0x217)](_0xa91ecf+_0x38ea06);return _0x3ce710<-Cesium$5[_0x5a03cd(0x27e)][_0x5a03cd(0x1ac)]&&(_0x3ce710=-Cesium$5[_0x5a03cd(0x27e)]['PI_OVER_TWO']),_0x266bbc>Cesium$5[_0x5a03cd(0x27e)]['PI_OVER_THREE']&&(_0x266bbc=Cesium$5[_0x5a03cd(0x27e)]['PI_OVER_TWO']),_0xaff0e3['lat']={'min':Cesium$5['Math']['toDegrees'](_0x3ce710),'max':Cesium$5['Math']['toDegrees'](_0x266bbc)},_0xaff0e3;};return{'getFullscreenQuad':_0x154464,'createTexture':_0x48476a,'createFramebuffer':_0x398093,'createRawRenderState':_0x58404a,'viewRectangleToLonLatRange':_0xe6aecb};}());var segmentDraw_vert='in\x20vec2\x20st;\x0a//\x20it\x20is\x20not\x20normal\x20itself,\x20but\x20used\x20to\x20control\x20normal\x0ain\x20vec3\x20normal;\x20//\x20(point\x20to\x20use,\x20offset\x20sign,\x20not\x20used\x20component)\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x0auniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20postProcessingSpeed;\x0a\x0auniform\x20float\x20particleHeight;\x0a\x0auniform\x20float\x20aspect;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20lineWidth;\x0a\x0aout\x20float\x20speedNormalization;\x0a\x0avec3\x20convertCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20WGS84\x20(lon,\x20lat,\x20lev)\x20->\x20ECEF\x20(x,\x20y,\x20z)\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_conversion#From_geodetic_to_ECEF_coordinates\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20WGS\x2084\x20geometric\x20constants\x0a\x20\x20\x20\x20float\x20a\x20=\x206378137.0;\x20//\x20Semi-major\x20axis\x0a\x20\x20\x20\x20float\x20b\x20=\x206356752.3142;\x20//\x20Semi-minor\x20axis\x0a\x20\x20\x20\x20float\x20e2\x20=\x206.69437999014e-3;\x20//\x20First\x20eccentricity\x20squared\x0a\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x20\x20\x20\x20float\x20longitude\x20=\x20radians(lonLatLev.x);\x0a\x0a\x20\x20\x20\x20float\x20cosLat\x20=\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20sinLat\x20=\x20sin(latitude);\x0a\x20\x20\x20\x20float\x20cosLon\x20=\x20cos(longitude);\x0a\x20\x20\x20\x20float\x20sinLon\x20=\x20sin(longitude);\x0a\x0a\x20\x20\x20\x20float\x20N_Phi\x20=\x20a\x20/\x20sqrt(1.0\x20-\x20e2\x20*\x20sinLat\x20*\x20sinLat);\x0a\x20\x20\x20\x20float\x20h\x20=\x20particleHeight;\x20//\x20it\x20should\x20be\x20high\x20enough\x20otherwise\x20the\x20particle\x20may\x20not\x20pass\x20the\x20terrain\x20depth\x20test\x0a\x0a\x20\x20\x20\x20vec3\x20cartesian\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20cartesian.x\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20cosLon;\x0a\x20\x20\x20\x20cartesian.y\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20sinLon;\x0a\x20\x20\x20\x20cartesian.z\x20=\x20((b\x20*\x20b)\x20/\x20(a\x20*\x20a)\x20*\x20N_Phi\x20+\x20h)\x20*\x20sinLat;\x0a\x20\x20\x20\x20return\x20cartesian;\x0a}\x0a\x0avec4\x20calcProjectedCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20the\x20range\x20of\x20longitude\x20in\x20Cesium\x20is\x20[-180,\x20180]\x20but\x20the\x20range\x20of\x20longitude\x20in\x20the\x20NetCDF\x20file\x20is\x20[0,\x20360]\x0a\x20\x20\x20\x20//\x20[0,\x20180]\x20is\x20corresponding\x20to\x20[0,\x20180]\x20and\x20[180,\x20360]\x20is\x20corresponding\x20to\x20[-180,\x200]\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x\x20+\x20180.0,\x20360.0)\x20-\x20180.0;\x0a\x20\x20\x20\x20vec3\x20particlePosition\x20=\x20convertCoordinate(lonLatLev);\x0a\x20\x20\x20\x20vec4\x20projectedCoordinate\x20=\x20czm_modelViewProjection\x20*\x20vec4(particlePosition,\x201.0);\x0a\x20\x20\x20\x20return\x20projectedCoordinate;\x0a}\x0a\x0avec4\x20calcOffset(vec4\x20currentProjectedCoordinate,\x20vec4\x20nextProjectedCoordinate,\x20float\x20offsetSign)\x20{\x0a\x20\x20\x20\x20vec2\x20aspectVec2\x20=\x20vec2(aspect,\x201.0);\x0a\x20\x20\x20\x20vec2\x20currentXY\x20=\x20(currentProjectedCoordinate.xy\x20/\x20currentProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x20\x20\x20\x20vec2\x20nextXY\x20=\x20(nextProjectedCoordinate.xy\x20/\x20nextProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x0a\x20\x20\x20\x20float\x20offsetLength\x20=\x20lineWidth\x20/\x202.0;\x0a\x20\x20\x20\x20vec2\x20direction\x20=\x20normalize(nextXY\x20-\x20currentXY);\x0a\x20\x20\x20\x20vec2\x20normalVector\x20=\x20vec2(-direction.y,\x20direction.x);\x0a\x20\x20\x20\x20normalVector.x\x20=\x20normalVector.x\x20/\x20aspect;\x0a\x20\x20\x20\x20normalVector\x20=\x20offsetLength\x20*\x20normalVector;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20vec4(offsetSign\x20*\x20normalVector,\x200.0,\x200.0);\x0a\x20\x20\x20\x20return\x20offset;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec2\x20particleIndex\x20=\x20st;\x0a\x0a\x20\x20\x20\x20vec3\x20currentPosition\x20=\x20texture(currentParticlesPosition,\x20particleIndex).rgb;\x0a\x20\x20\x20\x20vec4\x20nextPosition\x20=\x20texture(postProcessingPosition,\x20particleIndex);\x0a\x0a\x20\x20\x20\x20vec4\x20currentProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20vec4\x20nextProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(nextPosition.w\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(nextPosition.xyz);\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20float\x20pointToUse\x20=\x20normal.x;\x20//\x20-1\x20is\x20currentProjectedCoordinate\x20and\x20+1\x20is\x20nextProjectedCoordinate\x0a\x20\x20\x20\x20float\x20offsetSign\x20=\x20normal.y;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20pixelSize\x20*\x20calcOffset(currentProjectedCoordinate,\x20nextProjectedCoordinate,\x20offsetSign);\x0a\x20\x20\x20\x20if\x20(pointToUse\x20<\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20currentProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20nextProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20speedNormalization\x20=\x20texture(postProcessingSpeed,\x20particleIndex).a;\x0a}\x0a',segmentDraw_frag='uniform\x20sampler2D\x20colorTable;\x0a\x0ain\x20float\x20speedNormalization;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20out_FragColor\x20=\x20texture(colorTable,\x20vec2(speedNormalization,\x200.0));\x0a}\x0a',fullscreen_vert='in\x20vec3\x20position;\x0ain\x20vec2\x20st;\x0a\x0aout\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20textureCoordinate\x20=\x20st;\x0a\x20\x20\x20\x20gl_Position\x20=\x20vec4(position,\x201.0);\x0a}\x0a',trailDraw_frag='uniform\x20sampler2D\x20segmentsColorTexture;\x0auniform\x20sampler2D\x20segmentsDepthTexture;\x0a\x0auniform\x20sampler2D\x20currentTrailsColor;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0auniform\x20float\x20fadeOpacity;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20pointsColor\x20=\x20texture(segmentsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(currentTrailsColor,\x20textureCoordinate);\x0a\x0a\x20\x20\x20\x20trailsColor\x20=\x20floor(fadeOpacity\x20*\x20255.0\x20*\x20trailsColor)\x20/\x20255.0;\x20//\x20make\x20sure\x20the\x20trailsColor\x20will\x20be\x20strictly\x20decreased\x0a\x0a\x20\x20\x20\x20float\x20pointsDepth\x20=\x20texture(segmentsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(pointsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20pointsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20trailsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20gl_FragDepth\x20=\x20min(pointsDepth,\x20trailsDepth);\x0a}\x0a',screenDraw_frag=_0x5ed415(0x280);const Cesium$4=mars3d__namespace[_0x5ed415(0x1ce)];class ParticlesRendering{constructor(_0x182bbb,_0x42937a,_0x1a9209,_0x5b9ac3,_0x518066){const _0x1126c1=_0x5ed415;this['createRenderingTextures'](_0x182bbb,_0x42937a,_0x1a9209['colors']),this[_0x1126c1(0x230)](_0x182bbb),this[_0x1126c1(0x231)](_0x182bbb,_0x1a9209,_0x5b9ac3,_0x518066);}[_0x5ed415(0x23e)](_0x25a618,_0x117db6,_0x3927e8){const _0x485faf=_0x5ed415,_0x3b192c={'context':_0x25a618,'width':_0x25a618['drawingBufferWidth'],'height':_0x25a618[_0x485faf(0x1e9)],'pixelFormat':Cesium$4['PixelFormat']['RGBA'],'pixelDatatype':Cesium$4['PixelDatatype']['UNSIGNED_BYTE']},_0x202f42={'context':_0x25a618,'width':_0x25a618['drawingBufferWidth'],'height':_0x25a618['drawingBufferHeight'],'pixelFormat':Cesium$4['PixelFormat']['DEPTH_COMPONENT'],'pixelDatatype':Cesium$4['PixelDatatype']['UNSIGNED_INT']},_0x1f2a01=_0x3927e8[_0x485faf(0x256)],_0x24b92f=new Float32Array(_0x1f2a01*0x3);for(let _0x4aa8a9=0x0;_0x4aa8a9<_0x1f2a01;_0x4aa8a9++){const _0x1762c0=Cesium$4['Color']['fromCssColorString'](_0x3927e8[_0x4aa8a9]);_0x24b92f[0x3*_0x4aa8a9]=_0x1762c0['red'],_0x24b92f[0x3*_0x4aa8a9+0x1]=_0x1762c0['green'],_0x24b92f[0x3*_0x4aa8a9+0x2]=_0x1762c0[_0x485faf(0x25e)];}const _0x59d88e={'context':_0x25a618,'width':_0x1f2a01,'height':0x1,'pixelFormat':Cesium$4['PixelFormat'][_0x485faf(0x234)],'pixelDatatype':Cesium$4[_0x485faf(0x275)][_0x485faf(0x244)],'sampler':new Cesium$4['Sampler']({'minificationFilter':Cesium$4['TextureMinificationFilter']['LINEAR'],'magnificationFilter':Cesium$4[_0x485faf(0x218)]['LINEAR']})};this['textures']={'segmentsColor':Util['createTexture'](_0x3b192c),'segmentsDepth':Util['createTexture'](_0x202f42),'currentTrailsColor':Util[_0x485faf(0x268)](_0x3b192c),'currentTrailsDepth':Util['createTexture'](_0x202f42),'nextTrailsColor':Util['createTexture'](_0x3b192c),'nextTrailsDepth':Util[_0x485faf(0x268)](_0x202f42),'colorTable':Util['createTexture'](_0x59d88e,_0x24b92f)};}['createRenderingFramebuffers'](_0xf56c4b){const _0x15131b=_0x5ed415;this[_0x15131b(0x254)]={'segments':Util['createFramebuffer'](_0xf56c4b,this['textures']['segmentsColor'],this[_0x15131b(0x213)]['segmentsDepth']),'currentTrails':Util[_0x15131b(0x224)](_0xf56c4b,this[_0x15131b(0x213)][_0x15131b(0x27d)],this['textures'][_0x15131b(0x216)]),'nextTrails':Util['createFramebuffer'](_0xf56c4b,this['textures']['nextTrailsColor'],this['textures']['nextTrailsDepth'])};}[_0x5ed415(0x24b)](_0x434f3b){const _0x58342d=_0x5ed415,_0x21169a=0x4;let _0x5c795b=[];for(let _0x5f2bd9=0x0;_0x5f2bd9<_0x434f3b['particlesTextureSize'];_0x5f2bd9++){for(let _0x36f543=0x0;_0x36f543<_0x434f3b[_0x58342d(0x1a0)];_0x36f543++){for(let _0x5733bf=0x0;_0x5733bf<_0x21169a;_0x5733bf++){_0x5c795b['push'](_0x5f2bd9/_0x434f3b['particlesTextureSize']),_0x5c795b['push'](_0x36f543/_0x434f3b['particlesTextureSize']);}}}_0x5c795b=new Float32Array(_0x5c795b);let _0x2491ed=[];const _0x3265d7=[-0x1,0x1],_0x8afb0a=[-0x1,0x1];for(let _0xabd06b=0x0;_0xabd06b<_0x434f3b['maxParticles'];_0xabd06b++){for(let _0x1e1b4b=0x0;_0x1e1b4b<_0x21169a/0x2;_0x1e1b4b++){for(let _0x1c1f00=0x0;_0x1c1f00<_0x21169a/0x2;_0x1c1f00++){_0x2491ed['push'](_0x3265d7[_0x1e1b4b]),_0x2491ed['push'](_0x8afb0a[_0x1c1f00]),_0x2491ed['push'](0x0);}}}_0x2491ed=new Float32Array(_0x2491ed);const _0x3759ba=0x6*_0x434f3b['maxParticles'],_0x1e4508=new Uint32Array(_0x3759ba);for(let _0x121270=0x0,_0xdb124c=0x0,_0x277b68=0x0;_0x121270<_0x434f3b['maxParticles'];_0x121270++){_0x1e4508[_0xdb124c++]=_0x277b68+0x0,_0x1e4508[_0xdb124c++]=_0x277b68+0x1,_0x1e4508[_0xdb124c++]=_0x277b68+0x2,_0x1e4508[_0xdb124c++]=_0x277b68+0x2,_0x1e4508[_0xdb124c++]=_0x277b68+0x1,_0x1e4508[_0xdb124c++]=_0x277b68+0x3,_0x277b68+=0x4;}const _0x3b60d7=new Cesium$4[(_0x58342d(0x274))]({'attributes':new Cesium$4['GeometryAttributes']({'st':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x2,'values':_0x5c795b}),'normal':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x3,'values':_0x2491ed})}),'indices':_0x1e4508});return _0x3b60d7;}['createRenderingPrimitives'](_0x35285b,_0x5251fc,_0x173bfb,_0x8ebe57){const _0x506cf9=_0x5ed415,_0x5bd886=this;this['primitives']={'segments':new CustomPrimitive({'commandType':_0x506cf9(0x20a),'attributeLocations':{'st':0x0,'normal':0x1},'geometry':this['createSegmentsGeometry'](_0x5251fc),'primitiveType':Cesium$4['PrimitiveType'][_0x506cf9(0x22e)],'uniformMap':{'currentParticlesPosition':function(){const _0x53d2a8=_0x506cf9;return _0x8ebe57['particlesTextures'][_0x53d2a8(0x233)];},'postProcessingPosition':function(){return _0x8ebe57['particlesTextures']['postProcessingPosition'];},'postProcessingSpeed':function(){return _0x8ebe57['particlesTextures']['postProcessingSpeed'];},'colorTable':function(){const _0x419f89=_0x506cf9;return _0x5bd886['textures'][_0x419f89(0x201)];},'aspect':function(){return _0x35285b['drawingBufferWidth']/_0x35285b['drawingBufferHeight'];},'pixelSize':function(){const _0x4d6a70=_0x506cf9;return _0x173bfb[_0x4d6a70(0x27f)];},'lineWidth':function(){return _0x5251fc['lineWidth'];},'particleHeight':function(){const _0x2998bc=_0x506cf9;return _0x5251fc[_0x2998bc(0x19e)];}},'vertexShaderSource':new Cesium$4[(_0x506cf9(0x215))]({'sources':[segmentDraw_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![]},'depthMask':!![]}),'framebuffer':this[_0x506cf9(0x254)]['segments'],'autoClear':!![]}),'trails':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'segmentsColorTexture':function(){const _0xa29d7=_0x506cf9;return _0x5bd886['textures'][_0xa29d7(0x19f)];},'segmentsDepthTexture':function(){return _0x5bd886['textures']['segmentsDepth'];},'currentTrailsColor':function(){const _0x1709af=_0x506cf9;return _0x5bd886[_0x1709af(0x254)]['currentTrails'][_0x1709af(0x252)](0x0);},'trailsDepthTexture':function(){const _0x498891=_0x506cf9;return _0x5bd886['framebuffers']['currentTrails'][_0x498891(0x20f)];},'fadeOpacity':function(){return _0x5251fc['fadeOpacity'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':[_0x506cf9(0x1d0)],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':[_0x506cf9(0x226)],'sources':[trailDraw_frag]}),'rawRenderState':Util[_0x506cf9(0x211)]({'viewport':undefined,'depthTest':{'enabled':!![],'func':Cesium$4[_0x506cf9(0x1d4)]['ALWAYS']},'depthMask':!![]}),'framebuffer':this[_0x506cf9(0x254)]['nextTrails'],'autoClear':!![],'preExecute':function(){const _0x5a0604=_0x506cf9,_0x59853c=_0x5bd886['framebuffers']['currentTrails'];_0x5bd886['framebuffers']['currentTrails']=_0x5bd886['framebuffers']['nextTrails'],_0x5bd886[_0x5a0604(0x254)]['nextTrails']=_0x59853c,_0x5bd886['primitives']['trails']['commandToExecute']['framebuffer']=_0x5bd886['framebuffers'][_0x5a0604(0x237)],_0x5bd886['primitives'][_0x5a0604(0x287)][_0x5a0604(0x1ca)]['framebuffer']=_0x5bd886[_0x5a0604(0x254)]['nextTrails'];}}),'screen':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util[_0x506cf9(0x257)](),'primitiveType':Cesium$4[_0x506cf9(0x222)][_0x506cf9(0x22e)],'uniformMap':{'trailsColorTexture':function(){return _0x5bd886['framebuffers']['nextTrails']['getColorTexture'](0x0);},'trailsDepthTexture':function(){return _0x5bd886['framebuffers']['nextTrails']['depthTexture'];}},'vertexShaderSource':new Cesium$4[(_0x506cf9(0x215))]({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[screenDraw_frag]}),'rawRenderState':Util[_0x506cf9(0x211)]({'viewport':undefined,'depthTest':{'enabled':![]},'depthMask':!![],'blending':{'enabled':!![]}}),'framebuffer':undefined})};}}var getWind_frag=_0x5ed415(0x1b8),updateSpeed_frag='uniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0auniform\x20sampler2D\x20particlesWind;\x0a\x0a//\x20used\x20to\x20calculate\x20the\x20wind\x20norm\x0auniform\x20vec2\x20uSpeedRange;\x20//\x20(min,\x20max);\x0auniform\x20vec2\x20vSpeedRange;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20speedFactor;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0afloat\x20calculateWindNorm(vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec3\x20percent\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20percent.x\x20=\x20(speed.x\x20-\x20uSpeedRange.x)\x20/\x20(uSpeedRange.y\x20-\x20uSpeedRange.x);\x0a\x20\x20\x20\x20percent.y\x20=\x20(speed.y\x20-\x20vSpeedRange.x)\x20/\x20(vSpeedRange.y\x20-\x20vSpeedRange.x);\x0a\x20\x20\x20\x20float\x20normalization\x20=\x20length(percent);\x0a\x0a\x20\x20\x20\x20return\x20normalization;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20//\x20vec3\x20currentSpeed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20texture(particlesWind,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20vec4(speedFactor\x20*\x20pixelSize\x20*\x20windVector,\x20calculateWindNorm(windVector));\x0a\x20\x20\x20\x20out_FragColor\x20=\x20nextSpeed;\x0a}\x0a',updatePosition_frag=_0x5ed415(0x199),postProcessingPosition_frag=_0x5ed415(0x1af),postProcessingSpeed_frag=_0x5ed415(0x28b);const Cesium$3=mars3d__namespace['Cesium'];class ParticlesComputing{constructor(_0x5f58fe,_0x467c23,_0x17715f,_0x337dd9){const _0x1710d6=_0x5ed415;this['data']=_0x467c23,this[_0x1710d6(0x291)](_0x5f58fe,_0x467c23),this['createParticlesTextures'](_0x5f58fe,_0x17715f,_0x337dd9),this[_0x1710d6(0x1d3)](_0x467c23,_0x17715f,_0x337dd9);}[_0x5ed415(0x291)](_0x256dcb,_0x3c8659){const _0x12f587=_0x5ed415,_0x3684b8={'context':_0x256dcb,'width':_0x3c8659[_0x12f587(0x1b0)]['lon'],'height':_0x3c8659['dimensions']['lat']*(_0x3c8659['dimensions']['lev']||0x1),'pixelFormat':Cesium$3['PixelFormat']['LUMINANCE'],'pixelDatatype':Cesium$3[_0x12f587(0x275)]['FLOAT'],'flipY':![],'sampler':new Cesium$3[(_0x12f587(0x27a))]({'minificationFilter':Cesium$3[_0x12f587(0x22d)][_0x12f587(0x26f)],'magnificationFilter':Cesium$3['TextureMagnificationFilter'][_0x12f587(0x26f)]})};this['windTextures']={'U':Util['createTexture'](_0x3684b8,_0x3c8659['U']['array']),'V':Util['createTexture'](_0x3684b8,_0x3c8659['V']['array'])};}[_0x5ed415(0x1f8)](_0x29e4e4,_0x1c0cfc,_0x437c1d){const _0x1a1547=_0x5ed415,_0x1e20c3={'context':_0x29e4e4,'width':_0x1c0cfc['particlesTextureSize'],'height':_0x1c0cfc[_0x1a1547(0x1a0)],'pixelFormat':Cesium$3['PixelFormat']['RGBA'],'pixelDatatype':Cesium$3['PixelDatatype']['FLOAT'],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3['TextureMinificationFilter']['NEAREST'],'magnificationFilter':Cesium$3['TextureMagnificationFilter']['NEAREST']})},_0x3c0619=this['randomizeParticles'](_0x1c0cfc['maxParticles'],_0x437c1d),_0x2eab16=new Float32Array(0x4*_0x1c0cfc['maxParticles'])[_0x1a1547(0x1e5)](0x0);this[_0x1a1547(0x20c)]={'particlesWind':Util['createTexture'](_0x1e20c3),'currentParticlesPosition':Util[_0x1a1547(0x268)](_0x1e20c3,_0x3c0619),'nextParticlesPosition':Util['createTexture'](_0x1e20c3,_0x3c0619),'currentParticlesSpeed':Util[_0x1a1547(0x268)](_0x1e20c3,_0x2eab16),'nextParticlesSpeed':Util['createTexture'](_0x1e20c3,_0x2eab16),'postProcessingPosition':Util['createTexture'](_0x1e20c3,_0x3c0619),'postProcessingSpeed':Util['createTexture'](_0x1e20c3,_0x2eab16)};}['randomizeParticles'](_0x28afc7,_0x54771f){const _0x299083=_0x5ed415,_0x4987b8=new Float32Array(0x4*_0x28afc7);for(let _0x42825d=0x0;_0x42825d<_0x28afc7;_0x42825d++){_0x4987b8[0x4*_0x42825d]=Cesium$3[_0x299083(0x27e)]['randomBetween'](_0x54771f['lonRange']['x'],_0x54771f[_0x299083(0x214)]['y']),_0x4987b8[0x4*_0x42825d+0x1]=Cesium$3['Math']['randomBetween'](_0x54771f['latRange']['x'],_0x54771f[_0x299083(0x1a1)]['y']),_0x4987b8[0x4*_0x42825d+0x2]=Cesium$3[_0x299083(0x27e)]['randomBetween'](this['data']['lev']['min'],this[_0x299083(0x278)]['lev']['max']),_0x4987b8[0x4*_0x42825d+0x3]=0x0;}return _0x4987b8;}['destroyParticlesTextures'](){Object['keys'](this['particlesTextures'])['forEach'](_0x19a02b=>{const _0x1b43f6=_0x307d;this[_0x1b43f6(0x20c)][_0x19a02b]['destroy']();});}['createComputingPrimitives'](_0x5dd345,_0x20db57,_0x3571ab){const _0x5ef5a4=_0x5ed415,_0x3ca4e1=new Cesium$3[(_0x5ef5a4(0x1ed))](_0x5dd345['dimensions'][_0x5ef5a4(0x23f)],_0x5dd345['dimensions']['lat'],_0x5dd345['dimensions']['lev']),_0x42aca8=new Cesium$3['Cartesian3'](_0x5dd345['lon']['min'],_0x5dd345['lat'][_0x5ef5a4(0x283)],_0x5dd345['lev']['min']),_0x13a045=new Cesium$3[(_0x5ef5a4(0x1ed))](_0x5dd345[_0x5ef5a4(0x23f)][_0x5ef5a4(0x276)],_0x5dd345['lat']['max'],_0x5dd345['lev']['max']),_0x5b5c5f=new Cesium$3[(_0x5ef5a4(0x1ed))]((_0x13a045['x']-_0x42aca8['x'])/(_0x3ca4e1['x']-0x1),(_0x13a045['y']-_0x42aca8['y'])/(_0x3ca4e1['y']-0x1),_0x3ca4e1['z']>0x1?(_0x13a045['z']-_0x42aca8['z'])/(_0x3ca4e1['z']-0x1):0x1),_0x2ad0b0=new Cesium$3[(_0x5ef5a4(0x232))](_0x5dd345['U'][_0x5ef5a4(0x283)],_0x5dd345['U'][_0x5ef5a4(0x276)]),_0x71029a=new Cesium$3[(_0x5ef5a4(0x232))](_0x5dd345['V']['min'],_0x5dd345['V']['max']),_0x1499e8=this;this['primitives']={'getWind':new CustomPrimitive({'commandType':'Compute','uniformMap':{'U':function(){const _0x3c70f1=_0x5ef5a4;return _0x1499e8[_0x3c70f1(0x20e)]['U'];},'V':function(){return _0x1499e8['windTextures']['V'];},'currentParticlesPosition':function(){const _0x4bda42=_0x5ef5a4;return _0x1499e8['particlesTextures'][_0x4bda42(0x233)];},'dimension':function(){return _0x3ca4e1;},'minimum':function(){return _0x42aca8;},'maximum':function(){return _0x13a045;},'interval':function(){return _0x5b5c5f;}},'fragmentShaderSource':new Cesium$3[(_0x5ef5a4(0x215))]({'sources':[getWind_frag]}),'outputTexture':this['particlesTextures']['particlesWind'],'preExecute':function(){const _0x364561=_0x5ef5a4;_0x1499e8[_0x364561(0x26a)][_0x364561(0x285)]['commandToExecute']['outputTexture']=_0x1499e8[_0x364561(0x20c)]['particlesWind'];}}),'updateSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesSpeed':function(){const _0x30ace6=_0x5ef5a4;return _0x1499e8['particlesTextures'][_0x30ace6(0x1ba)];},'particlesWind':function(){const _0x5aee34=_0x5ef5a4;return _0x1499e8[_0x5aee34(0x20c)]['particlesWind'];},'uSpeedRange':function(){return _0x2ad0b0;},'vSpeedRange':function(){return _0x71029a;},'pixelSize':function(){return _0x3571ab['pixelSize'];},'speedFactor':function(){return _0x20db57['speedFactor'];}},'fragmentShaderSource':new Cesium$3[(_0x5ef5a4(0x215))]({'sources':[updateSpeed_frag]}),'outputTexture':this['particlesTextures']['nextParticlesSpeed'],'preExecute':function(){const _0x31f1c2=_0x5ef5a4,_0x5578be=_0x1499e8['particlesTextures'][_0x31f1c2(0x1ba)];_0x1499e8[_0x31f1c2(0x20c)]['currentParticlesSpeed']=_0x1499e8[_0x31f1c2(0x20c)]['postProcessingSpeed'],_0x1499e8['particlesTextures']['postProcessingSpeed']=_0x5578be,_0x1499e8[_0x31f1c2(0x26a)][_0x31f1c2(0x228)]['commandToExecute']['outputTexture']=_0x1499e8['particlesTextures']['nextParticlesSpeed'];}}),'updatePosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesPosition':function(){return _0x1499e8['particlesTextures']['currentParticlesPosition'];},'currentParticlesSpeed':function(){return _0x1499e8['particlesTextures']['currentParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updatePosition_frag]}),'outputTexture':this[_0x5ef5a4(0x20c)]['nextParticlesPosition'],'preExecute':function(){const _0x1f6059=_0x5ef5a4,_0x3292f1=_0x1499e8['particlesTextures']['currentParticlesPosition'];_0x1499e8['particlesTextures']['currentParticlesPosition']=_0x1499e8['particlesTextures'][_0x1f6059(0x1d9)],_0x1499e8['particlesTextures']['postProcessingPosition']=_0x3292f1,_0x1499e8['primitives'][_0x1f6059(0x1f5)]['commandToExecute']['outputTexture']=_0x1499e8['particlesTextures']['nextParticlesPosition'];}}),'postProcessingPosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'nextParticlesPosition':function(){return _0x1499e8['particlesTextures']['nextParticlesPosition'];},'nextParticlesSpeed':function(){const _0xa57248=_0x5ef5a4;return _0x1499e8['particlesTextures'][_0xa57248(0x261)];},'lonRange':function(){return _0x3571ab['lonRange'];},'latRange':function(){return _0x3571ab['latRange'];},'randomCoefficient':function(){const _0x71ddef=Math['random']();return _0x71ddef;},'dropRate':function(){return _0x20db57['dropRate'];},'dropRateBump':function(){return _0x20db57['dropRateBump'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[postProcessingPosition_frag]}),'outputTexture':this['particlesTextures']['postProcessingPosition'],'preExecute':function(){const _0x29e33f=_0x5ef5a4;_0x1499e8[_0x29e33f(0x26a)]['postProcessingPosition']['commandToExecute']['outputTexture']=_0x1499e8['particlesTextures']['postProcessingPosition'];}}),'postProcessingSpeed':new CustomPrimitive({'commandType':_0x5ef5a4(0x1b9),'uniformMap':{'postProcessingPosition':function(){return _0x1499e8['particlesTextures']['postProcessingPosition'];},'nextParticlesSpeed':function(){const _0x147e55=_0x5ef5a4;return _0x1499e8[_0x147e55(0x20c)]['nextParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[postProcessingSpeed_frag]}),'outputTexture':this[_0x5ef5a4(0x20c)][_0x5ef5a4(0x243)],'preExecute':function(){const _0x59099a=_0x5ef5a4;_0x1499e8[_0x59099a(0x26a)]['postProcessingSpeed']['commandToExecute'][_0x59099a(0x25d)]=_0x1499e8['particlesTextures'][_0x59099a(0x243)];}})};}}const Cesium$2=mars3d__namespace['Cesium'];class ParticleSystem{constructor(_0x2812b6,_0x545ed8,_0x13a3d0,_0x58f797){const _0x47d68e=_0x5ed415;this['context']=_0x2812b6,_0x545ed8={..._0x545ed8},_0x545ed8['udata']&&_0x545ed8['vdata']&&(_0x545ed8['dimensions']={},_0x545ed8['dimensions']['lon']=_0x545ed8['cols'],_0x545ed8['dimensions'][_0x47d68e(0x242)]=_0x545ed8['rows'],_0x545ed8['dimensions']['lev']=_0x545ed8['lev']||0x1,_0x545ed8['lon']={},_0x545ed8['lon']['min']=_0x545ed8['xmin'],_0x545ed8[_0x47d68e(0x23f)]['max']=_0x545ed8[_0x47d68e(0x26c)],_0x545ed8['lat']={},_0x545ed8['lat']['min']=_0x545ed8['ymin'],_0x545ed8['lat'][_0x47d68e(0x276)]=_0x545ed8[_0x47d68e(0x1e6)],_0x545ed8['lev']={},_0x545ed8['lev']['min']=_0x545ed8[_0x47d68e(0x294)]??0x1,_0x545ed8[_0x47d68e(0x250)]['max']=_0x545ed8[_0x47d68e(0x1c4)]??0x1,_0x545ed8['U']={},_0x545ed8['U']['array']=new Float32Array(_0x545ed8['udata']),_0x545ed8['U'][_0x47d68e(0x283)]=_0x545ed8['umin']??Math['min'](..._0x545ed8['udata']),_0x545ed8['U']['max']=_0x545ed8['umax']??Math['max'](..._0x545ed8['udata']),_0x545ed8['V']={},_0x545ed8['V'][_0x47d68e(0x255)]=new Float32Array(_0x545ed8['vdata']),_0x545ed8['V'][_0x47d68e(0x283)]=_0x545ed8['vmin']??Math['min'](..._0x545ed8['vdata']),_0x545ed8['V']['max']=_0x545ed8[_0x47d68e(0x20b)]??Math['max'](..._0x545ed8['vdata'])),this['data']=_0x545ed8,this['options']=_0x13a3d0,this['viewerParameters']=_0x58f797,this[_0x47d68e(0x262)]=new ParticlesComputing(this[_0x47d68e(0x28e)],this['data'],this[_0x47d68e(0x236)],this['viewerParameters']),this[_0x47d68e(0x205)]=new ParticlesRendering(this['context'],this['data'],this['options'],this['viewerParameters'],this['particlesComputing']);}[_0x5ed415(0x1da)](_0x1680f7){const _0x1955cc=_0x5ed415;this['particlesComputing']['destroyParticlesTextures'](),Object['keys'](this['particlesComputing'][_0x1955cc(0x20e)])[_0x1955cc(0x269)](_0x221f50=>{this['particlesComputing']['windTextures'][_0x221f50]['destroy']();}),this['particlesRendering'][_0x1955cc(0x213)]['colorTable'][_0x1955cc(0x26e)](),Object[_0x1955cc(0x1de)](this['particlesRendering']['framebuffers'])['forEach'](_0xc7373b=>{const _0x13ce3c=_0x1955cc;this['particlesRendering'][_0x13ce3c(0x254)][_0xc7373b]['destroy']();}),this['context']=_0x1680f7,this[_0x1955cc(0x262)]=new ParticlesComputing(this['context'],this['data'],this['options'],this['viewerParameters']),this['particlesRendering']=new ParticlesRendering(this['context'],this['data'],this['options'],this[_0x1955cc(0x225)],this['particlesComputing']);}[_0x5ed415(0x28f)](){const _0x5360a6=_0x5ed415,_0x1a0a61=new Cesium$2[(_0x5360a6(0x296))]({'color':new Cesium$2['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':undefined,'pass':Cesium$2[_0x5360a6(0x207)]['OPAQUE']});Object['keys'](this['particlesRendering']['framebuffers'])['forEach'](_0x393949=>{const _0x27b294=_0x5360a6;_0x1a0a61[_0x27b294(0x1c2)]=this['particlesRendering']['framebuffers'][_0x393949],_0x1a0a61['execute'](this['context']);});}['refreshParticles'](_0x127fa3){const _0x2501b5=_0x5ed415;this['clearFramebuffers'](),this['particlesComputing']['destroyParticlesTextures'](),this[_0x2501b5(0x262)][_0x2501b5(0x1f8)](this[_0x2501b5(0x28e)],this['options'],this['viewerParameters']);if(_0x127fa3){var _0x1b0d83,_0x30e1bf;const _0xdb245b=this['particlesRendering']['createSegmentsGeometry'](this['options']);this['particlesRendering']['primitives']['segments'][_0x2501b5(0x19d)]=_0xdb245b;const _0x2a3586=Cesium$2['VertexArray'][_0x2501b5(0x1b2)]({'context':this['context'],'geometry':_0xdb245b,'attributeLocations':this[_0x2501b5(0x205)][_0x2501b5(0x26a)][_0x2501b5(0x1e8)]['attributeLocations'],'bufferUsage':Cesium$2['BufferUsage'][_0x2501b5(0x19c)]});(_0x1b0d83=this[_0x2501b5(0x205)]['primitives'])!==null&&_0x1b0d83!==void 0x0&&(_0x30e1bf=_0x1b0d83['segments'])!==null&&_0x30e1bf!==void 0x0&&_0x30e1bf[_0x2501b5(0x1f7)]&&(this['particlesRendering']['primitives'][_0x2501b5(0x1e8)][_0x2501b5(0x1f7)][_0x2501b5(0x1fe)]=_0x2a3586);}}[_0x5ed415(0x1cb)](_0x54a46b){const _0x18e043=_0x5ed415;let _0x3b4642=![];this['options']['maxParticles']!==_0x54a46b['maxParticles']&&(_0x3b4642=!![]),Object[_0x18e043(0x1de)](_0x54a46b)['forEach'](_0x579e5c=>{this['options'][_0x579e5c]=_0x54a46b[_0x579e5c];}),this['refreshParticles'](_0x3b4642);}['applyViewerParameters'](_0x1f39ab){const _0x20ed66=_0x5ed415;Object[_0x20ed66(0x1de)](_0x1f39ab)['forEach'](_0x99fc14=>{this['viewerParameters'][_0x99fc14]=_0x1f39ab[_0x99fc14];}),this['refreshParticles'](![]);}[_0x5ed415(0x26e)](){const _0x17f48c=_0x5ed415;clearTimeout(this[_0x17f48c(0x1cd)]),this['particlesComputing']['destroyParticlesTextures'](),Object[_0x17f48c(0x1de)](this[_0x17f48c(0x262)]['windTextures'])['forEach'](_0xbf4a7e=>{const _0x518dc3=_0x17f48c;this['particlesComputing'][_0x518dc3(0x20e)][_0xbf4a7e]['destroy']();}),this[_0x17f48c(0x205)]['textures']['colorTable']['destroy'](),Object['keys'](this['particlesRendering'][_0x17f48c(0x254)])['forEach'](_0xadff6b=>{const _0x390f8f=_0x17f48c;this['particlesRendering']['framebuffers'][_0xadff6b][_0x390f8f(0x26e)]();});for(const _0x144f2c in this){delete this[_0x144f2c];}}}const Cesium$1=mars3d__namespace[_0x5ed415(0x1ce)],BaseLayer$1=mars3d__namespace['layer']['BaseLayer'],DEF_OPTIONS={'particlesNumber':0x1000,'fixedHeight':0x0,'fadeOpacity':0.996,'dropRate':0.003,'dropRateBump':0.01,'speedFactor':0.5,'lineWidth':0x2,'colors':['rgb(206,255,255)']};class WindLayer extends BaseLayer$1{constructor(_0x557c30={}){_0x557c30={...DEF_OPTIONS,..._0x557c30},super(_0x557c30),this['_setOptionsHook'](_0x557c30);}get[_0x5ed415(0x28c)](){return this['primitives'];}get['data'](){return this['_data'];}set['data'](_0x1ced6e){this['setData'](_0x1ced6e);}get['colors'](){return this['options']['colors'];}set['colors'](_0x245eff){const _0x4b0150=_0x5ed415;this['options']['colors']=_0x245eff,this['particleSystem']&&this['particleSystem'][_0x4b0150(0x1cb)]({'colors':_0x245eff}),this['resize']();}[_0x5ed415(0x26b)](){}['_addedHook'](){const _0x55f14c=_0x5ed415;this['scene']=this['_map']['scene'],this['camera']=this['_map'][_0x55f14c(0x1c1)],this['primitives']=new Cesium$1['PrimitiveCollection'](),this['_map']['scene']['primitives']['add'](this['primitives']),this['viewerParameters']={'lonRange':new Cesium$1[(_0x55f14c(0x232))](),'latRange':new Cesium$1[(_0x55f14c(0x232))](),'pixelSize':0x0},this[_0x55f14c(0x1d1)]=new Cesium$1['BoundingSphere'](Cesium$1[_0x55f14c(0x1ed)]['ZERO'],0.99*0x615299),this[_0x55f14c(0x277)](),window[_0x55f14c(0x1f6)]('resize',this['resize'][_0x55f14c(0x21a)](this),![]),this['mouse_down']=![],this[_0x55f14c(0x1a2)]=![],this['_map']['on'](mars3d__namespace[_0x55f14c(0x263)]['wheel'],this['_onMapWhellEvent'],this),this['_map']['on'](mars3d__namespace[_0x55f14c(0x263)]['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['on'](mars3d__namespace['EventType'][_0x55f14c(0x22a)],this[_0x55f14c(0x1f0)],this),this[_0x55f14c(0x1bc)]['on'](mars3d__namespace[_0x55f14c(0x263)]['mouseMove'],this[_0x55f14c(0x21e)],this),this['_data']&&this['setData'](this['_data']);}['_removedHook'](){const _0x585354=_0x5ed415;window['removeEventListener']('resize',this['resize']),this[_0x585354(0x1bc)]['off'](mars3d__namespace['EventType'][_0x585354(0x198)],this[_0x585354(0x24e)],this),this['_map']['off'](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this['_map'][_0x585354(0x1a8)](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['off'](mars3d__namespace['EventType']['mouseUp'],this[_0x585354(0x1f0)],this),this['_map']['off'](mars3d__namespace['EventType']['mouseMove'],this[_0x585354(0x21e)],this),this['primitives']['removeAll'](),this['_map']['scene']['primitives'][_0x585354(0x273)](this['primitives']);}['resize'](){const _0x40a312=_0x5ed415;if(!this['show']||!this[_0x40a312(0x1b7)])return;this[_0x40a312(0x26a)]['show']=![],this['primitives'][_0x40a312(0x246)](),this['_map'][_0x40a312(0x1b6)](mars3d__namespace['EventType']['preRender'],this[_0x40a312(0x24e)],this);}['_onMap_preRenderEvent'](_0x317cb6){const _0x12aeb8=_0x5ed415;this['particleSystem'][_0x12aeb8(0x1da)](this['scene'][_0x12aeb8(0x28e)]),this[_0x12aeb8(0x260)](),this['primitives']['show']=!![];}['_onMapWhellEvent'](_0x3eb222){clearTimeout(this['refreshTimer']);if(!this['show']||!this['particleSystem'])return;this['primitives']['show']=![],this['refreshTimer']=setTimeout(()=>{const _0x283785=_0x307d;if(!this['show'])return;this[_0x283785(0x25f)]();},0xc8);}['_onMouseDownEvent'](_0x34b70b){this['mouse_down']=!![];}[_0x5ed415(0x21e)](_0x590607){const _0x26c972=_0x5ed415;if(!this['show']||!this[_0x26c972(0x1b7)])return;this['mouse_down']&&(this['primitives']['show']=![],this[_0x26c972(0x1a2)]=!![]);}['_onMouseUpEvent'](_0x263ec7){const _0x550fb0=_0x5ed415;if(!this[_0x550fb0(0x1c5)]||!this[_0x550fb0(0x1b7)])return;this['mouse_down']&&this[_0x550fb0(0x1a2)]&&this['redraw'](),this['primitives']['show']=!![],this['mouse_down']=![],this['mouse_move']=![];}['redraw'](){const _0x2afb3c=_0x5ed415;if(!this['_map']||!this['show'])return;this['updateViewerParameters'](),this[_0x2afb3c(0x1b7)]['applyViewerParameters'](this[_0x2afb3c(0x225)]),this['primitives'][_0x2afb3c(0x1c5)]=!![];}['setData'](_0xb421df){const _0xb6fb71=_0x5ed415;this['_data']=_0xb421df,this['particleSystem']&&this['particleSystem']['destroy'](),this[_0xb6fb71(0x1b7)]=new ParticleSystem(this['scene']['context'],_0xb421df,this['getOptions'](),this[_0xb6fb71(0x225)]),this[_0xb6fb71(0x260)]();}['_setOptionsHook'](_0x3fae8b,_0x46249e){const _0x22650f=_0x5ed415;if(_0x3fae8b)for(const _0x11e11f in _0x3fae8b){this[_0x11e11f]=_0x3fae8b[_0x11e11f];}this['particleSystem']&&this['particleSystem']['setOptions'](this[_0x22650f(0x1ea)]());}[_0x5ed415(0x1ea)](){const _0xa976a6=_0x5ed415,_0x24d468=Math['ceil'](Math['sqrt'](this['particlesNumber']));return this['particlesNumber']=_0x24d468*_0x24d468,{'particlesTextureSize':_0x24d468,'maxParticles':this[_0xa976a6(0x22f)],'particleHeight':this['fixedHeight'],'fadeOpacity':this['fadeOpacity'],'dropRate':this['dropRate'],'dropRateBump':this[_0xa976a6(0x286)],'speedFactor':this['speedFactor'],'lineWidth':this['lineWidth'],'colors':this[_0xa976a6(0x206)]};}[_0x5ed415(0x260)](){const _0x5e4e5e=_0x5ed415;this['primitives'][_0x5e4e5e(0x229)](this['particleSystem'][_0x5e4e5e(0x262)]['primitives'][_0x5e4e5e(0x285)]),this['primitives']['add'](this['particleSystem'][_0x5e4e5e(0x262)]['primitives']['updateSpeed']),this[_0x5e4e5e(0x26a)][_0x5e4e5e(0x229)](this['particleSystem']['particlesComputing'][_0x5e4e5e(0x26a)][_0x5e4e5e(0x1f5)]),this[_0x5e4e5e(0x26a)][_0x5e4e5e(0x229)](this[_0x5e4e5e(0x1b7)]['particlesComputing'][_0x5e4e5e(0x26a)]['postProcessingPosition']),this['primitives'][_0x5e4e5e(0x229)](this[_0x5e4e5e(0x1b7)][_0x5e4e5e(0x262)]['primitives'][_0x5e4e5e(0x243)]),this['primitives']['add'](this['particleSystem']['particlesRendering']['primitives'][_0x5e4e5e(0x1e8)]),this[_0x5e4e5e(0x26a)][_0x5e4e5e(0x229)](this['particleSystem']['particlesRendering']['primitives']['trails']),this['primitives'][_0x5e4e5e(0x229)](this['particleSystem'][_0x5e4e5e(0x205)]['primitives']['screen']);}['updateViewerParameters'](){const _0x1197d3=_0x5ed415;let _0x3a6d5b=this[_0x1197d3(0x1c1)]['computeViewRectangle'](this['scene']['globe']['ellipsoid']);if(!_0x3a6d5b){const _0x233c74=this[_0x1197d3(0x1bc)][_0x1197d3(0x23a)]();_0x3a6d5b=Cesium$1['Rectangle']['fromDegrees'](_0x233c74['xmin'],_0x233c74[_0x1197d3(0x26d)],_0x233c74['xmax'],_0x233c74[_0x1197d3(0x1e6)]);}const _0x31bc6f=Util[_0x1197d3(0x281)](_0x3a6d5b);this['viewerParameters']['lonRange']['x']=_0x31bc6f['lon']['min'],this['viewerParameters']['lonRange']['y']=_0x31bc6f['lon']['max'],this[_0x1197d3(0x225)]['latRange']['x']=_0x31bc6f['lat']['min'],this['viewerParameters']['latRange']['y']=_0x31bc6f['lat']['max'];const _0x4a6391=this['camera']['getPixelSize'](this['globeBoundingSphere'],this['scene']['drawingBufferWidth'],this['scene']['drawingBufferHeight']);_0x4a6391>0x0&&(this['viewerParameters'][_0x1197d3(0x27f)]=_0x4a6391);}}mars3d__namespace[_0x5ed415(0x1c8)]['register']('wind',WindLayer),mars3d__namespace['layer']['WindLayer']=WindLayer;class CanvasParticle{constructor(){const _0x53d6e0=_0x5ed415;this[_0x53d6e0(0x259)]=null,this['lat']=null,this['tlng']=null,this[_0x53d6e0(0x1f3)]=null,this[_0x53d6e0(0x22b)]=null,this[_0x53d6e0(0x235)]=null;}['destroy'](){for(const _0x11f12d in this){delete this[_0x11f12d];}}}class CanvasWindField{constructor(_0x5508e1){this['setOptions'](_0x5508e1);}get['speedRate'](){return this['_speedRate'];}set['speedRate'](_0x5c56d3){const _0x25aa1c=_0x5ed415;this['_speedRate']=(0x64-(_0x5c56d3>0x63?0x63:_0x5c56d3))*0x64,this['_calc_speedRate']=[(this['xmax']-this['xmin'])/this['_speedRate'],(this[_0x25aa1c(0x1e6)]-this['ymin'])/this[_0x25aa1c(0x284)]];}get['maxAge'](){const _0x3e9325=_0x5ed415;return this[_0x3e9325(0x21b)];}set['maxAge'](_0x3d2fd9){const _0x2db06c=_0x5ed415;this[_0x2db06c(0x21b)]=_0x3d2fd9;}[_0x5ed415(0x1cb)](_0x83073a){const _0x455e06=_0x5ed415;this[_0x455e06(0x236)]=_0x83073a,this[_0x455e06(0x1aa)]=_0x83073a['maxAge']||0x78,this['speedRate']=_0x83073a[_0x455e06(0x221)]||0x32,this['particles']=[];const _0x4f1e99=_0x83073a['particlesNumber']||0x1000;for(let _0x3c8fa4=0x0;_0x3c8fa4<_0x4f1e99;_0x3c8fa4++){const _0x201277=this[_0x455e06(0x220)](new CanvasParticle());this['particles'][_0x455e06(0x1a6)](_0x201277);}}['setDate'](_0x436d81){const _0x5ad19a=_0x5ed415;this[_0x5ad19a(0x1b4)]=_0x436d81['rows'],this['cols']=_0x436d81['cols'],this['xmin']=_0x436d81[_0x5ad19a(0x1e0)],this['xmax']=_0x436d81['xmax'],this['ymin']=_0x436d81[_0x5ad19a(0x26d)],this['ymax']=_0x436d81[_0x5ad19a(0x1e6)],this['grid']=[];const _0x41ef89=_0x436d81['udata'],_0x2673f6=_0x436d81['vdata'];let _0x23d6c0=![];_0x41ef89['length']===this['rows']&&_0x41ef89[0x0][_0x5ad19a(0x256)]===this['cols']&&(_0x23d6c0=!![]);let _0x5e0548=0x0,_0x592df7=null,_0x4f1156=null;for(let _0x3766ba=0x0;_0x3766ba<this['rows'];_0x3766ba++){_0x592df7=[];for(let _0x1c3300=0x0;_0x1c3300<this['cols'];_0x1c3300++,_0x5e0548++){_0x23d6c0?_0x4f1156=this['_calcUV'](_0x41ef89[_0x3766ba][_0x1c3300],_0x2673f6[_0x3766ba][_0x1c3300]):_0x4f1156=this['_calcUV'](_0x41ef89[_0x5e0548],_0x2673f6[_0x5e0548]),_0x592df7['push'](_0x4f1156);}this[_0x5ad19a(0x270)]['push'](_0x592df7);}this['options']['reverseY']&&this['grid'][_0x5ad19a(0x1ff)]();}['clear'](){const _0x38e901=_0x5ed415;delete this['rows'],delete this['cols'],delete this['xmin'],delete this['xmax'],delete this['ymin'],delete this['ymax'],delete this[_0x38e901(0x270)],delete this['particles'];}['toGridXY'](_0x31fb6b,_0x26c10e){const _0x3508eb=_0x5ed415,_0x11e571=(_0x31fb6b-this['xmin'])/(this[_0x3508eb(0x26c)]-this['xmin'])*(this[_0x3508eb(0x1c9)]-0x1),_0x426276=(this['ymax']-_0x26c10e)/(this['ymax']-this['ymin'])*(this['rows']-0x1);return[_0x11e571,_0x426276];}[_0x5ed415(0x23b)](_0x304783,_0x2ca365){const _0x52b760=_0x5ed415;if(_0x304783<0x0||_0x304783>=this['cols']||_0x2ca365>=this['rows'])return[0x0,0x0,0x0];const _0x39522c=Math[_0x52b760(0x1b5)](_0x304783),_0x3d4df8=Math['floor'](_0x2ca365);if(_0x39522c===_0x304783&&_0x3d4df8===_0x2ca365)return this['grid'][_0x2ca365][_0x304783];const _0x50783d=_0x39522c+0x1,_0x577bf3=_0x3d4df8+0x1,_0x1ff890=this[_0x52b760(0x23b)](_0x39522c,_0x3d4df8),_0x4a36fd=this[_0x52b760(0x23b)](_0x50783d,_0x3d4df8),_0x5f517c=this['getUVByXY'](_0x39522c,_0x577bf3),_0x5aeaa9=this[_0x52b760(0x23b)](_0x50783d,_0x577bf3);let _0x1ef52f=null;try{_0x1ef52f=this[_0x52b760(0x1bd)](_0x304783-_0x39522c,_0x2ca365-_0x3d4df8,_0x1ff890,_0x4a36fd,_0x5f517c,_0x5aeaa9);}catch(_0x20385a){console['log'](_0x304783,_0x2ca365);}return _0x1ef52f;}['_bilinearInterpolation'](_0x4c8ffd,_0x2905ba,_0x142684,_0x184bfa,_0x392f16,_0x567116){const _0x2bf035=_0x5ed415,_0xfa648e=0x1-_0x4c8ffd,_0x42b055=0x1-_0x2905ba,_0x1b49d7=_0xfa648e*_0x42b055,_0x4beea0=_0x4c8ffd*_0x42b055,_0x3234c0=_0xfa648e*_0x2905ba,_0xf9a78=_0x4c8ffd*_0x2905ba,_0x24c845=_0x142684[0x0]*_0x1b49d7+_0x184bfa[0x0]*_0x4beea0+_0x392f16[0x0]*_0x3234c0+_0x567116[0x0]*_0xf9a78,_0x50159e=_0x142684[0x1]*_0x1b49d7+_0x184bfa[0x1]*_0x4beea0+_0x392f16[0x1]*_0x3234c0+_0x567116[0x1]*_0xf9a78;return this[_0x2bf035(0x19b)](_0x24c845,_0x50159e);}['_calcUV'](_0x4521dc,_0x1771ce){return[+_0x4521dc,+_0x1771ce,Math['sqrt'](_0x4521dc*_0x4521dc+_0x1771ce*_0x1771ce)];}['getUVByPoint'](_0x53b7d4,_0x174621){if(!this['isInExtent'](_0x53b7d4,_0x174621))return null;const _0xb10bd2=this['toGridXY'](_0x53b7d4,_0x174621),_0x1ba65f=this['getUVByXY'](_0xb10bd2[0x0],_0xb10bd2[0x1]);return _0x1ba65f;}['isInExtent'](_0x42d39c,_0x27c6ec){const _0x322d60=_0x5ed415;return _0x42d39c>=this[_0x322d60(0x1e0)]&&_0x42d39c<=this['xmax']&&_0x27c6ec>=this['ymin']&&_0x27c6ec<=this[_0x322d60(0x1e6)]?!![]:![];}['getRandomLatLng'](){const _0x416eac=_0x5ed415,_0x2d9aa4=fRandomByfloat(this[_0x416eac(0x1e0)],this['xmax']),_0x566198=fRandomByfloat(this[_0x416eac(0x26d)],this['ymax']);return{'lat':_0x566198,'lng':_0x2d9aa4};}[_0x5ed415(0x27b)](){const _0x41a206=_0x5ed415;let _0x5964bd,_0x11fd7d,_0x128f64;for(let _0x4c50b6=0x0,_0x46dc6c=this[_0x41a206(0x1ee)][_0x41a206(0x256)];_0x4c50b6<_0x46dc6c;_0x4c50b6++){let _0x484dea=this[_0x41a206(0x1ee)][_0x4c50b6];_0x484dea['age']<=0x0&&(_0x484dea=this[_0x41a206(0x220)](_0x484dea));if(_0x484dea[_0x41a206(0x22b)]>0x0){const _0x20ca41=_0x484dea[_0x41a206(0x1e4)],_0x1ebeed=_0x484dea['tlat'];_0x128f64=this[_0x41a206(0x245)](_0x20ca41,_0x1ebeed),_0x128f64?(_0x5964bd=_0x20ca41+this['_calc_speedRate'][0x0]*_0x128f64[0x0],_0x11fd7d=_0x1ebeed+this[_0x41a206(0x1a3)][0x1]*_0x128f64[0x1],_0x484dea['lng']=_0x20ca41,_0x484dea[_0x41a206(0x242)]=_0x1ebeed,_0x484dea['tlng']=_0x5964bd,_0x484dea['tlat']=_0x11fd7d,_0x484dea['speed']=_0x128f64[0x2],_0x484dea['age']--):_0x484dea['age']=0x0;}}return this['particles'];}[_0x5ed415(0x220)](_0x58a99b){const _0x1a0c96=_0x5ed415;let _0x2f4163,_0x380bbe;for(let _0x12ff65=0x0;_0x12ff65<0x1e;_0x12ff65++){_0x2f4163=this['getRandomLatLng'](),_0x380bbe=this['getUVByPoint'](_0x2f4163['lng'],_0x2f4163[_0x1a0c96(0x242)]);if(_0x380bbe&&_0x380bbe[0x2]>0x0)break;}if(!_0x380bbe)return _0x58a99b;const _0x4f84fb=_0x2f4163['lng']+this[_0x1a0c96(0x1a3)][0x0]*_0x380bbe[0x0],_0x3e71b7=_0x2f4163['lat']+this['_calc_speedRate'][0x1]*_0x380bbe[0x1];return _0x58a99b['lng']=_0x2f4163['lng'],_0x58a99b['lat']=_0x2f4163['lat'],_0x58a99b[_0x1a0c96(0x1e4)]=_0x4f84fb,_0x58a99b['tlat']=_0x3e71b7,_0x58a99b['age']=Math[_0x1a0c96(0x1f2)](Math['random']()*this['maxAge']),_0x58a99b[_0x1a0c96(0x235)]=_0x380bbe[0x2],_0x58a99b;}['destroy'](){for(const _0x504115 in this){delete this[_0x504115];}}}function fRandomByfloat(_0x4e3ca6,_0x35b6d6){return _0x4e3ca6+Math['random']()*(_0x35b6d6-_0x4e3ca6);}const Cesium=mars3d__namespace[_0x5ed415(0x1ce)],BaseLayer=mars3d__namespace[_0x5ed415(0x28c)]['BaseLayer'];class CanvasWindLayer extends BaseLayer{constructor(_0x31bdaa={}){const _0x503c3f=_0x5ed415;super(_0x31bdaa),this['_setOptionsHook'](_0x31bdaa),this[_0x503c3f(0x1db)]=null,_0x31bdaa[_0x503c3f(0x206)]&&_0x31bdaa['steps']&&(this[_0x503c3f(0x1ae)]=new mars3d__namespace['ColorRamp'](_0x31bdaa));}['_setOptionsHook'](_0x266a3d,_0x557213){const _0x4be5ab=_0x5ed415;this['frameTime']=0x3e8/(_0x266a3d['frameRate']||0xa),this['_pointerEvents']=this[_0x4be5ab(0x236)]['pointerEvents']??![],this[_0x4be5ab(0x264)]=_0x266a3d['color']||_0x4be5ab(0x28d),this[_0x4be5ab(0x23c)]=_0x266a3d[_0x4be5ab(0x23c)]||0x1,this['fixedHeight']=_0x266a3d['fixedHeight']??0x0,this['reverseY']=_0x266a3d[_0x4be5ab(0x295)]??![],this['windField']&&this[_0x4be5ab(0x1c3)]['setOptions'](_0x266a3d);}get['layer'](){return this['canvas'];}get['canvasWidth'](){return this['_map']['scene']['canvas']['clientWidth'];}get['canvasHeight'](){return this['_map']['scene']['canvas']['clientHeight'];}get['pointerEvents'](){return this['_pointerEvents'];}set[_0x5ed415(0x240)](_0x9b3b4b){const _0x55d596=_0x5ed415;this['_pointerEvents']=_0x9b3b4b;if(!this['canvas'])return;_0x9b3b4b?this['canvas']['style']['pointer-events']='all':this['canvas'][_0x55d596(0x1f1)]['pointer-events']='none';}get['particlesNumber'](){const _0x144907=_0x5ed415;return this['options'][_0x144907(0x22f)];}set[_0x5ed415(0x22f)](_0x5e175e){const _0x5090ee=_0x5ed415;this[_0x5090ee(0x236)]['particlesNumber']=_0x5e175e,clearTimeout(this['_canrefresh']),this['_canrefresh']=setTimeout(()=>{this['redraw']();},0x1f4);}get['speedRate'](){return this['options']['speedRate'];}set['speedRate'](_0x2f7aa7){const _0x3158e4=_0x5ed415;this['options']['speedRate']=_0x2f7aa7,this[_0x3158e4(0x1c3)]&&(this['windField'][_0x3158e4(0x221)]=_0x2f7aa7);}get['maxAge'](){const _0x4fadf8=_0x5ed415;return this[_0x4fadf8(0x236)]['maxAge'];}set['maxAge'](_0x33b9f7){const _0x499ca1=_0x5ed415;this['options']['maxAge']=_0x33b9f7,this['windField']&&(this['windField'][_0x499ca1(0x1aa)]=_0x33b9f7);}get['data'](){return this['windData'];}set['data'](_0x308994){this['setData'](_0x308994);}['_showHook'](_0xc82a7a){const _0x427c93=_0x5ed415;_0xc82a7a?this[_0x427c93(0x21d)]():(this[_0x427c93(0x24d)]&&(this[_0x427c93(0x236)]['data']=this['windData']),this[_0x427c93(0x212)]());}[_0x5ed415(0x26b)](){const _0x3a88af=_0x5ed415;this['options'][_0x3a88af(0x219)]?this['initWorker']():this['windField']=new CanvasWindField(this['options']);}['_addedHook'](){const _0x56d4a8=_0x5ed415;this['canvas']=this['_createCanvas'](),this['canvasContext']=this[_0x56d4a8(0x1db)][_0x56d4a8(0x1d8)]('2d',{'willReadFrequently':!![]}),this[_0x56d4a8(0x1b3)](),this['options']['data']&&this['setData'](this[_0x56d4a8(0x236)]['data']);}['_removedHook'](){const _0x3967d9=_0x5ed415;this[_0x3967d9(0x1e2)](),this['unbindEvent'](),this[_0x3967d9(0x1db)]&&(this['_map'][_0x3967d9(0x200)]['removeChild'](this['canvas']),delete this[_0x3967d9(0x1db)]);}['_createCanvas'](){const _0xefa5c1=_0x5ed415,_0x98e25d=mars3d__namespace['DomUtil']['create']('canvas','mars3d-canvasWind',this[_0xefa5c1(0x1bc)]['container']);return _0x98e25d['style'][_0xefa5c1(0x249)]=_0xefa5c1(0x241),_0x98e25d['style'][_0xefa5c1(0x239)]=_0xefa5c1(0x1ec),_0x98e25d['style']['left']=_0xefa5c1(0x1ec),_0x98e25d['style']['width']=this['_map']['scene']['canvas'][_0xefa5c1(0x27c)]+'px',_0x98e25d['style']['height']=this[_0xefa5c1(0x1bc)][_0xefa5c1(0x253)][_0xefa5c1(0x1db)]['clientHeight']+'px',_0x98e25d['style']['pointerEvents']=this['_pointerEvents']?_0xefa5c1(0x1d5):_0xefa5c1(0x1d7),_0x98e25d['style']['zIndex']=this['options']['zIndex']??0x9,_0x98e25d['width']=this[_0xefa5c1(0x1bc)]['scene']['canvas']['clientWidth'],_0x98e25d['height']=this['_map'][_0xefa5c1(0x253)]['canvas']['clientHeight'],_0x98e25d;}[_0x5ed415(0x266)](){const _0x268809=_0x5ed415;this['canvas']&&(this['canvas']['style']['width']=this['_map']['scene']['canvas'][_0x268809(0x27c)]+'px',this[_0x268809(0x1db)][_0x268809(0x1f1)]['height']=this['_map']['scene']['canvas'][_0x268809(0x209)]+'px',this[_0x268809(0x1db)]['width']=this['_map']['scene']['canvas']['clientWidth'],this['canvas']['height']=this[_0x268809(0x1bc)]['scene']['canvas'][_0x268809(0x209)]);}['bindEvent'](){const _0x74a0b1=_0x5ed415,_0x337c7f=this;let _0x987b98=Date['now']();(function _0x5e5120(){const _0x1006e9=_0x307d;_0x337c7f['animateFrame']=window['requestAnimationFrame'](_0x5e5120);if(_0x337c7f[_0x1006e9(0x1c5)]&&_0x337c7f[_0x1006e9(0x1c3)]){const _0x3ea9d0=Date['now'](),_0x56bed0=_0x3ea9d0-_0x987b98;_0x56bed0>_0x337c7f[_0x1006e9(0x1e3)]&&(_0x987b98=_0x3ea9d0-_0x56bed0%_0x337c7f['frameTime'],_0x337c7f['update']());}}(),window[_0x74a0b1(0x1f6)]('resize',this['resize']['bind'](this),![]),this['mouse_down']=![],this['mouse_move']=![],this[_0x74a0b1(0x236)][_0x74a0b1(0x1fd)]&&(this['_map']['on'](mars3d__namespace[_0x74a0b1(0x263)][_0x74a0b1(0x1bf)],this['_onMapWhellEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseDown'],this[_0x74a0b1(0x1f9)],this),this['_map']['on'](mars3d__namespace['EventType']['mouseUp'],this[_0x74a0b1(0x1f0)],this)));}['unbindEvent'](){const _0x58b7e9=_0x5ed415;window[_0x58b7e9(0x1b1)](this[_0x58b7e9(0x238)]),delete this['animateFrame'],window['removeEventListener'](_0x58b7e9(0x266),this[_0x58b7e9(0x266)]),this[_0x58b7e9(0x236)]['mouseHidden']&&(this['_map']['off'](mars3d__namespace['EventType'][_0x58b7e9(0x1bf)],this[_0x58b7e9(0x1a5)],this),this['_map']['off'](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['off'](mars3d__namespace[_0x58b7e9(0x263)]['mouseUp'],this[_0x58b7e9(0x1f0)],this),this['_map']['off'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this));}['_onMapWhellEvent'](_0x292391){const _0x4d7cbe=_0x5ed415;clearTimeout(this['refreshTimer']);if(!this['show']||!this['canvas'])return;this['canvas']['style'][_0x4d7cbe(0x25c)]='hidden',this['refreshTimer']=setTimeout(()=>{const _0x440739=_0x4d7cbe;if(!this[_0x440739(0x1c5)])return;this[_0x440739(0x25f)](),this['canvas']['style']['visibility']='visible';},0xc8);}[_0x5ed415(0x1f9)](_0x34c419){const _0x2a35e=_0x5ed415;this['mouse_down']=!![],this['_map']['off'](mars3d__namespace[_0x2a35e(0x263)]['mouseMove'],this['_onMouseMoveEvent'],this),this[_0x2a35e(0x1bc)]['on'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this);}[_0x5ed415(0x21e)](_0x5c5f74){const _0x53764d=_0x5ed415;if(!this['show']||!this['canvas'])return;this[_0x53764d(0x20d)]&&(this['canvas']['style']['visibility']='hidden',this['mouse_move']=!![]);}['_onMouseUpEvent'](_0x4f87ca){const _0x35af6a=_0x5ed415;if(!this['show']||!this[_0x35af6a(0x1db)])return;this[_0x35af6a(0x1bc)]['off'](mars3d__namespace['EventType']['mouseMove'],this[_0x35af6a(0x21e)],this),this['mouse_down']&&this['mouse_move']&&this['redraw'](),this['canvas']['style']['visibility']='visible',this[_0x35af6a(0x20d)]=![],this['mouse_move']=![];}['setData'](_0x83f680){const _0x57e130=_0x5ed415;this['clear'](),this[_0x57e130(0x24d)]=_0x83f680,this['windField']['setDate'](_0x83f680),this['redraw']();}[_0x5ed415(0x25f)](){const _0x5dcf21=_0x5ed415;if(!this['show'])return;this['windField']['setOptions'](this['options']),this[_0x5dcf21(0x282)]();}['update'](){const _0x224e58=_0x5ed415;if(this['_updateIng'])return;this['_updateIng']=!![];if(this['worker'])this[_0x224e58(0x1c3)]['update']();else{const _0x519c2d=this['windField']['getParticles']();this[_0x224e58(0x1be)](_0x519c2d);}this['_updateIng']=![];}['_drawLines'](_0x4c2e5d){const _0x1eabd8=_0x5ed415;this['canvasContext'][_0x1eabd8(0x288)]=_0x1eabd8(0x223),this['canvasContext']['fillRect'](0x0,0x0,this[_0x1eabd8(0x23d)],this['canvasHeight']),this[_0x1eabd8(0x227)]['globalCompositeOperation']=_0x1eabd8(0x24f),this['canvasContext']['globalAlpha']=0.9;const _0x4a3f5e=this[_0x1eabd8(0x1bc)]['scene']['mode']!==Cesium[_0x1eabd8(0x1d6)]['SCENE3D'],_0x3e1c8f=this['canvasWidth']*0.25;if(this['_colorRamp'])for(let _0x3da1ef=0x0,_0x3a206a=_0x4c2e5d['length'];_0x3da1ef<_0x3a206a;_0x3da1ef++){const _0x1a42de=_0x4c2e5d[_0x3da1ef],_0x59ed8d=this[_0x1eabd8(0x271)](_0x1a42de['lng'],_0x1a42de['lat'],_0x1a42de),_0x364b34=this['_tomap'](_0x1a42de[_0x1eabd8(0x1e4)],_0x1a42de[_0x1eabd8(0x1f3)],_0x1a42de);if(!_0x59ed8d||!_0x364b34)continue;if(_0x4a3f5e&&Math[_0x1eabd8(0x210)](_0x59ed8d[0x0]-_0x364b34[0x0])>=_0x3e1c8f)continue;this['canvasContext'][_0x1eabd8(0x248)](),this[_0x1eabd8(0x227)]['lineWidth']=this['lineWidth'],this[_0x1eabd8(0x227)][_0x1eabd8(0x1a9)]=this[_0x1eabd8(0x1ae)]['getColor'](_0x1a42de[_0x1eabd8(0x235)]),this['canvasContext']['moveTo'](_0x59ed8d[0x0],_0x59ed8d[0x1]),this['canvasContext']['lineTo'](_0x364b34[0x0],_0x364b34[0x1]),this['canvasContext']['stroke']();}else{this[_0x1eabd8(0x227)]['beginPath'](),this['canvasContext']['lineWidth']=this['lineWidth'],this['canvasContext']['strokeStyle']=this[_0x1eabd8(0x264)];for(let _0x3724e7=0x0,_0x25e01b=_0x4c2e5d[_0x1eabd8(0x256)];_0x3724e7<_0x25e01b;_0x3724e7++){const _0x3520e6=_0x4c2e5d[_0x3724e7],_0x52be6f=this[_0x1eabd8(0x271)](_0x3520e6['lng'],_0x3520e6['lat'],_0x3520e6),_0x35f6ea=this['_tomap'](_0x3520e6['tlng'],_0x3520e6[_0x1eabd8(0x1f3)],_0x3520e6);if(!_0x52be6f||!_0x35f6ea)continue;if(_0x4a3f5e&&Math['abs'](_0x52be6f[0x0]-_0x35f6ea[0x0])>=_0x3e1c8f)continue;this['canvasContext']['moveTo'](_0x52be6f[0x0],_0x52be6f[0x1]),this[_0x1eabd8(0x227)]['lineTo'](_0x35f6ea[0x0],_0x35f6ea[0x1]);}this['canvasContext'][_0x1eabd8(0x1df)]();}}['_tomap'](_0x43201b,_0x478dad,_0x1ce754){const _0x214835=_0x5ed415,_0x259fcb=Cesium['Cartesian3']['fromDegrees'](_0x43201b,_0x478dad,this['fixedHeight']),_0x419afe=this['_map'][_0x214835(0x253)];if(_0x419afe['mode']===Cesium['SceneMode']['SCENE3D']){const _0x2ad6f4=new Cesium[(_0x214835(0x267))](_0x419afe['globe']['ellipsoid'],_0x419afe['camera']['positionWC']),_0x17b512=_0x2ad6f4['isPointVisible'](_0x259fcb);if(!_0x17b512)return _0x1ce754['age']=0x0,null;}const _0x5c3648=Cesium['SceneTransforms']['wgs84ToWindowCoordinates'](this[_0x214835(0x1bc)][_0x214835(0x253)],_0x259fcb);return _0x5c3648?[_0x5c3648['x'],_0x5c3648['y']]:null;}['clear'](){this['windField']['clear'](),delete this['windData'];}['initWorker'](){const _0x1136d4=_0x5ed415;this[_0x1136d4(0x219)]=new Worker(this['options']['worker']),this[_0x1136d4(0x219)]['onmessage']=_0x4ee665=>{const _0x1d2c71=_0x1136d4;this[_0x1d2c71(0x1be)](_0x4ee665['data']['particles']),this['_updateIng2']=![];},this['windField']={'init':_0x492384=>{this['worker']['postMessage']({'type':'init','options':_0x492384});},'setOptions':_0x4481ba=>{const _0x4f6708=_0x1136d4;this['worker'][_0x4f6708(0x251)]({'type':'setOptions','options':_0x4481ba});},'setDate':_0x1aa229=>{const _0x288b2b=_0x1136d4;this[_0x288b2b(0x219)]['postMessage']({'type':'setDate','data':_0x1aa229});},'update':()=>{const _0x1a127c=_0x1136d4;if(this[_0x1a127c(0x1c6)])return;this['_updateIng2']=!![],this[_0x1a127c(0x219)][_0x1a127c(0x251)]({'type':'update'});},'clear':()=>{this['worker']['postMessage']({'type':'clear'});}},this['windField']['init'](this['options']);}}function _0x307d(_0x47c0dd,_0x483b1a){const _0x443bde=_0x443b();return _0x307d=function(_0x307d86,_0x575156){_0x307d86=_0x307d86-0x198;let _0x33037e=_0x443bde[_0x307d86];return _0x33037e;},_0x307d(_0x47c0dd,_0x483b1a);}mars3d__namespace[_0x5ed415(0x1c8)]['register']('canvasWind',CanvasWindLayer),mars3d__namespace['layer'][_0x5ed415(0x289)]=CanvasWindLayer,mars3d__namespace[_0x5ed415(0x247)]=CanvasWindField,mars3d__namespace['WindUtil']=WindUtil,exports['CanvasWindField']=CanvasWindField,exports[_0x5ed415(0x289)]=CanvasWindLayer,exports['WindLayer']=WindLayer,exports['WindUtil']=WindUtil,Object['defineProperty'](exports,'__esModule',{'value':!![]});
}));
